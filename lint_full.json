[{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\about\\page.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\challenges\\[day]\\page.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\challenges\\challengeData.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\challenges\\challengeDataEnriched.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\challenges\\data\\chapterContent.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\challenges\\data\\introToPythonCourse.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\challenges\\data\\module10Content.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\challenges\\data\\module10SympyContent.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\challenges\\data\\module11Content.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\challenges\\data\\module12Content.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\challenges\\data\\module13Content.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\challenges\\data\\module14Content.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\challenges\\data\\module2SuiteContent.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\challenges\\data\\module5SympyContent.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\challenges\\data\\module6SympyContent.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\challenges\\data\\module7Content.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\challenges\\data\\module8Content.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\challenges\\data\\module8SympyContent.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\challenges\\data\\module9Content.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\challenges\\data\\module9SympyContent.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\challenges\\data\\modules456Content.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\challenges\\data\\modules56SuiteContent.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\challenges\\data\\numpyMatplotlibContent.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\challenges\\masterclass\\page.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\challenges\\page.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\code\\page.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'pyodide'. Either include it or remove the dependency array.","line":428,"column":8,"nodeType":"ArrayExpression","endLine":428,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [pyodide]","fix":{"range":[23772,23774],"text":"[pyodide]"}}]}],"suppressedMessages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":246,"column":41,"nodeType":"JSXOpeningElement","endLine":246,"endColumn":115,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport RichText from '@/components/RichText';\r\nimport Editor from 'react-simple-code-editor';\r\nimport Prism from 'prismjs';\r\nimport 'prismjs/components/prism-python';\r\n\r\n// Composant pour une cellule individuelle\r\nconst NotebookCell = ({\r\n    cell,\r\n    index,\r\n    updateCell,\r\n    deleteCell,\r\n    moveCell,\r\n    runCell,\r\n    isActive,\r\n    setActive\r\n}) => {\r\n    // Editor g├¿re sa propre ref interne et hauteur\r\n\r\n    return (\r\n        <div\r\n            className={`group flex gap-2 mb-4 transition-all duration-200 ${isActive ? '' : 'opacity-90 hover:opacity-100'}`}\r\n            onClick={() => setActive(cell.id)}\r\n        >\r\n            {/* Colonne de gauche (In [ ]) */}\r\n            <div className=\"w-16 flex-shrink-0 flex flex-col items-end pt-2 gap-1 select-none\">\r\n                {cell.type === 'code' && (\r\n                    <span className={`font-mono text-xs ${cell.status === 'running' ? 'text-yellow-400' : 'text-gray-500'}`}>\r\n                        {cell.status === 'running' ? '[*]:' : `[${cell.executionCount || ' '}]:`}\r\n                    </span>\r\n                )}\r\n            </div>\r\n\r\n            {/* Contenu principal */}\r\n            <div className=\"flex-1 min-w-0 flex flex-col gap-2\">\r\n                {/* Zone d'entr├®e (Code ou Markdown) */}\r\n                <div className={`relative rounded-lg border transition-all duration-200 overflow-hidden\r\n                    ${isActive\r\n                        ? 'border-[#2DD4BF] shadow-[0_0_0_1px_rgba(0,245,212,0.3)] bg-[#0F1115]'\r\n                        : 'border-white/10 bg-[#0F1115] hover:border-white/20'\r\n                    }\r\n                `}>\r\n                    {/* Indicateur de type (petit badge) */}\r\n                    <div className=\"absolute top-0 right-0 p-1 z-10 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                        <span className=\"text-[10px] uppercase font-bold text-gray-600 bg-black/50 px-1.5 py-0.5 rounded\">\r\n                            {cell.type}\r\n                        </span>\r\n                    </div>\r\n\r\n                    <div className=\"flex\">\r\n                        {/* Marge color├®e ├®tat */}\r\n                        {cell.type === 'code' && (\r\n                            <div className={`w-1 flex-shrink-0 ${cell.status === 'running' ? 'bg-yellow-400 animate-pulse' :\r\n                                cell.status === 'success' ? 'bg-transparent' :\r\n                                    cell.status === 'error' ? 'bg-red-500' :\r\n                                        'bg-transparent'\r\n                                }`} />\r\n                        )}\r\n\r\n                        <div className=\"flex-1 p-3\">\r\n                            {cell.type === 'markdown' && !cell.isEditing ? (\r\n                                <div\r\n                                    className=\"prose prose-invert max-w-none min-h-[1.5rem] cursor-text\"\r\n                                    onDoubleClick={() => updateCell(cell.id, { isEditing: true })}\r\n                                >\r\n                                    <RichText>{cell.content || '<span class=\"text-gray-600 italic\">Double-cliquez pour ajouter du texte...</span>'}</RichText>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"relative w-full font-mono text-sm leading-relaxed bg-[#0F1115] rounded overflow-hidden\">\r\n                                    <style jsx global>{`\r\n                                        /* Prism SymLab Theme */\r\n                                        code[class*=\"language-\"], pre[class*=\"language-\"] {\r\n                                            color: #e0e0e0;\r\n                                            text-shadow: none;\r\n                                            font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;\r\n                                            line-height: 1.5;\r\n                                            direction: ltr;\r\n                                            text-align: left;\r\n                                            white-space: pre;\r\n                                            word-spacing: normal;\r\n                                            word-break: normal;\r\n                                            tab-size: 4;\r\n                                            hyphens: none;\r\n                                        }\r\n                                        .token.comment, .token.prolog, .token.doctype, .token.cdata { color: #6272a4; font-style: italic; }\r\n                                        .token.punctuation { color: #f8f8f2; }\r\n                                        .token.namespace { opacity: .7; }\r\n                                        .token.property, .token.tag, .token.constant, .token.symbol, .token.deleted { color: #ff79c6; }\r\n                                        .token.boolean, .token.number { color: #bd93f9; }\r\n                                        .token.selector, .token.attr-name, .token.string, .token.char, .token.builtin, .token.inserted { color: #f1fa8c; }\r\n                                        .token.operator, .token.entity, .token.url, .token.variable { color: #ff79c6; }\r\n                                        .token.atrule, .token.attr-value, .token.function, .token.class-name { color: #2DD4BF; font-weight: bold; }\r\n                                        .token.keyword { color: #ff79c6; font-weight: bold; }\r\n                                        .token.regex, .token.important { color: #f1fa8c; }\r\n                                        \r\n                                        /* Editor Overrides */\r\n                                        .editor-container textarea { outline: none !important; }\r\n                                    `}</style>\r\n                                    <Editor\r\n                                        value={cell.content || ''}\r\n                                        onValueChange={(code) => updateCell(cell.id, { content: code })}\r\n                                        highlight={code => {\r\n                                            if (Prism.languages.python) {\r\n                                                return Prism.highlight(code, Prism.languages.python, 'python');\r\n                                            }\r\n                                            return code;\r\n                                        }}\r\n                                        padding={10}\r\n                                        className=\"font-mono text-sm editor-container\"\r\n                                        textareaClassName=\"focus:outline-none\"\r\n                                        style={{\r\n                                            fontFamily: '\"Fira code\", \"Fira Mono\", monospace',\r\n                                            fontSize: 14,\r\n                                            backgroundColor: 'transparent',\r\n                                            minHeight: '80px',\r\n                                        }}\r\n                                        onKeyDown={(e) => {\r\n                                            const textarea = e.target;\r\n\r\n                                            // Ex├®cution : Shift + Enter\r\n                                            if (e.key === 'Enter' && e.shiftKey) {\r\n                                                e.preventDefault();\r\n                                                runCell(cell.id);\r\n                                                return;\r\n                                            }\r\n\r\n                                            // Indentation : Tab\r\n                                            if (e.key === 'Tab') {\r\n                                                e.preventDefault();\r\n                                                const start = textarea.selectionStart;\r\n                                                const end = textarea.selectionEnd;\r\n                                                const value = textarea.value;\r\n                                                const newValue = value.substring(0, start) + \"    \" + value.substring(end);\r\n                                                updateCell(cell.id, { content: newValue });\r\n                                                setTimeout(() => {\r\n                                                    textarea.selectionStart = start + 4;\r\n                                                    textarea.selectionEnd = start + 4;\r\n                                                }, 0);\r\n                                                return;\r\n                                            }\r\n\r\n                                            // Auto-close : (, [, {, \", '\r\n                                            const pairs = { '(': ')', '[': ']', '{': '}', '\"': '\"', \"'\": \"'\" };\r\n                                            if (pairs[e.key]) {\r\n                                                e.preventDefault();\r\n                                                const start = textarea.selectionStart;\r\n                                                const end = textarea.selectionEnd;\r\n                                                const value = textarea.value;\r\n                                                const char = e.key;\r\n                                                const closeChar = pairs[char];\r\n                                                const newValue = value.substring(0, start) + char + closeChar + value.substring(end);\r\n                                                updateCell(cell.id, { content: newValue });\r\n                                                setTimeout(() => {\r\n                                                    textarea.selectionStart = start + 1;\r\n                                                    textarea.selectionEnd = start + 1;\r\n                                                }, 0);\r\n                                                return;\r\n                                            }\r\n\r\n                                            // Skip closing char\r\n                                            const closeChars = [')', ']', '}', '\"', \"'\"];\r\n                                            if (closeChars.includes(e.key)) {\r\n                                                const start = textarea.selectionStart;\r\n                                                const value = textarea.value;\r\n                                                if (value[start] === e.key) {\r\n                                                    e.preventDefault();\r\n                                                    setTimeout(() => {\r\n                                                        textarea.selectionStart = start + 1;\r\n                                                        textarea.selectionEnd = start + 1;\r\n                                                    }, 0);\r\n                                                    return;\r\n                                                }\r\n                                            }\r\n\r\n                                            // Backspace sur une paire vide\r\n                                            if (e.key === 'Backspace') {\r\n                                                const start = textarea.selectionStart;\r\n                                                const value = textarea.value;\r\n                                                const prevChar = value[start - 1];\r\n                                                const nextChar = value[start];\r\n                                                const pairMap = { '(': ')', '[': ']', '{': '}', '\"': '\"', \"'\": \"'\" };\r\n\r\n                                                if (prevChar && pairMap[prevChar] === nextChar) {\r\n                                                    e.preventDefault();\r\n                                                    const newValue = value.substring(0, start - 1) + value.substring(start + 1);\r\n                                                    updateCell(cell.id, { content: newValue });\r\n                                                    setTimeout(() => {\r\n                                                        textarea.selectionStart = start - 1;\r\n                                                        textarea.selectionEnd = start - 1;\r\n                                                    }, 0);\r\n                                                    return;\r\n                                                }\r\n                                            }\r\n                                        }}\r\n                                    />\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Barre d'actions flottante */}\r\n                    <div className={`absolute top-1 right-1 flex gap-0.5 bg-[#1A1D24] rounded-md border border-white/10 shadow-xl transition-all duration-200 z-20 ${isActive ? 'opacity-100 translate-y-0' : 'opacity-0 -translate-y-2 group-hover:opacity-100 group-hover:translate-y-0'\r\n                        }`}>\r\n                        <button onClick={() => runCell(cell.id)} className=\"p-1.5 hover:bg-white/10 text-[#2DD4BF]\" title=\"Ex├®cuter (Shift+Enter)\">ÔûÂ</button>\r\n                        <div className=\"w-px bg-white/10 my-1\" />\r\n                        <button onClick={() => moveCell(index, -1)} className=\"p-1.5 hover:bg-white/10 text-gray-400 hover:text-white\">Ôåæ</button>\r\n                        <button onClick={() => moveCell(index, 1)} className=\"p-1.5 hover:bg-white/10 text-gray-400 hover:text-white\">Ôåô</button>\r\n                        <div className=\"w-px bg-white/10 my-1\" />\r\n                        <button onClick={() => deleteCell(cell.id)} className=\"p-1.5 hover:bg-white/10 text-gray-400 hover:text-red-400\">Ô£ò</button>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Zone de Sortie (Output) Am├®lior├®e pour Multi-Types */}\r\n                {cell.output && (\r\n                    <div className=\"flex flex-col gap-2 animate-in fade-in slide-in-from-top-2 duration-300 mt-2 border-t border-white/5 pt-2\">\r\n                        <div className=\"flex gap-2\">\r\n                            <div className=\"w-16 flex-shrink-0 text-right pr-3 font-mono text-xs text-red-400/50 select-none pt-1\">\r\n                                {cell.output.error ? 'Error' : `[${cell.executionCount || '?'}]`}\r\n                            </div>\r\n                            <div className={`flex-1 overflow-x-auto min-h-[1.5rem] ${cell.output.error ? 'bg-red-500/10 border-l-2 border-red-500 p-3 rounded-r text-red-400' : 'text-gray-200'}`}>\r\n\r\n                                {/* 1. Erreur */}\r\n                                {cell.output.error && (\r\n                                    <pre className=\"font-mono text-sm whitespace-pre-wrap mb-2\">{cell.output.error}</pre>\r\n                                )}\r\n\r\n                                {/* 2. Texte Standard (Stdout / Result) */}\r\n                                {cell.output.text && (\r\n                                    <pre className=\"font-mono text-sm whitespace-pre-wrap mb-2\">{cell.output.text}</pre>\r\n                                )}\r\n\r\n                                {/* 3. LaTeX */}\r\n                                {cell.output.latex && (\r\n                                    <div className=\"p-2 bg-white/5 rounded overflow-x-auto mb-2\">\r\n                                        <RichText>{`$$${cell.output.latex}$$`}</RichText>\r\n                                    </div>\r\n                                )}\r\n\r\n                                {/* 4. Image */}\r\n                                {cell.output.image && (\r\n                                    <div className=\"bg-white p-2 rounded inline-block\">\r\n                                        {/* eslint-disable-next-line @next/next/no-img-element */}\r\n                                        <img src={cell.output.image} alt=\"Output\" className=\"max-w-full h-auto\" />\r\n                                    </div>\r\n                                )}\r\n\r\n                                {/* 5. HTML (Pandas) */}\r\n                                {cell.output.html && (\r\n                                    <div className=\"overflow-x-auto pandas-output my-2\">\r\n                                        <style jsx global>{`\r\n                                            .pandas-output table.dataframe {\r\n                                                color: #e0e0e0;\r\n                                                border-collapse: collapse;\r\n                                                border: none;\r\n                                                font-size: 0.85rem;\r\n                                                font-family: monospace;\r\n                                                margin-bottom: 0.5rem;\r\n                                            }\r\n                                            .pandas-output table.dataframe th {\r\n                                                font-weight: bold;\r\n                                                background: #1A1D24;\r\n                                                color: #2DD4BF;\r\n                                                border-bottom: 1px solid rgba(0, 245, 212, 0.3);\r\n                                                padding: 0.5rem 1rem;\r\n                                                text-align: left;\r\n                                            }\r\n                                            .pandas-output table.dataframe td {\r\n                                                padding: 0.4rem 1rem;\r\n                                                border-bottom: 1px solid rgba(255, 255, 255, 0.05);\r\n                                            }\r\n                                            .pandas-output table.dataframe tr:hover td {\r\n                                                background: rgba(255, 255, 255, 0.05);\r\n                                            }\r\n                                            .pandas-output table.dataframe tr:last-child td {\r\n                                                border-bottom: none;\r\n                                            }\r\n                                        `}</style>\r\n                                        <div dangerouslySetInnerHTML={{ __html: cell.output.html }} />\r\n                                    </div>\r\n                                )}\r\n\r\n                                {/* Indicateur si vide */}\r\n                                {!cell.output.text && !cell.output.image && !cell.output.latex && !cell.output.html && !cell.output.error && (\r\n                                    <span className=\"text-gray-500 italic text-xs\">Ô£ô Ex├®cut├® (aucune sortie)</span>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default function NotebookPage() {\r\n    const [cells, setCells] = useState([\r\n        {\r\n            id: '1',\r\n            type: 'markdown',\r\n            content: '# Bienvenue dans SymLab Notebook ­ƒÉì\\n\\nEnvironnement **pr├¬t ├á l\\'emploi** avec NumPy, Pandas, Matplotlib, SymPy.\\n\\n### Raccourcis :\\n- **Shift + Enter** : Ex├®cuter\\n- **Tab** : Indenter\\n- **Auto-close** : Parenth├¿ses et guillemets',\r\n            status: 'idle',\r\n            output: null,\r\n            isEditing: false\r\n        },\r\n        {\r\n            id: '2',\r\n            type: 'code',\r\n            content: '# Exemple: Matrice NumPy et Plot\\nX = np.linspace(0, 10, 100)\\nY = np.sin(X)\\n\\nplt.figure(figsize=(10, 4))\\nplt.plot(X, Y, label=\"Sinus\", color=\"#2DD4BF\")\\nplt.title(\"Test Graphique\")\\nplt.legend()\\nplt.show()',\r\n            status: 'idle',\r\n            output: null,\r\n            executionCount: null\r\n        }\r\n    ]);\r\n    const [activeCellId, setActiveCellId] = useState(null);\r\n    const [kernelStatus, setKernelStatus] = useState('loading');\r\n    const [loadingProgress, setLoadingProgress] = useState('Initialisation...');\r\n    const [pyodide, setPyodide] = useState(null);\r\n\r\n    // Initialisation de Pyodide (SSR Protected)\r\n    useEffect(() => {\r\n        if (typeof window === 'undefined') return;\r\n\r\n        const loadPyodide = async () => {\r\n            try {\r\n                if (!window.loadPyodide) {\r\n                    const script = document.createElement('script');\r\n                    script.src = 'https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js';\r\n                    script.async = true;\r\n                    script.onload = async () => {\r\n                        setLoadingProgress('Chargement de Python...');\r\n                        const py = await window.loadPyodide();\r\n                        setLoadingProgress('Installation des packages scientifiques...');\r\n                        await py.loadPackage(['micropip', 'numpy', 'matplotlib', 'pandas', 'scipy', 'sympy', 'scikit-learn']);\r\n                        const initCode = `\r\nimport numpy as np\r\nimport pandas as pd\r\nimport matplotlib.pyplot as plt\r\nimport scipy\r\nimport sympy\r\nfrom sympy import *\r\nimport sklearn\r\nimport sys\r\nimport io\r\nimport json\r\nimport builtins\r\n\r\n# Override input() to work in browser\r\ndef _browser_input(prompt=\"\"):\r\n    import js\r\n    if prompt:\r\n        sys.stdout.write(str(prompt))\r\n        sys.stdout.flush()\r\n    result = js.prompt(str(prompt) if prompt else \"Enter input:\")\r\n    if result is None:\r\n        result = \"\"\r\n    return str(result)\r\n\r\nbuiltins.input = _browser_input\r\n\r\n# Initialize SymPy pretty printing\r\ninit_printing(use_latex='mathjax')\r\n\r\nprint(\"Ô£ô Kernel ready - NumPy, Pandas, Matplotlib, SymPy, Scikit-learn\")\r\nprint(\"Ô£ô input() function available\")\r\nprint(\"Ô£ô SymPy pretty printing enabled\")\r\n`;\r\n                        await py.runPythonAsync(initCode);\r\n                        setPyodide(py);\r\n                        setKernelStatus('ready');\r\n                    };\r\n                    document.body.appendChild(script);\r\n                } else if (!pyodide) {\r\n                    setKernelStatus('loading');\r\n                    const py = await window.loadPyodide();\r\n                    await py.loadPackage(['micropip', 'numpy', 'matplotlib', 'pandas', 'scipy', 'sympy', 'scikit-learn']);\r\n                    const initCode = `\r\nimport numpy as np\r\nimport pandas as pd\r\nimport matplotlib.pyplot as plt\r\nimport scipy\r\nimport sympy\r\nfrom sympy import *\r\nimport sklearn\r\nimport builtins\r\n\r\n# Override input() to work in browser\r\ndef _browser_input(prompt=\"\"):\r\n    import js\r\n    if prompt:\r\n        sys.stdout.write(str(prompt))\r\n        sys.stdout.flush()\r\n    result = js.prompt(str(prompt) if prompt else \"Enter input:\")\r\n    if result is None:\r\n        result = \"\"\r\n    return str(result)\r\n\r\nbuiltins.input = _browser_input\r\n\r\n# Initialize SymPy pretty printing\r\ninit_printing(use_latex='mathjax')\r\n`;\r\n                    await py.runPythonAsync(initCode);\r\n                    setPyodide(py);\r\n                    setKernelStatus('ready');\r\n                }\r\n            } catch (err) {\r\n                console.error(\"Erreur chargement Pyodide:\", err);\r\n                setKernelStatus('error');\r\n            }\r\n        };\r\n        loadPyodide();\r\n        return () => {\r\n            if (pyodide) {\r\n                try {\r\n                    pyodide.runPythonAsync(`\r\nimport matplotlib.pyplot as plt\r\nplt.close('all')\r\n`).catch(err => console.log('Cleanup error:', err));\r\n                } catch (err) {\r\n                    console.log('Cleanup error:', err);\r\n                }\r\n            }\r\n            setKernelStatus('loading');\r\n        };\r\n    }, []);\r\n\r\n    const updateCell = (id, updates) => setCells(cells.map(c => c.id === id ? { ...c, ...updates } : c));\r\n\r\n    const addCell = (index, type = 'code') => {\r\n        const newCell = {\r\n            id: Date.now().toString(),\r\n            type,\r\n            content: '',\r\n            status: 'idle',\r\n            output: null,\r\n            executionCount: null,\r\n            isEditing: true\r\n        };\r\n        const newCells = [...cells];\r\n        newCells.splice(index + 1, 0, newCell);\r\n        setCells(newCells);\r\n        setActiveCellId(newCell.id);\r\n    };\r\n\r\n    const deleteCell = (id) => {\r\n        if (cells.length > 1) setCells(cells.filter(c => c.id !== id));\r\n    };\r\n\r\n    const moveCell = (index, direction) => {\r\n        if (index + direction >= 0 && index + direction < cells.length) {\r\n            const newCells = [...cells];\r\n            const temp = newCells[index];\r\n            newCells[index] = newCells[index + direction];\r\n            newCells[index + direction] = temp;\r\n            setCells(newCells);\r\n        }\r\n    };\r\n\r\n    const restartKernel = async () => {\r\n        setKernelStatus('loading');\r\n        if (pyodide) {\r\n            await pyodide.runPythonAsync(`\r\nimport builtins\r\nimport sys\r\n\r\n# Clear globals but preserve our custom input\r\nglobals().clear()\r\n\r\nimport numpy as np\r\nimport pandas as pd\r\nimport matplotlib.pyplot as plt\r\nimport scipy\r\nimport sympy\r\nfrom sympy import *\r\nimport sklearn\r\nimport sys\r\nimport io\r\nimport json\r\n\r\n# Override input() to work in browser\r\ndef _browser_input(prompt=\"\"):\r\n    import js\r\n    if prompt:\r\n        sys.stdout.write(str(prompt))\r\n        sys.stdout.flush()\r\n    result = js.prompt(str(prompt) if prompt else \"Enter input:\")\r\n    if result is None:\r\n        result = \"\"\r\n    return str(result)\r\n\r\nbuiltins.input = _browser_input\r\n\r\n# Initialize SymPy pretty printing\r\ninit_printing(use_latex='mathjax')\r\n`);\r\n            setCells(cells.map(c => ({ ...c, status: 'idle', output: null, executionCount: null })));\r\n            setKernelStatus('ready');\r\n        }\r\n    };\r\n\r\n    const runCell = async (id) => {\r\n        const cell = cells.find(c => c.id === id);\r\n        if (!cell || cell.type === 'markdown') {\r\n            if (cell) updateCell(id, { isEditing: false });\r\n            return;\r\n        }\r\n\r\n        if (!pyodide) return alert(\"Kernel en chargement...\");\r\n\r\n        updateCell(id, { status: 'running' });\r\n        setKernelStatus('busy');\r\n\r\n        try {\r\n            const pythonCode = `\r\nimport sys\r\nimport io\r\nimport json\r\nimport base64\r\nimport matplotlib.pyplot as plt\r\n\r\nsys.stdout = io.StringIO()\r\nsys.stderr = io.StringIO()\r\n\r\n# Cleanup plots\r\nplt.close('all')\r\nplt.clf()\r\n\r\ncode = ${JSON.stringify(cell.content)}\r\nresult = None\r\n\r\ntry:\r\n    import ast\r\n    tree = ast.parse(code)\r\n    if not tree.body:\r\n        pass\r\n    elif isinstance(tree.body[-1], ast.Expr):\r\n        last_expr = tree.body.pop()\r\n        if tree.body:\r\n            exec(compile(tree, filename=\"<cell>\", mode=\"exec\"), globals())\r\n        result = eval(compile(ast.Expression(last_expr.value), filename=\"<cell>\", mode=\"eval\"), globals())\r\n    else:\r\n        exec(code, globals())\r\nexcept Exception as e:\r\n    import traceback\r\n    traceback.print_exc()\r\n\r\n# Capture Plot\r\nimg_str = None\r\nif plt.get_fignums() and len(plt.gcf().axes) > 0:\r\n    buf = io.BytesIO()\r\n    plt.savefig(buf, format='png', bbox_inches='tight', transparent=True, dpi=120)\r\n    buf.seek(0)\r\n    img_str = 'data:image/png;base64,' + base64.b64encode(buf.read()).decode('UTF-8')\r\n    plt.close('all')\r\n\r\n# Capture LaTeX\r\nlatex_str = None\r\nif result is not None:\r\n    try:\r\n        # Check if it's a SymPy object\r\n        if hasattr(result, '_repr_latex_'):\r\n            latex_str = result._repr_latex_()\r\n            # Remove $$ delimiters if present\r\n            if latex_str and latex_str.startswith('$$'):\r\n                latex_str = latex_str[2:-2]\r\n        elif 'sympy' in str(type(result).__module__):\r\n            # It's a SymPy object, use sympy.latex()\r\n            from sympy import latex as sympy_latex\r\n            latex_str = sympy_latex(result)\r\n        # Check for lists/tuples of SymPy objects\r\n        elif isinstance(result, (list, tuple)):\r\n            try:\r\n                from sympy import latex as sympy_latex\r\n                # Try to convert the whole structure\r\n                latex_str = sympy_latex(result)\r\n            except:\r\n                pass\r\n    except:\r\n        pass\r\n\r\n# Capture HTML (Pandas)\r\nhtml_str = None\r\nif result is not None:\r\n    if hasattr(result, '_repr_html_'):\r\n        html_str = result._repr_html_()\r\n\r\nstdout_val = sys.stdout.getvalue()\r\nstderr_val = sys.stderr.getvalue()\r\n\r\njson.dumps({\r\n    \"stdout\": stdout_val,\r\n    \"stderr\": stderr_val,\r\n    \"result\": str(result) if result is not None else None,\r\n    \"image\": img_str,\r\n    \"latex\": latex_str,\r\n    \"html\": html_str\r\n})\r\n`;\r\n            const responseStr = await pyodide.runPythonAsync(pythonCode);\r\n            const response = JSON.parse(responseStr);\r\n\r\n            // Structure de sortie multi-Champs\r\n            const out = {};\r\n\r\n            // 1. Erreur\r\n            if (response.stderr && response.stderr.includes('Traceback')) {\r\n                out.error = response.stderr;\r\n            } else if (response.stderr) {\r\n                // Warnings\r\n                out.text = (response.stdout || '') + '\\nÔÜá´©Å ' + response.stderr;\r\n            }\r\n\r\n            // 2. Texte\r\n            let text = response.stdout || '';\r\n            if (response.result && response.result !== 'None' && !response.image && !response.latex && !response.html) {\r\n                text += (text ? '\\n' : '') + `[Out]: ${response.result}`;\r\n            }\r\n            if (!out.error && text.trim()) {\r\n                out.text = (out.text || '') + text;\r\n            }\r\n\r\n            // 3. Rich Outputs\r\n            if (response.latex) out.latex = response.latex;\r\n            if (response.image) out.image = response.image;\r\n            if (response.html) out.html = response.html;\r\n\r\n            // Si aucune sortie n'est d├®tect├®e, on met null pour cacher la zone\r\n            const finalOutput = Object.keys(out).length > 0 ? out : null;\r\n\r\n            updateCell(id, {\r\n                status: 'success',\r\n                output: finalOutput,\r\n                executionCount: (cell.executionCount || 0) + 1\r\n            });\r\n\r\n        } catch (err) {\r\n            console.error(\"Exec Error:\", err);\r\n            updateCell(id, {\r\n                status: 'error',\r\n                output: { error: err.toString() }\r\n            });\r\n        } finally {\r\n            setKernelStatus('ready');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <main className=\"min-h-screen bg-black text-white flex flex-col\">\r\n            <header className=\"h-16 border-b border-white/10 flex items-center justify-between px-4 bg-[#0F1115] fixed w-full z-50\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    <Link href=\"/programming\" className=\"text-gray-400 hover:text-white transition-colors\">ÔåÉ Retour</Link>\r\n                    <div className=\"h-6 w-px bg-white/10\" />\r\n                    <h1 className=\"font-bold text-lg\">SymLab Notebook</h1>\r\n                    <span className=\"text-xs text-gray-500\">Python 3.11 (Pyodide)</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-4\">\r\n                    <div className=\"flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/5 border border-white/10\">\r\n                        <div className={`w-2 h-2 rounded-full ${kernelStatus === 'ready' ? 'bg-green-500' : kernelStatus === 'error' ? 'bg-red-500' : 'bg-yellow-500 animate-pulse'} `} />\r\n                        <span className=\"text-xs font-mono text-gray-300\">{kernelStatus === 'loading' ? loadingProgress : kernelStatus === 'busy' ? 'Run...' : 'Pr├¬t'}</span>\r\n                    </div>\r\n                    <button className=\"bg-[#2DD4BF] text-black px-4 py-1.5 rounded font-bold text-sm hover:bg-[#2DD4BF]/90 transition-colors\">Partager</button>\r\n                </div>\r\n            </header>\r\n\r\n            <div className=\"mt-16 h-12 border-b border-white/10 flex items-center px-4 gap-2 bg-[#0F1115] sticky top-16 z-40\">\r\n                <button onClick={() => addCell(cells.length - 1, 'code')} className=\"flex items-center gap-2 px-3 py-1.5 hover:bg-white/10 rounded text-gray-300 transition-colors\"><span className=\"text-[#2DD4BF] font-bold\">+</span> Code</button>\r\n                <button onClick={() => addCell(cells.length - 1, 'markdown')} className=\"flex items-center gap-2 px-3 py-1.5 hover:bg-white/10 rounded text-gray-300 transition-colors\"><span className=\"text-gray-400 font-bold\">+</span> Texte</button>\r\n                <div className=\"h-6 w-px bg-white/10 mx-2\" />\r\n                <button onClick={() => restartKernel()} className=\"p-2 hover:bg-white/10 rounded text-gray-300 transition-colors\">Ôå╗ Restart</button>\r\n            </div>\r\n\r\n            <div className=\"flex-1 overflow-y-auto p-4 md:p-8 max-w-5xl mx-auto w-full pb-32\">\r\n                {cells.map((cell, index) => (\r\n                    <div key={cell.id} className=\"group/add\">\r\n                        <NotebookCell\r\n                            cell={cell}\r\n                            index={index}\r\n                            updateCell={updateCell}\r\n                            deleteCell={deleteCell}\r\n                            moveCell={moveCell}\r\n                            runCell={runCell}\r\n                            isActive={activeCellId === cell.id}\r\n                            setActive={setActiveCellId}\r\n                        />\r\n                        <div className=\"h-4 -mt-4 mb-2 flex items-center justify-center opacity-0 group-hover/add:opacity-100 transition-opacity z-10 relative pointer-events-none group-hover/add:pointer-events-auto\">\r\n                            <div className=\"absolute inset-x-0 h-px bg-[#2DD4BF]/20\" />\r\n                            <div className=\"flex gap-2 bg-black px-2 relative z-20\">\r\n                                <button onClick={() => addCell(index, 'code')} className=\"text-[10px] bg-[#2DD4BF]/10 text-[#2DD4BF] px-2 py-0.5 rounded border border-[#2DD4BF]/20 hover:bg-[#2DD4BF]/20\">+ Code</button>\r\n                                <button onClick={() => addCell(index, 'markdown')} className=\"text-[10px] bg-white/10 text-gray-300 px-2 py-0.5 rounded border border-white/10 hover:bg-white/20\">+ Texte</button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n                <div className=\"h-32 border-2 border-dashed border-white/5 rounded-xl flex items-center justify-center text-gray-600 hover:border-[#2DD4BF]/30 hover:text-[#2DD4BF]/50 transition-all cursor-pointer\" onClick={() => addCell(cells.length - 1, 'code')}>Cliquez pour ajouter</div>\r\n            </div>\r\n        </main>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\courseData.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\appliedDataScience.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\chapterImages.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\chimie1s.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\chimie2s.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\chimieTs.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\entrainement1s.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\entrainement2s.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\machineLearning.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\math1s.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\math2s.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\math3e.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\math4e.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\math5e.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\math6e.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\mathForML.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\mathTs.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\pc3e.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\pc4e.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\phys1s.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\phys2s.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\physTs.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\svt1l.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\svt1s.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\svt2s.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\svt3e.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\svt4e.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\svt5e.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\svt6e.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\svtTs.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\data\\visualization.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\courses\\page.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'selectedCourse'. Either include it or remove the dependency array.","line":537,"column":8,"nodeType":"ArrayExpression","endLine":537,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [searchParams, selectedCourse]","fix":{"range":[23343,23357],"text":"[searchParams, selectedCourse]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":1086,"column":65,"nodeType":"JSXOpeningElement","endLine":1090,"endColumn":67}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport Link from 'next/link';\r\nimport { courses } from './courseData';\r\nimport { math6eData } from './data/math6e';\r\nimport { math5eData } from './data/math5e';\r\nimport { math4eData } from './data/math4e';\r\nimport { math3eData } from './data/math3e';\r\nimport { pc4eData } from './data/pc4e';\r\nimport { pc3eData } from './data/pc3e';\r\nimport { svt6eData } from './data/svt6e';\r\nimport { svt5eData } from './data/svt5e';\r\nimport { svt4eData } from './data/svt4e';\r\nimport { svt3eData } from './data/svt3e';\r\nimport { phys2sData } from './data/phys2s';\r\nimport { phys1sData } from './data/phys1s';\r\nimport { chimie2sData } from './data/chimie2s';\r\nimport { chimie1sData } from './data/chimie1s';\r\nimport { entrainement2sData } from './data/entrainement2s';\r\nimport { entrainement1sData } from './data/entrainement1s';\r\nimport { math2sData } from './data/math2s';\r\nimport { math1sData } from './data/math1s';\r\nimport { svt2sData } from './data/svt2s';\r\nimport { svt1sData } from './data/svt1s';\r\nimport { svt1lData } from './data/svt1l';\r\nimport { mathTsData } from './data/mathTs';\r\nimport { svtTsData } from './data/svtTs';\r\nimport { physTsData } from './data/physTs';\r\nimport { chimieTsData } from './data/chimieTs';\r\nimport { machineLearningData } from './data/machineLearning';\r\nimport { mathForMLData } from './data/mathForML';\r\nimport { visualizationData } from './data/visualization';\r\nimport { dataScienceProjects } from './data/appliedDataScience';\r\nimport { BookOpen, Download, Eye, ChevronRight, GraduationCap, Atom, Calculator, Dna, CheckCircle, XCircle, Menu, ArrowLeft } from 'lucide-react';\r\nimport 'katex/dist/katex.min.css';\r\nimport ReactMarkdown from 'react-markdown';\r\nimport remarkMath from 'remark-math';\r\nimport rehypeKatex from 'rehype-katex';\r\nimport rehypeRaw from 'rehype-raw';\r\n\r\n\r\nimport { useSearchParams, useRouter } from 'next/navigation';\r\nimport { Suspense } from 'react';\r\n\r\n// Helper to strip indentation from template literals to avoid Markdown code block detection\r\nconst stripIndentation = (str) => {\r\n    if (!str) return '';\r\n    // Remove the first line if it's empty (common in template literals)\r\n    const lines = str.split('\\n');\r\n    if (lines.length > 0 && lines[0].trim() === '') {\r\n        lines.shift();\r\n    }\r\n\r\n    // Find minimum indentation of non-empty lines\r\n    let minIndent = Infinity;\r\n    lines.forEach(line => {\r\n        if (line.trim().length > 0) {\r\n            const indent = line.match(/^\\s*/)[0].length;\r\n            if (indent < minIndent) minIndent = indent;\r\n        }\r\n    });\r\n\r\n    if (minIndent === Infinity) return str;\r\n\r\n    // Remove that indentation from all lines\r\n    return lines.map(line => {\r\n        if (line.length >= minIndent) {\r\n            return line.slice(minIndent);\r\n        }\r\n        return line;\r\n    }).join('\\n');\r\n};\r\n\r\nconst levels = ['6├¿me', '5├¿me', '4├¿me', '3├¿me', 'Seconde', 'Premi├¿re', 'Terminale', 'Sup├®rieur'];\r\nconst subjects = ['Tous', 'Math├®matiques', 'Physique-Chimie', 'SVT', 'Informatique', 'Data & IA', 'Data Science'];\r\n\r\n// Map course IDs to their structured data if available\r\nconst structuredCourses = {\r\n    'math-6e': math6eData,\r\n    'math-5e': math5eData,\r\n    'math-4e': math4eData,\r\n    'math-3e': math3eData,\r\n    'pc-4e': pc4eData,\r\n    'pc-3e': pc3eData,\r\n    'svt-6e': svt6eData,\r\n    'svt-5e': svt5eData,\r\n    'svt-4e': svt4eData,\r\n    'svt-3e': svt3eData,\r\n    'phys-2s': phys2sData,\r\n    'phys-1s': phys1sData,\r\n    'chimie-2s': chimie2sData,\r\n    'chimie-1s': chimie1sData,\r\n    'entrainement-2s': entrainement2sData,\r\n    'entrainement-1s': entrainement1sData,\r\n    'math-2s': math2sData,\r\n    'math-1s': math1sData,\r\n    'svt-2s': svt2sData,\r\n    'svt-1s': svt1sData,\r\n    'svt-1l': svt1lData,\r\n    'math-ts': mathTsData,\r\n    'svt-ts': svtTsData,\r\n    'phys-ts': physTsData,\r\n    'chimie-ts': chimieTsData,\r\n    'ml-intro': machineLearningData,\r\n    'math-ml': mathForMLData,\r\n    'vis-data': visualizationData,\r\n    // Data Science Projects - Map each project to its detailed data\r\n    ...dataScienceProjects.reduce((acc, project) => {\r\n        acc[project.id] = {\r\n            chapters: project.modules.map(mod => ({\r\n                id: `mod-${mod.id}`,\r\n                title: mod.titre,\r\n                part: `Module ${mod.id} - ${mod.duree}`,\r\n                content: mod.content || `**Objectif:** ${mod.objectif}\\n\\n*Dur├®e estim├®e: ${mod.duree}*`,\r\n                summary: mod.summary || []\r\n            }))\r\n        };\r\n        return acc;\r\n    }, {})\r\n};\r\n\r\nfunction CoursesContent() {\r\n    const [activeLevel, setActiveLevel] = useState('6├¿me');\r\n    const [activeSubject, setActiveSubject] = useState('Tous');\r\n    const [selectedCourse, setSelectedCourse] = useState(null);\r\n    const searchParams = useSearchParams();\r\n    const router = useRouter();\r\n\r\n    // ... (rest of state)\r\n\r\n    // Structured Course State\r\n    const [activeChapter, setActiveChapter] = useState(null);\r\n    const [showExercises, setShowExercises] = useState(false);\r\n    const [quizAnswers, setQuizAnswers] = useState({});\r\n    const [quizResults, setQuizResults] = useState({});\r\n\r\n    // TTS State\r\n    const [isSpeaking, setIsSpeaking] = useState(false);\r\n    const [isPaused, setIsPaused] = useState(false);\r\n    const [selectedVoice, setSelectedVoice] = useState(null);\r\n    const [frenchVoices, setFrenchVoices] = useState([]);\r\n    const speechRef = useRef(null);\r\n\r\n    // Scroll to top on mount\r\n    useEffect(() => {\r\n        window.scrollTo(0, 0);\r\n    }, []);\r\n\r\n    // Charger les voix fran├ºaises (fr-FR uniquement)\r\n    useEffect(() => {\r\n        const loadVoices = () => {\r\n            const voices = window.speechSynthesis?.getVoices() || [];\r\n            const french = voices.filter(v => v.lang === 'fr-FR' || v.lang === 'fr_FR');\r\n            setFrenchVoices(french);\r\n            if (french.length > 0 && !selectedVoice) {\r\n                const googleFr = french.find(v => v.name.includes('Google')) || french[french.length - 1];\r\n                setSelectedVoice(googleFr);\r\n            }\r\n        };\r\n        loadVoices();\r\n        window.speechSynthesis?.addEventListener('voiceschanged', loadVoices);\r\n        return () => window.speechSynthesis?.removeEventListener('voiceschanged', loadVoices);\r\n    }, [selectedVoice]);\r\n\r\n    // Nettoyer le texte pour TTS - Lecture intelligente maths et sciences\r\n    const cleanTextForSpeech = (text) => {\r\n        if (!text) return '';\r\n\r\n        let result = text\r\n            // === FILTRAGE STRICT IC├öNES ET FL├êCHES ===\r\n            .replace(/[\\u{1F600}-\\u{1F64F}]/gu, '') // Emoticons\r\n            .replace(/[\\u{1F300}-\\u{1F5FF}]/gu, '') // Misc Symbols and Pictographs\r\n            .replace(/[\\u{1F680}-\\u{1F6FF}]/gu, '') // Transport and Map\r\n            .replace(/[\\u{1F900}-\\u{1F9FF}]/gu, '') // Supplemental Symbols\r\n            .replace(/[\\u{2600}-\\u{27BF}]/gu, '')   // Misc Symbols\r\n            .replace(/[\\u{2190}-\\u{21FF}]/gu, '')   // Arrows (Unicode)\r\n            .replace(/[\\u{2B00}-\\u{2BFF}]/gu, '')   // Misc Symbols and Arrows\r\n            .replace(/ÔåÆ/g, '')                      // Fl├¿che simple\r\n            .replace(/ÔçÆ/g, ' implique ')\r\n            .replace(/Ôåö/g, ' ├®quivaut ├á ')\r\n            .replace(/Ôçö/g, ' ├®quivaut ├á ')\r\n\r\n            // Supprimer blocs de code et formatage\r\n            .replace(/```[\\s\\S]*?```/g, '. ')\r\n            .replace(/`([^`]+)`/g, '$1')\r\n            .replace(/\\*\\*([^*]+)\\*\\*/g, '$1')\r\n            .replace(/\\*([^*]+)\\*/g, '$1')\r\n            .replace(/#{1,6}\\s*/g, '')\r\n            .replace(/\\$/g, '');\r\n\r\n        // === ENSEMBLES DE NOMBRES (LaTeX) ===\r\n        result = result\r\n            .replace(/\\\\mathbb\\{R\\}/g, \" l'ensemble des nombres r├®els \")\r\n            .replace(/\\\\mathbb\\{N\\}/g, \" l'ensemble des entiers naturels \")\r\n            .replace(/\\\\mathbb\\{Z\\}/g, \" l'ensemble des entiers relatifs \")\r\n            .replace(/\\\\mathbb\\{Q\\}/g, \" l'ensemble des nombres rationnels \")\r\n            .replace(/\\\\mathbb\\{C\\}/g, \" l'ensemble des nombres complexes \")\r\n            .replace(/\\\\mathbb\\{D\\}/g, \" l'ensemble des nombres d├®cimaux \");\r\n\r\n        // === VALEURS ABSOLUES ===\r\n        // LaTeX: \\left| x \\right| ou |x|\r\n        result = result.replace(/\\\\left\\|([^|]+)\\\\right\\|/g, ' valeur absolue de $1 ');\r\n        result = result.replace(/\\|([^|]+)\\|/g, ' valeur absolue de $1 ');\r\n        result = result.replace(/\\\\lvert\\s*([^|\\\\]+)\\s*\\\\rvert/g, ' valeur absolue de $1 ');\r\n        // Module (vecteurs)\r\n        result = result.replace(/\\\\left\\|\\\\vec\\{([^}]+)\\}\\\\right\\|/g, ' norme du vecteur $1 ');\r\n\r\n        // === IDENTIT├ëS REMARQUABLES ET PUISSANCES ===\r\n        // (a+b)^2 -> a plus b le tout au carr├®\r\n        result = result.replace(/\\(([^)]+)\\)\\^2/g, ' $1 le tout au carr├® ');\r\n        result = result.replace(/\\(([^)]+)\\)\\^3/g, ' $1 le tout au cube ');\r\n        // a^2 -> a au carr├® (d├®j├á g├®r├® mais renforc├®)\r\n        result = result.replace(/([a-zA-Z0-9]+)\\^2/g, ' $1 au carr├® ');\r\n        result = result.replace(/([a-zA-Z0-9]+)\\^3/g, ' $1 au cube ');\r\n\r\n        // Cas g├®n├®ral: 10^n, a^n, x^{n+1}\r\n        result = result.replace(/([a-zA-Z0-9]+)\\^([a-zA-Z0-9]+)/g, ' $1 puissance $2 ');\r\n        result = result.replace(/([a-zA-Z0-9]+)\\^\\{([^}]+)\\}/g, ' $1 puissance $2 ');\r\n        result = result.replace(/\\^([a-zA-Z0-9]+)/g, ' puissance $1 '); // Puissance orpheline\r\n\r\n        // Indices: u_n -> u indice n\r\n        result = result.replace(/([a-zA-Z])_([a-zA-Z0-9]+)/g, ' $1 indice $2 ');\r\n        result = result.replace(/([a-zA-Z])_\\{([^}]+)\\}/g, ' $1 indice $2 ');\r\n\r\n        // === LECTURE FONCTIONNELLE INTELLIGENTE ===\r\n        // f(x) -> f de x\r\n        result = result.replace(/\\b([fghuv])\\s*\\(\\s*([a-z0-9]+)\\s*\\)/gi, '$1 de $2');\r\n        result = result.replace(/\\\\(sin|cos|tan|ln|log|exp)\\s*\\(\\s*([^)]+)\\s*\\)/g, '$1 de $2');\r\n        result = result.replace(/\\\\lim_\\{([^}]+)\\}/g, ' limite quand $1 ');\r\n\r\n        // === SOMMES ET PRODUITS ===\r\n        result = result.replace(/\\\\sum_\\{([^}]+)\\}\\^\\{([^}]+)\\}/g, ' somme de $1 ├á $2 ');\r\n        result = result.replace(/\\\\sum/g, ' somme ');\r\n\r\n        // === INTERVALLES ===\r\n        result = result.replace(/\\[\\s*([^;]+)\\s*;\\s*([^\\]]+)\\s*\\]/g, ' intervalle ferm├® de $1 ├á $2 ');\r\n        result = result.replace(/\\]\\s*([^;]+)\\s*;\\s*([^\\[]+)\\s*\\[/g, ' intervalle ouvert de $1 ├á $2 ');\r\n        result = result.replace(/\\[\\s*([^;]+)\\s*;\\s*([^\\[]+)\\s*\\[/g, ' intervalle de $1 ferm├® ├á $2 ouvert ');\r\n        result = result.replace(/\\]\\s*([^;]+)\\s*;\\s*([^\\]]+)\\s*\\]/g, ' intervalle de $1 ouvert ├á $2 ferm├® ');\r\n\r\n        // === IN├ëGALIT├ëS ===\r\n        result = result\r\n            .replace(/\\\\leq/g, ' inf├®rieur ou ├®gal ├á ')\r\n            .replace(/\\\\geq/g, ' sup├®rieur ou ├®gal ├á ')\r\n            .replace(/<=/g, ' inf├®rieur ou ├®gal ├á ')\r\n            .replace(/>=/g, ' sup├®rieur ou ├®gal ├á ')\r\n            .replace(/</g, ' inf├®rieur ├á ')\r\n            .replace(/>/g, ' sup├®rieur ├á ')\r\n            .replace(/\\\\neq/g, ' diff├®rent de ');\r\n\r\n        // === LATEX AVANC├ë ET MATHS ===\r\n        result = result\r\n            .replace(/\\\\frac\\s*\\{([^{}]*)\\}\\s*\\{([^{}]*)\\}/g, ' $1 sur $2 ')\r\n            .replace(/\\\\sqrt\\[(\\d+)\\]\\s*\\{([^}]+)\\}/g, ' racine $1-i├¿me de $2 ')\r\n            .replace(/\\\\sqrt\\s*\\{([^}]+)\\}/g, ' racine carr├®e de $2 ')\r\n            .replace(/\\\\vec\\s*\\{([^}]+)\\}/g, ' vecteur $1 ')\r\n            .replace(/\\\\overrightarrow\\s*\\{([^}]+)\\}/g, ' vecteur $1 ')\r\n            // Logique et Ensembles\r\n            .replace(/\\\\in/g, ' appartient ├á ')\r\n            .replace(/\\\\notin/g, ' n\\'appartient pas ├á ')\r\n            .replace(/\\\\cup/g, ' union ')\r\n            .replace(/\\\\cap/g, ' intersection ')\r\n            .replace(/\\\\subset/g, ' inclus dans ')\r\n            .replace(/\\\\forall/g, ' pour tout ')\r\n            .replace(/\\\\exists/g, ' il existe ')\r\n            .replace(/\\\\infty/g, ' l\\'infini ')\r\n            // Op├®rateurs\r\n            .replace(/\\\\times/g, ' fois ')\r\n            .replace(/\\\\cdot/g, ' fois ')\r\n            .replace(/\\\\div/g, ' divis├® par ')\r\n            .replace(/\\\\approx/g, ' environ ├®gal ├á ')\r\n            // Grecques\r\n            .replace(/\\\\pi/g, ' pi ')\r\n            .replace(/\\\\alpha/g, ' alpha ')\r\n            .replace(/\\\\beta/g, ' b├¬ta ')\r\n            .replace(/\\\\Delta/g, ' Delta ')\r\n            .replace(/\\\\theta/g, ' th├¬ta ')\r\n            .replace(/\\\\lambda/g, ' lambda ')\r\n            // Nettoyage LaTeX r├®siduel\r\n            .replace(/\\\\text\\{([^}]+)\\}/g, '$1')\r\n            .replace(/\\\\[a-zA-Z]+/g, '')\r\n            .replace(/\\{|\\}/g, '');\r\n\r\n        // === LECTURE NATURELLE ===\r\n        result = result.replace(/(\\d+),(\\d+)/g, '$1 virgule $2');\r\n        result = result.replace(/(\\d+)\\.(\\d+)/g, '$1 virgule $2');\r\n        result = result.replace(/=/g, ' ├®gale ');\r\n        result = result.replace(/\\+/g, ' plus ');\r\n        // Attention au moins (-) qui peut ├¬tre un tiret. On suppose math si entour├® d'espaces ou chiffres\r\n        result = result.replace(/(\\d)\\s*-\\s*(\\d)/g, '$1 moins $2');\r\n\r\n        // Nettoyage final\r\n        result = result\r\n            .replace(/\\n+/g, '. ')\r\n            .replace(/\\s+/g, ' ')\r\n            .replace(/^[.,\\s]+/, '') // Nettoyer d├®but\r\n            .trim();\r\n\r\n        return result;\r\n    };\r\n\r\n    const smartTTS = (text) => {\r\n        if (!text) return '';\r\n        // 1. Nettoyage initial et Dictionnaire\r\n        let t = text\r\n            .replace(/[\\u{1F600}-\\u{1F64F}\\u{1F300}-\\u{1F5FF}\\u{1F680}-\\u{1F6FF}\\u{1F900}-\\u{1F9FF}\\u{2600}-\\u{27BF}\\u{2190}-\\u{21FF}\\u{2B00}-\\u{2BFF}]/gu, '')\r\n            .replace(/ÔåÆ|ÔçÆ|Ôçö|Ôåö/g, ' ')\r\n            .replace(/```[\\s\\S]*?```/g, '. Code. ')\r\n            .replace(/`([^`]+)`/g, '$1')\r\n            .replace(/\\*\\*([^*]+)\\*\\*/g, '$1')\r\n            .replace(/\\*([^*]+)\\*/g, '$1')\r\n            .replace(/#{1,6}\\s*/g, '')\r\n            .replace(/\\$/g, ' ');\r\n\r\n        const replacements = {\r\n            '\\\\in': ' appartient ├á ', '\\\\notin': \" n'appartient pas ├á \",\r\n            '\\\\cup': ' union ', '\\\\cap': ' inter ', '\\\\subset': ' inclus dans ',\r\n            '\\\\forall': ' pour tout ', '\\\\exists': ' il existe ', '\\\\infty': \" l'infini \",\r\n            '\\\\neq': ' diff├®rent de ', '\\\\leq': ' inf├®rieur ou ├®gal ├á ', '\\\\geq': ' sup├®rieur ou ├®gal ├á ',\r\n            '\\\\approx': ' environ ', '\\\\pm': ' plus ou moins ', '\\\\times': ' fois ', '\\\\cdot': ' fois ', '\\\\div': ' divis├® par ',\r\n            '\\\\pi': ' pi ', '\\\\alpha': ' alpha ', '\\\\beta': ' b├¬ta ', '\\\\theta': ' th├¬ta ',\r\n            '\\\\lambda': ' lambda ', '\\\\Delta': ' Delta ', '\\\\gamma': ' gamma ', '\\\\sigma': ' sigma ',\r\n            '\\\\Omega': ' om├®ga ', '\\\\omega': ' om├®ga ', '\\\\phi': ' phi ', '\\\\psi': ' psi ',\r\n            '=': ' ├®gale, ', '+': ' plus ', '<': ' inf├®rieur ├á ', '>': ' sup├®rieur ├á '\r\n        };\r\n        for (const [key, val] of Object.entries(replacements)) { t = t.split(key).join(val); }\r\n\r\n        // 2. Traitement It├®ratif (Imbrication)\r\n        let hasChanged = true;\r\n        let loops = 0;\r\n        while (hasChanged && loops < 5) {\r\n            hasChanged = false;\r\n            const original = t;\r\n            t = t.replace(/\\\\frac\\s*\\{([^{}]+)\\}\\s*\\{([^{}]+)\\}/g, ' $1 sur $2 ');\r\n            t = t.replace(/\\\\sqrt\\s*\\[([^{}]+)\\]\\s*\\{([^{}]+)\\}/g, ' racine $1-i├¿me de $2 ');\r\n            t = t.replace(/\\\\sqrt\\s*\\{([^{}]+)\\}/g, ' racine d fois e $1 ');\r\n            t = t.replace(/\\^\\{([^{}]+)\\}/g, ' puissance $1 ');\r\n            t = t.replace(/_\\{([^{}]+)\\}/g, ' indice $1 ');\r\n            t = t.replace(/\\\\vec\\s*\\{([^{}]+)\\}/g, ' vecteur $1 ');\r\n            t = t.replace(/\\\\overrightarrow\\s*\\{([^{}]+)\\}/g, ' vecteur $1 ');\r\n            t = t.replace(/\\\\left\\|\\s*([^{}]+)\\s*\\\\right\\|/g, ' valeur absolue de $1 ');\r\n            t = t.replace(/\\|\\s*([^{}]+)\\s*\\|/g, ' valeur absolue de $1 ');\r\n            // Matrices/Vecteurs colonnes (Maths 3e)\r\n            t = t.replace(/\\\\begin\\{pmatrix\\}\\s*([^\\\\]+)\\s*\\\\\\\\\\s*([^\\\\]+)\\s*\\\\end\\{pmatrix\\}/g, ' de coordonn├®es $1 et $2 ');\r\n            if (t !== original) hasChanged = true;\r\n            loops++;\r\n        }\r\n\r\n        // 3. Correctifs Phon├®tiques Sp├®cifiques (USER REQUEST)\r\n        t = t\r\n            // Unit├®s attach├®es (6m -> 6 m├¿tres) - Prioritaire sur les variables\r\n            .replace(/(\\d+)\\s*m┬▓\\b/gi, '$1 m├¿tres carr├®s ')\r\n            .replace(/(\\d+)\\s*cm┬▓\\b/gi, '$1 centim├¿tres carr├®s ')\r\n            .replace(/(\\d+)\\s*km┬▓\\b/gi, '$1 kilom├¿tres carr├®s ')\r\n            .replace(/(\\d+)\\s*m\\b/gi, '$1 m├¿tres ')\r\n            .replace(/(\\d+)\\s*cm\\b/gi, '$1 centim├¿tres ')\r\n            .replace(/(\\d+)\\s*mm\\b/gi, '$1 millim├¿tres ')\r\n            .replace(/(\\d+)\\s*km\\b/gi, '$1 kilom├¿tres ')\r\n            .replace(/(\\d+)\\s*kg\\b/gi, '$1 kilogrammes ')\r\n            // Variables coll├®es (bd -> b fois d)\r\n            .replace(/\\b(ab|bc|cd|de|ef|fg|gh|xy|yz|uv|vw|bd|ac|ad)\\b/gi, (match) => match.split('').join(' fois '))\r\n            .replace(/\\bm\\b/g, ' m├¿tres ');\r\n\r\n        // 4. S├®mantique Globale\r\n        t = t\r\n            .replace(/(\\d)\\s*([a-zA-Z])/g, '$1 fois $2')\r\n            .replace(/(\\d)\\s*\\(/g, '$1 facteur de (')\r\n            .replace(/\\b([fghuv])\\s*\\(\\s*([a-z0-9]+)\\s*\\)/gi, '$1 de $2')\r\n            .replace(/\\\\?(sin|cos|tan|ln|log|exp)\\s*\\(\\s*([^)]+)\\s*\\)/gi, '$1 de $2')\r\n            .replace(/([a-zA-Z0-9]+)\\^([a-zA-Z0-9]+)/g, '$1 puissance $2')\r\n            .replace(/\\[\\s*([^;]+)\\s*[;,]\\s*([^\\]]+)\\s*\\]/g, ' intervalle ferm├® de $1 ├á $2 ')\r\n            .replace(/\\]\\s*([^;]+)\\s*[;,]\\s*([^\\[]+)\\s*\\[/g, ' intervalle ouvert de $1 ├á $2 ')\r\n            .replace(/\\\\mathbb\\{R\\}/g, \" R \")\r\n            .replace(/\\\\mathbb\\{N\\}/g, \" N \")\r\n            .replace(/\\\\sum/g, ' somme ')\r\n            .replace(/\\\\lim/g, ' limite ')\r\n            .replace(/\\\\int/g, ' int├®grale ')\r\n            .replace(/┬░C/g, ' degr├®s Celsius ')\r\n            .replace(/(\\d+)[.,](\\d+)/g, '$1 virgule $2')\r\n            .replace(/\\\\[a-zA-Z]+/g, '')\r\n            .replace(/[{}]/g, '')\r\n            .replace(/[\\(\\)]/g, ' ')\r\n            .replace(/\\n+/g, '. ')\r\n            .replace(/\\s+/g, ' ')\r\n            .trim();\r\n        return t;\r\n    };\r\n\r\n    // D├®marrer la lecture (S├®quentielle pour gestion des pauses naturelles)\r\n    const startSpeaking = (text) => {\r\n        return; // Lecture d├®sactiv├®e temporairement (demande utilisateur)\r\n        if (!window.speechSynthesis) return;\r\n        window.speechSynthesis.cancel();\r\n\r\n        const cleanText = smartTTS(text);\r\n        if (!cleanText) return;\r\n\r\n        // D├®coupage en phrases\r\n        const sentences = cleanText.match(/[^.!?]+[.!?]+|[^.!?]+$/g) || [cleanText];\r\n\r\n        setIsSpeaking(true);\r\n        setIsPaused(false);\r\n\r\n        let currentIndex = 0;\r\n\r\n        const speakNext = () => {\r\n            // Si la lecture est annul├®e ou finie\r\n            if (currentIndex >= sentences.length) {\r\n                setIsSpeaking(false);\r\n                return;\r\n            }\r\n\r\n            const sentence = sentences[currentIndex].trim();\r\n            if (!sentence) {\r\n                currentIndex++;\r\n                speakNext();\r\n                return;\r\n            }\r\n\r\n            const utterance = new SpeechSynthesisUtterance(sentence);\r\n            speechRef.current = utterance; // Mettre ├á jour la ref pour les contr├┤les pause/stop\r\n\r\n            utterance.lang = 'fr-FR';\r\n            utterance.rate = 1.0;\r\n            utterance.pitch = 1;\r\n            if (selectedVoice) utterance.voice = selectedVoice;\r\n\r\n            utterance.onend = () => {\r\n                currentIndex++;\r\n                speakNext();\r\n            };\r\n\r\n            utterance.onerror = (e) => {\r\n                console.error(\"Erreur TTS:\", e);\r\n                currentIndex++;\r\n                speakNext();\r\n            };\r\n\r\n            window.speechSynthesis.speak(utterance);\r\n        };\r\n\r\n        speakNext();\r\n    };\r\n\r\n    const togglePause = () => {\r\n        if (window.speechSynthesis.paused) {\r\n            window.speechSynthesis.resume();\r\n            setIsPaused(false);\r\n        } else {\r\n            window.speechSynthesis.pause();\r\n            setIsPaused(true);\r\n        }\r\n    };\r\n\r\n    const stopSpeaking = () => {\r\n        window.speechSynthesis.cancel();\r\n        setIsSpeaking(false);\r\n        setIsPaused(false);\r\n    };\r\n\r\n    const filteredCourses = courses.filter(course => {\r\n        const matchLevel = course.level === activeLevel;\r\n        const matchSubject = activeSubject === 'Tous' || course.subject === activeSubject;\r\n        return matchLevel && matchSubject;\r\n    });\r\n\r\n    const handleCourseSelect = (course) => {\r\n        router.push(`/courses?course=${course.id}`);\r\n    };\r\n\r\n    const handleQuizSubmit = (chapterId, exerciseId, optionIndex) => {\r\n        setQuizAnswers(prev => ({\r\n            ...prev,\r\n            [`${chapterId}-${exerciseId}`]: optionIndex\r\n        }));\r\n\r\n        const chapter = structuredCourses[selectedCourse.id].chapters.find(c => c.id === chapterId);\r\n        // Support both 'exercises' and 'defis'\r\n        const exercisesList = chapter.defis || chapter.exercises || [];\r\n        const exercise = exercisesList.find(e => e.id === exerciseId);\r\n        const isCorrect = exercise.correctAnswer === optionIndex;\r\n\r\n        setQuizResults(prev => ({\r\n            ...prev,\r\n            [`${chapterId}-${exerciseId}`]: isCorrect\r\n        }));\r\n    };\r\n\r\n    // Handle deep linking via search params\r\n    useEffect(() => {\r\n        const courseId = searchParams.get('course');\r\n        const chapterId = searchParams.get('activeChapter');\r\n\r\n        // Si un chapitre est sp├®cifi├®, trouver le cours correspondant\r\n        if (chapterId && !courseId) {\r\n            // Chercher dans tous les cours structur├®s\r\n            for (const [cid, courseData] of Object.entries(structuredCourses)) {\r\n                const chapter = courseData.chapters?.find(ch => ch.id === chapterId);\r\n                if (chapter) {\r\n                    const course = courses.find(c => c.id === cid);\r\n                    if (course) {\r\n                        setSelectedCourse(course);\r\n                        setActiveLevel(course.level);\r\n                        setActiveSubject(course.subject);\r\n                        setActiveChapter(chapter);\r\n                        setShowExercises(false);\r\n                        setQuizAnswers({});\r\n                        setQuizResults({});\r\n                    }\r\n                    break;\r\n                }\r\n            }\r\n        } else if (courseId) {\r\n            const course = courses.find(c => c.id === courseId);\r\n            if (course && course.id !== selectedCourse?.id) {\r\n                // Determine layout based on course type\r\n                if (structuredCourses[course.id]) {\r\n\r\n                    setActiveChapter(structuredCourses[course.id].chapters[0]);\r\n                    setShowExercises(false);\r\n                    setQuizAnswers({});\r\n                    setQuizResults({});\r\n                } else {\r\n                    setActiveChapter(null);\r\n                }\r\n                setSelectedCourse(course);\r\n                setActiveLevel(course.level);\r\n                setActiveSubject(course.subject);\r\n            }\r\n        } else if (!chapterId) {\r\n            // No params - clear selection (Back/Home)\r\n            if (selectedCourse) {\r\n                setSelectedCourse(null);\r\n            }\r\n        }\r\n    }, [searchParams]);\r\n\r\n    // Handle hash-based navigation (e.g., /courses#ml-intro)\r\n    useEffect(() => {\r\n        const handleHashNavigation = () => {\r\n            const hash = window.location.hash.replace('#', '');\r\n            if (!hash) return;\r\n\r\n            // Map hash to course ID\r\n            const hashToCourse = {\r\n                'ml-intro': 'ml-intro',\r\n                'vis-data': 'vis-data',\r\n                'mathematiques': null, // Filter by subject\r\n                'math': null,\r\n            };\r\n\r\n            if (hash === 'mathematiques' || hash === 'math') {\r\n                // Filter to show Math courses\r\n                setActiveSubject('Math├®matiques');\r\n                setSelectedCourse(null);\r\n                return;\r\n            }\r\n\r\n            const courseId = hashToCourse[hash] || hash;\r\n            const course = courses.find(c => c.id === courseId);\r\n\r\n            if (course) {\r\n                setActiveLevel(course.level);\r\n                setActiveSubject(course.subject);\r\n\r\n                if (structuredCourses[course.id]) {\r\n                    setActiveChapter(structuredCourses[course.id].chapters[0]);\r\n                    setShowExercises(false);\r\n                    setQuizAnswers({});\r\n                    setQuizResults({});\r\n                } else {\r\n                    setActiveChapter(null);\r\n                }\r\n                setSelectedCourse(course);\r\n            }\r\n        };\r\n\r\n        handleHashNavigation();\r\n        window.addEventListener('hashchange', handleHashNavigation);\r\n        return () => window.removeEventListener('hashchange', handleHashNavigation);\r\n    }, []);\r\n\r\n    // ReactMarkdown avec rehype-katex g├¿re maintenant le rendu LaTeX automatiquement\r\n\r\n\r\n    return (\r\n        <main className=\"min-h-screen bg-[#020617] text-white font-sans selection:bg-[#06d6a0] selection:text-black flex flex-col\">\r\n            {/* Navbar - Now uses global navbar */}\r\n            <nav className=\"fixed top-0 w-full z-50 border-b border-white/[0.06] bg-[#020617]/85 backdrop-blur-2xl\">\r\n                <div className=\"max-w-7xl mx-auto px-4 h-16 flex items-center justify-between\">\r\n                    <Link href=\"/\" className=\"flex items-center gap-2 group\">\r\n                        <div className=\"w-8 h-8 rounded-lg bg-gradient-to-br from-[#06d6a0] to-[#8b5cf6] flex items-center justify-center font-bold text-white group-hover:scale-110 transition-transform\">\r\n                            <BookOpen size={18} />\r\n                        </div>\r\n                        <span className=\"font-bold text-xl tracking-tight\">SymLab <span className=\"gradient-text-static\">Cours</span></span>\r\n                    </Link>\r\n                    <div className=\"flex gap-6 text-sm font-medium text-gray-400\">\r\n                        <Link href=\"/engineering\" className=\"hover:text-white transition-colors\">Ing├®nierie</Link>\r\n                        <Link href=\"/simulations\" className=\"hover:text-white transition-colors\">Simulations</Link>\r\n                        <Link href=\"/code\" className=\"hover:text-white transition-colors\">Notebook</Link>\r\n                    </div>\r\n                </div>\r\n            </nav>\r\n\r\n            <div className=\"flex flex-1 pt-16\">\r\n                {/* Sidebar - Levels (Hidden if structured course is open) */}\r\n                {!selectedCourse && (\r\n                    <div className=\"w-64 border-r border-white/[0.06] bg-[#0a0f1e] hidden md:flex flex-col fixed h-[calc(100vh-4rem)] overflow-y-auto\">\r\n                        <div className=\"p-6\">\r\n                            <h2 className=\"text-xs font-bold text-[#06d6a0] uppercase tracking-widest mb-4\">Niveaux Scolaires</h2>\r\n                            <div className=\"space-y-1\">\r\n                                {levels.map((level) => (\r\n                                    <button\r\n                                        key={level}\r\n                                        onClick={() => setActiveLevel(level)}\r\n                                        className={`w-full flex items-center justify-between px-4 py-3 rounded-xl text-sm font-medium transition-all ${activeLevel === level\r\n                                            ? 'bg-[#06d6a0]/10 text-[#06d6a0] border border-[#06d6a0]/20'\r\n                                            : 'text-slate-400 hover:bg-white/5 hover:text-white'\r\n                                            }`}\r\n                                    >\r\n                                        {level}\r\n                                        {activeLevel === level && <ChevronRight size={16} />}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Main Content */}\r\n                <div className={`flex-1 ${!selectedCourse ? 'md:ml-64' : ''} p-2 sm:p-4 md:p-8 lg:p-12`}>\r\n\r\n                    {!selectedCourse ? (\r\n                        // COURSE LIST VIEW\r\n                        <>\r\n                            {/* Mobile Level Selector */}\r\n                            <div className=\"md:hidden mb-6\">\r\n                                <label className=\"block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2\">\r\n                                    Niveau Scolaire\r\n                                </label>\r\n                                <select\r\n                                    value={activeLevel}\r\n                                    onChange={(e) => setActiveLevel(e.target.value)}\r\n                                    className=\"w-full px-4 py-3 rounded-xl bg-[#0F1115] border border-white/10 text-white font-medium focus:border-blue-500 focus:outline-none\"\r\n                                >\r\n                                    <optgroup label=\"­ƒôÜ Coll├¿ge\">\r\n                                        <option value=\"6├¿me\">6├¿me</option>\r\n                                        <option value=\"5├¿me\">5├¿me</option>\r\n                                        <option value=\"4├¿me\">4├¿me</option>\r\n                                        <option value=\"3├¿me\">3├¿me</option>\r\n                                    </optgroup>\r\n                                    <optgroup label=\"­ƒÄô Lyc├®e\">\r\n                                        <option value=\"Seconde\">Seconde</option>\r\n                                        <option value=\"Premi├¿re\">Premi├¿re</option>\r\n                                        <option value=\"Terminale\">Terminale</option>\r\n                                    </optgroup>\r\n                                    <optgroup label=\"­ƒÜÇ Sup├®rieur\">\r\n                                        <option value=\"Sup├®rieur\">Sup├®rieur & Pro</option>\r\n                                    </optgroup>\r\n                                </select>\r\n                            </div>\r\n\r\n                            <div className=\"mb-4 sm:mb-6 md:mb-12 text-center sm:text-left\">\r\n                                <h1 className=\"text-xl sm:text-2xl md:text-4xl font-black mb-2 sm:mb-4 flex items-center justify-center sm:justify-start gap-2 sm:gap-3\">\r\n                                    <GraduationCap size={24} className=\"sm:w-8 sm:h-8 md:w-10 md:h-10 text-blue-500\" />\r\n                                    <span>Cours de {activeLevel}</span>\r\n                                </h1>\r\n                                <p className=\"text-xs sm:text-sm md:text-base text-gray-400 px-4 sm:px-0\">\r\n                                    Ressources p├®dagogiques conformes au programme du S├®n├®gal.\r\n                                </p>\r\n                            </div>\r\n\r\n                            <div className=\"flex gap-1.5 sm:gap-2 mb-4 sm:mb-6 md:mb-8 overflow-x-auto pb-2 -mx-2 px-2 sm:mx-0 sm:px-0 scrollbar-hide\">\r\n                                {subjects.map(subject => (\r\n                                    <button\r\n                                        key={subject}\r\n                                        onClick={() => setActiveSubject(subject)}\r\n                                        className={`px-2.5 sm:px-4 py-1.5 sm:py-2 rounded-full text-xs sm:text-sm font-bold whitespace-nowrap transition-all active:scale-95 ${activeSubject === subject\r\n                                            ? 'bg-white text-black'\r\n                                            : 'bg-white/5 text-gray-400 hover:bg-white/10 hover:text-white'\r\n                                            }`}\r\n                                    >\r\n                                        {subject}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n\r\n\r\n                            {filteredCourses.length > 0 ? (\r\n                                <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6\">\r\n                                    {filteredCourses.map((course) => (\r\n                                        <div\r\n                                            key={course.id}\r\n                                            className=\"group relative glass-card p-5 sm:p-6 hover:border-[#06d6a0]/30 transition-all duration-300 active:scale-[0.98] hover:-translate-y-2 hover:shadow-[0_20px_50px_rgba(6,214,160,0.1)] overflow-hidden\"\r\n                                        >\r\n                                            {/* Gradient Shine Effect */}\r\n                                            <div className=\"absolute inset-0 bg-gradient-to-br from-white/5 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none\" />\r\n\r\n                                            <div className=\"relative z-10\">\r\n                                                <div className=\"flex items-center justify-between mb-4\">\r\n                                                    <div className={`w-12 h-12 rounded-xl flex items-center justify-center text-2xl bg-${course.color || 'blue'}-500/10 text-${course.color || 'blue'}-500 group-hover:scale-110 transition-transform duration-300 ring-1 ring-white/5 group-hover:ring-${course.color || 'blue'}-500/30`}>\r\n                                                        {course.icon}\r\n                                                    </div>\r\n                                                    <span className=\"px-2.5 py-1 rounded-md text-[10px] font-bold uppercase tracking-wider bg-white/5 text-gray-400 border border-white/5 group-hover:bg-white/10 transition-colors\">\r\n                                                        {course.subject}\r\n                                                    </span>\r\n                                                </div>\r\n\r\n                                                <h3 className=\"text-lg font-bold mb-2 text-white group-hover:text-[#06d6a0] transition-colors line-clamp-1\">\r\n                                                    {course.title}\r\n                                                </h3>\r\n                                                <p className=\"text-sm text-gray-500 mb-6 line-clamp-2 h-10 group-hover:text-gray-400 transition-colors\">\r\n                                                    {course.description}\r\n                                                </p>\r\n\r\n                                                <button\r\n                                                    onClick={() => handleCourseSelect(course)}\r\n                                                    className=\"w-full flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl bg-gradient-to-r from-[#06d6a0] to-[#4ade80] hover:from-[#4ade80] hover:to-[#06d6a0] text-black text-sm font-bold transition-all shadow-lg shadow-[#06d6a0]/20 group-hover:shadow-[#06d6a0]/40\"\r\n                                                >\r\n                                                    <Eye size={16} />\r\n                                                    <span>{structuredCourses[course.id] ? 'Commencer' : 'Aper├ºu'}</span>\r\n                                                </button>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"text-center py-20 bg-[#0F1115] rounded-3xl border border-white/5 border-dashed\">\r\n                                    <div className=\"w-16 h-16 mx-auto rounded-full bg-white/5 flex items-center justify-center mb-4 text-gray-600\">\r\n                                        <BookOpen size={32} />\r\n                                    </div>\r\n                                    <h3 className=\"text-xl font-bold text-gray-400 mb-2\">Aucun cours disponible</h3>\r\n                                    <p className=\"text-gray-600\">\r\n                                        Les ressources pour {activeSubject} en {activeLevel} seront bient├┤t ajout├®es.\r\n                                    </p>\r\n                                </div>\r\n                            )}\r\n                        </>\r\n                    ) : (\r\n                        // STRUCTURED COURSE VIEW OR PDF VIEWER\r\n                        <div className=\"h-[calc(100vh-8rem)] flex flex-col\">\r\n                            {/* Header dynamique */}\r\n                            <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-3 sm:gap-4 mb-6\">\r\n                                <button\r\n                                    onClick={() => router.push('/courses')}\r\n                                    className=\"p-2 rounded-lg bg-white/5 hover:bg-white/10 text-white transition-colors\"\r\n                                >\r\n                                    <ArrowLeft size={20} />\r\n                                </button>\r\n                                <div className=\"flex-1\">\r\n                                    <h2 className=\"text-xl sm:text-2xl font-bold flex items-center gap-2\">\r\n                                        {selectedCourse.icon && <span className=\"text-2xl\">{selectedCourse.icon}</span>}\r\n                                        {selectedCourse.title}\r\n                                    </h2>\r\n                                    {selectedCourse.isProject && (\r\n                                        <div className=\"flex flex-wrap items-center gap-2 mt-2\">\r\n                                            <span className=\"px-2 py-1 rounded-full bg-gradient-to-r from-cyan-500/20 to-blue-500/20 text-cyan-400 text-xs font-bold border border-cyan-500/30\">\r\n                                                ­ƒôè Data Science Appliqu├®e\r\n                                            </span>\r\n                                            <span className=\"px-2 py-1 rounded-full bg-white/5 text-gray-400 text-xs\">\r\n                                                Projet #{selectedCourse.projectNumber}\r\n                                            </span>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n\r\n                            {structuredCourses[selectedCourse.id] ? (\r\n                                // STRUCTURED VIEW (Chapters + Exercises)\r\n                                <div className=\"flex-1 flex flex-col lg:flex-row gap-4 lg:gap-6 overflow-hidden\">\r\n                                    {/* Chapters Sidebar - Hidden on mobile, shown on large screens */}\r\n                                    <div className=\"hidden lg:flex lg:flex-col w-80 bg-[#0F1115] rounded-2xl border border-white/10 overflow-hidden max-h-[calc(100vh-12rem)]\">\r\n                                        <div className=\"p-4 border-b border-white/10 bg-white/5 flex-shrink-0\">\r\n                                            <h3 className=\"font-bold text-sm uppercase tracking-wider text-gray-400\">Chapitres</h3>\r\n                                        </div>\r\n                                        <div className=\"flex-1 overflow-y-auto p-2 space-y-1 scrollbar-thin scrollbar-thumb-white/20 scrollbar-track-transparent hover:scrollbar-thumb-white/30\">\r\n                                            {structuredCourses[selectedCourse.id].chapters.map((chapter, index, arr) => {\r\n                                                const prevChapter = arr[index - 1];\r\n                                                const showDivider = !prevChapter || prevChapter.part !== chapter.part;\r\n\r\n                                                return (\r\n                                                    <div key={chapter.id}>\r\n                                                        {showDivider && chapter.part && (\r\n                                                            <div className=\"px-3 py-2 mt-4 mb-2 text-xs font-bold text-[#06d6a0] uppercase tracking-widest bg-[#06d6a0]/5 rounded border border-[#06d6a0]/10 backdrop-blur-sm sticky top-0 z-10 mx-1\">\r\n                                                                {chapter.part}\r\n                                                            </div>\r\n                                                        )}\r\n                                                        <button\r\n                                                            onClick={() => {\r\n                                                                setActiveChapter(chapter);\r\n                                                                setShowExercises(false);\r\n                                                            }}\r\n                                                            className={`w-full text-left p-3 rounded-lg text-sm transition-all border ${activeChapter?.id === chapter.id\r\n                                                                ? 'bg-[#06d6a0]/10 text-[#06d6a0] font-bold border-[#06d6a0]/30 shadow-lg shadow-[#06d6a0]/10'\r\n                                                                : 'text-gray-400 border-transparent hover:bg-white/5 hover:text-white hover:border-white/5'\r\n                                                                }`}\r\n                                                        >\r\n                                                            <div className=\"flex items-center gap-3\">\r\n                                                                <span className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold shrink-0 ${activeChapter?.id === chapter.id ? 'bg-white/20' : 'bg-white/5'}`}>\r\n                                                                    {index + 1}\r\n                                                                </span>\r\n                                                                {chapter.title.replace(/^\\d+\\.\\s*/, '')}\r\n                                                            </div>\r\n                                                        </button>\r\n                                                    </div>\r\n                                                );\r\n                                            })}\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* Content Area */}\r\n                                    <div className=\"flex-1 bg-[#0F1115] rounded-2xl border border-white/10 flex flex-col overflow-hidden relative\">\r\n                                        {/* Mobile Chapter Selector */}\r\n                                        <div className=\"lg:hidden p-4 border-b border-white/10 bg-black/20\">\r\n                                            <label className=\"block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2\">\r\n                                                Chapitre\r\n                                            </label>\r\n                                            <select\r\n                                                value={activeChapter?.id || ''}\r\n                                                onChange={(e) => {\r\n                                                    const chapter = structuredCourses[selectedCourse.id].chapters.find(c => c.id === e.target.value);\r\n                                                    setActiveChapter(chapter);\r\n                                                    setShowExercises(false);\r\n                                                }}\r\n                                                className=\"w-full px-3 py-2 rounded-lg bg-[#0F1115] border border-white/10 text-white text-sm focus:border-blue-500 focus:outline-none\"\r\n                                            >\r\n                                                {structuredCourses[selectedCourse.id].chapters.map((chapter, index) => (\r\n                                                    <option key={chapter.id} value={chapter.id}>\r\n                                                        {index + 1}. {chapter.title.replace(/^\\d+\\.\\s*/, '')}\r\n                                                    </option>\r\n                                                ))}\r\n                                            </select>\r\n                                        </div>\r\n\r\n                                        {/* Tabs - Masqu├®s pour Data Science Projects */}\r\n                                        {!selectedCourse.isProject && (\r\n                                            <div className=\"flex border-b border-white/10 bg-black/20\">\r\n                                                {selectedCourse.id.includes('entrainement') ? (\r\n                                                    <div className=\"flex-1 py-4 text-sm font-bold uppercase tracking-wider text-[#06d6a0] border-t-2 border-[#06d6a0] bg-[#0a0f1e] text-center\">\r\n                                                        Ô£Å´©Å Exercices\r\n                                                    </div>\r\n                                                ) : (\r\n                                                    <>\r\n                                                        <button\r\n                                                            onClick={() => setShowExercises(false)}\r\n                                                            className={`flex-1 py-4 text-sm font-bold uppercase tracking-wider transition-colors ${!showExercises ? 'bg-[#0a0f1e] text-[#06d6a0] border-t-2 border-[#06d6a0]' : 'text-gray-500 hover:text-white bg-black/20'\r\n                                                                }`}\r\n                                                        >\r\n                                                            ­ƒôû Le├ºon\r\n                                                        </button>\r\n                                                        <button\r\n                                                            onClick={() => setShowExercises(true)}\r\n                                                            className={`flex-1 py-4 text-sm font-bold uppercase tracking-wider transition-colors ${showExercises ? 'bg-[#0a0f1e] text-[#06d6a0] border-t-2 border-[#06d6a0]' : 'text-gray-500 hover:text-white bg-black/20'\r\n                                                                }`}\r\n                                                        >\r\n                                                            ­ƒÄ» D├®fis\r\n                                                        </button>\r\n                                                    </>\r\n                                                )}\r\n                                            </div>\r\n                                        )}\r\n\r\n                                        {/* Scrollable Content */}\r\n                                        <div className=\"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-thin scrollbar-thumb-white/10 scrollbar-track-transparent\">\r\n                                            {!showExercises || selectedCourse.id.includes('entrainement') ? (\r\n                                                <div className=\"max-w-4xl mx-auto\">\r\n\r\n                                                    <h2 className=\"text-2xl md:text-4xl font-black mb-4 text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-purple-400 to-white leading-tight\">\r\n                                                        {activeChapter?.title}\r\n                                                    </h2>\r\n\r\n                                                    {/* Bouton ├ëcouter */}\r\n                                                    {activeChapter?.content && (\r\n                                                        <div className=\"flex items-center gap-3 mb-6 p-3 rounded-xl bg-[#2DD4BF]/10 border border-[#2DD4BF]/20\">\r\n                                                            <span className=\"text-xl\">­ƒÄº</span>\r\n                                                            <div className=\"flex-1\">\r\n                                                                <div className=\"text-sm font-medium text-white\">├ëcouter ce chapitre</div>\r\n                                                                <div className=\"text-xs text-gray-400\">Voix fran├ºaise naturelle</div>\r\n                                                            </div>\r\n                                                            {isSpeaking ? (\r\n                                                                <div className=\"flex items-center gap-2\">\r\n                                                                    <button\r\n                                                                        onClick={togglePause}\r\n                                                                        className={`p-2 rounded-lg transition-all ${isPaused ? 'bg-yellow-500/20 text-yellow-400' : 'bg-blue-500/20 text-blue-400'}`}\r\n                                                                    >\r\n                                                                        {isPaused ? 'ÔûÂ´©Å' : 'ÔÅ©´©Å'}\r\n                                                                    </button>\r\n                                                                    <button\r\n                                                                        onClick={stopSpeaking}\r\n                                                                        className=\"p-2 rounded-lg bg-red-500/20 text-red-400\"\r\n                                                                    >\r\n                                                                        ÔÅ╣´©Å\r\n                                                                    </button>\r\n                                                                </div>\r\n                                                            ) : (\r\n                                                                <button\r\n                                                                    onClick={() => startSpeaking(activeChapter.content)}\r\n                                                                    className=\"flex items-center gap-2 px-4 py-2 rounded-lg bg-[#2DD4BF] text-black font-bold hover:bg-[#2DD4BF]/90 transition-all\"\r\n                                                                >\r\n                                                                    ÔûÂ´©Å ├ëcouter\r\n                                                                </button>\r\n                                                            )}\r\n                                                        </div>\r\n                                                    )}\r\n                                                    {activeChapter?.story && (\r\n                                                        <div className=\"mb-8 md:mb-10 p-4 md:p-6 rounded-2xl bg-gradient-to-br from-indigo-900/20 to-purple-900/20 border border-indigo-500/20 relative overflow-hidden group hover:border-indigo-500/40 transition-all\">\r\n                                                            <div className=\"absolute top-0 right-0 p-6 text-8xl opacity-5 group-hover:opacity-10 transition-opacity select-none\">­ƒôû</div>\r\n                                                            <h3 className=\"text-lg font-bold text-indigo-300 mb-3 flex items-center gap-2\">\r\n                                                                <span className=\"text-xl\">Ô£¿</span> La Petite Histoire\r\n                                                            </h3>\r\n                                                            <p className=\"text-gray-300 italic leading-relaxed text-base md:text-lg font-serif\">\r\n                                                                &quot;{activeChapter.story}&quot;\r\n                                                            </p>\r\n                                                        </div>\r\n                                                    )}\r\n\r\n                                                    {/* Main Content */}\r\n                                                    <div className=\"prose prose-invert prose-sm md:prose-lg max-w-none  \r\n                                                        prose-headings:text-gray-100 prose-headings:font-bold prose-headings:tracking-tight\r\n                                                        prose-p:text-gray-300 prose-p:leading-relaxed\r\n                                                        prose-strong:text-white prose-strong:font-black\r\n                                                        prose-ul:text-gray-300 prose-li:marker:text-blue-500\r\n                                                        prose-code:text-[#2DD4BF] prose-code:bg-white/10 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:font-mono prose-code:text-sm\r\n                                                        prose-pre:bg-gradient-to-br prose-pre:from-[#1a1f2e] prose-pre:to-[#0d1117] prose-pre:border prose-pre:border-cyan-500/20 prose-pre:rounded-xl prose-pre:shadow-lg prose-pre:shadow-cyan-500/5\r\n                                                        prose-img:rounded-xl prose-img:border prose-img:border-white/10 prose-img:mx-auto prose-img:block prose-img:shadow-lg\r\n                                                        prose-table:border-collapse prose-th:bg-white/5 prose-th:border prose-th:border-white/10 prose-th:px-4 prose-th:py-2\r\n                                                        prose-td:border prose-td:border-white/10 prose-td:px-4 prose-td:py-2\">\r\n\r\n                                                        {/* Module Info Banner for Data Science Projects */}\r\n                                                        {selectedCourse.isProject && activeChapter?.part && (\r\n                                                            <div className=\"not-prose mb-8 p-4 rounded-xl bg-gradient-to-r from-cyan-500/10 via-blue-500/10 to-purple-500/10 border border-cyan-500/20\">\r\n                                                                <div className=\"flex items-center gap-3\">\r\n                                                                    <span className=\"text-3xl\">­ƒôÜ</span>\r\n                                                                    <div>\r\n                                                                        <div className=\"text-cyan-400 font-bold text-sm uppercase tracking-wider\">{activeChapter.part}</div>\r\n                                                                        <div className=\"text-gray-400 text-sm\">Objectif : Ma├«triser les concepts cl├®s de ce module</div>\r\n                                                                    </div>\r\n                                                                </div>\r\n                                                            </div>\r\n                                                        )}\r\n\r\n                                                        <ReactMarkdown\r\n                                                            remarkPlugins={[remarkMath]}\r\n                                                            rehypePlugins={[rehypeRaw, rehypeKatex]}\r\n                                                            components={{\r\n                                                                pre: ({ children }) => (\r\n                                                                    <div className=\"not-prose my-6 rounded-xl overflow-hidden border border-cyan-500/30 shadow-lg shadow-cyan-500/10\">\r\n                                                                        <div className=\"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-cyan-500/20 to-blue-500/20 border-b border-cyan-500/20\">\r\n                                                                            <div className=\"flex gap-1.5\">\r\n                                                                                <div className=\"w-3 h-3 rounded-full bg-red-500/80\"></div>\r\n                                                                                <div className=\"w-3 h-3 rounded-full bg-yellow-500/80\"></div>\r\n                                                                                <div className=\"w-3 h-3 rounded-full bg-green-500/80\"></div>\r\n                                                                            </div>\r\n                                                                            <span className=\"text-cyan-400 text-xs font-mono ml-2\">Python</span>\r\n                                                                            <span className=\"ml-auto text-gray-500 text-xs\">­ƒÆí Code ex├®cutable</span>\r\n                                                                        </div>\r\n                                                                        <pre className=\"!bg-[#0d1117] !m-0 !rounded-none !border-0 p-4 overflow-x-auto text-sm\">\r\n                                                                            {children}\r\n                                                                        </pre>\r\n                                                                    </div>\r\n                                                                ),\r\n                                                                code: ({ className, children, ...props }) => {\r\n                                                                    const isInline = !className;\r\n                                                                    if (isInline) {\r\n                                                                        return <code className=\"text-[#2DD4BF] bg-white/10 px-1.5 py-0.5 rounded font-mono text-sm\" {...props}>{children}</code>;\r\n                                                                    }\r\n                                                                    return <code className=\"font-mono text-sm text-gray-200\" {...props}>{children}</code>;\r\n                                                                }\r\n                                                            }}\r\n                                                        >\r\n                                                            {stripIndentation(activeChapter?.content || '')}\r\n                                                        </ReactMarkdown>\r\n                                                    </div>\r\n\r\n                                                    {/* Key Points / Summary */}\r\n                                                    {activeChapter?.summary && (\r\n                                                        <div className=\"mt-12 p-6 rounded-2xl bg-emerald-900/10 border border-emerald-500/20\">\r\n                                                            <h3 className=\"text-lg font-bold text-emerald-400 mb-4 flex items-center gap-2\">\r\n                                                                <span className=\"text-xl\">­ƒÆí</span> Ce qu&apos;il faut retenir\r\n                                                            </h3>\r\n                                                            <ul className=\"space-y-3\">\r\n                                                                {activeChapter.summary.map((point, idx) => (\r\n                                                                    <li key={idx} className=\"flex items-start gap-3 text-gray-300 text-base\">\r\n                                                                        <div className=\"w-1.5 h-1.5 rounded-full bg-emerald-500 mt-2.5 shrink-0\"></div>\r\n                                                                        <div className=\"flex-1\">\r\n                                                                            <ReactMarkdown\r\n                                                                                remarkPlugins={[remarkMath]}\r\n                                                                                rehypePlugins={[rehypeRaw, rehypeKatex]}\r\n                                                                            >\r\n                                                                                {point}\r\n                                                                            </ReactMarkdown>\r\n                                                                        </div>\r\n                                                                    </li>\r\n                                                                ))}\r\n                                                            </ul>\r\n                                                        </div>\r\n                                                    )}\r\n\r\n                                                    {/* Analogie P├®dagogique */}\r\n                                                    {activeChapter?.analogy && (\r\n                                                        <div className=\"mt-12 p-6 rounded-2xl bg-gradient-to-br from-amber-900/20 via-orange-900/10 to-yellow-900/20 border border-amber-500/20 relative overflow-hidden group hover:border-amber-500/40 transition-all\">\r\n                                                            <div className=\"absolute top-0 right-0 p-6 text-8xl opacity-5 group-hover:opacity-10 transition-opacity select-none\">­ƒîì</div>\r\n                                                            <h3 className=\"text-lg font-bold text-amber-300 mb-4 flex items-center gap-2\">\r\n                                                                <span className=\"text-2xl\">{activeChapter.analogy.title.split(' ')[0]}</span>\r\n                                                                {activeChapter.analogy.title.replace(/^[^\\s]+\\s/, '')}\r\n                                                            </h3>\r\n                                                            <div className=\"prose prose-invert prose-sm max-w-none prose-strong:text-amber-200 prose-strong:font-bold prose-p:text-gray-300 prose-p:leading-relaxed\">\r\n                                                                <ReactMarkdown\r\n                                                                    remarkPlugins={[remarkMath]}\r\n                                                                    rehypePlugins={[rehypeRaw, rehypeKatex]}\r\n                                                                >\r\n                                                                    {activeChapter.analogy.content}\r\n                                                                </ReactMarkdown>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    )}\r\n\r\n                                                    {/* Lien vers la Simulation */}\r\n                                                    {activeChapter?.simulation && (\r\n                                                        <div className=\"mt-12 p-6 rounded-2xl bg-gradient-to-br from-cyan-900/30 via-blue-900/20 to-purple-900/20 border border-cyan-500/30 relative overflow-hidden group hover:scale-[1.01] transition-all cursor-pointer\">\r\n                                                            <Link href={`/simulations/${activeChapter.simulation.id}?returnTo=courses&chapter=${activeChapter.id}`}>\r\n                                                                <div className=\"flex items-center gap-6\">\r\n                                                                    <div className=\"w-20 h-20 rounded-2xl bg-gradient-to-br from-cyan-500/30 to-blue-500/30 flex items-center justify-center text-5xl border border-cyan-500/20 group-hover:scale-110 transition-transform shadow-lg shadow-cyan-500/10\">\r\n                                                                        ­ƒÄ«\r\n                                                                    </div>\r\n                                                                    <div className=\"flex-1\">\r\n                                                                        <div className=\"text-xs font-bold text-cyan-400 uppercase tracking-wider mb-1\">\r\n                                                                            ­ƒÜÇ Simulation Interactive\r\n                                                                        </div>\r\n                                                                        <h4 className=\"text-xl font-bold text-white mb-1 group-hover:text-cyan-400 transition-colors\">\r\n                                                                            {activeChapter.simulation.title}\r\n                                                                        </h4>\r\n                                                                        <p className=\"text-sm text-gray-400\">\r\n                                                                            Exp├®rimente ce concept en 3D pour mieux le comprendre !\r\n                                                                        </p>\r\n                                                                    </div>\r\n                                                                    <div className=\"text-3xl group-hover:translate-x-2 transition-transform\">\r\n                                                                        ÔåÆ\r\n                                                                    </div>\r\n                                                                </div>\r\n                                                            </Link>\r\n                                                        </div>\r\n                                                    )}\r\n\r\n                                                    {/* Image Interactive du Chapitre */}\r\n                                                    {activeChapter?.image && (\r\n                                                        <div className=\"mt-12 group\">\r\n                                                            <div className=\"text-xs font-bold text-purple-400 uppercase tracking-wider mb-3 flex items-center gap-2\">\r\n                                                                <span className=\"text-lg\">­ƒû╝´©Å</span> Illustration Interactive\r\n                                                            </div>\r\n                                                            <div\r\n                                                                className=\"relative rounded-2xl overflow-hidden border-2 border-purple-500/30 shadow-2xl shadow-purple-500/10 cursor-zoom-in transition-all duration-500 hover:border-purple-500/60 hover:shadow-purple-500/30\"\r\n                                                                onClick={(e) => {\r\n                                                                    const img = e.currentTarget.querySelector('img');\r\n                                                                    if (img) {\r\n                                                                        // Toggle fullscreen lightbox\r\n                                                                        if (!document.getElementById('lightbox-overlay')) {\r\n                                                                            const overlay = document.createElement('div');\r\n                                                                            overlay.id = 'lightbox-overlay';\r\n                                                                            overlay.className = 'fixed inset-0 z-[9999] bg-black/95 flex items-center justify-center p-4 cursor-zoom-out animate-fade-in';\r\n                                                                            overlay.onclick = () => overlay.remove();\r\n                                                                            const imgClone = img.cloneNode();\r\n                                                                            imgClone.className = 'max-w-full max-h-[90vh] object-contain rounded-xl shadow-2xl animate-scale-in';\r\n                                                                            overlay.appendChild(imgClone);\r\n                                                                            // Close button\r\n                                                                            const closeBtn = document.createElement('button');\r\n                                                                            closeBtn.className = 'absolute top-4 right-4 w-12 h-12 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center text-white text-2xl transition-all';\r\n                                                                            closeBtn.innerHTML = 'Ô£ò';\r\n                                                                            closeBtn.onclick = () => overlay.remove();\r\n                                                                            overlay.appendChild(closeBtn);\r\n                                                                            // Caption\r\n                                                                            const caption = document.createElement('div');\r\n                                                                            caption.className = 'absolute bottom-6 left-1/2 -translate-x-1/2 px-6 py-3 rounded-full bg-black/80 backdrop-blur-xl text-white font-medium border border-white/20';\r\n                                                                            caption.textContent = img.alt;\r\n                                                                            overlay.appendChild(caption);\r\n                                                                            document.body.appendChild(overlay);\r\n                                                                        }\r\n                                                                    }\r\n                                                                }}\r\n                                                            >\r\n                                                                {/* Gradient overlay */}\r\n                                                                <div className=\"absolute inset-0 bg-gradient-to-t from-purple-900/60 via-transparent to-cyan-900/30 opacity-60 group-hover:opacity-40 transition-opacity pointer-events-none z-10\"></div>\r\n\r\n                                                                {/* Image */}\r\n                                                                <img\r\n                                                                    src={activeChapter.image}\r\n                                                                    alt={activeChapter.title}\r\n                                                                    className=\"w-full h-64 md:h-80 object-cover transition-transform duration-700 group-hover:scale-110\"\r\n                                                                />\r\n\r\n                                                                {/* Hover overlay */}\r\n                                                                <div className=\"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300 z-20\">\r\n                                                                    <div className=\"px-6 py-3 rounded-full bg-white/20 backdrop-blur-xl border border-white/30 text-white font-bold flex items-center gap-2 transform scale-90 group-hover:scale-100 transition-transform\">\r\n                                                                        <span className=\"text-xl\">­ƒöì</span> Cliquez pour agrandir\r\n                                                                    </div>\r\n                                                                </div>\r\n\r\n                                                                {/* Bottom info bar */}\r\n                                                                <div className=\"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/90 to-transparent z-10\">\r\n                                                                    <div className=\"flex items-center justify-between\">\r\n                                                                        <span className=\"px-3 py-1 rounded-full bg-purple-500/30 text-purple-300 text-xs font-bold uppercase tracking-wider border border-purple-500/30\">\r\n                                                                            {activeChapter.part?.split(':')[0] || 'Illustration'}\r\n                                                                        </span>\r\n                                                                        <span className=\"text-gray-400 text-sm flex items-center gap-1\">\r\n                                                                            <span>­ƒôÀ</span> Sch├®ma explicatif\r\n                                                                        </span>\r\n                                                                    </div>\r\n                                                                </div>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    )}\r\n                                                    {/* In Training Mode, Show Exercises Below Content */}\r\n                                                    {selectedCourse.id.includes('entrainement') && (\r\n                                                        <div className=\"mt-16 pt-10 border-t border-white/10 space-y-8\">\r\n                                                            <h2 className=\"text-2xl font-bold mb-6\">Questions</h2>\r\n                                                            {(activeChapter?.defis || activeChapter?.exercises || []).map((ex, idx) => (\r\n                                                                <div key={ex.id} className=\"bg-black/30 rounded-xl p-4 md:p-6 border border-white/10\">\r\n                                                                    <div className=\"flex items-start gap-4 mb-4\">\r\n                                                                        <span className=\"w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center font-bold text-sm shrink-0\">\r\n                                                                            {idx + 1}\r\n                                                                        </span>\r\n                                                                        <div className=\"text-lg font-medium pt-1\">\r\n                                                                            <ReactMarkdown remarkPlugins={[remarkMath]} rehypePlugins={[rehypeKatex, rehypeRaw]}>\r\n                                                                                {ex.question}\r\n                                                                            </ReactMarkdown>\r\n                                                                        </div>\r\n                                                                    </div>\r\n\r\n                                                                    <div className=\"space-y-3 pl-0 md:pl-12\">\r\n                                                                        {ex.options.map((option, optIdx) => {\r\n                                                                            const isSelected = quizAnswers[`${activeChapter.id}-${ex.id}`] === optIdx;\r\n                                                                            const isCorrect = quizResults[`${activeChapter.id}-${ex.id}`];\r\n\r\n                                                                            let btnClass = \"w-full text-left p-4 rounded-lg border transition-all \";\r\n                                                                            if (isSelected) {\r\n                                                                                if (isCorrect) btnClass += \"bg-green-500/20 border-green-500 text-green-400\";\r\n                                                                                else btnClass += \"bg-red-500/20 border-red-500 text-red-400\";\r\n                                                                            } else {\r\n                                                                                btnClass += \"bg-white/5 border-white/10 hover:bg-white/10\";\r\n                                                                            }\r\n\r\n                                                                            return (\r\n                                                                                <button\r\n                                                                                    key={optIdx}\r\n                                                                                    onClick={() => handleQuizSubmit(activeChapter.id, ex.id, optIdx)}\r\n                                                                                    disabled={quizAnswers[`${activeChapter.id}-${ex.id}`] !== undefined}\r\n                                                                                    className={btnClass}\r\n                                                                                >\r\n                                                                                    <div className=\"flex items-center justify-between\">\r\n                                                                                        <div>\r\n                                                                                            <ReactMarkdown\r\n                                                                                                remarkPlugins={[remarkMath]}\r\n                                                                                                rehypePlugins={[rehypeKatex, rehypeRaw]}\r\n                                                                                                components={{ p: ({ node, ...props }) => <span {...props} /> }}\r\n                                                                                            >\r\n                                                                                                {option}\r\n                                                                                            </ReactMarkdown>\r\n                                                                                        </div>\r\n                                                                                        {isSelected && (\r\n                                                                                            isCorrect ? <CheckCircle size={20} /> : <XCircle size={20} />\r\n                                                                                        )}\r\n                                                                                    </div>\r\n                                                                                </button>\r\n                                                                            );\r\n                                                                        })}\r\n                                                                    </div>\r\n\r\n                                                                    {quizAnswers[`${activeChapter.id}-${ex.id}`] !== undefined && (\r\n                                                                        <div className={`mt-4 ml-0 md:ml-12 p-4 rounded-lg text-sm ${quizResults[`${activeChapter.id}-${ex.id}`] ? 'bg-green-900/20 text-green-300' : 'bg-red-900/20 text-red-300'}`}>\r\n                                                                            <strong>Explication :</strong>\r\n                                                                            <span className=\"inline-block ml-1\">\r\n                                                                                <ReactMarkdown\r\n                                                                                    remarkPlugins={[remarkMath]}\r\n                                                                                    rehypePlugins={[rehypeKatex, rehypeRaw]}\r\n                                                                                    components={{ p: ({ node, ...props }) => <span {...props} /> }}\r\n                                                                                >\r\n                                                                                    {ex.explanation}\r\n                                                                                </ReactMarkdown>\r\n                                                                            </span>\r\n                                                                        </div>\r\n                                                                    )}\r\n                                                                </div>\r\n                                                            ))}\r\n                                                        </div>\r\n                                                    )}\r\n                                                </div>\r\n                                            ) : (\r\n                                                <div className=\"max-w-3xl mx-auto space-y-8\">\r\n                                                    <h2 className=\"text-2xl font-bold mb-6 flex items-center gap-3\">\r\n                                                        <span className=\"text-3xl\">­ƒÄ»</span> D├®fis\r\n                                                    </h2>\r\n                                                    {(activeChapter?.defis || activeChapter?.exercises || []).map((ex, idx) => (\r\n                                                        <div key={ex.id} className=\"bg-black/30 rounded-xl p-4 md:p-6 border border-white/10\">\r\n                                                            <div className=\"flex items-start gap-4 mb-4\">\r\n                                                                <span className=\"w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center font-bold text-sm shrink-0\">\r\n                                                                    {idx + 1}\r\n                                                                </span>\r\n                                                                <div className=\"text-lg font-medium pt-1\">\r\n                                                                    <ReactMarkdown remarkPlugins={[remarkMath]} rehypePlugins={[rehypeKatex, rehypeRaw]}>\r\n                                                                        {ex.question}\r\n                                                                    </ReactMarkdown>\r\n                                                                </div>\r\n                                                            </div>\r\n\r\n                                                            <div className=\"space-y-3 pl-0 md:pl-12\">\r\n                                                                {ex.options.map((option, optIdx) => {\r\n                                                                    const isSelected = quizAnswers[`${activeChapter.id}-${ex.id}`] === optIdx;\r\n                                                                    const isCorrect = quizResults[`${activeChapter.id}-${ex.id}`];\r\n\r\n                                                                    let btnClass = \"w-full text-left p-4 rounded-lg border transition-all \";\r\n                                                                    if (isSelected) {\r\n                                                                        if (isCorrect) btnClass += \"bg-green-500/20 border-green-500 text-green-400\";\r\n                                                                        else btnClass += \"bg-red-500/20 border-red-500 text-red-400\";\r\n                                                                    } else {\r\n                                                                        btnClass += \"bg-white/5 border-white/10 hover:bg-white/10\";\r\n                                                                    }\r\n\r\n                                                                    return (\r\n                                                                        <button\r\n                                                                            key={optIdx}\r\n                                                                            onClick={() => handleQuizSubmit(activeChapter.id, ex.id, optIdx)}\r\n                                                                            disabled={quizAnswers[`${activeChapter.id}-${ex.id}`] !== undefined}\r\n                                                                            className={btnClass}\r\n                                                                        >\r\n                                                                            <div className=\"flex items-center justify-between\">\r\n                                                                                <div>\r\n                                                                                    <ReactMarkdown\r\n                                                                                        remarkPlugins={[remarkMath]}\r\n                                                                                        rehypePlugins={[rehypeKatex, rehypeRaw]}\r\n                                                                                        components={{ p: ({ node, ...props }) => <span {...props} /> }}\r\n                                                                                    >\r\n                                                                                        {option}\r\n                                                                                    </ReactMarkdown>\r\n                                                                                </div>\r\n                                                                                {isSelected && (\r\n                                                                                    isCorrect ? <CheckCircle size={20} /> : <XCircle size={20} />\r\n                                                                                )}\r\n                                                                            </div>\r\n                                                                        </button>\r\n                                                                    );\r\n                                                                })}\r\n                                                            </div>\r\n\r\n                                                            {quizAnswers[`${activeChapter.id}-${ex.id}`] !== undefined && (\r\n                                                                <div className={`mt-4 ml-0 md:ml-12 p-4 rounded-lg text-sm ${quizResults[`${activeChapter.id}-${ex.id}`] ? 'bg-green-900/20 text-green-300' : 'bg-red-900/20 text-red-300'}`}>\r\n                                                                    <strong>Explication :</strong>\r\n                                                                    <span className=\"inline-block ml-1\">\r\n                                                                        <ReactMarkdown\r\n                                                                            remarkPlugins={[remarkMath]}\r\n                                                                            rehypePlugins={[rehypeKatex, rehypeRaw]}\r\n                                                                            components={{ p: ({ node, ...props }) => <span {...props} /> }}\r\n                                                                        >\r\n                                                                            {ex.explanation}\r\n                                                                        </ReactMarkdown>\r\n                                                                    </span>\r\n                                                                </div>\r\n                                                            )}\r\n                                                        </div>\r\n                                                    ))}\r\n                                                </div>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            ) : (\r\n                                // FALLBACK PDF VIEWER\r\n                                <div className=\"flex-1 bg-[#0F1115] rounded-2xl border border-white/10 overflow-hidden\">\r\n                                    <iframe\r\n                                        src={selectedCourse.file}\r\n                                        className=\"w-full h-full\"\r\n                                        title={selectedCourse.title}\r\n                                    />\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Floating Audio Player */}\r\n            {isSpeaking && (\r\n                <div className=\"fixed bottom-6 left-1/2 -translate-x-1/2 z-50\">\r\n                    <div className=\"flex items-center gap-4 px-5 py-3 rounded-full bg-[#0F1115] border border-[#2DD4BF]/30 shadow-lg\">\r\n                        <div className=\"w-2 h-2 rounded-full bg-[#2DD4BF] animate-pulse\"></div>\r\n                        <span className=\"text-sm text-gray-300\">Lecture en cours</span>\r\n                        <button onClick={togglePause} className={`p-2 rounded-full ${isPaused ? 'bg-yellow-500/20 text-yellow-400' : 'bg-blue-500/20 text-blue-400'}`}>\r\n                            {isPaused ? 'ÔûÂ´©Å' : 'ÔÅ©´©Å'}\r\n                        </button>\r\n                        <button onClick={stopSpeaking} className=\"p-2 rounded-full bg-red-500/20 text-red-400\">\r\n                            ÔÅ╣´©Å\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </main>\r\n    );\r\n}\r\n\r\nexport default function CoursesPage() {\r\n    return (\r\n        <Suspense fallback={<div className=\"min-h-screen bg-black flex items-center justify-center text-[#2DD4BF]\">Chargement...</div>}>\r\n            <CoursesContent />\r\n        </Suspense>\r\n    );\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\engineering\\page.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\engineering\\projectData.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\exams\\examsData.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\exams\\page.js","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":257,"column":98,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[15598,15813],"text":"\r\n                                                    Voici les ├®l├®ments de r├®ponse. Assurez-vous d&apos;avoir bien cherch├® par vous-m├¬me avant de consulter la solution !\r\n                                                "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[15598,15813],"text":"\r\n                                                    Voici les ├®l├®ments de r├®ponse. Assurez-vous d&lsquo;avoir bien cherch├® par vous-m├¬me avant de consulter la solution !\r\n                                                "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[15598,15813],"text":"\r\n                                                    Voici les ├®l├®ments de r├®ponse. Assurez-vous d&#39;avoir bien cherch├® par vous-m├¬me avant de consulter la solution !\r\n                                                "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[15598,15813],"text":"\r\n                                                    Voici les ├®l├®ments de r├®ponse. Assurez-vous d&rsquo;avoir bien cherch├® par vous-m├¬me avant de consulter la solution !\r\n                                                "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport examsData from './examsData';\r\nimport RichText from '@/components/RichText';\r\n\r\nexport default function ExamsPage() {\r\n    const [filterType, setFilterType] = useState('ALL'); // ALL, BFEM, BAC, BAC S1, BAC S2\r\n    const [filterSubject, setFilterSubject] = useState('ALL'); // ALL, Math├®matiques, Physique-Chimie\r\n    const [selectedExam, setSelectedExam] = useState(null); // For the modal\r\n    const [showCorrection, setShowCorrection] = useState(false); // Toggle between Subject and Correction\r\n\r\n    // Effects for body scroll lock\r\n    const [isExamOpen, setIsExamOpen] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (isExamOpen) {\r\n            document.body.style.overflow = 'hidden';\r\n        } else {\r\n            document.body.style.overflow = 'unset';\r\n        }\r\n    }, [isExamOpen]);\r\n\r\n    const filteredExams = examsData.filter(exam => {\r\n        const typeMatch = filterType === 'ALL' || exam.type === filterType || (filterType === 'BAC' && exam.type.startsWith('BAC'));\r\n        const subjectMatch = filterSubject === 'ALL' || exam.subject === filterSubject;\r\n        return typeMatch && subjectMatch;\r\n    });\r\n\r\n    const openExam = (exam) => {\r\n        setSelectedExam(exam);\r\n        setShowCorrection(false);\r\n        setIsExamOpen(true);\r\n    };\r\n\r\n    const closeExam = () => {\r\n        setSelectedExam(null);\r\n        setShowCorrection(false);\r\n        setIsExamOpen(false);\r\n    };\r\n\r\n    return (\r\n        <main className=\"min-h-screen bg-black text-white selection:bg-[#2DD4BF] selection:text-black\">\r\n            {/* --- Hero Section with Background Glow --- */}\r\n            <div className=\"relative pt-32 pb-20 px-4 overflow-hidden\">\r\n                <div className=\"absolute top-0 left-1/2 -translate-x-1/2 w-[800px] h-[500px] bg-[#2DD4BF]/10 blur-[120px] rounded-full pointer-events-none\" />\r\n\r\n                <section className=\"relative max-w-7xl mx-auto text-center z-10\">\r\n                    <div className=\"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/5 border border-white/10 backdrop-blur-md mb-8 hover:bg-white/10 transition-colors cursor-default\">\r\n                        <span className=\"w-2 h-2 rounded-full bg-[#2DD4BF] animate-pulse\" />\r\n                        <span className=\"text-gray-300 text-sm font-medium tracking-wide\">BANQUE D&apos;├ëPREUVES OFFICIELLES</span>\r\n                    </div>\r\n\r\n                    <h1 className=\"text-5xl md:text-7xl font-black mb-8 tracking-tight\">\r\n                        Pr├®parez votre<br />\r\n                        <span className=\"text-transparent bg-clip-text bg-gradient-to-r from-white via-[#2DD4BF] to-[#818CF8] animate-gradient-x\">\r\n                            R├®ussite aux Examens\r\n                        </span>\r\n                    </h1>\r\n\r\n                    <p className=\"text-xl text-gray-400 max-w-2xl mx-auto leading-relaxed\">\r\n                        Acc├®dez gratuitement aux sujets corrig├®s du BFEM et du BAC (S1, S2).\r\n                        Une ressource indispensable pour s&apos;entra├«ner en conditions r├®elles.\r\n                    </p>\r\n                </section>\r\n            </div>\r\n\r\n            {/* --- Filters Section --- */}\r\n            <section className=\"sticky top-20 z-30 bg-black/80 backdrop-blur-xl border-y border-white/5 py-4 mb-12\">\r\n                <div className=\"max-w-7xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-4\">\r\n                    {/* Type Filter */}\r\n                    <div className=\"flex bg-white/5 p-1.5 rounded-2xl gap-1\">\r\n                        {['ALL', 'BFEM', 'BAC S1', 'BAC S2'].map(type => (\r\n                            <button\r\n                                key={type}\r\n                                onClick={() => setFilterType(type)}\r\n                                className={`px-5 py-2 rounded-xl text-sm font-bold transition-all duration-300 ${filterType === type\r\n                                    ? 'bg-[#2DD4BF] text-black shadow-lg shadow-[#2DD4BF]/20 scale-105'\r\n                                    : 'text-gray-400 hover:text-white hover:bg-white/5'\r\n                                    }`}\r\n                            >\r\n                                {type === 'ALL' ? 'Tout' : type}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n\r\n                    {/* Subject Filter */}\r\n                    <div className=\"flex bg-white/5 p-1.5 rounded-2xl gap-1 overflow-x-auto max-w-full\">\r\n                        {['ALL', 'Math├®matiques', 'Physique-Chimie'].map(subject => (\r\n                            <button\r\n                                key={subject}\r\n                                onClick={() => setFilterSubject(subject)}\r\n                                className={`px-5 py-2 rounded-xl text-sm font-bold transition-all duration-300 whitespace-nowrap ${filterSubject === subject\r\n                                    ? 'bg-[#818CF8] text-white shadow-lg shadow-[#818CF8]/20 scale-105'\r\n                                    : 'text-gray-400 hover:text-white hover:bg-white/5'\r\n                                    }`}\r\n                            >\r\n                                {subject === 'ALL' ? 'Toutes les mati├¿res' : subject}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            </section>\r\n\r\n            {/* --- Content Grid --- */}\r\n            <div className=\"max-w-7xl mx-auto px-4 pb-20\">\r\n                {filteredExams.length === 0 ? (\r\n                    <div className=\"text-center py-20\">\r\n                        <p className=\"text-2xl text-gray-500 font-bold\">Aucun sujet trouv├® pour ces crit├¿res.</p>\r\n                        <button\r\n                            onClick={() => { setFilterType('ALL'); setFilterSubject('ALL') }}\r\n                            className=\"mt-4 text-[#2DD4BF] hover:underline\"\r\n                        >\r\n                            R├®initialiser les filtres\r\n                        </button>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\r\n                        {filteredExams.map((exam) => (\r\n                            <div\r\n                                key={exam.id}\r\n                                onClick={() => openExam(exam)}\r\n                                className=\"group relative bg-[#0A0A0A] rounded-3xl border border-white/5 overflow-hidden hover:border-[#2DD4BF]/30 transition-all duration-500 hover:shadow-2xl hover:shadow-[#2DD4BF]/5 hover:-translate-y-2 cursor-pointer\"\r\n                            >\r\n                                {/* Card Header with Color Splash */}\r\n                                <div className={`h-2 w-full ${exam.type.includes('BAC') ? 'bg-gradient-to-r from-yellow-400 to-orange-500' : 'bg-gradient-to-r from-[#2DD4BF] to-teal-500'}`} />\r\n\r\n                                <div className=\"p-8\">\r\n                                    <div className=\"flex justify-between items-start mb-6\">\r\n                                        <div className=\"flex gap-2\">\r\n                                            <span className={`px-3 py-1 rounded-lg text-xs font-bold tracking-wider ${exam.type.includes('BAC')\r\n                                                    ? 'bg-yellow-500/10 text-yellow-400 border border-yellow-500/20'\r\n                                                    : 'bg-[#2DD4BF]/10 text-[#2DD4BF] border border-[#2DD4BF]/20'\r\n                                                }`}>\r\n                                                {exam.type}\r\n                                            </span>\r\n                                            <span className=\"px-3 py-1 rounded-lg bg-white/5 text-gray-400 text-xs font-bold border border-white/10\">\r\n                                                {exam.subject.substring(0, 4).toUpperCase()}.\r\n                                            </span>\r\n                                        </div>\r\n                                        <div className=\"flex items-center gap-1 text-xs font-bold text-gray-500\">\r\n                                            <span className=\"w-2 h-2 rounded-full bg-gray-700\" />\r\n                                            {exam.duration}\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <h3 className=\"text-2xl font-bold text-white mb-3 group-hover:text-[#2DD4BF] transition-colors leading-tight\">\r\n                                        {exam.title}\r\n                                    </h3>\r\n\r\n                                    <p className=\"text-gray-400 text-sm leading-relaxed mb-6 line-clamp-2\">\r\n                                        {exam.description}\r\n                                    </p>\r\n\r\n                                    {/* Topics Pills */}\r\n                                    <div className=\"flex flex-wrap gap-2 mt-auto\">\r\n                                        {exam.topics.slice(0, 3).map((topic, i) => (\r\n                                            <span key={i} className=\"px-2.5 py-1 rounded-md bg-white/5 text-xs text-gray-300 border border-white/5 group-hover:border-white/20 transition-colors\">\r\n                                                {topic}\r\n                                            </span>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Hover Action */}\r\n                                <div className=\"absolute bottom-0 left-0 w-full h-1 bg-[#2DD4BF] scale-x-0 group-hover:scale-x-100 transition-transform duration-500 origin-left\" />\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* --- Premium Modal --- */}\r\n            {selectedExam && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 md:p-8\">\r\n                    {/* Backdrop */}\r\n                    <div\r\n                        className=\"absolute inset-0 bg-black/90 backdrop-blur-md transition-opacity duration-300\"\r\n                        onClick={closeExam}\r\n                    />\r\n\r\n                    {/* Modal Content */}\r\n                    <div\r\n                        className=\"relative w-full max-w-5xl h-[85vh] bg-[#121212] rounded-[32px] border border-white/10 shadow-2xl flex flex-col overflow-hidden animate-in zoom-in-95 duration-300\"\r\n                    >\r\n                        {/* Header */}\r\n                        <div className=\"flex items-center justify-between px-8 py-6 border-b border-white/5 bg-[#1A1A1A]\">\r\n                            <div className=\"flex items-center gap-4\">\r\n                                <div className={`w-12 h-12 rounded-2xl flex items-center justify-center font-black text-xl shadow-lg ${selectedExam.type.includes('BAC')\r\n                                        ? 'bg-gradient-to-br from-yellow-400 to-orange-600 text-white'\r\n                                        : 'bg-gradient-to-br from-[#2DD4BF] to-teal-600 text-black'\r\n                                    }`}>\r\n                                    {selectedExam.type.charAt(0)}\r\n                                </div>\r\n                                <div>\r\n                                    <h2 className=\"text-xl font-bold text-white\">{selectedExam.title}</h2>\r\n                                    <p className=\"text-sm text-gray-400 font-medium\">{selectedExam.subject} ÔÇó {selectedExam.duration}</p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"flex items-center gap-4\">\r\n                                {/* Toggle Switch */}\r\n                                <div className=\"hidden md:flex bg-black p-1 rounded-xl border border-white/10\">\r\n                                    <button\r\n                                        onClick={() => setShowCorrection(false)}\r\n                                        className={`px-6 py-2 rounded-lg text-sm font-bold transition-all ${!showCorrection ? 'bg-white text-black shadow-md' : 'text-gray-400 hover:text-white'\r\n                                            }`}\r\n                                    >\r\n                                        Sujet\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => setShowCorrection(true)}\r\n                                        className={`px-6 py-2 rounded-lg text-sm font-bold transition-all ${showCorrection ? 'bg-[#2DD4BF] text-black shadow-md' : 'text-gray-400 hover:text-white'\r\n                                            }`}\r\n                                    >\r\n                                        Correction\r\n                                    </button>\r\n                                </div>\r\n\r\n                                <button\r\n                                    onClick={closeExam}\r\n                                    className=\"w-10 h-10 flex items-center justify-center rounded-full bg-white/5 hover:bg-white/10 text-gray-400 hover:text-white transition-colors\"\r\n                                >\r\n                                    Ô£ò\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Mobile Toggle (Visible only on small screens) */}\r\n                        <div className=\"md:hidden flex border-b border-white/5 bg-black\">\r\n                            <button\r\n                                onClick={() => setShowCorrection(false)}\r\n                                className={`flex-1 py-4 text-sm font-bold border-b-2 transition-all ${!showCorrection ? 'text-white border-white' : 'text-gray-500 border-transparent'\r\n                                    }`}\r\n                            >\r\n                                SUJET\r\n                            </button>\r\n                            <button\r\n                                onClick={() => setShowCorrection(true)}\r\n                                className={`flex-1 py-4 text-sm font-bold border-b-2 transition-all ${showCorrection ? 'text-[#2DD4BF] border-[#2DD4BF]' : 'text-gray-500 border-transparent'\r\n                                    }`}\r\n                            >\r\n                                CORRECTION\r\n                            </button>\r\n                        </div>\r\n\r\n                        {/* Scrollable Content */}\r\n                        <div className=\"flex-1 overflow-y-auto bg-[#0A0A0A] custom-scrollbar\">\r\n                            <div className=\"max-w-4xl mx-auto p-8 md:p-12\">\r\n                                {showCorrection ? (\r\n                                    <div className=\"animate-in slide-in-from-right-4 fade-in duration-300\">\r\n                                        <div className=\"mb-8 p-6 rounded-2xl bg-gradient-to-br from-[#2DD4BF]/10 to-transparent border border-[#2DD4BF]/20 flex gap-4 items-start\">\r\n                                            <span className=\"text-2xl\">­ƒÆí</span>\r\n                                            <div>\r\n                                                <h3 className=\"text-[#2DD4BF] font-bold text-lg mb-1\">Corrig├® D├®taill├®</h3>\r\n                                                <p className=\"text-sm text-gray-400 leading-relaxed\">\r\n                                                    Voici les ├®l├®ments de r├®ponse. Assurez-vous d'avoir bien cherch├® par vous-m├¬me avant de consulter la solution !\r\n                                                </p>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"prose prose-invert prose-lg max-w-none\">\r\n                                            <RichText>{selectedExam.correction}</RichText>\r\n                                        </div>\r\n                                    </div>\r\n                                ) : (\r\n                                    <div className=\"animate-in slide-in-from-left-4 fade-in duration-300\">\r\n                                        <div className=\"prose prose-invert prose-lg max-w-none\">\r\n                                            <RichText>{selectedExam.content}</RichText>\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Footer for actions like Print (fake) */}\r\n                        <div className=\"p-4 border-t border-white/5 bg-[#121212] flex justify-between items-center text-xs text-gray-500 px-8\">\r\n                            <span>SymLab Official ÔÇó {selectedExam.id}</span>\r\n                            <div className=\"flex gap-4\">\r\n                                <button className=\"hover:text-white transition-colors flex gap-2 items-center\">\r\n                                    <span>­ƒû¿´©Å</span> Imprimer\r\n                                </button>\r\n                                <button className=\"hover:text-white transition-colors flex gap-2 items-center\">\r\n                                    <span>Ô¼ç´©Å</span> PDF\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </main>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\layout.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\page.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\programming\\curriculum.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\programming\\new_projects.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\programming\\page.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\simulations\\[id]\\page.js","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":307,"column":17,"nodeType":"JSXOpeningElement","endLine":311,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { useSearchParams } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport Image from 'next/image';\r\nimport dynamic from 'next/dynamic';\r\nimport { collegeSimulationsData } from '../collegeData';\r\nimport { lyceeSimulationsData } from '../lyceeData';\r\nimport { getSimulationImage, simulationHotspots } from '../imageConfig';\r\nimport EnhancedQuiz from '@/components/EnhancedQuiz';\r\n\r\n// Import dynamique pour ├®viter les erreurs SSR avec Three.js\r\nconst Simulation3D = dynamic(() => import('@/components/Simulation3D'), {\r\n    ssr: false,\r\n    loading: () => (\r\n        <div className=\"w-full h-[600px] flex items-center justify-center bg-gradient-to-br from-black to-slate-900 rounded-2xl border border-white/20\">\r\n            <div className=\"text-center\">\r\n                <div className=\"text-6xl mb-4 animate-spin\">ÔÜø´©Å</div>\r\n                <p className=\"text-xl text-gray-400\">Chargement de la simulation 3D...</p>\r\n            </div>\r\n        </div>\r\n    )\r\n});\r\n\r\n// Fusionner toutes les sources de donn├®es\r\nconst allSimulationsData = {\r\n    ...collegeSimulationsData,\r\n    ...lyceeSimulationsData,\r\n};\r\n\r\n// Fonction pour d├®terminer le niveau d'une simulation\r\nconst getSimulationLevel = (simulationId) => {\r\n    if (collegeSimulationsData[simulationId]) {\r\n        return {\r\n            name: 'Coll├¿ge (BFEM)',\r\n            description: '6├¿me - 3├¿me'\r\n        };\r\n    }\r\n    if (lyceeSimulationsData[simulationId]) {\r\n        return {\r\n            name: 'Lyc├®e (BAC)',\r\n            description: 'Seconde - Terminale'\r\n        };\r\n    }\r\n    return {\r\n        name: 'Non d├®fini',\r\n        description: ''\r\n    };\r\n};\r\n\r\n// Donn├®es par d├®faut si l'ID n'est pas trouv├®\r\nconst defaultSimulation = {\r\n    title: 'Simulation non trouv├®e',\r\n    description: 'D├®sol├®, cette simulation n\\'est pas encore disponible.',\r\n    type: 'atom',\r\n    config: {},\r\n    theory: 'Contenu non disponible.',\r\n    analogy: {\r\n        title: 'Pas d\\'analogie disponible',\r\n        content: '...'\r\n    },\r\n    exercises: []\r\n};\r\n\r\n// Points d'exploration pour le mode guid├® (exemples g├®n├®riques)\r\nconst explorationPoints = [\r\n    { id: 1, title: \"Introduction\", description: \"D├®couvrez les bases de cette simulation\", icon: \"­ƒÄ»\" },\r\n    { id: 2, title: \"Interaction\", description: \"Apprenez ├á manipuler les ├®l├®ments\", icon: \"­ƒæå\" },\r\n    { id: 3, title: \"Concepts cl├®s\", description: \"Comprenez la th├®orie derri├¿re\", icon: \"­ƒÆí\" },\r\n    { id: 4, title: \"Application\", description: \"Voyez l'application dans la vie r├®elle\", icon: \"­ƒîì\" },\r\n];\r\n\r\n// Composant Badge anim├®\r\nconst AnimatedBadge = ({ children, color = \"cyan\", pulse = false }) => (\r\n    <span className={`inline-flex items-center px-3 py-1 rounded-full text-xs font-bold\r\n        ${color === 'cyan' ? 'bg-cyan-500/20 text-cyan-400 border border-cyan-500/30' : ''}\r\n        ${color === 'purple' ? 'bg-purple-500/20 text-purple-400 border border-purple-500/30' : ''}\r\n        ${color === 'green' ? 'bg-green-500/20 text-green-400 border border-green-500/30' : ''}\r\n        ${color === 'orange' ? 'bg-orange-500/20 text-orange-400 border border-orange-500/30' : ''}\r\n        ${color === 'pink' ? 'bg-pink-500/20 text-pink-400 border border-pink-500/30' : ''}\r\n        ${pulse ? 'animate-pulse' : ''}\r\n        transition-all duration-300 hover:scale-105`}>\r\n        {children}\r\n    </span>\r\n);\r\n\r\n// Composant Timer\r\nconst SessionTimer = ({ startTime }) => {\r\n    const [elapsed, setElapsed] = useState(0);\r\n\r\n    useEffect(() => {\r\n        const interval = setInterval(() => {\r\n            setElapsed(Math.floor((Date.now() - startTime) / 1000));\r\n        }, 1000);\r\n        return () => clearInterval(interval);\r\n    }, [startTime]);\r\n\r\n    const minutes = Math.floor(elapsed / 60);\r\n    const seconds = elapsed % 60;\r\n\r\n    return (\r\n        <div className=\"flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 border border-white/10\">\r\n            <span className=\"text-lg\">ÔÅ▒´©Å</span>\r\n            <span className=\"font-mono text-sm\">\r\n                {String(minutes).padStart(2, '0')}:{String(seconds).padStart(2, '0')}\r\n            </span>\r\n        </div>\r\n    );\r\n};\r\n\r\n// Composant Panneau de Contr├┤les Avanc├®s\r\nconst AdvancedControls = ({\r\n    autoRotate,\r\n    setAutoRotate,\r\n    speed,\r\n    setSpeed,\r\n    showLabels,\r\n    setShowLabels,\r\n    showGrid,\r\n    setShowGrid,\r\n    zoom,\r\n    setZoom\r\n}) => (\r\n    <div className=\"p-4 rounded-xl bg-gradient-to-br from-white/10 to-white/5 border border-white/20 space-y-4\">\r\n        <h4 className=\"text-sm font-bold text-[#00F5D4] flex items-center gap-2\">\r\n            <span>ÔÜÖ´©Å</span> Contr├┤les Avanc├®s\r\n        </h4>\r\n\r\n        {/* Toggle Rotation Auto */}\r\n        <div className=\"flex items-center justify-between\">\r\n            <span className=\"text-sm text-gray-300\">Rotation Auto</span>\r\n            <button\r\n                onClick={() => setAutoRotate(!autoRotate)}\r\n                className={`w-12 h-6 rounded-full transition-all duration-300 ${autoRotate ? 'bg-[#00F5D4]' : 'bg-gray-600'}`}\r\n            >\r\n                <div className={`w-5 h-5 rounded-full bg-white shadow-lg transform transition-transform duration-300 ${autoRotate ? 'translate-x-6' : 'translate-x-0.5'}`} />\r\n            </button>\r\n        </div>\r\n\r\n        {/* Slider Vitesse */}\r\n        <div>\r\n            <div className=\"flex justify-between text-sm mb-1\">\r\n                <span className=\"text-gray-300\">Vitesse d&apos;animation</span>\r\n                <span className=\"text-[#00F5D4] font-mono\">{speed}x</span>\r\n            </div>\r\n            <input\r\n                type=\"range\"\r\n                min=\"0.25\"\r\n                max=\"3\"\r\n                step=\"0.25\"\r\n                value={speed}\r\n                onChange={(e) => setSpeed(parseFloat(e.target.value))}\r\n                className=\"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-[#00F5D4]\"\r\n            />\r\n        </div>\r\n\r\n        {/* Toggle Labels */}\r\n        <div className=\"flex items-center justify-between\">\r\n            <span className=\"text-sm text-gray-300\">Afficher les labels</span>\r\n            <button\r\n                onClick={() => setShowLabels(!showLabels)}\r\n                className={`w-12 h-6 rounded-full transition-all duration-300 ${showLabels ? 'bg-purple-500' : 'bg-gray-600'}`}\r\n            >\r\n                <div className={`w-5 h-5 rounded-full bg-white shadow-lg transform transition-transform duration-300 ${showLabels ? 'translate-x-6' : 'translate-x-0.5'}`} />\r\n            </button>\r\n        </div>\r\n\r\n        {/* Toggle Grille */}\r\n        <div className=\"flex items-center justify-between\">\r\n            <span className=\"text-sm text-gray-300\">Afficher la grille</span>\r\n            <button\r\n                onClick={() => setShowGrid(!showGrid)}\r\n                className={`w-12 h-6 rounded-full transition-all duration-300 ${showGrid ? 'bg-pink-500' : 'bg-gray-600'}`}\r\n            >\r\n                <div className={`w-5 h-5 rounded-full bg-white shadow-lg transform transition-transform duration-300 ${showGrid ? 'translate-x-6' : 'translate-x-0.5'}`} />\r\n            </button>\r\n        </div>\r\n\r\n        {/* Boutons de zoom rapide */}\r\n        <div>\r\n            <span className=\"text-sm text-gray-300 block mb-2\">Zoom rapide</span>\r\n            <div className=\"flex gap-2\">\r\n                {[0.5, 1, 1.5, 2].map((z) => (\r\n                    <button\r\n                        key={z}\r\n                        onClick={() => setZoom(z)}\r\n                        className={`flex-1 py-2 rounded-lg text-xs font-bold transition-all ${zoom === z\r\n                            ? 'bg-[#00F5D4] text-black'\r\n                            : 'bg-white/10 text-gray-300 hover:bg-white/20'}`}\r\n                    >\r\n                        {z}x\r\n                    </button>\r\n                ))}\r\n            </div>\r\n        </div>\r\n    </div>\r\n);\r\n\r\n// Composant Mode Exploration Guid├®e\r\nconst GuidedExploration = ({\r\n    currentStep,\r\n    setCurrentStep,\r\n    totalSteps,\r\n    isActive,\r\n    setIsActive\r\n}) => {\r\n    const progress = ((currentStep + 1) / totalSteps) * 100;\r\n\r\n    return (\r\n        <div className={`p-4 rounded-xl border transition-all duration-500 ${isActive\r\n            ? 'bg-gradient-to-br from-[#00F5D4]/20 to-purple-500/20 border-[#00F5D4]/50'\r\n            : 'bg-white/5 border-white/20'}`}>\r\n            <div className=\"flex items-center justify-between mb-3\">\r\n                <h4 className=\"text-sm font-bold text-[#00F5D4] flex items-center gap-2\">\r\n                    <span>­ƒº¡</span> Exploration Guid├®e\r\n                </h4>\r\n                <button\r\n                    onClick={() => setIsActive(!isActive)}\r\n                    className={`px-3 py-1 rounded-lg text-xs font-bold transition-all ${isActive\r\n                        ? 'bg-red-500/20 text-red-400 hover:bg-red-500/30'\r\n                        : 'bg-green-500/20 text-green-400 hover:bg-green-500/30'}`}\r\n                >\r\n                    {isActive ? 'Arr├¬ter' : 'D├®marrer'}\r\n                </button>\r\n            </div>\r\n\r\n            {isActive && (\r\n                <>\r\n                    {/* Barre de progression */}\r\n                    <div className=\"relative h-2 bg-gray-700 rounded-full mb-4 overflow-hidden\">\r\n                        <div\r\n                            className=\"absolute h-full bg-gradient-to-r from-[#00F5D4] to-purple-500 rounded-full transition-all duration-500\"\r\n                            style={{ width: `${progress}%` }}\r\n                        />\r\n                    </div>\r\n\r\n                    {/* ├ëtape actuelle */}\r\n                    <div className=\"p-3 rounded-lg bg-black/30 mb-3\">\r\n                        <div className=\"flex items-center gap-3 mb-2\">\r\n                            <span className=\"text-2xl\">{explorationPoints[currentStep]?.icon}</span>\r\n                            <div>\r\n                                <p className=\"font-bold text-white text-sm\">\r\n                                    ├ëtape {currentStep + 1}: {explorationPoints[currentStep]?.title}\r\n                                </p>\r\n                                <p className=\"text-xs text-gray-400\">\r\n                                    {explorationPoints[currentStep]?.description}\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Navigation */}\r\n                    <div className=\"flex gap-2\">\r\n                        <button\r\n                            onClick={() => setCurrentStep(Math.max(0, currentStep - 1))}\r\n                            disabled={currentStep === 0}\r\n                            className=\"flex-1 py-2 rounded-lg bg-white/10 text-gray-300 hover:bg-white/20 disabled:opacity-50 disabled:cursor-not-allowed text-sm font-bold transition-all\"\r\n                        >\r\n                            ÔåÉ Pr├®c├®dent\r\n                        </button>\r\n                        <button\r\n                            onClick={() => setCurrentStep(Math.min(totalSteps - 1, currentStep + 1))}\r\n                            disabled={currentStep === totalSteps - 1}\r\n                            className=\"flex-1 py-2 rounded-lg bg-gradient-to-r from-[#00F5D4] to-purple-500 text-black font-bold text-sm hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed transition-all\"\r\n                        >\r\n                            Suivant ÔåÆ\r\n                        </button>\r\n                    </div>\r\n\r\n                    {/* Points de navigation */}\r\n                    <div className=\"flex justify-center gap-2 mt-3\">\r\n                        {explorationPoints.map((_, idx) => (\r\n                            <button\r\n                                key={idx}\r\n                                onClick={() => setCurrentStep(idx)}\r\n                                className={`w-3 h-3 rounded-full transition-all ${idx === currentStep\r\n                                    ? 'bg-[#00F5D4] scale-125'\r\n                                    : idx < currentStep\r\n                                        ? 'bg-purple-500'\r\n                                        : 'bg-gray-600'}`}\r\n                            />\r\n                        ))}\r\n                    </div>\r\n                </>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\n// Composant Simulation Interactive bas├®e sur Image\r\nconst ImageSimulation = ({ simulationId, title }) => {\r\n    const [activeHotspot, setActiveHotspot] = useState(null);\r\n    const [isAnimating, setIsAnimating] = useState(true);\r\n    const containerRef = useRef(null);\r\n\r\n    const imageSrc = getSimulationImage(simulationId);\r\n    const hotspots = simulationHotspots[simulationId] || [];\r\n\r\n    // Si pas d'image pour cette simulation, retourner null\r\n    if (!imageSrc) return null;\r\n\r\n    return (\r\n        <div className=\"rounded-2xl overflow-hidden border border-white/20 bg-black\">\r\n            {/* Image Container */}\r\n            <div ref={containerRef} className=\"relative\" style={{ height: '450px' }}>\r\n                <img\r\n                    src={imageSrc}\r\n                    alt={title}\r\n                    className=\"w-full h-full object-contain bg-gradient-to-br from-slate-900 to-black\"\r\n                />\r\n\r\n                {/* Hotspots interactifs */}\r\n                {hotspots.map((hotspot, index) => (\r\n                    <div\r\n                        key={index}\r\n                        className=\"absolute transform -translate-x-1/2 -translate-y-1/2 z-10\"\r\n                        style={{ left: `${hotspot.x}%`, top: `${hotspot.y}%` }}\r\n                    >\r\n                        <button\r\n                            onClick={() => setActiveHotspot(activeHotspot === index ? null : index)}\r\n                            className={`relative w-6 h-6 rounded-full flex items-center justify-center transition-all duration-300\r\n                                ${activeHotspot === index\r\n                                    ? 'scale-150 ring-4 ring-white/30'\r\n                                    : 'hover:scale-125'\r\n                                }\r\n                                ${isAnimating ? 'animate-pulse' : ''}\r\n                            `}\r\n                            style={{\r\n                                backgroundColor: hotspot.color,\r\n                                boxShadow: `0 0 15px ${hotspot.color}80`\r\n                            }}\r\n                        >\r\n                            <span className=\"text-white font-bold text-xs drop-shadow-lg\">\r\n                                {index + 1}\r\n                            </span>\r\n                        </button>\r\n\r\n                        {/* Tooltip au clic */}\r\n                        {activeHotspot === index && (\r\n                            <div\r\n                                className=\"absolute left-1/2 transform -translate-x-1/2 w-52 p-4 rounded-xl backdrop-blur-xl z-30 animate-in fade-in zoom-in-95 duration-200\"\r\n                                style={{\r\n                                    top: hotspot.y > 60 ? 'auto' : '100%',\r\n                                    bottom: hotspot.y > 60 ? '100%' : 'auto',\r\n                                    marginTop: hotspot.y > 60 ? 0 : '10px',\r\n                                    marginBottom: hotspot.y > 60 ? '10px' : 0,\r\n                                    backgroundColor: 'rgba(0,0,0,0.9)',\r\n                                    border: `2px solid ${hotspot.color}`\r\n                                }}\r\n                            >\r\n                                <h4 className=\"font-bold text-lg mb-1\" style={{ color: hotspot.color }}>\r\n                                    {hotspot.label}\r\n                                </h4>\r\n                                <p className=\"text-sm text-gray-200\">{hotspot.info}</p>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Barre d'info en bas */}\r\n            {hotspots.length > 0 && (\r\n                <div className=\"p-4 bg-gradient-to-r from-slate-900 to-black border-t border-white/10\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <p className=\"text-sm text-gray-400\">\r\n                            Cliquez sur les <span className=\"text-cyan-400 font-bold\">points</span> pour explorer\r\n                        </p>\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <button\r\n                                onClick={() => setIsAnimating(!isAnimating)}\r\n                                className={`px-3 py-1 rounded-lg text-xs font-bold transition-all ${isAnimating ? 'bg-cyan-500/20 text-cyan-400' : 'bg-white/10 text-gray-400'}`}\r\n                            >\r\n                                {isAnimating ? 'ÔùÅ Animation' : 'Ôùï Statique'}\r\n                            </button>\r\n                            <span className=\"text-xs text-gray-500 bg-white/5 px-2 py-1 rounded\">\r\n                                {hotspots.length} zones\r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* L├®gende des hotspots */}\r\n                    <div className=\"flex flex-wrap gap-2 mt-3\">\r\n                        {hotspots.map((h, i) => (\r\n                            <button\r\n                                key={i}\r\n                                onClick={() => setActiveHotspot(activeHotspot === i ? null : i)}\r\n                                className={`flex items-center gap-1.5 px-2 py-1 rounded-lg text-xs transition-all\r\n                                    ${activeHotspot === i ? 'bg-white/20' : 'bg-white/5 hover:bg-white/10'}\r\n                                `}\r\n                            >\r\n                                <span\r\n                                    className=\"w-3 h-3 rounded-full\"\r\n                                    style={{ backgroundColor: h.color }}\r\n                                />\r\n                                <span className=\"text-white\">{h.label}</span>\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\n// Composant Challenges Rapides\r\nconst QuickChallenges = ({ simulation, onComplete }) => {\r\n    const [currentChallenge, setCurrentChallenge] = useState(0);\r\n    const [score, setScore] = useState(0);\r\n    const [answered, setAnswered] = useState(false);\r\n    const [selectedOption, setSelectedOption] = useState(null);\r\n\r\n    const challenges = simulation.exercises || [];\r\n    const challenge = challenges[currentChallenge];\r\n\r\n    if (challenges.length === 0) {\r\n        return (\r\n            <div className=\"p-4 rounded-xl bg-white/5 border border-white/20 text-center\">\r\n                <span className=\"text-4xl mb-2 block\">­ƒôØ</span>\r\n                <p className=\"text-gray-400 text-sm\">Aucun d├®fi disponible pour cette simulation</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const handleAnswer = (index) => {\r\n        if (answered) return;\r\n        setSelectedOption(index);\r\n        setAnswered(true);\r\n        if (index === challenge.correct) {\r\n            setScore(score + 1);\r\n        }\r\n    };\r\n\r\n    const nextChallenge = () => {\r\n        if (currentChallenge < challenges.length - 1) {\r\n            setCurrentChallenge(currentChallenge + 1);\r\n            setAnswered(false);\r\n            setSelectedOption(null);\r\n        } else {\r\n            onComplete?.(score, challenges.length);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"p-4 rounded-xl bg-gradient-to-br from-orange-500/10 to-red-500/10 border border-orange-500/30\">\r\n            <div className=\"flex items-center justify-between mb-3\">\r\n                <h4 className=\"text-sm font-bold text-orange-400 flex items-center gap-2\">\r\n                    <span>ÔÜí</span> D├®fi Rapide\r\n                </h4>\r\n                <div className=\"flex items-center gap-2\">\r\n                    <AnimatedBadge color=\"orange\">\r\n                        {currentChallenge + 1}/{challenges.length}\r\n                    </AnimatedBadge>\r\n                    <AnimatedBadge color=\"green\" pulse={score > 0}>\r\n                        ­ƒÅå {score}\r\n                    </AnimatedBadge>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Question */}\r\n            <p className=\"text-white font-medium mb-3 text-sm\">{challenge.question}</p>\r\n\r\n            {/* Options */}\r\n            <div className=\"space-y-2 mb-3\">\r\n                {challenge.options.map((option, index) => (\r\n                    <button\r\n                        key={index}\r\n                        onClick={() => handleAnswer(index)}\r\n                        disabled={answered}\r\n                        className={`w-full p-3 rounded-lg text-left text-sm transition-all ${answered\r\n                            ? index === challenge.correct\r\n                                ? 'bg-green-500/30 border border-green-500'\r\n                                : index === selectedOption\r\n                                    ? 'bg-red-500/30 border border-red-500'\r\n                                    : 'bg-white/5 border border-white/10 opacity-50'\r\n                            : 'bg-white/10 border border-white/10 hover:bg-white/20 hover:border-orange-500/50'}`}\r\n                    >\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <span className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${answered && index === challenge.correct\r\n                                ? 'bg-green-500 text-white'\r\n                                : answered && index === selectedOption\r\n                                    ? 'bg-red-500 text-white'\r\n                                    : 'bg-white/10'}`}>\r\n                                {String.fromCharCode(65 + index)}\r\n                            </span>\r\n                            <span>{option}</span>\r\n                        </div>\r\n                    </button>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Explication */}\r\n            {answered && (\r\n                <div className={`p-3 rounded-lg mb-3 text-sm ${selectedOption === challenge.correct\r\n                    ? 'bg-green-500/20 border border-green-500/30'\r\n                    : 'bg-blue-500/20 border border-blue-500/30'}`}>\r\n                    <p className=\"text-gray-200\">\r\n                        ­ƒÆí {challenge.explanation}\r\n                    </p>\r\n                </div>\r\n            )}\r\n\r\n            {/* Bouton suivant */}\r\n            {answered && (\r\n                <button\r\n                    onClick={nextChallenge}\r\n                    className=\"w-full py-2 rounded-lg bg-gradient-to-r from-orange-500 to-red-500 text-white font-bold text-sm hover:scale-105 transition-transform\"\r\n                >\r\n                    {currentChallenge < challenges.length - 1 ? 'Question suivante ÔåÆ' : 'Voir les r├®sultats ­ƒÅå'}\r\n                </button>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\n// Composant Notes personnelles\r\nconst PersonalNotes = ({ simulationId }) => {\r\n    const [notes, setNotes] = useState('');\r\n    const [saved, setSaved] = useState(false);\r\n\r\n    useEffect(() => {\r\n        // Charger les notes sauvegard├®es\r\n        const savedNotes = localStorage.getItem(`notes_${simulationId}`);\r\n        if (savedNotes) setNotes(savedNotes);\r\n    }, [simulationId]);\r\n\r\n    const saveNotes = () => {\r\n        localStorage.setItem(`notes_${simulationId}`, notes);\r\n        setSaved(true);\r\n        setTimeout(() => setSaved(false), 2000);\r\n    };\r\n\r\n    return (\r\n        <div className=\"p-4 rounded-xl bg-white/5 border border-white/20\">\r\n            <div className=\"flex items-center justify-between mb-3\">\r\n                <h4 className=\"text-sm font-bold text-yellow-400 flex items-center gap-2\">\r\n                    <span>­ƒôØ</span> Mes notes\r\n                </h4>\r\n                <button\r\n                    onClick={saveNotes}\r\n                    className={`px-3 py-1 rounded-lg text-xs font-bold transition-all ${saved\r\n                        ? 'bg-green-500 text-white'\r\n                        : 'bg-yellow-500/20 text-yellow-400 hover:bg-yellow-500/30'}`}\r\n                >\r\n                    {saved ? 'Ô£ô Sauvegard├®' : 'Sauvegarder'}\r\n                </button>\r\n            </div>\r\n            <textarea\r\n                value={notes}\r\n                onChange={(e) => setNotes(e.target.value)}\r\n                placeholder=\"Prenez des notes sur cette simulation...\"\r\n                className=\"w-full h-24 p-3 rounded-lg bg-black/30 border border-white/10 text-white text-sm placeholder-gray-500 focus:outline-none focus:border-yellow-500/50 resize-none\"\r\n            />\r\n        </div>\r\n    );\r\n};\r\n\r\n// Composant Mode Plein ├ëcran\r\nconst FullscreenButton = ({ containerRef }) => {\r\n    const [isFullscreen, setIsFullscreen] = useState(false);\r\n\r\n    const toggleFullscreen = () => {\r\n        if (!document.fullscreenElement) {\r\n            containerRef.current?.requestFullscreen();\r\n            setIsFullscreen(true);\r\n        } else {\r\n            document.exitFullscreen();\r\n            setIsFullscreen(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <button\r\n            onClick={toggleFullscreen}\r\n            className=\"p-3 rounded-xl bg-white/10 border border-white/20 hover:bg-white/20 transition-all group\"\r\n            title={isFullscreen ? \"Quitter le plein ├®cran\" : \"Plein ├®cran\"}\r\n        >\r\n            <span className=\"text-xl group-hover:scale-110 inline-block transition-transform\">\r\n                {isFullscreen ? '­ƒùù' : 'ÔøÂ'}\r\n            </span>\r\n        </button>\r\n    );\r\n};\r\n\r\n// Composant Panneau Draggable (D├®pla├ºable)\r\nconst DraggableControlPanel = ({\r\n    children,\r\n    title = \"­ƒÄø´©Å Contr├┤les\",\r\n    initialPosition = { x: 20, y: 20 },\r\n    isVisible,\r\n    setIsVisible\r\n}) => {\r\n    const [position, setPosition] = useState(initialPosition);\r\n    const [isDragging, setIsDragging] = useState(false);\r\n    const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });\r\n    const [isMinimized, setIsMinimized] = useState(false);\r\n    const panelRef = useRef(null);\r\n\r\n    const handleMouseDown = (e) => {\r\n        if (e.target.closest('.no-drag')) return;\r\n        setIsDragging(true);\r\n        const rect = panelRef.current.getBoundingClientRect();\r\n        setDragOffset({\r\n            x: e.clientX - rect.left,\r\n            y: e.clientY - rect.top\r\n        });\r\n    };\r\n\r\n    const handleMouseMove = useCallback((e) => {\r\n        if (!isDragging) return;\r\n\r\n        const newX = e.clientX - dragOffset.x;\r\n        const newY = e.clientY - dragOffset.y;\r\n\r\n        // Limiter aux bords de l'├®cran\r\n        const maxX = window.innerWidth - (panelRef.current?.offsetWidth || 300);\r\n        const maxY = window.innerHeight - (panelRef.current?.offsetHeight || 200);\r\n\r\n        setPosition({\r\n            x: Math.max(0, Math.min(newX, maxX)),\r\n            y: Math.max(0, Math.min(newY, maxY))\r\n        });\r\n    }, [isDragging, dragOffset]);\r\n\r\n    const handleMouseUp = () => {\r\n        setIsDragging(false);\r\n    };\r\n\r\n    // Touch support\r\n    const handleTouchStart = (e) => {\r\n        if (e.target.closest('.no-drag')) return;\r\n        const touch = e.touches[0];\r\n        setIsDragging(true);\r\n        const rect = panelRef.current.getBoundingClientRect();\r\n        setDragOffset({\r\n            x: touch.clientX - rect.left,\r\n            y: touch.clientY - rect.top\r\n        });\r\n    };\r\n\r\n    const handleTouchMove = useCallback((e) => {\r\n        if (!isDragging) return;\r\n        const touch = e.touches[0];\r\n\r\n        const newX = touch.clientX - dragOffset.x;\r\n        const newY = touch.clientY - dragOffset.y;\r\n\r\n        const maxX = window.innerWidth - (panelRef.current?.offsetWidth || 300);\r\n        const maxY = window.innerHeight - (panelRef.current?.offsetHeight || 200);\r\n\r\n        setPosition({\r\n            x: Math.max(0, Math.min(newX, maxX)),\r\n            y: Math.max(0, Math.min(newY, maxY))\r\n        });\r\n    }, [isDragging, dragOffset]);\r\n\r\n    useEffect(() => {\r\n        if (isDragging) {\r\n            window.addEventListener('mousemove', handleMouseMove);\r\n            window.addEventListener('mouseup', handleMouseUp);\r\n            window.addEventListener('touchmove', handleTouchMove);\r\n            window.addEventListener('touchend', handleMouseUp);\r\n        }\r\n        return () => {\r\n            window.removeEventListener('mousemove', handleMouseMove);\r\n            window.removeEventListener('mouseup', handleMouseUp);\r\n            window.removeEventListener('touchmove', handleTouchMove);\r\n            window.removeEventListener('touchend', handleMouseUp);\r\n        };\r\n    }, [isDragging, handleMouseMove, handleTouchMove]);\r\n\r\n    if (!isVisible) return null;\r\n\r\n    return (\r\n        <div\r\n            ref={panelRef}\r\n            className={`fixed z-50 bg-black/95 backdrop-blur-xl rounded-2xl border border-white/20 shadow-2xl overflow-hidden transition-all duration-200 ${isDragging ? 'cursor-grabbing scale-[1.02]' : ''}`}\r\n            style={{\r\n                left: position.x,\r\n                top: position.y,\r\n                width: isMinimized ? '200px' : '320px',\r\n                maxHeight: isMinimized ? '50px' : '80vh'\r\n            }}\r\n        >\r\n            {/* Header - Zone de drag */}\r\n            <div\r\n                className=\"flex items-center justify-between p-3 bg-gradient-to-r from-[#00F5D4]/20 to-purple-500/20 border-b border-white/10 cursor-grab active:cursor-grabbing select-none\"\r\n                onMouseDown={handleMouseDown}\r\n                onTouchStart={handleTouchStart}\r\n            >\r\n                <div className=\"flex items-center gap-2\">\r\n                    <span className=\"text-lg\">{title.split(' ')[0]}</span>\r\n                    <span className=\"font-bold text-sm text-[#00F5D4]\">{title.split(' ').slice(1).join(' ')}</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-1\">\r\n                    {/* Bouton Minimiser */}\r\n                    <button\r\n                        onClick={() => setIsMinimized(!isMinimized)}\r\n                        className=\"no-drag w-7 h-7 rounded-lg bg-white/10 hover:bg-white/20 flex items-center justify-center transition-all text-sm\"\r\n                        title={isMinimized ? \"Agrandir\" : \"R├®duire\"}\r\n                    >\r\n                        {isMinimized ? '­ƒö╝' : '­ƒö¢'}\r\n                    </button>\r\n                    {/* Bouton Fermer */}\r\n                    <button\r\n                        onClick={() => setIsVisible(false)}\r\n                        className=\"no-drag w-7 h-7 rounded-lg bg-red-500/20 hover:bg-red-500/40 flex items-center justify-center transition-all text-red-400 text-sm\"\r\n                        title=\"Fermer\"\r\n                    >\r\n                        Ô£ò\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Content */}\r\n            {!isMinimized && (\r\n                <div className=\"p-4 overflow-y-auto max-h-[calc(80vh-50px)] no-drag\">\r\n                    {children}\r\n                </div>\r\n            )}\r\n\r\n            {/* Indicateur de drag */}\r\n            {isMinimized && (\r\n                <div className=\"absolute bottom-1 left-1/2 -translate-x-1/2 w-8 h-1 rounded-full bg-white/30\" />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\n// Composant Barre d'outils flottante - Simplifi├®e (Aide uniquement)\r\nconst FloatingToolbar = ({ onHelp }) => (\r\n    <div className=\"absolute bottom-2 sm:bottom-4 left-1/2 transform -translate-x-1/2 flex gap-1 sm:gap-2 p-1.5 sm:p-2 rounded-xl sm:rounded-2xl bg-black/90 backdrop-blur-xl border border-white/20 z-10\">\r\n        <button\r\n            onClick={onHelp}\r\n            className=\"w-8 h-8 sm:w-10 sm:h-10 rounded-lg sm:rounded-xl bg-white/10 flex items-center justify-center active:scale-95 transition-all\"\r\n            title=\"Aide\"\r\n        >\r\n            <span className=\"text-sm sm:text-base\">ÔØô</span>\r\n        </button>\r\n    </div>\r\n);\r\n\r\n// Modal d'aide\r\nconst HelpModal = ({ isOpen, onClose }) => {\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm\" onClick={onClose}>\r\n            <div className=\"bg-gradient-to-br from-slate-900 to-black p-6 rounded-2xl border border-white/20 max-w-md w-full mx-4 animate-in fade-in zoom-in duration-300\" onClick={e => e.stopPropagation()}>\r\n                <div className=\"flex items-center justify-between mb-4\">\r\n                    <h3 className=\"text-xl font-bold text-[#00F5D4]\">­ƒÄ« Guide des contr├┤les</h3>\r\n                    <button onClick={onClose} className=\"text-gray-400 hover:text-white text-2xl\">&times;</button>\r\n                </div>\r\n\r\n                <div className=\"space-y-4\">\r\n                    <div className=\"p-3 rounded-lg bg-white/5\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <span className=\"text-2xl\">­ƒû▒´©Å</span>\r\n                            <div>\r\n                                <p className=\"font-semibold text-white\">Clic gauche + Glisser</p>\r\n                                <p className=\"text-sm text-gray-400\">Faire tourner la simulation</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"p-3 rounded-lg bg-white/5\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <span className=\"text-2xl\">­ƒöì</span>\r\n                            <div>\r\n                                <p className=\"font-semibold text-white\">Molette de la souris</p>\r\n                                <p className=\"text-sm text-gray-400\">Zoomer / D├®zoomer</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"p-3 rounded-lg bg-white/5\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <span className=\"text-2xl\">­ƒæå</span>\r\n                            <div>\r\n                                <p className=\"font-semibold text-white\">Clic droit + Glisser</p>\r\n                                <p className=\"text-sm text-gray-400\">D├®placer la vue</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"p-3 rounded-lg bg-white/5\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <span className=\"text-2xl\">­ƒô▒</span>\r\n                            <div>\r\n                                <p className=\"font-semibold text-white\">Tactile</p>\r\n                                <p className=\"text-sm text-gray-400\">Pincer pour zoomer, glisser pour tourner</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <button\r\n                    onClick={onClose}\r\n                    className=\"w-full mt-6 py-3 rounded-xl bg-gradient-to-r from-[#00F5D4] to-purple-500 text-black font-bold hover:scale-105 transition-transform\"\r\n                >\r\n                    Compris ! ­ƒæì\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n// Modal de r├®sultats du quiz\r\nconst ResultsModal = ({ isOpen, onClose, score, total }) => {\r\n    if (!isOpen) return null;\r\n\r\n    const percentage = Math.round((score / total) * 100);\r\n    const emoji = percentage >= 80 ? '­ƒÅå' : percentage >= 60 ? 'Ô¡É' : percentage >= 40 ? '­ƒæì' : '­ƒÆ¬';\r\n    const message = percentage >= 80\r\n        ? 'Excellent ! Tu ma├«trises ce sujet !'\r\n        : percentage >= 60\r\n            ? 'Bien jou├® ! Continue comme ├ºa !'\r\n            : percentage >= 40\r\n                ? 'Pas mal ! Tu peux faire encore mieux !'\r\n                : 'Continue ├á pratiquer, tu vas y arriver !';\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm\" onClick={onClose}>\r\n            <div className=\"bg-gradient-to-br from-slate-900 to-black p-8 rounded-2xl border border-white/20 max-w-sm w-full mx-4 text-center animate-in fade-in zoom-in duration-300\" onClick={e => e.stopPropagation()}>\r\n                <span className=\"text-6xl mb-4 block animate-bounce\">{emoji}</span>\r\n                <h3 className=\"text-2xl font-bold text-white mb-2\">R├®sultats</h3>\r\n                <div className=\"text-5xl font-black bg-clip-text text-transparent bg-gradient-to-r from-[#00F5D4] to-purple-500 mb-4\">\r\n                    {score}/{total}\r\n                </div>\r\n                <p className=\"text-gray-300 mb-6\">{message}</p>\r\n\r\n                {/* Barre de progression */}\r\n                <div className=\"w-full h-4 bg-gray-700 rounded-full mb-6 overflow-hidden\">\r\n                    <div\r\n                        className={`h-full rounded-full transition-all duration-1000 ${percentage >= 80 ? 'bg-green-500' : percentage >= 60 ? 'bg-yellow-500' : percentage >= 40 ? 'bg-orange-500' : 'bg-red-500'}`}\r\n                        style={{ width: `${percentage}%` }}\r\n                    />\r\n                </div>\r\n\r\n                <button\r\n                    onClick={onClose}\r\n                    className=\"w-full py-3 rounded-xl bg-gradient-to-r from-[#00F5D4] to-purple-500 text-black font-bold hover:scale-105 transition-transform\"\r\n                >\r\n                    Continuer ­ƒÜÇ\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default function SimulationDetailPage({ params }) {\r\n    const searchParams = useSearchParams();\r\n    const tabParam = searchParams.get('tab');\r\n    const [resolvedParams, setResolvedParams] = useState(null);\r\n    const [activeTab, setActiveTab] = useState(tabParam || 'simulation');\r\n    const [currentExercise, setCurrentExercise] = useState(0);\r\n    const [selectedAnswer, setSelectedAnswer] = useState(null);\r\n    const [showExplanation, setShowExplanation] = useState(false);\r\n\r\n    // ├ëtat pour le retour au cours\r\n    const [returnInfo, setReturnInfo] = useState(null);\r\n\r\n    // ├ëtats pour les nouvelles fonctionnalit├®s\r\n    const [sessionStartTime] = useState(Date.now());\r\n    const [autoRotate, setAutoRotate] = useState(true);\r\n    const [speed, setSpeed] = useState(1);\r\n    const [showLabels, setShowLabels] = useState(true);\r\n    const [showGrid, setShowGrid] = useState(true);\r\n    const [zoom, setZoom] = useState(1);\r\n    const [isPlaying, setIsPlaying] = useState(true);\r\n\r\n    // Mode exploration guid├®e\r\n    const [explorationStep, setExplorationStep] = useState(0);\r\n    const [isExplorationActive, setIsExplorationActive] = useState(false);\r\n\r\n    // Modals\r\n    const [showHelpModal, setShowHelpModal] = useState(false);\r\n    const [showResultsModal, setShowResultsModal] = useState(false);\r\n    const [quizResults, setQuizResults] = useState({ score: 0, total: 0 });\r\n\r\n    // Panneau de contr├┤le draggable\r\n    const [showControlPanel, setShowControlPanel] = useState(false);\r\n\r\n    // Ref pour le conteneur de simulation\r\n    const simulationContainerRef = useRef(null);\r\n\r\n    useEffect(() => {\r\n        Promise.resolve(params).then(setResolvedParams);\r\n        // Lire les param├¿tres URL pour le retour\r\n        if (typeof window !== 'undefined') {\r\n            const urlParams = new URLSearchParams(window.location.search);\r\n            const returnTo = urlParams.get('returnTo');\r\n            const chapter = urlParams.get('chapter');\r\n            if (returnTo === 'courses' && chapter) {\r\n                setReturnInfo({ returnTo, chapter });\r\n            }\r\n        }\r\n    }, [params]);\r\n\r\n    const handleChallengeComplete = useCallback((score, total) => {\r\n        setQuizResults({ score, total });\r\n        setShowResultsModal(true);\r\n    }, []);\r\n\r\n    const handleScreenshot = useCallback(() => {\r\n        // Logique de capture d'├®cran (notification pour l'instant)\r\n        alert('­ƒô© Capture d\\'├®cran enregistr├®e ! (Fonctionnalit├® ├á venir)');\r\n    }, []);\r\n\r\n    const handleReset = useCallback(() => {\r\n        setSpeed(1);\r\n        setAutoRotate(true);\r\n        setZoom(1);\r\n        setShowLabels(true);\r\n        setShowGrid(true);\r\n        setIsPlaying(true);\r\n    }, []);\r\n\r\n    if (!resolvedParams) {\r\n        return (\r\n            <div className=\"min-h-screen bg-black text-white flex items-center justify-center\">\r\n                <div className=\"text-center\">\r\n                    <div className=\"animate-spin text-6xl mb-4\">ÔÜø´©Å</div>\r\n                    <p className=\"text-gray-400\">Chargement...</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const simulation = allSimulationsData[resolvedParams.id] || defaultSimulation;\r\n    const simulationLevel = getSimulationLevel(resolvedParams.id);\r\n\r\n    const handleAnswerSelect = (index) => {\r\n        setSelectedAnswer(index);\r\n        setShowExplanation(true);\r\n    };\r\n\r\n    return (\r\n        <main className=\"min-h-screen bg-gradient-to-br from-black via-slate-950 to-black text-white\">\r\n            {/* Navbar am├®lior├®e - Mobile First */}\r\n            <nav className=\"border-b border-white/10 backdrop-blur-xl bg-black/80 sticky top-0 z-50\">\r\n                <div className=\"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 h-14 sm:h-16 flex items-center justify-between\">\r\n                    {/* Bouton retour conditionnel */}\r\n                    {returnInfo ? (\r\n                        <Link\r\n                            href={`/courses?activeChapter=${returnInfo.chapter}`}\r\n                            className=\"text-emerald-400 hover:text-emerald-300 transition-colors flex items-center gap-1 sm:gap-2 group bg-emerald-500/10 px-3 py-1.5 rounded-lg border border-emerald-500/30\"\r\n                        >\r\n                            <span className=\"text-xl sm:text-2xl group-hover:-translate-x-1 transition-transform\">­ƒôÜ</span>\r\n                            <span className=\"hidden sm:inline font-bold\">Retour au cours</span>\r\n                            <span className=\"sm:hidden text-sm font-bold\">Cours</span>\r\n                        </Link>\r\n                    ) : (\r\n                        <Link\r\n                            href={`/simulations?level=${lyceeSimulationsData[resolvedParams.id] ? 'lycee' : 'college'}#${resolvedParams.id}`}\r\n                            className=\"text-gray-400 hover:text-white transition-colors flex items-center gap-1 sm:gap-2 group\"\r\n                        >\r\n                            <span className=\"text-xl sm:text-2xl group-hover:-translate-x-1 transition-transform\">ÔåÉ</span>\r\n                            <span className=\"hidden sm:inline\">Retour aux simulations</span>\r\n                            <span className=\"sm:hidden text-sm\">Retour</span>\r\n                        </Link>\r\n                    )}\r\n                    <div className=\"flex items-center gap-2 sm:gap-4\">\r\n                        <div className=\"hidden sm:block\"><SessionTimer startTime={sessionStartTime} /></div>\r\n                        <AnimatedBadge color=\"cyan\">\r\n                            <span className=\"hidden sm:inline\">Simulation 3D</span>\r\n                            <span className=\"sm:hidden\">3D</span>\r\n                        </AnimatedBadge>\r\n                    </div>\r\n                </div>\r\n            </nav>\r\n\r\n            {/* Header avec titre anim├® - Mobile First */}\r\n            <div className=\"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 py-4 sm:py-8\">\r\n                <div className=\"mb-4 sm:mb-8\">\r\n                    <div className=\"flex flex-wrap items-center gap-2 mb-2 sm:mb-4\">\r\n                        <AnimatedBadge color=\"purple\">{simulationLevel.name}</AnimatedBadge>\r\n                        <AnimatedBadge color=\"green\">{simulationLevel.description}</AnimatedBadge>\r\n                    </div>\r\n                    <h1 className=\"text-2xl sm:text-4xl md:text-5xl font-black mb-2 sm:mb-4 bg-clip-text text-transparent bg-gradient-to-r from-[#00F5D4] via-purple-500 to-pink-500\">\r\n                        {simulation.title}\r\n                    </h1>\r\n                    <p className=\"text-sm sm:text-xl text-gray-300 line-clamp-2 sm:line-clamp-none\">{simulation.description}</p>\r\n                </div>\r\n\r\n                {/* Tabs am├®lior├®s - Mobile First avec scroll horizontal */}\r\n                <div className=\"flex gap-1.5 sm:gap-3 mb-4 sm:mb-8 overflow-x-auto pb-2 -mx-3 px-3 sm:mx-0 sm:px-0 scrollbar-hide\">\r\n                    {[\r\n                        { id: 'simulation', label: 'Simulation', icon: '­ƒÄ«', shortLabel: 'Simu' },\r\n                        { id: 'analogy', label: 'Analogie', icon: '­ƒîì', shortLabel: 'Analo.' },\r\n                    ].map((tab) => (\r\n                        <button\r\n                            key={tab.id}\r\n                            onClick={() => setActiveTab(tab.id)}\r\n                            className={`px-2.5 sm:px-5 py-2 sm:py-3 rounded-lg sm:rounded-xl text-xs sm:text-sm font-bold transition-all duration-300 whitespace-nowrap flex items-center gap-1 sm:gap-2 flex-shrink-0 ${activeTab === tab.id\r\n                                ? 'bg-gradient-to-r from-[#00F5D4] to-purple-500 text-black shadow-lg'\r\n                                : 'bg-white/5 text-gray-400 hover:bg-white/10 border border-white/10'\r\n                                }`}\r\n                        >\r\n                            <span className=\"text-sm sm:text-base\">{tab.icon}</span>\r\n                            <span className=\"hidden sm:inline\">{tab.label}</span>\r\n                            <span className=\"sm:hidden\">{tab.shortLabel}</span>\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n\r\n                {/* Content - Full width */}\r\n                <div className=\"space-y-4 sm:space-y-6\">\r\n                    {/* Main Content */}\r\n                    <div>\r\n                        {activeTab === 'simulation' && (\r\n                            <div className=\"animate-in fade-in slide-in-from-bottom-4 duration-500\">\r\n                                {/* Simulation en pleine largeur sur mobile */}\r\n                                <div className=\"space-y-4\">\r\n                                    {/* Conteneur de simulation - Plein ├®cran mobile */}\r\n                                    <div ref={simulationContainerRef} className=\"relative rounded-xl sm:rounded-2xl overflow-hidden shadow-2xl border border-white/20 bg-black/50 h-[50vh] sm:h-[60vh] lg:h-[70vh]\">\r\n                                        <Simulation3D type={simulation.type} config={simulation.config} />\r\n                                        <FloatingToolbar\r\n                                            onHelp={() => setShowHelpModal(true)}\r\n                                        />\r\n                                        <div className=\"absolute top-2 right-2 sm:top-4 sm:right-4 z-10\">\r\n                                            <FullscreenButton containerRef={simulationContainerRef} />\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* Panneau de contr├┤le repliable sur mobile */}\r\n                                    <details className=\"lg:hidden group\">\r\n                                        <summary className=\"flex items-center justify-between p-3 rounded-xl bg-white/5 border border-white/10 cursor-pointer list-none active:scale-[0.98] transition-all\">\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <span className=\"text-lg\">­ƒÄø´©Å</span>\r\n                                                <span className=\"font-bold text-sm text-[#00F5D4]\">Contr├┤les</span>\r\n                                            </div>\r\n                                            <span className=\"text-gray-400 group-open:rotate-180 transition-transform\">Ôû╝</span>\r\n                                        </summary>\r\n                                        <div className=\"mt-2 p-4 rounded-xl bg-white/5 border border-white/10 space-y-4\">\r\n                                            <AdvancedControls\r\n                                                autoRotate={autoRotate}\r\n                                                setAutoRotate={setAutoRotate}\r\n                                                speed={speed}\r\n                                                setSpeed={setSpeed}\r\n                                                showLabels={showLabels}\r\n                                                setShowLabels={setShowLabels}\r\n                                                showGrid={showGrid}\r\n                                                setShowGrid={setShowGrid}\r\n                                                zoom={zoom}\r\n                                                setZoom={setZoom}\r\n                                            />\r\n                                            {/* Guide tactile mobile */}\r\n                                            <div className=\"flex flex-wrap gap-2 text-xs text-gray-400\">\r\n                                                <span className=\"flex items-center gap-1 bg-white/5 px-2 py-1 rounded\">­ƒæå Glisser = Rotation</span>\r\n                                                <span className=\"flex items-center gap-1 bg-white/5 px-2 py-1 rounded\">­ƒñÅ Pincer = Zoom</span>\r\n                                            </div>\r\n                                        </div>\r\n                                    </details>\r\n\r\n\r\n\r\n                                    {/* Visualisation Interactive (Image backup) - Hidden on mobile */}\r\n                                    <div className=\"hidden sm:block\">\r\n                                        <ImageSimulation\r\n                                            simulationId={resolvedParams.id}\r\n                                            title={simulation.title}\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {activeTab === 'challenges' && (\r\n                            <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\r\n                                {/* Header Mode D├®fi */}\r\n                                <div className=\"p-6 rounded-2xl bg-gradient-to-br from-orange-500/20 to-red-500/20 border border-orange-500/40\">\r\n                                    <div className=\"flex items-center justify-between mb-4\">\r\n                                        <div className=\"flex items-center gap-4\">\r\n                                            <div className=\"w-16 h-16 rounded-2xl bg-gradient-to-br from-orange-500 to-red-500 flex items-center justify-center text-3xl animate-pulse\">\r\n                                                ÔÜí\r\n                                            </div>\r\n                                            <div>\r\n                                                <h2 className=\"text-2xl font-black text-white\">MODE D├ëFI</h2>\r\n                                                <p className=\"text-orange-300\">Testez vos connaissances !</p>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"grid grid-cols-3 gap-3\">\r\n                                        <div className=\"p-3 rounded-xl bg-black/30 text-center\">\r\n                                            <p className=\"text-2xl font-bold text-green-400\">­ƒÄ»</p>\r\n                                            <p className=\"text-xs text-gray-400\">Pr├®cision</p>\r\n                                        </div>\r\n                                        <div className=\"p-3 rounded-xl bg-black/30 text-center\">\r\n                                            <p className=\"text-2xl font-bold text-yellow-400\">Ô¡É</p>\r\n                                            <p className=\"text-xs text-gray-400\">XP Bonus</p>\r\n                                        </div>\r\n                                        <div className=\"p-3 rounded-xl bg-black/30 text-center\">\r\n                                            <p className=\"text-2xl font-bold text-purple-400\">­ƒöÑ</p>\r\n                                            <p className=\"text-xs text-gray-400\">Streak</p>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <EnhancedQuiz simulation={simulation} onComplete={handleChallengeComplete} />\r\n                            </div>\r\n                        )}\r\n\r\n                        {activeTab === 'gallery' && (\r\n                            <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\r\n                                {/* Image de cette simulation */}\r\n                                <div className=\"rounded-2xl overflow-hidden\">\r\n                                    <ImageSimulation\r\n                                        simulationId={resolvedParams.id}\r\n                                        title={simulation.title}\r\n                                    />\r\n                                </div>\r\n\r\n                                {/* Galerie d'exploration */}\r\n                                <div className=\"p-6 rounded-2xl bg-gradient-to-br from-white/5 to-white/10 border border-white/20\">\r\n                                    <h3 className=\"text-xl font-bold text-white mb-4\">­ƒö¼ Explorer d&apos;autres concepts</h3>\r\n                                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\r\n                                        {[\r\n                                            { id: 'cell-structure', title: 'Cellule', icon: '­ƒö¼' },\r\n                                            { id: 'blood-circulation', title: 'C┼ôur', icon: 'ÔØñ´©Å' },\r\n                                            { id: 'volcano-eruption', title: 'Volcan', icon: '­ƒîï' },\r\n                                            { id: 'water-cycle', title: 'Cycle Eau', icon: '­ƒÆº' },\r\n                                            { id: 'nervous-system', title: 'Neurone', icon: '­ƒºá' },\r\n                                            { id: 'atomic-structure', title: 'Atome', icon: 'ÔÜø´©Å' },\r\n                                            { id: 'photosynthesis', title: 'Photosynth├¿se', icon: '­ƒî▒' },\r\n                                            { id: 'genetics-dna', title: 'ADN', icon: '­ƒº¼' },\r\n                                            { id: 'digestive-system', title: 'Digestion', icon: '­ƒì¢´©Å' },\r\n                                            { id: 'respiration-human', title: 'Respiration', icon: '­ƒ½ü' },\r\n                                            { id: 'states-of-matter', title: '├ëtats Mati├¿re', icon: '­ƒºè' },\r\n                                            { id: 'simple-circuits', title: 'Circuits', icon: '­ƒÆí' },\r\n                                            { id: 'food-chain', title: 'Cha├«ne Alim.', icon: '­ƒªü' },\r\n                                            { id: 'chemical-reactions', title: 'R├®actions', icon: 'ÔÜù´©Å' },\r\n                                            { id: 'plate-tectonics', title: 'Tectonique', icon: '­ƒîì' },\r\n                                            { id: 'plant-growth', title: 'Plante', icon: '­ƒî┐' },\r\n                                        ].filter(s => s.id !== resolvedParams.id).slice(0, 8).map((sim, i) => (\r\n                                            <a\r\n                                                key={i}\r\n                                                href={`/simulations/${sim.id}`}\r\n                                                className=\"p-4 rounded-xl bg-white/5 border border-white/10 hover:border-cyan-500/50 hover:bg-white/10 transition-all text-center group\"\r\n                                            >\r\n                                                <span className=\"text-3xl block mb-2 group-hover:scale-110 transition-transform\">{sim.icon}</span>\r\n                                                <span className=\"text-xs text-white font-medium\">{sim.title}</span>\r\n                                            </a>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {activeTab === 'analogy' && simulation.analogy && (\r\n                            <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\r\n                                <div className=\"p-8 rounded-2xl bg-gradient-to-br from-[#00F5D4]/10 to-purple-500/10 border border-[#00F5D4]/30\">\r\n                                    <div className=\"flex items-center gap-4 mb-6\">\r\n                                        <span className=\"text-5xl animate-bounce\">­ƒç©­ƒç│</span>\r\n                                        <div>\r\n                                            <h2 className=\"text-2xl font-bold text-[#00F5D4]\">{simulation.analogy.title}</h2>\r\n                                            <p className=\"text-sm text-gray-400\">Analogie avec le contexte s├®n├®galais</p>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"whitespace-pre-line text-lg text-gray-200 leading-relaxed\">\r\n                                        {simulation.analogy.content}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {activeTab === 'theory' && (\r\n                            <div className=\"p-8 rounded-2xl bg-gradient-to-br from-white/10 to-white/5 border border-white/20 prose prose-invert max-w-none animate-in fade-in slide-in-from-bottom-4 duration-500\">\r\n                                <div className=\"whitespace-pre-line text-gray-300 leading-relaxed\">\r\n                                    {simulation.theory}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Section Exercices supprim├®e - remplac├®e par Mode D├®fi */}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Modals */}\r\n            <HelpModal isOpen={showHelpModal} onClose={() => setShowHelpModal(false)} />\r\n            <ResultsModal\r\n                isOpen={showResultsModal}\r\n                onClose={() => setShowResultsModal(false)}\r\n                score={quizResults.score}\r\n                total={quizResults.total}\r\n            />\r\n        </main >\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\simulations\\collegeData.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\simulations\\curriculum.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\simulations\\imageConfig.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\simulations\\lyceeData.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\simulations\\page.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\simulations\\pc3eSimulations.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\app\\simulations\\pc4eSimulations.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\AnalyticsWrapper.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\Analytics\\AnalyticsDashboard.js","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":82,"column":42,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[2621,2701],"text":"\r\n                        Acc├¿s r├®serv├® ├á l&apos;administrateur\r\n                    "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[2621,2701],"text":"\r\n                        Acc├¿s r├®serv├® ├á l&lsquo;administrateur\r\n                    "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[2621,2701],"text":"\r\n                        Acc├¿s r├®serv├® ├á l&#39;administrateur\r\n                    "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[2621,2701],"text":"\r\n                        Acc├¿s r├®serv├® ├á l&rsquo;administrateur\r\n                    "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":118,"column":30,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[4557,4652],"text":"\r\n                        Vue d&apos;ensemble des utilisateurs et interactions\r\n                    "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[4557,4652],"text":"\r\n                        Vue d&lsquo;ensemble des utilisateurs et interactions\r\n                    "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[4557,4652],"text":"\r\n                        Vue d&#39;ensemble des utilisateurs et interactions\r\n                    "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[4557,4652],"text":"\r\n                        Vue d&rsquo;ensemble des utilisateurs et interactions\r\n                    "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":302,"column":81,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[16278,16279],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[16278,16279],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[16278,16279],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[16278,16279],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":302,"column":108,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[16305,16306],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[16305,16306],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[16305,16306],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[16305,16306],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { useAnalytics } from './AnalyticsProvider';\r\n\r\nconst niveauLabels = {\r\n    '6eme': '6├¿me',\r\n    '5eme': '5├¿me',\r\n    '4eme': '4├¿me',\r\n    '3eme': '3├¿me',\r\n    '2nde': 'Seconde',\r\n    '1ere': 'Premi├¿re',\r\n    'tle': 'Terminale',\r\n    'etudiant': '├ëtudiant',\r\n    'enseignant': 'Enseignant',\r\n    'autre': 'Autre',\r\n};\r\n\r\nconst niveauColors = {\r\n    '6eme': '#60A5FA',\r\n    '5eme': '#34D399',\r\n    '4eme': '#FBBF24',\r\n    '3eme': '#F87171',\r\n    '2nde': '#A78BFA',\r\n    '1ere': '#FB923C',\r\n    'tle': '#EC4899',\r\n    'etudiant': '#00F5D4',\r\n    'enseignant': '#14B8A6',\r\n    'autre': '#9CA3AF',\r\n};\r\n\r\nexport default function AnalyticsDashboard() {\r\n    const { isRoot, analytics, getStats, clearAnalytics, loginAsRoot, logoutRoot } = useAnalytics();\r\n    const [password, setPassword] = useState('');\r\n    const [error, setError] = useState('');\r\n    const [showClearConfirm, setShowClearConfirm] = useState(false);\r\n    const [activeTab, setActiveTab] = useState('overview');\r\n\r\n    const stats = getStats();\r\n\r\n    const handleLogin = (e) => {\r\n        e.preventDefault();\r\n        if (loginAsRoot(password)) {\r\n            setError('');\r\n            setPassword('');\r\n        } else {\r\n            setError('Mot de passe incorrect');\r\n        }\r\n    };\r\n\r\n    const handleClear = () => {\r\n        clearAnalytics();\r\n        setShowClearConfirm(false);\r\n    };\r\n\r\n    const formatDuration = (seconds) => {\r\n        if (seconds < 60) return `${seconds}s`;\r\n        if (seconds < 3600) return `${Math.floor(seconds / 60)}m ${seconds % 60}s`;\r\n        return `${Math.floor(seconds / 3600)}h ${Math.floor((seconds % 3600) / 60)}m`;\r\n    };\r\n\r\n    const formatDate = (dateString) => {\r\n        const date = new Date(dateString);\r\n        return date.toLocaleDateString('fr-FR', {\r\n            day: '2-digit',\r\n            month: 'short',\r\n            hour: '2-digit',\r\n            minute: '2-digit',\r\n        });\r\n    };\r\n\r\n    // Si pas connect├® en root, afficher le formulaire de connexion\r\n    if (!isRoot) {\r\n        return (\r\n            <div className=\"mt-16 p-8 rounded-3xl bg-gradient-to-br from-slate-900/80 to-slate-800/80 border border-white/10 backdrop-blur-xl\">\r\n                <div className=\"max-w-md mx-auto text-center\">\r\n                    <div className=\"text-5xl mb-4\">­ƒôè</div>\r\n                    <h3 className=\"text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-[#00F5D4] to-purple-500 mb-2\">\r\n                        Analytics Dashboard\r\n                    </h3>\r\n                    <p className=\"text-gray-400 mb-6\">\r\n                        Acc├¿s r├®serv├® ├á l'administrateur\r\n                    </p>\r\n\r\n                    <form onSubmit={handleLogin} className=\"space-y-4\">\r\n                        <input\r\n                            type=\"password\"\r\n                            value={password}\r\n                            onChange={(e) => setPassword(e.target.value)}\r\n                            className=\"w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white placeholder-gray-500 focus:border-[#00F5D4] focus:outline-none focus:ring-2 focus:ring-[#00F5D4]/20 transition-all text-center\"\r\n                            placeholder=\"Mot de passe admin\"\r\n                        />\r\n                        {error && <p className=\"text-red-400 text-sm\">{error}</p>}\r\n                        <button\r\n                            type=\"submit\"\r\n                            className=\"w-full px-6 py-3 rounded-xl bg-gradient-to-r from-[#00F5D4] to-purple-500 text-black font-bold hover:opacity-90 transition-all\"\r\n                        >\r\n                            Acc├®der aux Analytics\r\n                        </button>\r\n                    </form>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"mt-16 space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 p-6 rounded-2xl bg-gradient-to-r from-[#00F5D4]/10 to-purple-500/10 border border-white/10\">\r\n                <div>\r\n                    <h3 className=\"text-2xl font-bold text-white flex items-center gap-2\">\r\n                        ­ƒôè Analytics Dashboard\r\n                        <span className=\"px-2 py-0.5 text-xs bg-green-500/20 text-green-400 rounded-full\">\r\n                            ADMIN\r\n                        </span>\r\n                    </h3>\r\n                    <p className=\"text-gray-400 text-sm mt-1\">\r\n                        Vue d'ensemble des utilisateurs et interactions\r\n                    </p>\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                    <button\r\n                        onClick={() => setShowClearConfirm(true)}\r\n                        className=\"px-4 py-2 rounded-lg bg-red-500/10 text-red-400 text-sm font-medium hover:bg-red-500/20 transition-all\"\r\n                    >\r\n                        ­ƒùæ´©Å Effacer\r\n                    </button>\r\n                    <button\r\n                        onClick={logoutRoot}\r\n                        className=\"px-4 py-2 rounded-lg bg-white/10 text-gray-400 text-sm font-medium hover:bg-white/20 transition-all\"\r\n                    >\r\n                        D├®connexion\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Stats Cards */}\r\n            <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-4\">\r\n                <div className=\"p-6 rounded-2xl bg-gradient-to-br from-cyan-500/10 to-cyan-500/5 border border-cyan-500/20\">\r\n                    <div className=\"text-3xl mb-2\">­ƒæÑ</div>\r\n                    <div className=\"text-3xl font-bold text-white\">{stats.uniqueUsers}</div>\r\n                    <div className=\"text-sm text-gray-400\">Utilisateurs uniques</div>\r\n                </div>\r\n                <div className=\"p-6 rounded-2xl bg-gradient-to-br from-purple-500/10 to-purple-500/5 border border-purple-500/20\">\r\n                    <div className=\"text-3xl mb-2\">­ƒôê</div>\r\n                    <div className=\"text-3xl font-bold text-white\">{stats.totalSessions}</div>\r\n                    <div className=\"text-sm text-gray-400\">Sessions totales</div>\r\n                </div>\r\n                <div className=\"p-6 rounded-2xl bg-gradient-to-br from-pink-500/10 to-pink-500/5 border border-pink-500/20\">\r\n                    <div className=\"text-3xl mb-2\">ÔÅ▒´©Å</div>\r\n                    <div className=\"text-3xl font-bold text-white\">{formatDuration(stats.avgDuration)}</div>\r\n                    <div className=\"text-sm text-gray-400\">Dur├®e moyenne</div>\r\n                </div>\r\n                <div className=\"p-6 rounded-2xl bg-gradient-to-br from-green-500/10 to-green-500/5 border border-green-500/20\">\r\n                    <div className=\"text-3xl mb-2\">Ô¡É</div>\r\n                    <div className=\"text-3xl font-bold text-white\">\r\n                        {analytics.filter(a => a.feedback?.rating).length}\r\n                    </div>\r\n                    <div className=\"text-sm text-gray-400\">Feedbacks re├ºus</div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Tabs */}\r\n            <div className=\"flex gap-2 overflow-x-auto pb-2\">\r\n                {['overview', 'users', 'feedback'].map((tab) => (\r\n                    <button\r\n                        key={tab}\r\n                        onClick={() => setActiveTab(tab)}\r\n                        className={`px-4 py-2 rounded-lg font-medium text-sm whitespace-nowrap transition-all ${activeTab === tab\r\n                                ? 'bg-[#00F5D4] text-black'\r\n                                : 'bg-white/5 text-gray-400 hover:bg-white/10'\r\n                            }`}\r\n                    >\r\n                        {tab === 'overview' && '­ƒôè Vue d\\'ensemble'}\r\n                        {tab === 'users' && '­ƒæÑ Utilisateurs'}\r\n                        {tab === 'feedback' && '­ƒÆ¼ Feedbacks'}\r\n                    </button>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Content */}\r\n            <div className=\"p-6 rounded-2xl bg-slate-900/50 border border-white/10\">\r\n                {activeTab === 'overview' && (\r\n                    <div className=\"space-y-6\">\r\n                        {/* R├®partition par niveau */}\r\n                        <div>\r\n                            <h4 className=\"text-lg font-bold text-white mb-4\">R├®partition par niveau</h4>\r\n                            <div className=\"space-y-3\">\r\n                                {Object.entries(stats.levelCounts).sort((a, b) => b[1] - a[1]).map(([niveau, count]) => {\r\n                                    const percentage = Math.round((count / stats.totalSessions) * 100) || 0;\r\n                                    return (\r\n                                        <div key={niveau} className=\"flex items-center gap-4\">\r\n                                            <div className=\"w-24 text-sm text-gray-400\">{niveauLabels[niveau] || niveau}</div>\r\n                                            <div className=\"flex-1 h-6 bg-white/5 rounded-full overflow-hidden\">\r\n                                                <div\r\n                                                    className=\"h-full rounded-full transition-all duration-500\"\r\n                                                    style={{\r\n                                                        width: `${percentage}%`,\r\n                                                        backgroundColor: niveauColors[niveau] || '#00F5D4',\r\n                                                    }}\r\n                                                ></div>\r\n                                            </div>\r\n                                            <div className=\"w-16 text-right text-sm font-bold\" style={{ color: niveauColors[niveau] || '#00F5D4' }}>\r\n                                                {count} ({percentage}%)\r\n                                            </div>\r\n                                        </div>\r\n                                    );\r\n                                })}\r\n                                {Object.keys(stats.levelCounts).length === 0 && (\r\n                                    <p className=\"text-gray-500 text-center py-4\">Aucune donn├®e disponible</p>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Visites r├®centes */}\r\n                        <div>\r\n                            <h4 className=\"text-lg font-bold text-white mb-4\">Visites par jour</h4>\r\n                            <div className=\"flex gap-2 flex-wrap\">\r\n                                {Object.entries(stats.dailyVisits).slice(-7).map(([date, count]) => (\r\n                                    <div key={date} className=\"px-3 py-2 rounded-lg bg-white/5 text-center\">\r\n                                        <div className=\"text-lg font-bold text-[#00F5D4]\">{count}</div>\r\n                                        <div className=\"text-xs text-gray-500\">{date.slice(5)}</div>\r\n                                    </div>\r\n                                ))}\r\n                                {Object.keys(stats.dailyVisits).length === 0 && (\r\n                                    <p className=\"text-gray-500\">Aucune visite enregistr├®e</p>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {activeTab === 'users' && (\r\n                    <div className=\"overflow-x-auto\">\r\n                        <table className=\"w-full text-sm\">\r\n                            <thead>\r\n                                <tr className=\"border-b border-white/10\">\r\n                                    <th className=\"text-left py-3 px-2 text-gray-400 font-medium\">Utilisateur</th>\r\n                                    <th className=\"text-left py-3 px-2 text-gray-400 font-medium\">Niveau</th>\r\n                                    <th className=\"text-left py-3 px-2 text-gray-400 font-medium\">Date</th>\r\n                                    <th className=\"text-left py-3 px-2 text-gray-400 font-medium\">Dur├®e</th>\r\n                                    <th className=\"text-left py-3 px-2 text-gray-400 font-medium\">Appareil</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody>\r\n                                {stats.recentSessions.map((session, i) => (\r\n                                    <tr key={i} className=\"border-b border-white/5 hover:bg-white/5\">\r\n                                        <td className=\"py-3 px-2 text-white\">\r\n                                            {session.user?.prenom} {session.user?.nom}\r\n                                        </td>\r\n                                        <td className=\"py-3 px-2\">\r\n                                            <span\r\n                                                className=\"px-2 py-1 rounded-full text-xs font-medium\"\r\n                                                style={{\r\n                                                    backgroundColor: `${niveauColors[session.user?.niveau] || '#00F5D4'}20`,\r\n                                                    color: niveauColors[session.user?.niveau] || '#00F5D4',\r\n                                                }}\r\n                                            >\r\n                                                {niveauLabels[session.user?.niveau] || session.user?.niveau}\r\n                                            </span>\r\n                                        </td>\r\n                                        <td className=\"py-3 px-2 text-gray-400\">{formatDate(session.date)}</td>\r\n                                        <td className=\"py-3 px-2 text-gray-400\">{formatDuration(session.duration || 0)}</td>\r\n                                        <td className=\"py-3 px-2 text-gray-500 text-xs\">{session.screenSize}</td>\r\n                                    </tr>\r\n                                ))}\r\n                                {stats.recentSessions.length === 0 && (\r\n                                    <tr>\r\n                                        <td colSpan={5} className=\"py-8 text-center text-gray-500\">\r\n                                            Aucune session enregistr├®e\r\n                                        </td>\r\n                                    </tr>\r\n                                )}\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                )}\r\n\r\n                {activeTab === 'feedback' && (\r\n                    <div className=\"space-y-4\">\r\n                        {analytics.filter(a => a.feedback).map((session, i) => (\r\n                            <div key={i} className=\"p-4 rounded-xl bg-white/5 border border-white/10\">\r\n                                <div className=\"flex items-start justify-between mb-2\">\r\n                                    <div>\r\n                                        <span className=\"font-bold text-white\">{session.user?.prenom}</span>\r\n                                        <span className=\"text-gray-500 ml-2 text-sm\">\r\n                                            {niveauLabels[session.user?.niveau] || session.user?.niveau}\r\n                                        </span>\r\n                                    </div>\r\n                                    <div className=\"flex items-center gap-1\">\r\n                                        {[1, 2, 3, 4, 5].map((star) => (\r\n                                            <span\r\n                                                key={star}\r\n                                                className={star <= session.feedback.rating ? 'text-yellow-400' : 'text-gray-600'}\r\n                                            >\r\n                                                Ôÿà\r\n                                            </span>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                                {session.feedback.comment && (\r\n                                    <p className=\"text-gray-300 text-sm italic\">\"{session.feedback.comment}\"</p>\r\n                                )}\r\n                                <p className=\"text-gray-500 text-xs mt-2\">{formatDate(session.feedback.submittedAt)}</p>\r\n                            </div>\r\n                        ))}\r\n                        {analytics.filter(a => a.feedback).length === 0 && (\r\n                            <p className=\"text-gray-500 text-center py-8\">Aucun feedback re├ºu</p>\r\n                        )}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Confirmation de suppression */}\r\n            {showClearConfirm && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-xl\">\r\n                    <div className=\"bg-slate-900 p-6 rounded-2xl border border-white/10 max-w-sm\">\r\n                        <div className=\"text-4xl text-center mb-4\">ÔÜá´©Å</div>\r\n                        <h4 className=\"text-lg font-bold text-white text-center mb-2\">Effacer toutes les analytics ?</h4>\r\n                        <p className=\"text-gray-400 text-sm text-center mb-6\">\r\n                            Cette action est irr├®versible. Toutes les donn├®es seront supprim├®es.\r\n                        </p>\r\n                        <div className=\"flex gap-3\">\r\n                            <button\r\n                                onClick={() => setShowClearConfirm(false)}\r\n                                className=\"flex-1 px-4 py-2 rounded-lg bg-white/10 text-gray-400 font-medium hover:bg-white/20 transition-all\"\r\n                            >\r\n                                Annuler\r\n                            </button>\r\n                            <button\r\n                                onClick={handleClear}\r\n                                className=\"flex-1 px-4 py-2 rounded-lg bg-red-500 text-white font-medium hover:bg-red-600 transition-all\"\r\n                            >\r\n                                Effacer tout\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\Analytics\\AnalyticsProvider.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'saveSessionData'. Either include it or remove the dependency array.","line":93,"column":8,"nodeType":"ArrayExpression","endLine":93,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [saveSessionData]","fix":{"range":[3313,3315],"text":"[saveSessionData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { createContext, useContext, useState, useEffect, useCallback } from 'react';\r\n\r\nconst AnalyticsContext = createContext(null);\r\n\r\n// Mot de passe root\r\nconst ROOT_PASSWORD = 'SymLab2025';\r\n\r\n// Cl├®s de stockage\r\nconst STORAGE_KEYS = {\r\n    USER_DATA: 'symlab_user_data',\r\n    ANALYTICS: 'symlab_analytics',\r\n    SESSION_ID: 'symlab_session_id',\r\n    IS_ROOT: 'symlab_is_root',\r\n    VISITED: 'symlab_visited',\r\n};\r\n\r\n// G├®n├®rer un ID de session unique\r\nconst generateSessionId = () => {\r\n    return `session_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`;\r\n};\r\n\r\nexport function AnalyticsProvider({ children }) {\r\n    const [showWelcomeModal, setShowWelcomeModal] = useState(false);\r\n    const [showFeedbackModal, setShowFeedbackModal] = useState(false);\r\n    const [userData, setUserData] = useState(null);\r\n    const [isRoot, setIsRoot] = useState(false);\r\n    const [analytics, setAnalytics] = useState([]);\r\n    const [sessionId, setSessionId] = useState(null);\r\n    const [sessionStart, setSessionStart] = useState(null);\r\n\r\n    // Charger les donn├®es au d├®marrage\r\n    useEffect(() => {\r\n        if (typeof window === 'undefined') return;\r\n\r\n        const stored = localStorage.getItem(STORAGE_KEYS.USER_DATA);\r\n        const storedRoot = localStorage.getItem(STORAGE_KEYS.IS_ROOT);\r\n        const storedAnalytics = localStorage.getItem(STORAGE_KEYS.ANALYTICS);\r\n        const visited = sessionStorage.getItem(STORAGE_KEYS.VISITED);\r\n\r\n        if (storedRoot === 'true') {\r\n            setIsRoot(true);\r\n        }\r\n\r\n        if (storedAnalytics) {\r\n            try {\r\n                setAnalytics(JSON.parse(storedAnalytics));\r\n            } catch (e) {\r\n                console.error('Error parsing analytics', e);\r\n            }\r\n        }\r\n\r\n        if (stored) {\r\n            try {\r\n                const data = JSON.parse(stored);\r\n                setUserData(data);\r\n            } catch (e) {\r\n                console.error('Error parsing user data', e);\r\n            }\r\n        } else if (!visited && storedRoot !== 'true') {\r\n            // Premi├¿re visite, afficher le modal de bienvenue\r\n            setShowWelcomeModal(true);\r\n        }\r\n\r\n        // Cr├®er une nouvelle session\r\n        const newSessionId = generateSessionId();\r\n        setSessionId(newSessionId);\r\n        setSessionStart(Date.now());\r\n        sessionStorage.setItem(STORAGE_KEYS.VISITED, 'true');\r\n\r\n        // D├®tecter la fermeture de page pour le feedback\r\n        const handleBeforeUnload = (e) => {\r\n            if (!storedRoot && stored && !sessionStorage.getItem('feedback_given')) {\r\n                // On ne peut pas vraiment afficher un modal ici, mais on peut sauvegarder la session\r\n                saveSessionData();\r\n            }\r\n        };\r\n\r\n        const handleVisibilityChange = () => {\r\n            if (document.visibilityState === 'hidden') {\r\n                saveSessionData();\r\n            }\r\n        };\r\n\r\n        window.addEventListener('beforeunload', handleBeforeUnload);\r\n        document.addEventListener('visibilitychange', handleVisibilityChange);\r\n\r\n        return () => {\r\n            window.removeEventListener('beforeunload', handleBeforeUnload);\r\n            document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n        };\r\n    }, []);\r\n\r\n    // Sauvegarder les donn├®es de session\r\n    const saveSessionData = useCallback(() => {\r\n        if (!userData || isRoot) return;\r\n\r\n        const sessionData = {\r\n            sessionId,\r\n            user: userData,\r\n            startTime: sessionStart,\r\n            endTime: Date.now(),\r\n            duration: Math.round((Date.now() - sessionStart) / 1000), // en secondes\r\n            pagesVisited: window.history.length,\r\n            userAgent: navigator.userAgent,\r\n            screenSize: `${window.innerWidth}x${window.innerHeight}`,\r\n            date: new Date().toISOString(),\r\n        };\r\n\r\n        const currentAnalytics = JSON.parse(localStorage.getItem(STORAGE_KEYS.ANALYTICS) || '[]');\r\n        currentAnalytics.push(sessionData);\r\n        localStorage.setItem(STORAGE_KEYS.ANALYTICS, JSON.stringify(currentAnalytics));\r\n        setAnalytics(currentAnalytics);\r\n    }, [userData, isRoot, sessionId, sessionStart]);\r\n\r\n    // Enregistrer un nouvel utilisateur\r\n    const registerUser = (data) => {\r\n        const userInfo = {\r\n            ...data,\r\n            registeredAt: new Date().toISOString(),\r\n            id: `user_${Date.now()}`,\r\n        };\r\n        localStorage.setItem(STORAGE_KEYS.USER_DATA, JSON.stringify(userInfo));\r\n        setUserData(userInfo);\r\n        setShowWelcomeModal(false);\r\n    };\r\n\r\n    // Connexion root\r\n    const loginAsRoot = (password) => {\r\n        if (password === ROOT_PASSWORD) {\r\n            localStorage.setItem(STORAGE_KEYS.IS_ROOT, 'true');\r\n            setIsRoot(true);\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    // D├®connexion root\r\n    const logoutRoot = () => {\r\n        localStorage.removeItem(STORAGE_KEYS.IS_ROOT);\r\n        setIsRoot(false);\r\n    };\r\n\r\n    // Soumettre le feedback\r\n    const submitFeedback = (feedback) => {\r\n        if (!userData || isRoot) return;\r\n\r\n        const feedbackData = {\r\n            sessionId,\r\n            user: userData,\r\n            feedback,\r\n            submittedAt: new Date().toISOString(),\r\n        };\r\n\r\n        const currentAnalytics = JSON.parse(localStorage.getItem(STORAGE_KEYS.ANALYTICS) || '[]');\r\n        // Ajouter le feedback ├á la derni├¿re session de cet utilisateur\r\n        const lastIndex = currentAnalytics.findIndex(a => a.sessionId === sessionId);\r\n        if (lastIndex !== -1) {\r\n            currentAnalytics[lastIndex].feedback = feedback;\r\n        } else {\r\n            currentAnalytics.push(feedbackData);\r\n        }\r\n        localStorage.setItem(STORAGE_KEYS.ANALYTICS, JSON.stringify(currentAnalytics));\r\n        setAnalytics(currentAnalytics);\r\n        sessionStorage.setItem('feedback_given', 'true');\r\n        setShowFeedbackModal(false);\r\n    };\r\n\r\n    // Obtenir les statistiques\r\n    const getStats = () => {\r\n        const uniqueUsers = new Set(analytics.map(a => a.user?.id)).size;\r\n        const totalSessions = analytics.length;\r\n        const avgDuration = analytics.reduce((acc, a) => acc + (a.duration || 0), 0) / (totalSessions || 1);\r\n\r\n        const levelCounts = {};\r\n        const dailyVisits = {};\r\n\r\n        analytics.forEach(a => {\r\n            if (a.user?.niveau) {\r\n                levelCounts[a.user.niveau] = (levelCounts[a.user.niveau] || 0) + 1;\r\n            }\r\n            const day = a.date?.split('T')[0] || 'unknown';\r\n            dailyVisits[day] = (dailyVisits[day] || 0) + 1;\r\n        });\r\n\r\n        return {\r\n            uniqueUsers,\r\n            totalSessions,\r\n            avgDuration: Math.round(avgDuration),\r\n            levelCounts,\r\n            dailyVisits,\r\n            recentSessions: analytics.slice(-20).reverse(),\r\n        };\r\n    };\r\n\r\n    // Effacer toutes les analytics\r\n    const clearAnalytics = () => {\r\n        localStorage.removeItem(STORAGE_KEYS.ANALYTICS);\r\n        setAnalytics([]);\r\n    };\r\n\r\n    // Demander feedback avant de quitter\r\n    const requestFeedback = () => {\r\n        if (!isRoot && userData && !sessionStorage.getItem('feedback_given')) {\r\n            setShowFeedbackModal(true);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <AnalyticsContext.Provider\r\n            value={{\r\n                userData,\r\n                isRoot,\r\n                analytics,\r\n                showWelcomeModal,\r\n                showFeedbackModal,\r\n                setShowWelcomeModal,\r\n                setShowFeedbackModal,\r\n                registerUser,\r\n                loginAsRoot,\r\n                logoutRoot,\r\n                submitFeedback,\r\n                getStats,\r\n                clearAnalytics,\r\n                requestFeedback,\r\n                ROOT_PASSWORD,\r\n            }}\r\n        >\r\n            {children}\r\n        </AnalyticsContext.Provider>\r\n    );\r\n}\r\n\r\nexport function useAnalytics() {\r\n    const context = useContext(AnalyticsContext);\r\n    if (!context) {\r\n        throw new Error('useAnalytics must be used within an AnalyticsProvider');\r\n    }\r\n    return context;\r\n}\r\n\r\nexport { ROOT_PASSWORD };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\Analytics\\FeedbackModal.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\Analytics\\WelcomeModal.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\Analytics\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\Chimie1ereSimulations.js","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":588,"column":101,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[31152,31203],"text":" R├ëACTIONS D&apos;ADDITION\r\n                            "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[31152,31203],"text":" R├ëACTIONS D&lsquo;ADDITION\r\n                            "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[31152,31203],"text":" R├ëACTIONS D&#39;ADDITION\r\n                            "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[31152,31203],"text":" R├ëACTIONS D&rsquo;ADDITION\r\n                            "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":798,"column":33,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[43236,43442],"text":"\r\n                                &quot;Les ├®lectrons ne sont pas fixes. Ils forment un nuage de probabilit├® parfaitement sym├®trique, rendant la mol├®cule incroyablement r├®sistante.\"\r\n                            "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[43236,43442],"text":"\r\n                                &ldquo;Les ├®lectrons ne sont pas fixes. Ils forment un nuage de probabilit├® parfaitement sym├®trique, rendant la mol├®cule incroyablement r├®sistante.\"\r\n                            "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[43236,43442],"text":"\r\n                                &#34;Les ├®lectrons ne sont pas fixes. Ils forment un nuage de probabilit├® parfaitement sym├®trique, rendant la mol├®cule incroyablement r├®sistante.\"\r\n                            "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[43236,43442],"text":"\r\n                                &rdquo;Les ├®lectrons ne sont pas fixes. Ils forment un nuage de probabilit├® parfaitement sym├®trique, rendant la mol├®cule incroyablement r├®sistante.\"\r\n                            "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":798,"column":174,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[43236,43442],"text":"\r\n                                \"Les ├®lectrons ne sont pas fixes. Ils forment un nuage de probabilit├® parfaitement sym├®trique, rendant la mol├®cule incroyablement r├®sistante.&quot;\r\n                            "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[43236,43442],"text":"\r\n                                \"Les ├®lectrons ne sont pas fixes. Ils forment un nuage de probabilit├® parfaitement sym├®trique, rendant la mol├®cule incroyablement r├®sistante.&ldquo;\r\n                            "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[43236,43442],"text":"\r\n                                \"Les ├®lectrons ne sont pas fixes. Ils forment un nuage de probabilit├® parfaitement sym├®trique, rendant la mol├®cule incroyablement r├®sistante.&#34;\r\n                            "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[43236,43442],"text":"\r\n                                \"Les ├®lectrons ne sont pas fixes. Ils forment un nuage de probabilit├® parfaitement sym├®trique, rendant la mol├®cule incroyablement r├®sistante.&rdquo;\r\n                            "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":978,"column":169,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[54978,55095],"text":"Capable de former des liaisons hydrog├¿ne. Tr├¿s soluble, point d&apos;├®bullition ├®lev├® et r├®actif vis-├á-vis de l'oxydation."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[54978,55095],"text":"Capable de former des liaisons hydrog├¿ne. Tr├¿s soluble, point d&lsquo;├®bullition ├®lev├® et r├®actif vis-├á-vis de l'oxydation."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[54978,55095],"text":"Capable de former des liaisons hydrog├¿ne. Tr├¿s soluble, point d&#39;├®bullition ├®lev├® et r├®actif vis-├á-vis de l'oxydation."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[54978,55095],"text":"Capable de former des liaisons hydrog├¿ne. Tr├¿s soluble, point d&rsquo;├®bullition ├®lev├® et r├®actif vis-├á-vis de l'oxydation."},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":978,"column":212,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[54978,55095],"text":"Capable de former des liaisons hydrog├¿ne. Tr├¿s soluble, point d'├®bullition ├®lev├® et r├®actif vis-├á-vis de l&apos;oxydation."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[54978,55095],"text":"Capable de former des liaisons hydrog├¿ne. Tr├¿s soluble, point d'├®bullition ├®lev├® et r├®actif vis-├á-vis de l&lsquo;oxydation."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[54978,55095],"text":"Capable de former des liaisons hydrog├¿ne. Tr├¿s soluble, point d'├®bullition ├®lev├® et r├®actif vis-├á-vis de l&#39;oxydation."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[54978,55095],"text":"Capable de former des liaisons hydrog├¿ne. Tr├¿s soluble, point d'├®bullition ├®lev├® et r├®actif vis-├á-vis de l&rsquo;oxydation."},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":997,"column":103,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[56907,56918],"text":"R ÔÇö CO ÔÇö R&apos;"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[56907,56918],"text":"R ÔÇö CO ÔÇö R&lsquo;"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[56907,56918],"text":"R ÔÇö CO ÔÇö R&#39;"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[56907,56918],"text":"R ÔÇö CO ÔÇö R&rsquo;"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":1405,"column":53,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[78298,78318],"text":"Dur├®e de l&apos;op├®ration"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[78298,78318],"text":"Dur├®e de l&lsquo;op├®ration"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[78298,78318],"text":"Dur├®e de l&#39;op├®ration"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[78298,78318],"text":"Dur├®e de l&rsquo;op├®ration"},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useRef, useMemo, useEffect } from 'react';\r\nimport { useFrame } from '@react-three/fiber';\r\nimport { Html, OrbitControls, Text, Sphere, Box, Cylinder, Line, Plane, Float, MeshDistortMaterial } from '@react-three/drei';\r\nimport * as THREE from 'three';\r\nimport DraggableHtmlPanel from './DraggableHtmlPanel';\r\nimport { SuccessOverlay, ConfettiExplosion, ChallengeTimer, GradeBadge, XPBar, PhaseSelector, MissionObjective } from './GamificationUtils';\r\n\r\n// ==========================================\r\n// ATOM COLORS & RADII\r\n// ==========================================\r\nconst ATOM = {\r\n    C: { color: '#262626', r: 0.4 },\r\n    H: { color: '#F8FAFC', r: 0.25 },\r\n    O: { color: '#EF4444', r: 0.38 },\r\n    N: { color: '#3B82F6', r: 0.38 },\r\n    Cl: { color: '#10B981', r: 0.45 },\r\n};\r\n\r\n// trigSuccess removal (using SuccessOverlay now)\r\n\r\n// ==========================================\r\n// C1: G├ëN├ëRALIT├ëS CHIMIE ORGANIQUE (T├®travalence du C)\r\n// ==========================================\r\nexport function ChimieOrgaGeneralSim() {\r\n    // ├ëtats Globaux & Gamification\r\n    const [phase, setPhase] = useState('mission');\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(30);\r\n\r\n    // ├ëtats Physiques\r\n    const [showLabels, setShowLabels] = useState(false);\r\n    const groupRef = useRef();\r\n\r\n    // Missions Config\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Analyse T├®tra├®drique', objective: 'Activez les labels pour identifier le Carbone central.', type: 'labels' },\r\n        { id: 2, title: 'G├®om├®trie Mol├®culaire', objective: 'Observez la structure tridimensionnelle du m├®thane.', type: 'observe' },\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            setMission(missions[0]);\r\n            setTimeLeft(30);\r\n        }\r\n    }, [phase, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        let timer;\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess && mission) {\r\n            timer = setInterval(() => setTimeLeft(prev => prev - 1), 1000);\r\n        }\r\n        return () => clearInterval(timer);\r\n    }, [phase, timeLeft, showSuccess, mission]);\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        const nextIdx = missions.findIndex(m => m.id === mission.id) + 1;\r\n        if (nextIdx < missions.length) {\r\n            setMission(missions[nextIdx]);\r\n            setTimeLeft(30);\r\n        } else {\r\n            setPhase('explore');\r\n            setMission(null);\r\n        }\r\n    };\r\n\r\n    const completeObjective = () => {\r\n        if (showSuccess) return;\r\n        setScore(prev => prev + 250);\r\n        setShowSuccess(true);\r\n    };\r\n\r\n    useFrame((state, delta) => {\r\n        if (groupRef.current) {\r\n            groupRef.current.rotation.y += delta * 0.2;\r\n        }\r\n    });\r\n\r\n    // M├®thane CH4 - T├®tra├¿dre parfait\r\n    const hPos = [\r\n        [0.6, 0.6, 0.6], [-0.6, -0.6, 0.6], [-0.6, 0.6, -0.6], [0.6, -0.6, -0.6]\r\n    ];\r\n\r\n    return (\r\n        <group>\r\n            <OrbitControls enableZoom={false} />\r\n            <ambientLight intensity={0.7} />\r\n            <pointLight position={[10, 10, 10]} intensity={1.5} />\r\n            <pointLight position={[-10, -10, -10]} intensity={0.5} color=\"#00F5D4\" />\r\n\r\n            <Float speed={2} rotationIntensity={0.5} floatIntensity={0.5}>\r\n                <group ref={groupRef} scale={1.8}>\r\n                    {/* Carbone central avec effet Glow */}\r\n                    <mesh>\r\n                        <sphereGeometry args={[ATOM.C.r, 32, 32]} />\r\n                        <meshStandardMaterial color={ATOM.C.color} metalness={0.9} roughness={0.1} />\r\n                    </mesh>\r\n                    {showLabels && (\r\n                        <Text position={[0, 0.6, 0]} fontSize={0.2} color=\"#00F5D4\" font=\"/fonts/Inter-Bold.woff\" outlineWidth={0.02} outlineColor=\"#000\">\r\n                            C\r\n                        </Text>\r\n                    )}\r\n\r\n                    {/* 4 Hydrog├¿nes avec liaisons holographiques */}\r\n                    {hPos.map((p, i) => (\r\n                        <group key={i}>\r\n                            <mesh position={p}>\r\n                                <sphereGeometry args={[ATOM.H.r, 24, 24]} />\r\n                                <meshStandardMaterial color={ATOM.H.color} emissive=\"#fff\" emissiveIntensity={0.2} metalness={1} roughness={0} />\r\n                            </mesh>\r\n                            <Line points={[[0, 0, 0], p]} color=\"#00F5D4\" lineWidth={3} transparent opacity={0.4} />\r\n                            {showLabels && (\r\n                                <Text position={[p[0] * 1.3, p[1] * 1.3, p[2] * 1.3]} fontSize={0.15} color=\"#FFF\" font=\"/fonts/Inter-Regular.woff\" outlineWidth={0.01} outlineColor=\"#000\">\r\n                                    H\r\n                                </Text>\r\n                            )}\r\n                        </group>\r\n                    ))}\r\n                </group>\r\n            </Float>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒº¬ Laboratoire de Structure\" className=\"w-[380px] border-cyan-500/30 text-white\" defaultPosition=\"bottom-right\">\r\n                    <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                    <div className=\"flex justify-between items-center mb-4 border-b border-white/10 pb-2\">\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-[10px] text-cyan-400 font-black uppercase tracking-widest leading-tight\">Chimie Organique</span>\r\n                            <span className=\"text-lg font-black\">{phase === 'explore' ? 'Visualisation 3D' : 'Mission T├®travalence ­ƒÄ»'}</span>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {phase === 'mission' && mission && (\r\n                        <div className=\"mb-4 space-y-2\">\r\n                            <ChallengeTimer timeLeft={timeLeft} />\r\n                            <MissionObjective objective={mission.objective} icon=\"­ƒö¼\" />\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"bg-gray-950 p-4 rounded-2xl border border-white/5 relative overflow-hidden group\">\r\n                            <div className=\"absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-100 transition-opacity\">\r\n                                <div className=\"text-3xl font-black text-cyan-500\">CHÔéä</div>\r\n                            </div>\r\n                            <div className=\"text-[10px] text-gray-500 font-black uppercase mb-1 tracking-widest\">Mol├®cule Mod├¿le</div>\r\n                            <div className=\"text-xl font-black text-white uppercase tracking-tight\">Le M├®thane</div>\r\n                            <div className=\"text-[10px] text-cyan-400 font-bold uppercase mt-1 tracking-wider\">Hydrocarbure satur├® simple</div>\r\n                        </div>\r\n\r\n                        <button\r\n                            onClick={() => {\r\n                                setShowLabels(!showLabels);\r\n                                if (phase === 'mission' && mission?.type === 'labels') completeObjective();\r\n                            }}\r\n                            className={`w-full py-4 rounded-xl font-black text-xs transition-all transform active:scale-95 flex items-center justify-center gap-3 ${showLabels\r\n                                ? 'bg-cyan-600 shadow-lg shadow-cyan-900/40 border-b-4 border-cyan-800'\r\n                                : 'bg-gray-800 hover:bg-gray-700 border-b-4 border-gray-950'}`}\r\n                        >\r\n                            <span>{showLabels ? 'D├ëSACTIVER LABELS' : 'ACTIVER LABELS ├ëLECTRONIQUES'}</span>\r\n                            {showLabels && <span className=\"animate-pulse w-2 h-2 rounded-full bg-white block\" />}\r\n                        </button>\r\n\r\n                        <div className=\"grid grid-cols-2 gap-3\">\r\n                            <div className=\"p-3 bg-black/40 rounded-xl border border-white/5 group hover:border-cyan-500/30 transition-colors\">\r\n                                <p className=\"text-[9px] text-gray-500 font-black uppercase mb-1 tracking-widest group-hover:text-cyan-400\">Angles</p>\r\n                                <p className=\"text-sm font-black text-white\">109.5┬░</p>\r\n                            </div>\r\n                            <div className=\"p-3 bg-black/40 rounded-xl border border-white/5 group hover:border-cyan-500/30 transition-colors\">\r\n                                <p className=\"text-[9px] text-gray-500 font-black uppercase mb-1 tracking-widest group-hover:text-cyan-400\">G├®om├®trie</p>\r\n                                <p className=\"text-sm font-black text-white uppercase\">T├®tra├¿dre</p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <XPBar current={score % 500} nextLevel={500} />\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay show={showSuccess} message={mission?.title || \"Analyse Valid├®e !\"} points={250} onNext={nextMission} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// ==========================================\r\n// C2: ALCANES (Nomenclature + Combustion)\r\n// ==========================================\r\nexport function AlcanesSim() {\r\n    // ├ëtats Globaux & Gamification\r\n    const [phase, setPhase] = useState('mission');\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n\r\n    // ├ëtats Physiques\r\n    const [n, setN] = useState(1);\r\n    const names = ['', 'M├®thane', '├ëthane', 'Propane', 'Butane', 'Pentane', 'Hexane', 'Heptane', 'Octane'];\r\n\r\n    // Missions Config\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Synth├¿se Butane', objective: 'Ajustez la cha├«ne pour former du Butane (n=4).', targetN: 4 },\r\n        { id: 2, title: 'Hydrocarbure Liquide', objective: 'Mod├®lisez un alcane liquide ├á temp├®rature ambiante (n ÔëÑ 5).', type: 'liquid' },\r\n        { id: 3, title: 'Combustion Compl├¿te', objective: 'Pr├®parez l\\'Octane pour une simulation moteur.', targetN: 8 }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            setMission(missions[0]);\r\n            setTimeLeft(45);\r\n        }\r\n    }, [phase, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        let timer;\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess && mission) {\r\n            timer = setInterval(() => setTimeLeft(prev => prev - 1), 1000);\r\n        }\r\n        return () => clearInterval(timer);\r\n    }, [phase, timeLeft, showSuccess, mission]);\r\n\r\n    const handleNChange = (val) => {\r\n        setN(val);\r\n        if (phase === 'mission' && mission) {\r\n            if (mission.type === 'liquid' && val >= 5) {\r\n                completeObjective();\r\n            } else if (val === mission.targetN) {\r\n                completeObjective();\r\n            }\r\n        }\r\n    };\r\n\r\n    const completeObjective = () => {\r\n        if (showSuccess) return;\r\n        setScore(prev => prev + 350);\r\n        setShowSuccess(true);\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        const nextIdx = missions.findIndex(m => m.id === mission.id) + 1;\r\n        if (nextIdx < missions.length) {\r\n            setMission(missions[nextIdx]);\r\n            setTimeLeft(45);\r\n        } else {\r\n            setPhase('explore');\r\n            setMission(null);\r\n        }\r\n    };\r\n\r\n    const structure = useMemo(() => {\r\n        const list = [];\r\n        const bondLen = 0.9;\r\n        const angle = 35 * Math.PI / 180;\r\n        const dx = bondLen * Math.cos(angle);\r\n        const dy = bondLen * Math.sin(angle);\r\n        const hRad = 0.7;\r\n\r\n        for (let i = 0; i < n; i++) {\r\n            const cx = i * dx - ((n - 1) * dx) / 2;\r\n            const cy = (i % 2 === 0) ? -dy / 2 : dy / 2;\r\n            const cPos = new THREE.Vector3(cx, cy, 0);\r\n            list.push({ type: 'C', pos: cPos, id: i });\r\n\r\n            const up = (i % 2 === 0) ? 1 : -1;\r\n\r\n            const h1 = new THREE.Vector3(cx, cy + up * hRad * 0.7, hRad * 0.8);\r\n            const h2 = new THREE.Vector3(cx, cy + up * hRad * 0.7, -hRad * 0.8);\r\n            list.push({ type: 'H', pos: h1, parent: cPos });\r\n            list.push({ type: 'H', pos: h2, parent: cPos });\r\n\r\n            if (i === 0) {\r\n                const hTerm = new THREE.Vector3(cx - hRad, cy - up * 0.3, 0);\r\n                list.push({ type: 'H', pos: hTerm, parent: cPos });\r\n            }\r\n            if (i === n - 1) {\r\n                const hTerm = new THREE.Vector3(cx + hRad, cy - up * 0.3, 0);\r\n                list.push({ type: 'H', pos: hTerm, parent: cPos });\r\n            }\r\n        }\r\n        return { atoms: list, carbonCount: n };\r\n    }, [n]);\r\n\r\n    return (\r\n        <group>\r\n            <OrbitControls enableZoom={false} />\r\n            <ambientLight intensity={0.6} />\r\n            <pointLight position={[10, 10, 10]} intensity={1.2} />\r\n            <pointLight position={[-5, 5, 5]} intensity={0.5} color=\"#F97316\" />\r\n\r\n            <group scale={1.8}>\r\n                {structure.atoms.map((a, k) => (\r\n                    <group key={k}>\r\n                        <mesh position={a.pos}>\r\n                            <sphereGeometry args={[a.type === 'C' ? ATOM.C.r : ATOM.H.r, 24, 24]} />\r\n                            <meshStandardMaterial\r\n                                color={a.type === 'C' ? ATOM.C.color : ATOM.H.color}\r\n                                metalness={0.7}\r\n                                roughness={0.2}\r\n                                emissive={a.type === 'H' ? \"#FFF\" : \"#000\"}\r\n                                emissiveIntensity={a.type === 'H' ? 0.1 : 0}\r\n                            />\r\n                        </mesh>\r\n                        {a.parent && <Line points={[a.parent, a.pos]} color=\"#F97316\" lineWidth={1} transparent opacity={0.3} />}\r\n                    </group>\r\n                ))}\r\n\r\n                {Array.from({ length: n - 1 }).map((_, i) => {\r\n                    const carbons = structure.atoms.filter(a => a.type === 'C');\r\n                    return <Line key={'cc' + i} points={[carbons[i].pos, carbons[i + 1].pos]} color=\"#F97316\" lineWidth={4} />;\r\n                })}\r\n            </group>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"Ôø¢ Raffinerie d'Alcanes\" className=\"w-[400px] border-orange-500/30 text-white\" defaultPosition=\"bottom-right\">\r\n                    <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                    <div className=\"flex justify-between items-center mb-4 border-b border-white/10 pb-2\">\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-[10px] text-orange-400 font-black uppercase tracking-widest leading-tight\">Hydrocarbures Satur├®s</span>\r\n                            <span className=\"text-lg font-black\">{phase === 'explore' ? 'Mod├®lisation' : 'Challenge Raffinerie ­ƒÄ»'}</span>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {phase === 'mission' && mission && (\r\n                        <div className=\"mb-4 space-y-2\">\r\n                            <ChallengeTimer timeLeft={timeLeft} />\r\n                            <MissionObjective objective={mission.objective} icon=\"­ƒöï\" />\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"bg-gray-950 p-4 rounded-2xl border border-white/5 relative overflow-hidden group\">\r\n                            <div className=\"flex justify-between items-center relative z-10\">\r\n                                <div className=\"flex flex-col\">\r\n                                    <span className=\"text-[10px] text-orange-400 font-black uppercase tracking-widest leading-none mb-1\">Nom Nomenclature</span>\r\n                                    <span className=\"text-2xl font-black text-white\">{names[n].toUpperCase()}</span>\r\n                                </div>\r\n                                <div className=\"text-right\">\r\n                                    <span className=\"text-[10px] text-gray-500 font-black uppercase tracking-widest leading-none block mb-1\">Formule</span>\r\n                                    <span className=\"text-xl font-mono font-black text-orange-400\">C{n > 1 ? <sub>{n}</sub> : ''}H<sub>{2 * n + 2}</sub></span>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"absolute -bottom-2 -right-2 opacity-5 scale-150 rotate-12 transition-transform group-hover:rotate-0\">\r\n                                <span className=\"text-8xl font-black text-orange-500\">{n}</span>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"px-2\">\r\n                            <div className=\"flex justify-between text-[10px] text-gray-500 font-black uppercase tracking-widest mb-2\">\r\n                                <span>Longueur de cha├«ne</span>\r\n                                <span className=\"text-orange-400\">{n} Carbones</span>\r\n                            </div>\r\n                            <input\r\n                                type=\"range\" min=\"1\" max=\"8\" value={n}\r\n                                onChange={e => handleNChange(Number(e.target.value))}\r\n                                className=\"w-full h-1.5 bg-gray-800 rounded-lg appearance-none cursor-pointer accent-orange-500 hover:accent-orange-400 transition-all shadow-inner\"\r\n                            />\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-2 gap-3\">\r\n                            <div className=\"p-3 bg-black/40 rounded-xl border border-white/5 group hover:border-orange-500/30 transition-colors\">\r\n                                <p className=\"text-[9px] text-gray-500 font-black uppercase mb-1 tracking-widest group-hover:text-orange-400\">├ëtat Physique</p>\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <span className=\"text-sm font-black text-white uppercase\">{n < 5 ? 'Gazeux' : 'Liquide'}</span>\r\n                                    <span className=\"w-2 h-2 rounded-full animate-pulse\" style={{ backgroundColor: n < 5 ? '#60A5FA' : '#F59E0B' }}></span>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"p-3 bg-black/40 rounded-xl border border-white/5 group hover:border-orange-500/30 transition-colors\">\r\n                                <p className=\"text-[9px] text-gray-500 font-black uppercase mb-1 tracking-widest group-hover:text-orange-400\">Masse Molaire</p>\r\n                                <p className=\"text-sm font-black text-white\">{14 * n + 2} g/mol</p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"p-4 bg-orange-950/20 rounded-2xl border border-orange-500/10 relative overflow-hidden group/burn\">\r\n                            <div className=\"flex items-center gap-3 mb-2\">\r\n                                <span className=\"text-lg\">­ƒöÑ</span>\r\n                                <p className=\"text-[10px] font-black text-orange-300 uppercase tracking-widest\">├ëquation de Combustion</p>\r\n                            </div>\r\n                            <div className=\"font-mono text-[11px] text-white overflow-x-auto whitespace-nowrap scrollbar-hide py-1\">\r\n                                <span className=\"text-orange-400 font-black\">C<sub>{n}</sub>H<sub>{2 * n + 2}</sub></span>\r\n                                <span className=\"mx-2 text-gray-600\">+</span>\r\n                                <span className=\"text-blue-400 font-black\">{(3 * n + 1) / 2}O<sub>2</sub></span>\r\n                                <span className=\"mx-2 text-red-500 animate-pulse\">ÔåÆ</span>\r\n                                <span className=\"text-emerald-400 font-black\">{n}CO<sub>2</sub></span>\r\n                                <span className=\"mx-2 text-gray-600\">+</span>\r\n                                <span className=\"text-cyan-400 font-black\">{n + 1}H<sub>2</sub>O</span>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <XPBar current={score % 1000} nextLevel={1000} />\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay show={showSuccess} message={mission?.title || \"Raffinage R├®ussi !\"} points={350} onNext={nextMission} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// ==========================================\r\n// C3: ALC├êNES (Double liaison)\r\n// ==========================================\r\nexport function AlcenesSim() {\r\n    // ├ëtats Globaux & Gamification\r\n    const [phase, setPhase] = useState('mission');\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(60);\r\n\r\n    // ├ëtats Physiques\r\n    const groupRef = useRef();\r\n    const [showDoubleBond, setShowDoubleBond] = useState(true);\r\n\r\n    // Missions Config\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Analyse d\\'Insaturation', objective: 'Localisez et identifiez la double liaison C=C en l\\'activant.', type: 'bond', points: 350 },\r\n        { id: 2, title: 'G├®om├®trie Plane', objective: 'V├®rifiez l\\'alignement des atomes dans le plan sp┬▓.', type: 'geometry', points: 400 },\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            setMission(missions[0]);\r\n            setTimeLeft(60);\r\n        }\r\n    }, [phase, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        let timer;\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess && mission) {\r\n            timer = setInterval(() => setTimeLeft(prev => prev - 1), 1000);\r\n        }\r\n        return () => clearInterval(timer);\r\n    }, [phase, timeLeft, showSuccess, mission]);\r\n\r\n    const completeObjective = () => {\r\n        if (showSuccess) return;\r\n        setScore(prev => prev + (mission?.points || 350));\r\n        setShowSuccess(true);\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        const nextIdx = missions.findIndex(m => m.id === mission.id) + 1;\r\n        if (nextIdx < missions.length) {\r\n            setMission(missions[nextIdx]);\r\n            setTimeLeft(60);\r\n        } else {\r\n            setPhase('explore');\r\n            setMission(null);\r\n        }\r\n    };\r\n\r\n    useFrame((state, delta) => {\r\n        if (groupRef.current) groupRef.current.rotation.y += delta * 0.4;\r\n    });\r\n\r\n    return (\r\n        <group>\r\n            <OrbitControls enableZoom={false} />\r\n            <ambientLight intensity={0.6} />\r\n            <pointLight position={[10, 10, 10]} intensity={2} />\r\n            <pointLight position={[-5, -5, 5]} intensity={1} color={ATOM.C.color} />\r\n\r\n            <Float speed={2.5} rotationIntensity={0.6} floatIntensity={0.5}>\r\n                <group ref={groupRef} scale={1.6}>\r\n                    {/* ├ëth├¿ne C2H4 - Atomes de Carbone */}\r\n                    <mesh position={[-0.6, 0, 0]}>\r\n                        <sphereGeometry args={[0.35, 32, 32]} />\r\n                        <meshStandardMaterial color={ATOM.C.color} metalness={0.9} roughness={0.05} />\r\n                    </mesh>\r\n                    <mesh position={[0.6, 0, 0]}>\r\n                        <sphereGeometry args={[0.35, 32, 32]} />\r\n                        <meshStandardMaterial color={ATOM.C.color} metalness={0.9} roughness={0.05} />\r\n                    </mesh>\r\n\r\n                    {/* Double liaison Holographique de Haute ├ënergie */}\r\n                    {showDoubleBond && (\r\n                        <group>\r\n                            <mesh position={[0, 0.12, 0]} rotation={[0, 0, Math.PI / 2]}>\r\n                                <cylinderGeometry args={[0.045, 0.045, 1.2, 16]} />\r\n                                <meshStandardMaterial\r\n                                    color=\"#10B981\"\r\n                                    emissive=\"#10B981\"\r\n                                    emissiveIntensity={4}\r\n                                    transparent\r\n                                    opacity={0.7}\r\n                                />\r\n                            </mesh>\r\n                            <mesh position={[0, -0.12, 0]} rotation={[0, 0, Math.PI / 2]}>\r\n                                <cylinderGeometry args={[0.045, 0.045, 1.2, 16]} />\r\n                                <meshStandardMaterial\r\n                                    color=\"#10B981\"\r\n                                    emissive=\"#10B981\"\r\n                                    emissiveIntensity={4}\r\n                                    transparent\r\n                                    opacity={0.7}\r\n                                />\r\n                            </mesh>\r\n                        </group>\r\n                    )}\r\n\r\n                    {/* Atomes d'Hydrog├¿ne avec effet de lueur */}\r\n                    <group>\r\n                        {[\r\n                            [-1.15, 0.55, 0], [-1.15, -0.55, 0],\r\n                            [1.15, 0.55, 0], [1.15, -0.55, 0]\r\n                        ].map((pos, i) => (\r\n                            <group key={i} position={pos}>\r\n                                <mesh>\r\n                                    <sphereGeometry args={[0.22, 24, 24]} />\r\n                                    <meshStandardMaterial color={ATOM.H.color} emissive={ATOM.H.color} emissiveIntensity={0.3} />\r\n                                </mesh>\r\n                                {/* Liaison C-H */}\r\n                                <Line\r\n                                    points={[[0, 0, 0], [i < 2 ? 0.55 : -0.55, i % 2 === 0 ? -0.55 : 0.55, 0]]}\r\n                                    color=\"#10B981\"\r\n                                    lineWidth={1.5}\r\n                                    transparent\r\n                                    opacity={0.4}\r\n                                />\r\n                            </group>\r\n                        ))}\r\n                    </group>\r\n                </group>\r\n            </Float>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒº¬ Expert des Alc├¿nes\" className=\"w-[400px] border-emerald-500/30 text-white\" defaultPosition=\"bottom-right\">\r\n                    <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                    <div className=\"flex justify-between items-center mb-4 border-b border-white/10 pb-2\">\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-[10px] text-emerald-400 font-black uppercase tracking-widest leading-tight\">Hydrocarbures Insatur├®s</span>\r\n                            <span className=\"text-lg font-black\">{phase === 'explore' ? 'Mod├®lisation Structurelle' : 'Mission Analyse ­ƒÄ»'}</span>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {phase === 'mission' && mission && (\r\n                        <div className=\"mb-4 space-y-2\">\r\n                            <ChallengeTimer timeLeft={timeLeft} />\r\n                            <MissionObjective objective={mission.objective} icon=\"­ƒö¼\" />\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"bg-gray-950 p-5 rounded-2xl border border-white/5 relative overflow-hidden group shadow-2xl\">\r\n                            <div className=\"absolute top-0 right-0 p-4 opacity-5 group-hover:opacity-20 transition-opacity\">\r\n                                <div className=\"text-6xl font-black text-emerald-500 text-right\">CÔééHÔéä</div>\r\n                            </div>\r\n                            <div className=\"relative z-10\">\r\n                                <div className=\"text-2xl font-black text-white uppercase tracking-tight leading-none mb-1\">├ëth├¿ne</div>\r\n                                <div className=\"text-[11px] text-emerald-500 font-black uppercase tracking-[0.2em]\">Squelette sp┬▓ Plan</div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-2 gap-3\">\r\n                            <button\r\n                                onClick={() => {\r\n                                    setShowDoubleBond(!showDoubleBond);\r\n                                    if (phase === 'mission' && mission?.type === 'bond') completeObjective();\r\n                                }}\r\n                                className={`p-4 rounded-2xl font-black text-[10px] transition-all flex flex-col items-center gap-3 border-b-4 active:border-b-0 active:translate-y-1 transform ${showDoubleBond\r\n                                    ? 'bg-emerald-600 border-emerald-800 text-white shadow-lg shadow-emerald-900/40'\r\n                                    : 'bg-gray-800 border-black/40 text-gray-400 hover:bg-gray-700'}`}>\r\n                                <span className={`text-2xl ${showDoubleBond ? 'animate-bounce' : ''}`}>ÔÜí</span>\r\n                                <span>LIAISON PI (¤Ç)</span>\r\n                            </button>\r\n                            <div\r\n                                onClick={() => {\r\n                                    if (phase === 'mission' && mission?.type === 'geometry') completeObjective();\r\n                                }}\r\n                                className=\"p-4 bg-gray-950 rounded-2xl border border-white/5 flex flex-col items-center justify-center transition-all hover:border-emerald-500/40 cursor-pointer group/geo shadow-lg\">\r\n                                <p className=\"text-[9px] text-gray-500 font-black uppercase mb-1 tracking-widest group-hover/geo:text-emerald-400 transition-colors\">Angle de Liaison</p>\r\n                                <p className=\"text-2xl font-black text-white italic group-hover/geo:scale-110 transition-transform\">120┬░</p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"p-4 bg-black/40 rounded-2xl border border-white/5 space-y-3\">\r\n                            <p className=\"text-[10px] font-black text-yellow-500 uppercase tracking-widest flex items-center gap-2\">\r\n                                <span className=\"p-1 bg-yellow-500/20 rounded\">­ƒº¬</span> R├ëACTIONS D'ADDITION\r\n                            </p>\r\n                            <div className=\"grid grid-cols-1 gap-2\">\r\n                                {[\r\n                                    { name: 'Hydrog├®nation', formula: 'HÔéé / Ni', desc: 'Vers les Alcanes' },\r\n                                    { name: 'Dihalog├®nation', formula: 'BrÔéé (aq)', desc: 'Test au Brome' },\r\n                                    { name: 'Hydratation', formula: 'HÔééO / HÔü║', desc: 'Vers les Alcools' }\r\n                                ].map((react, i) => (\r\n                                    <div key={i} className=\"flex justify-between items-center bg-gray-950/50 p-2.5 rounded-xl border border-white/5 hover:bg-emerald-500/10 transition-colors cursor-default group/item\">\r\n                                        <div className=\"flex flex-col\">\r\n                                            <span className=\"text-[11px] font-black text-white group-hover/item:text-emerald-400 transition-colors\">{react.name}</span>\r\n                                            <span className=\"text-[8px] text-gray-500 font-bold uppercase tracking-tighter\">{react.desc}</span>\r\n                                        </div>\r\n                                        <div className=\"px-2 py-1 bg-black rounded-lg border border-white/10 font-mono text-[10px] text-emerald-400 font-black\">\r\n                                            {react.formula}\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n\r\n                        <XPBar current={score % 1000} nextLevel={1000} />\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay show={showSuccess} message={mission?.title || \"Analyse R├®ussie !\"} points={mission?.points || 350} onNext={nextMission} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// ==========================================\r\n// C4: BENZ├êNE (Cycle aromatique)\r\n// ==========================================\r\nexport function BenzeneSim() {\r\n    // ├ëtats Globaux & Gamification\r\n    const [phase, setPhase] = useState('mission');\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(60);\r\n\r\n    // ├ëtats Physiques\r\n    const groupRef = useRef();\r\n    const [showAromaticCircle, setShowAromaticCircle] = useState(true);\r\n\r\n    // Missions Config\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Cercle de M├®som├®rie', objective: 'Activez la d├®localisation ├®lectronique pour stabiliser le cycle.', type: 'arom', points: 400 },\r\n        { id: 2, title: 'Sym├®trie Hexagonale', objective: 'Analysez les angles de liaison parfaits de 120┬░.', type: 'sym', points: 450 },\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            setMission(missions[0]);\r\n            setTimeLeft(60);\r\n        }\r\n    }, [phase, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        let timer;\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess && mission) {\r\n            timer = setInterval(() => setTimeLeft(prev => prev - 1), 1000);\r\n        }\r\n        return () => clearInterval(timer);\r\n    }, [phase, timeLeft, showSuccess, mission]);\r\n\r\n    const completeObjective = () => {\r\n        if (showSuccess) return;\r\n        setScore(prev => prev + (mission?.points || 400));\r\n        setShowSuccess(true);\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        const nextIdx = missions.findIndex(m => m.id === mission.id) + 1;\r\n        if (nextIdx < missions.length) {\r\n            setMission(missions[nextIdx]);\r\n            setTimeLeft(60);\r\n        } else {\r\n            setPhase('explore');\r\n            setMission(null);\r\n        }\r\n    };\r\n\r\n    useFrame((state, delta) => {\r\n        if (groupRef.current) groupRef.current.rotation.y += delta * 0.25;\r\n    });\r\n\r\n    const angle = (i) => (i * Math.PI * 2) / 6;\r\n    const r = 1.25;\r\n\r\n    return (\r\n        <group>\r\n            <OrbitControls enableZoom={false} />\r\n            <ambientLight intensity={0.5} />\r\n            <pointLight position={[10, 10, 10]} intensity={2} />\r\n            <pointLight position={[-10, 5, 5]} intensity={1} color=\"#EC4899\" />\r\n\r\n            <Float speed={2} rotationIntensity={0.3} floatIntensity={0.4}>\r\n                <group ref={groupRef} scale={1.2}>\r\n                    {/* 6 Carbones en hexagone parfait */}\r\n                    {Array.from({ length: 6 }).map((_, i) => (\r\n                        <group key={i}>\r\n                            <mesh position={[r * Math.cos(angle(i)), r * Math.sin(angle(i)), 0]}>\r\n                                <sphereGeometry args={[0.32, 32, 32]} />\r\n                                <meshStandardMaterial color={ATOM.C.color} metalness={1} roughness={0.05} />\r\n                            </mesh>\r\n                            {/* Liaison C-C aromatique */}\r\n                            <Line points={[\r\n                                [r * Math.cos(angle(i)), r * Math.sin(angle(i)), 0],\r\n                                [r * Math.cos(angle(i + 1)), r * Math.sin(angle(i + 1)), 0]\r\n                            ]} color=\"#EC4899\" lineWidth={4} transparent opacity={0.5} />\r\n\r\n                            {/* Atomes d'Hydrog├¿ne p├®riph├®riques */}\r\n                            <mesh position={[2 * Math.cos(angle(i)), 2 * Math.sin(angle(i)), 0]}>\r\n                                <sphereGeometry args={[0.18, 24, 24]} />\r\n                                <meshStandardMaterial color={ATOM.H.color} emissive={ATOM.H.color} emissiveIntensity={0.3} />\r\n                            </mesh>\r\n                            {/* Liaison C-H */}\r\n                            <Line points={[\r\n                                [r * Math.cos(angle(i)), r * Math.sin(angle(i)), 0],\r\n                                [1.9 * Math.cos(angle(i)), 1.9 * Math.sin(angle(i)), 0]\r\n                            ]} color=\"#EC4899\" lineWidth={1.5} transparent opacity={0.3} />\r\n                        </group>\r\n                    ))}\r\n\r\n                    {/* Cercle de d├®localisation (Effet Quantique) */}\r\n                    {showAromaticCircle && (\r\n                        <mesh rotation={[Math.PI / 2, 0, 0]}>\r\n                            <torusGeometry args={[0.7, 0.06, 16, 100]} />\r\n                            <MeshDistortMaterial\r\n                                color=\"#EC4899\"\r\n                                emissive=\"#EC4899\"\r\n                                emissiveIntensity={5}\r\n                                distort={0.4}\r\n                                speed={3}\r\n                                transparent\r\n                                opacity={0.8}\r\n                            />\r\n                        </mesh>\r\n                    )}\r\n                </group>\r\n            </Float>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒÆÄ Chambre de l'Aromatisme\" className=\"w-[400px] border-pink-500/30 text-white\" defaultPosition=\"bottom-right\">\r\n                    <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                    <div className=\"flex justify-between items-center mb-4 border-b border-white/10 pb-2\">\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-[10px] text-pink-400 font-black uppercase tracking-widest leading-tight\">Cycles Cabon├®s Sp├®ciaux</span>\r\n                            <span className=\"text-lg font-black\">{phase === 'explore' ? 'Mod├¿le Benz├®nique' : 'D├®fi de H├╝ckel ­ƒÄ»'}</span>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {phase === 'mission' && mission && (\r\n                        <div className=\"mb-4 space-y-2\">\r\n                            <ChallengeTimer timeLeft={timeLeft} />\r\n                            <MissionObjective objective={mission.objective} icon=\"­ƒÆÄ\" />\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"bg-gray-950 p-5 rounded-2xl border border-white/5 relative overflow-hidden group shadow-2xl\">\r\n                            <div className=\"absolute top-0 right-0 p-4 opacity-5 group-hover:opacity-20 transition-opacity\">\r\n                                <div className=\"text-7xl font-black text-pink-500 text-right\">CÔéåHÔéå</div>\r\n                            </div>\r\n                            <div className=\"relative z-10\">\r\n                                <div className=\"text-2xl font-black text-white uppercase tracking-tight leading-none mb-1\">Benz├¿ne</div>\r\n                                <div className=\"text-[11px] text-pink-500 font-black uppercase tracking-[0.2em]\">Noyau Aromatique Stable</div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <button\r\n                            onClick={() => {\r\n                                setShowAromaticCircle(!showAromaticCircle);\r\n                                if (phase === 'mission' && mission?.type === 'arom') completeObjective();\r\n                            }}\r\n                            className={`w-full py-4 rounded-2xl font-black text-xs transition-all transform active:scale-95 flex items-center justify-center gap-4 border-b-4 active:border-b-0 active:translate-y-1 ${showAromaticCircle\r\n                                ? 'bg-pink-600 border-pink-800 text-white shadow-lg shadow-pink-900/40'\r\n                                : 'bg-gray-800 border-black/40 text-gray-400 hover:bg-gray-700'}`}\r\n                        >\r\n                            <span className=\"text-xl\">{showAromaticCircle ? '­ƒîÇ' : 'ÔÜí'}</span>\r\n                            <span>{showAromaticCircle ? 'SYST├êME STABILIS├ë' : 'D├ëLOCALISER ├ëLECTRONS ¤Ç'}</span>\r\n                            {showAromaticCircle && <span className=\"animate-ping w-2 h-2 rounded-full bg-white opacity-75\" />}\r\n                        </button>\r\n\r\n                        <div className=\"grid grid-cols-2 gap-3\">\r\n                            <div className=\"p-4 bg-gray-950 rounded-2xl border border-white/5 group hover:border-pink-500/30 transition-all shadow-lg text-center\">\r\n                                <p className=\"text-[10px] text-gray-500 font-black uppercase mb-1 tracking-widest group-hover:text-pink-400 transition-colors\">├ëlectrons ¤Ç</p>\r\n                                <p className=\"text-xl font-black text-white italic\">6 Mobiles</p>\r\n                            </div>\r\n                            <div\r\n                                onClick={() => {\r\n                                    if (phase === 'mission' && mission?.type === 'sym') completeObjective();\r\n                                }}\r\n                                className=\"p-4 bg-gray-950 rounded-2xl border border-white/5 group hover:border-pink-500/30 transition-all shadow-lg text-center cursor-pointer\">\r\n                                <p className=\"text-[10px] text-gray-500 font-black uppercase mb-1 tracking-widest group-hover:text-pink-400 transition-colors\">Longueur Moy.</p>\r\n                                <p className=\"text-xl font-black text-white uppercase tracking-tighter\">1.40 ├à</p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"p-5 bg-black/40 rounded-2xl border border-white/5 space-y-3 relative overflow-hidden\">\r\n                            <p className=\"text-[10px] font-black text-pink-300 uppercase tracking-widest flex items-center gap-2\">\r\n                                <span className=\"p-1 bg-pink-500/20 rounded\">ÔÜø´©Å</span> POSTULAT DE K├ëKUL├ë\r\n                            </p>\r\n                            <p className=\"text-[11px] text-gray-400 leading-relaxed italic pr-8\">\r\n                                \"Les ├®lectrons ne sont pas fixes. Ils forment un nuage de probabilit├® parfaitement sym├®trique, rendant la mol├®cule incroyablement r├®sistante.\"\r\n                            </p>\r\n                            <div className=\"absolute bottom-4 right-4 text-2xl opacity-20\">­ƒô£</div>\r\n                        </div>\r\n\r\n                        <XPBar current={score % 1000} nextLevel={1000} />\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay show={showSuccess} message={mission?.title || \"Aromatisme Confirm├® !\"} points={mission?.points || 400} onNext={nextMission} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// ==========================================\r\n// C5: COMPOS├ëS OXYG├ëN├ëS (Alcools, Ald├®hydes, C├®tones)\r\n// ==========================================\r\nexport function ComposesOxygenesSim() {\r\n    const groupRef = useRef();\r\n    const [type, setType] = useState('alcool');\r\n    const [phase, setPhase] = useState('mission');\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(60);\r\n\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Identification Alcool', objective: 'Trouvez et affichez la mol├®cule d\\'Ethanol (Groupe hydroxyle -OH).', target: 'alcool', points: 300 },\r\n        { id: 2, title: 'Fonction Carbonyle', objective: 'Localisez la C├®tone (C=O interne ├á la cha├«ne).', target: 'cetone', points: 350 },\r\n        { id: 3, title: 'Groupement Ald├®hyde', objective: 'Identifiez l\\'Ald├®hyde (C=O en bout de cha├«ne).', target: 'aldehyde', points: 400 }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            setMission(missions[0]);\r\n            setTimeLeft(60);\r\n        }\r\n    }, [phase, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        let timer;\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess && mission) {\r\n            timer = setInterval(() => setTimeLeft(prev => prev - 1), 1000);\r\n        }\r\n        return () => clearInterval(timer);\r\n    }, [phase, timeLeft, showSuccess, mission]);\r\n\r\n    const handleSelect = (t) => {\r\n        setType(t);\r\n        if (phase === 'mission' && mission && t === mission.target) {\r\n            setScore(s => s + (mission.points || 300));\r\n            setShowSuccess(true);\r\n        }\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        const nextIdx = missions.findIndex(m => m.id === mission.id) + 1;\r\n        if (nextIdx < missions.length) {\r\n            setMission(missions[nextIdx]);\r\n            setTimeLeft(60);\r\n        } else {\r\n            setPhase('explore');\r\n            setMission(null);\r\n        }\r\n    };\r\n\r\n    useFrame((state, delta) => {\r\n        if (groupRef.current) groupRef.current.rotation.y += delta * 0.45;\r\n    });\r\n\r\n    return (\r\n        <group>\r\n            <OrbitControls enableZoom={false} />\r\n            <ambientLight intensity={0.6} />\r\n            <pointLight position={[10, 10, 10]} intensity={2} />\r\n            <pointLight position={[-5, 5, -5]} intensity={1} color=\"#EF4444\" />\r\n\r\n            <Float speed={2.5} rotationIntensity={0.4} floatIntensity={0.5}>\r\n                <group ref={groupRef} scale={1.6}>\r\n                    {type === 'alcool' && (\r\n                        <group>\r\n                            {/* ├ëthanol: CH3-CH2-OH */}\r\n                            <Sphere args={[0.32]} position={[-1.1, 0, 0]}><meshStandardMaterial color={ATOM.C.color} metalness={0.9} roughness={0.05} /></Sphere>\r\n                            <Sphere args={[0.32]} position={[0, 0, 0]}><meshStandardMaterial color={ATOM.C.color} metalness={0.9} roughness={0.05} /></Sphere>\r\n                            <Sphere args={[0.32]} position={[1.1, 0, 0]}><meshStandardMaterial color={ATOM.O.color} emissive={ATOM.O.color} emissiveIntensity={0.6} metalness={0.8} /></Sphere>\r\n                            <Sphere args={[0.22]} position={[1.7, 0.45, 0]}><meshStandardMaterial color={ATOM.H.color} emissive={ATOM.H.color} emissiveIntensity={0.2} /></Sphere>\r\n\r\n                            <Line points={[[-1.1, 0, 0], [0, 0, 0]]} color=\"#555\" lineWidth={2} transparent opacity={0.6} />\r\n                            <Line points={[[0, 0, 0], [1.1, 0, 0]]} color=\"#EF4444\" lineWidth={3} transparent opacity={0.8} />\r\n                            <Line points={[[1.1, 0, 0], [1.7, 0.45, 0]]} color=\"#EF4444\" lineWidth={2} transparent opacity={0.8} />\r\n\r\n                            <Text position={[1.1, -0.7, 0]} fontSize={0.18} color=\"#EF4444\" font=\"/fonts/Inter-Bold.woff\" anchorY=\"top\">HYDROXYLE</Text>\r\n                        </group>\r\n                    )}\r\n                    {type === 'aldehyde' && (\r\n                        <group>\r\n                            {/* ├ëthanal CH3-CHO */}\r\n                            <Sphere args={[0.32]} position={[-0.7, 0, 0]}><meshStandardMaterial color={ATOM.C.color} metalness={0.9} roughness={0.05} /></Sphere>\r\n                            <Sphere args={[0.32]} position={[0.7, 0, 0]}><meshStandardMaterial color={ATOM.C.color} metalness={0.9} roughness={0.05} /></Sphere>\r\n                            <Sphere args={[0.28]} position={[0.7, 0.9, 0]}><meshStandardMaterial color={ATOM.O.color} emissive={ATOM.O.color} emissiveIntensity={0.8} metalness={0.8} /></Sphere>\r\n                            <Sphere args={[0.18]} position={[1.4, -0.35, 0]}><meshStandardMaterial color={ATOM.H.color} emissive={ATOM.H.color} emissiveIntensity={0.2} /></Sphere>\r\n\r\n                            <Line points={[[-0.7, 0, 0], [0.7, 0, 0]]} color=\"#555\" lineWidth={2} transparent opacity={0.6} />\r\n                            {/* Double liaison C=O */}\r\n                            <Line points={[[0.58, 0.1, 0], [0.58, 0.8, 0]]} color=\"#F97316\" lineWidth={3} transparent opacity={0.9} />\r\n                            <Line points={[[0.82, 0.1, 0], [0.82, 0.8, 0]]} color=\"#F97316\" lineWidth={3} transparent opacity={0.9} />\r\n                            <Line points={[[0.7, 0, 0], [1.4, -0.35, 0]]} color=\"#555\" lineWidth={1.5} transparent opacity={0.6} />\r\n\r\n                            <Text position={[0.7, -0.8, 0]} fontSize={0.18} color=\"#F97316\" font=\"/fonts/Inter-Bold.woff\" anchorY=\"top\">CARBONYLE (Bout)</Text>\r\n                        </group>\r\n                    )}\r\n                    {type === 'cetone' && (\r\n                        <group>\r\n                            {/* Propanone CH3-CO-CH3 */}\r\n                            <Sphere args={[0.32]} position={[-1.1, 0, 0]}><meshStandardMaterial color={ATOM.C.color} metalness={0.9} roughness={0.05} /></Sphere>\r\n                            <Sphere args={[0.32]} position={[0, 0, 0]}><meshStandardMaterial color={ATOM.C.color} metalness={0.9} roughness={0.05} /></Sphere>\r\n                            <Sphere args={[0.32]} position={[1.1, 0, 0]}><meshStandardMaterial color={ATOM.C.color} metalness={0.9} roughness={0.05} /></Sphere>\r\n                            <Sphere args={[0.28]} position={[0, 0.9, 0]}><meshStandardMaterial color={ATOM.O.color} emissive={ATOM.O.color} emissiveIntensity={0.8} metalness={0.8} /></Sphere>\r\n\r\n                            <Line points={[[-1.1, 0, 0], [0, 0, 0]]} color=\"#555\" lineWidth={2} transparent opacity={0.6} />\r\n                            <Line points={[[0, 0, 0], [1.1, 0, 0]]} color=\"#555\" lineWidth={2} transparent opacity={0.6} />\r\n                            {/* Double liaison C=O */}\r\n                            <Line points={[[-0.12, 0.1, 0], [-0.12, 0.8, 0]]} color=\"#A855F7\" lineWidth={3} transparent opacity={0.9} />\r\n                            <Line points={[[0.12, 0.1, 0], [0.12, 0.8, 0]]} color=\"#A855F7\" lineWidth={3} transparent opacity={0.9} />\r\n\r\n                            <Text position={[0, -0.8, 0]} fontSize={0.18} color=\"#A855F7\" font=\"/fonts/Inter-Bold.woff\" anchorY=\"top\">CARBONYLE (Interne)</Text>\r\n                        </group>\r\n                    )}\r\n                </group>\r\n            </Float>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒº¬ Expert Compos├®s Oxyg├®n├®s\" className=\"w-[420px] border-red-500/30 text-white\" defaultPosition=\"bottom-right\">\r\n                    <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                    <div className=\"flex justify-between items-center mb-4 border-b border-white/10 pb-2\">\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-[10px] text-red-500 font-black uppercase tracking-widest leading-tight\">Familles Fonctionnelles</span>\r\n                            <span className=\"text-lg font-black\">{phase === 'explore' ? 'Mod├®lisation Mol├®culaire' : 'Analyse de Fonctions ­ƒÄ»'}</span>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {phase === 'mission' && mission && (\r\n                        <div className=\"mb-4 space-y-2\">\r\n                            <ChallengeTimer timeLeft={timeLeft} />\r\n                            <MissionObjective objective={mission.objective} icon=\"­ƒº¬\" />\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"grid grid-cols-3 gap-2\">\r\n                            {[\r\n                                { id: 'alcool', label: 'Alcool', color: 'bg-red-600', border: 'border-red-800', shadow: 'shadow-red-900/40' },\r\n                                { id: 'aldehyde', label: 'Ald├®hyde', color: 'bg-orange-600', border: 'border-orange-800', shadow: 'shadow-orange-900/40' },\r\n                                { id: 'cetone', label: 'C├®tone', color: 'bg-purple-600', border: 'border-purple-800', shadow: 'shadow-purple-900/40' }\r\n                            ].map((cat) => (\r\n                                <button\r\n                                    key={cat.id}\r\n                                    onClick={() => handleSelect(cat.id)}\r\n                                    className={`py-3 rounded-xl text-[10px] font-black uppercase transition-all transform active:scale-95 border-b-4 active:border-b-0 active:translate-y-1 ${type === cat.id\r\n                                        ? `${cat.color} ${cat.border} ${cat.shadow} shadow-lg text-white`\r\n                                        : 'bg-gray-800 border-black/40 hover:bg-gray-750 text-gray-500'}`}\r\n                                >\r\n                                    {cat.label}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n\r\n                        <div className=\"bg-gray-950 p-5 rounded-2xl border border-white/5 relative overflow-hidden shadow-2xl\">\r\n                            {type === 'alcool' && (\r\n                                <div className=\"animate-in slide-in-from-bottom duration-500\">\r\n                                    <div className=\"flex items-center gap-2 mb-2\">\r\n                                        <span className=\"w-8 h-8 rounded-full bg-red-600/20 flex items-center justify-center text-red-500 font-black tracking-tighter text-xs\">OH</span>\r\n                                        <p className=\"text-[10px] font-black text-red-400 uppercase tracking-widest\">Groupe Hydroxyle</p>\r\n                                    </div>\r\n                                    <p className=\"text-xl font-bold text-white mb-2 italic\">R ÔÇö OH (Liaison Polaris├®e)</p>\r\n                                    <p className=\"text-[11px] text-gray-400 leading-relaxed font-medium\">Capable de former des liaisons hydrog├¿ne. Tr├¿s soluble, point d'├®bullition ├®lev├® et r├®actif vis-├á-vis de l'oxydation.</p>\r\n                                </div>\r\n                            )}\r\n                            {type === 'aldehyde' && (\r\n                                <div className=\"animate-in slide-in-from-bottom duration-500\">\r\n                                    <div className=\"flex items-center gap-2 mb-2\">\r\n                                        <span className=\"w-8 h-8 rounded-full bg-orange-600/20 flex items-center justify-center text-orange-500 font-black tracking-tighter text-xs\">C=O</span>\r\n                                        <p className=\"text-[10px] font-black text-orange-400 uppercase tracking-widest\">Groupe Carbonyle (Bout)</p>\r\n                                    </div>\r\n                                    <p className=\"text-xl font-bold text-white mb-2 italic\">R ÔÇö CHO</p>\r\n                                    <p className=\"text-[11px] text-gray-400 leading-relaxed font-medium\">R├®ducteur fort. Donne un test positif ├á la liqueur de Fehling (pr├®cipit├® rouge brique) et au r├®actif de Schiff.</p>\r\n                                </div>\r\n                            )}\r\n                            {type === 'cetone' && (\r\n                                <div className=\"animate-in slide-in-from-bottom duration-500\">\r\n                                    <div className=\"flex items-center gap-2 mb-2\">\r\n                                        <span className=\"w-8 h-8 rounded-full bg-purple-600/20 flex items-center justify-center text-purple-500 font-black tracking-tighter text-xs\">C=O</span>\r\n                                        <p className=\"text-[10px] font-black text-purple-400 uppercase tracking-widest\">Groupe Carbonyle (Interne)</p>\r\n                                    </div>\r\n                                    <p className=\"text-xl font-bold text-white mb-2 italic\">R ÔÇö CO ÔÇö R'</p>\r\n                                    <p className=\"text-[11px] text-gray-400 leading-relaxed font-medium\">Stable vis-├á-vis des oxydants m├®nag├®s. Test DNPH positif (pr├®cipit├® jaune-orang├®) mais Fehling n├®gatif.</p>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        <div className=\"p-4 bg-black/40 rounded-2xl border border-white/5 group hover:border-white/10 transition-colors\">\r\n                            <div className=\"flex justify-between items-center mb-2\">\r\n                                <p className=\"text-[9px] text-gray-500 font-black uppercase tracking-widest group-hover:text-white transition-colors\">Mol├®cule de d├®monstration</p>\r\n                                <span className=\"px-2 py-0.5 bg-gray-900 rounded-full text-[9px] font-black text-emerald-400\">PURE</span>\r\n                            </div>\r\n                            <div className=\"flex items-center justify-between text-sm font-mono\">\r\n                                <span className=\"text-gray-300\">\r\n                                    {type === 'alcool' ? '├ëthanol' : type === 'aldehyde' ? '├ëthanal' : 'Propanone'}\r\n                                </span>\r\n                                <span className=\"text-white font-black\">\r\n                                    {type === 'alcool' ? 'CHÔéâCHÔééOH' : type === 'aldehyde' ? 'CHÔéâCHO' : 'CHÔéâCOCHÔéâ'}\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <XPBar current={score % 1000} nextLevel={1000} />\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay show={showSuccess} message=\"Famille de Compos├®s Valid├®e !\" points={mission?.points || 300} onNext={nextMission} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// ==========================================\r\n// C6-C9: REDOX (R├¿gle du Gamma)\r\n// ==========================================\r\n// ==========================================\r\n// C6-C9: REDOX (D├®fi Corrosion)\r\n// ==========================================\r\nexport function RedoxGammaSim() {\r\n    const [phase, setPhase] = useState('mission');\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(60);\r\n\r\n    const [oxSelected, setOxSelected] = useState(null);\r\n    const [redSelected, setRedSelected] = useState(null);\r\n\r\n    const redoxCouples = [\r\n        { id: 1, ox: 'Au┬│Ôü║', red: 'Au', e0: 1.50, color: '#FFD700' },\r\n        { id: 2, ox: 'AgÔü║', red: 'Ag', e0: 0.80, color: '#C0C0C0' },\r\n        { id: 3, ox: 'Cu┬▓Ôü║', red: 'Cu', e0: 0.34, color: '#B87333' },\r\n        { id: 4, ox: 'HÔü║', red: 'HÔéé', e0: 0.00, color: '#FFFFFF' },\r\n        { id: 5, ox: 'Fe┬▓Ôü║', red: 'Fe', e0: -0.44, color: '#A19D94' },\r\n        { id: 6, ox: 'Zn┬▓Ôü║', red: 'Zn', e0: -0.76, color: '#71706E' },\r\n        { id: 7, ox: 'Al┬│Ôü║', red: 'Al', e0: -1.66, color: '#E5E4E2' }\r\n    ];\r\n\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Corrosion du Zinc', objective: 'S├®lectionnez l\\'Oxydant HÔü║ et le R├®ducteur Zinc pour simuler l\\'attaque acide.', targetOx: 'HÔü║', targetRed: 'Zn' },\r\n        { id: 2, title: 'Dorure par D├®placement', objective: 'R├®cup├®rez l\\'Or (Au) en utilisant du Cuivre (Cu).', targetOx: 'Au┬│Ôü║', targetRed: 'Cu' },\r\n        { id: 3, title: 'Argenture vive', objective: 'R├®duisez les ions Argent (AgÔü║) avec du Zinc.', targetOx: 'AgÔü║', targetRed: 'Zn' }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            setMission(missions[0]);\r\n            setTimeLeft(60);\r\n        }\r\n    }, [phase, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        let timer;\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess && mission) {\r\n            timer = setInterval(() => setTimeLeft(prev => prev - 1), 1000);\r\n        }\r\n        return () => clearInterval(timer);\r\n    }, [phase, timeLeft, showSuccess, mission]);\r\n\r\n    const checkMission = () => {\r\n        if (!mission || !oxSelected || !redSelected) return;\r\n        const ox = redoxCouples.find(c => c.id === oxSelected);\r\n        const red = redoxCouples.find(c => c.id === redSelected);\r\n\r\n        // R├¿gle du Gamma : R├®action possible si E0(Ox) > E0(Red)\r\n        if (ox.ox === mission.targetOx && red.red === mission.targetRed && ox.e0 > red.e0) {\r\n            setScore(s => s + 450);\r\n            setShowSuccess(true);\r\n        }\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        setOxSelected(null);\r\n        setRedSelected(null);\r\n        const nextIdx = missions.findIndex(m => m.id === mission.id) + 1;\r\n        if (nextIdx < missions.length) {\r\n            setMission(missions[nextIdx]);\r\n            setTimeLeft(60);\r\n        } else {\r\n            setPhase('explore');\r\n            setMission(null);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            <OrbitControls enableZoom={false} />\r\n            <ambientLight intensity={0.5} />\r\n            <pointLight position={[5, 10, 5]} intensity={1.5} />\r\n\r\n            {/* ├ëchelle des potentiels */}\r\n            <group position={[-3, 0, 0]}>\r\n                <mesh position={[0, 0, 0]}>\r\n                    <boxGeometry args={[0.2, 5, 0.1]} />\r\n                    <meshStandardMaterial color=\"#444\" />\r\n                </mesh>\r\n                <Text position={[0, 2.8, 0]} fontSize={0.2} color=\"white\">E┬░ (V)</Text>\r\n                {redoxCouples.map((c, i) => (\r\n                    <group key={c.id} position={[0, (c.e0 * 1.5), 0]}>\r\n                        <mesh position={[0.2, 0, 0]}>\r\n                            <boxGeometry args={[2.5, 0.05, 0.05]} />\r\n                            <meshStandardMaterial color={c.color} emissive={c.color} emissiveIntensity={0.2} />\r\n                        </mesh>\r\n                        <Text position={[1.5, 0.2, 0]} fontSize={0.15} color={c.color}>{c.ox} / {c.red}</Text>\r\n                        <Text position={[-0.4, 0, 0]} fontSize={0.15} color=\"gray\">{c.e0.toFixed(2)}</Text>\r\n                    </group>\r\n                ))}\r\n            </group>\r\n\r\n            {/* Visualisation R├®action */}\r\n            <group position={[2, 0, 0]}>\r\n                <mesh position={[0, -1, 0]}>\r\n                    <cylinderGeometry args={[1, 1, 3, 32]} />\r\n                    <meshPhysicalMaterial color=\"#60A5FA\" transmission={0.9} transparent opacity={0.2} roughness={0.1} />\r\n                </mesh>\r\n\r\n                {oxSelected && (\r\n                    <Float speed={5} rotationIntensity={2}>\r\n                        <Text position={[0, 1, 0]} fontSize={0.3} color={redoxCouples.find(c => c.id === oxSelected).color}>\r\n                            {redoxCouples.find(c => c.id === oxSelected).ox}\r\n                        </Text>\r\n                    </Float>\r\n                )}\r\n                {redSelected && (\r\n                    <mesh position={[0, -0.5, 0]}>\r\n                        <boxGeometry args={[0.5, 1.5, 0.1]} />\r\n                        <meshStandardMaterial color={redoxCouples.find(c => c.id === redSelected).color} metalness={1} roughness={0.2} />\r\n                    </mesh>\r\n                )}\r\n            </group>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"ÔÜí Station d'Oxydor├®duction\" className=\"w-[420px] border-yellow-500/30 text-white\" defaultPosition=\"bottom-right\">\r\n                    <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                    <div className=\"flex justify-between items-center mb-4 border-b border-white/10 pb-2\">\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-[10px] text-yellow-500 font-black uppercase tracking-widest leading-tight\">Potentiels Standard</span>\r\n                            <span className=\"text-lg font-black\">{phase === 'explore' ? 'Analyse Redox' : 'D├®fi R├¿gle du Gamma ­ƒÄ»'}</span>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {phase === 'mission' && mission && (\r\n                        <div className=\"mb-4 space-y-2\">\r\n                            <ChallengeTimer timeLeft={timeLeft} />\r\n                            <MissionObjective objective={mission.objective} icon=\"ÔÜí\" />\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"grid grid-cols-2 gap-4\">\r\n                            <div className=\"space-y-2\">\r\n                                <p className=\"text-[10px] font-black text-blue-400 uppercase tracking-widest text-center\">Oxydants (Captent eÔü╗)</p>\r\n                                <div className=\"grid grid-cols-1 gap-1\">\r\n                                    {redoxCouples.map(c => (\r\n                                        <button\r\n                                            key={c.id}\r\n                                            onClick={() => setOxSelected(c.id)}\r\n                                            className={`py-1.5 px-2 rounded-lg text-[10px] font-black transition-all border ${oxSelected === c.id\r\n                                                ? 'bg-blue-600 border-white text-white shadow-lg shadow-blue-900/40'\r\n                                                : 'bg-gray-800 border-white/5 text-gray-400 hover:bg-gray-700'}`}\r\n                                        >\r\n                                            {c.ox}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <p className=\"text-[10px] font-black text-red-400 uppercase tracking-widest text-center\">R├®ducteurs (C├¿dent eÔü╗)</p>\r\n                                <div className=\"grid grid-cols-1 gap-1\">\r\n                                    {redoxCouples.slice().reverse().map(c => (\r\n                                        <button\r\n                                            key={c.id}\r\n                                            onClick={() => setRedSelected(c.id)}\r\n                                            className={`py-1.5 px-2 rounded-lg text-[10px] font-black transition-all border ${redSelected === c.id\r\n                                                ? 'bg-red-600 border-white text-white shadow-lg shadow-red-900/40'\r\n                                                : 'bg-gray-800 border-white/5 text-gray-400 hover:bg-gray-700'}`}\r\n                                        >\r\n                                            {c.red}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <button\r\n                            onClick={checkMission}\r\n                            disabled={!oxSelected || !redSelected}\r\n                            className=\"w-full py-4 rounded-xl bg-gradient-to-r from-yellow-600 to-amber-600 font-black text-xs transition-all shadow-lg active:scale-95 disabled:opacity-50 disabled:grayscale uppercase tracking-widest\"\r\n                        >\r\n                            V├®riifer la R├®action ­ƒº¬\r\n                        </button>\r\n\r\n                        <div className=\"p-3 bg-black/40 rounded-xl border border-white/5\">\r\n                            <div className=\"flex justify-between items-center mb-1\">\r\n                                <p className=\"text-[10px] font-black text-gray-500 uppercase\">├ëquation Bilan</p>\r\n                                {oxSelected && redSelected && (\r\n                                    <span className={`text-[10px] font-black ${redoxCouples.find(c => c.id === oxSelected).e0 > redoxCouples.find(c => c.id === redSelected).e0 ? 'text-emerald-400' : 'text-red-400'}`}>\r\n                                        {redoxCouples.find(c => c.id === oxSelected).e0 > redoxCouples.find(c => c.id === redSelected).e0 ? 'SPONTAN├ëE Ô£à' : 'IMPOSSIBLE ÔØî'}\r\n                                    </span>\r\n                                )}\r\n                            </div>\r\n                            <p className=\"font-mono text-[11px] text-white overflow-x-auto whitespace-nowrap\">\r\n                                {oxSelected && redSelected ? (\r\n                                    <>\r\n                                        {redoxCouples.find(c => c.id === oxSelected).ox} + {redoxCouples.find(c => c.id === redSelected).red} ÔåÆ {redoxCouples.find(c => c.id === oxSelected).red} + {redoxCouples.find(c => c.id === redSelected).ox}\r\n                                    </>\r\n                                ) : 'S├®lectionnez un couple...'}\r\n                            </p>\r\n                        </div>\r\n\r\n                        <XPBar current={score % 1000} nextLevel={1000} />\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay show={showSuccess} message={mission?.title || \"R├®action Valid├®e !\"} points={450} onNext={nextMission} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// ==========================================\r\n// C10: ├ëLECTROLYSE (Loi de Faraday)\r\n// ==========================================\r\n// ==========================================\r\n// C10: ├ëLECTROLYSE (Atelier d'Orf├¿vre)\r\n// ==========================================\r\nexport function ElectrolyseSim() {\r\n    const [phase, setPhase] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(60);\r\n\r\n    const [current, setCurrent] = useState(2); // Amp├¿res\r\n    const [time, setTime] = useState(10); // Minutes\r\n    const [metal, setMetal] = useState('Cu');\r\n\r\n    const metals = {\r\n        Cu: { name: 'Cuivre', M: 63.5, n: 2, color: '#B87333' },\r\n        Ag: { name: 'Argent', M: 107.9, n: 1, color: '#C0C0C0' },\r\n        Au: { name: 'Or', M: 197.0, n: 3, color: '#FFD700' }\r\n    };\r\n\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: '├ëlectrod├®position de Cuivre', objective: 'D├®posez exactement 0.40g de Cuivre (┬▒0.02g).', targetMass: 0.40, metal: 'Cu' },\r\n        { id: 2, title: 'Placage d\\'Argent', objective: 'D├®posez 1.35g d\\'Argent pour ce bijou (┬▒0.05g).', targetMass: 1.35, metal: 'Ag' },\r\n        { id: 3, title: 'L\\'Or des Rois', objective: 'Une dorure de luxe n├®cessite 0.82g d\\'Or (┬▒0.03g).', targetMass: 0.82, metal: 'Au' }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            setMission(missions[0]);\r\n            setTimeLeft(60);\r\n        }\r\n    }, [phase, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        let timer;\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess && mission) {\r\n            timer = setInterval(() => setTimeLeft(prev => prev - 1), 1000);\r\n        }\r\n        return () => clearInterval(timer);\r\n    }, [phase, timeLeft, showSuccess, mission]);\r\n\r\n    const m = metals[metal];\r\n    const F = 96500;\r\n    const mass = (current * (time * 60) * m.M) / (m.n * F);\r\n\r\n    const checkMission = () => {\r\n        if (!mission) return;\r\n        const diff = Math.abs(mass - mission.targetMass);\r\n        if (diff < 0.05 && metal === mission.metal) {\r\n            setScore(s => s + 500);\r\n            setShowSuccess(true);\r\n        }\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        const nextIdx = missions.findIndex(m => m.id === mission.id) + 1;\r\n        if (nextIdx < missions.length) {\r\n            setMission(missions[nextIdx]);\r\n            setTimeLeft(60);\r\n        } else {\r\n            setPhase('explore');\r\n            setMission(null);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            <OrbitControls enableZoom={false} />\r\n            <ambientLight intensity={0.5} />\r\n            <pointLight position={[5, 10, 5]} intensity={1.5} />\r\n\r\n            {/* Cuve ├á ├®lectrolyse */}\r\n            <mesh position={[0, -1, 0]}>\r\n                <boxGeometry args={[4, 2, 2]} />\r\n                <meshPhysicalMaterial color=\"#3B82F6\" transmission={0.9} transparent opacity={0.15} roughness={0.05} />\r\n            </mesh>\r\n\r\n            {/* ├ëlectrodes */}\r\n            <group position={[-1, 0, 0]}>\r\n                <mesh>\r\n                    <boxGeometry args={[0.2, 3, 0.5]} />\r\n                    <meshStandardMaterial color=\"#444\" metalness={1} />\r\n                </mesh>\r\n                <Text position={[0, 1.8, 0]} fontSize={0.2} color=\"white\">ANODE (+)</Text>\r\n            </group>\r\n            <group position={[1, 0, 0]}>\r\n                <mesh>\r\n                    <boxGeometry args={[0.2, 3, 0.5]} />\r\n                    <meshStandardMaterial color={m.color} metalness={1} roughness={0.3} />\r\n                </mesh>\r\n                <Text position={[0, 1.8, 0]} fontSize={0.2} color=\"white\">CATHODE (-)</Text>\r\n\r\n                {/* Couche de m├®tal d├®pos├®e */}\r\n                <mesh position={[0.11, 0, 0]}>\r\n                    <boxGeometry args={[0.05, 3 * (mass / 2), 0.55]} />\r\n                    <meshStandardMaterial color={m.color} emissive={m.color} emissiveIntensity={0.3} />\r\n                </mesh>\r\n                <Text position={[0, -1.8, 0]} fontSize={0.2} color={m.color} font=\"/fonts/Inter-Bold.woff\">DEPOT: {mass.toFixed(3)}g</Text>\r\n            </group>\r\n\r\n            {/* Bulles Animation */}\r\n            {Array.from({ length: 15 }).map((_, i) => (\r\n                <Float key={i} speed={2} rotationIntensity={0} floatIntensity={1} position={[\r\n                    (Math.random() - 0.5) * 0.5 - 1,\r\n                    -1.5 + Math.random() * 1.5,\r\n                    (Math.random() - 0.5) * 0.5\r\n                ]}>\r\n                    <mesh opacity={0.5} transparent>\r\n                        <sphereGeometry args={[0.03]} />\r\n                        <meshStandardMaterial color=\"white\" transparent opacity={0.4} />\r\n                    </mesh>\r\n                </Float>\r\n            ))}\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒº¬ Atelier de Galvanoplastie\" className=\"w-[400px] border-blue-500/30 text-white\" defaultPosition=\"bottom-right\">\r\n                    <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                    <div className=\"flex justify-between items-center mb-4 border-b border-white/10 pb-2\">\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-[10px] text-blue-400 font-black uppercase tracking-widest leading-tight\">Lois de Faraday</span>\r\n                            <span className=\"text-lg font-black\">{phase === 'explore' ? 'Simulation' : 'D├®fi Orf├¿vrerie ­ƒÄ»'}</span>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {phase === 'mission' && mission && (\r\n                        <div className=\"mb-4 space-y-2\">\r\n                            <ChallengeTimer timeLeft={timeLeft} />\r\n                            <MissionObjective objective={mission.objective} icon=\"­ƒÆÄ\" />\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"space-y-5\">\r\n                        <div className=\"grid grid-cols-3 gap-2\">\r\n                            {Object.keys(metals).map(k => (\r\n                                <button\r\n                                    key={k}\r\n                                    onClick={() => setMetal(k)}\r\n                                    className={`py-2 rounded-xl text-[10px] font-black transition-all border ${metal === k\r\n                                        ? 'bg-blue-600 border-white shadow-lg'\r\n                                        : 'bg-gray-800 border-white/5 text-gray-400'}`}\r\n                                >\r\n                                    {metals[k].name.toUpperCase()}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n\r\n                        <div className=\"space-y-4 px-1\">\r\n                            <div>\r\n                                <div className=\"flex justify-between text-[10px] text-gray-500 font-black uppercase mb-1\">\r\n                                    <span>Intensit├® du Courant</span>\r\n                                    <span className=\"text-blue-400\">{current.toFixed(1)} A</span>\r\n                                </div>\r\n                                <input type=\"range\" min=\"0.1\" max=\"10\" step=\"0.1\" value={current} onChange={e => setCurrent(Number(e.target.value))}\r\n                                    className=\"w-full h-1.5 bg-gray-800 rounded-lg appearance-none cursor-pointer accent-blue-500\" />\r\n                            </div>\r\n\r\n                            <div>\r\n                                <div className=\"flex justify-between text-[10px] text-gray-500 font-black uppercase mb-1\">\r\n                                    <span>Dur├®e de l'op├®ration</span>\r\n                                    <span className=\"text-blue-400\">{time} min</span>\r\n                                </div>\r\n                                <input type=\"range\" min=\"1\" max=\"60\" value={time} onChange={e => setTime(Number(e.target.value))}\r\n                                    className=\"w-full h-1.5 bg-gray-800 rounded-lg appearance-none cursor-pointer accent-blue-500\" />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"bg-gray-950 p-4 rounded-2xl border border-white/5 relative overflow-hidden group\">\r\n                            <div className=\"flex justify-between items-center relative z-10\">\r\n                                <div className=\"flex flex-col\">\r\n                                    <span className=\"text-[10px] text-gray-500 font-black uppercase tracking-widest leading-none mb-1\">Masse d├®pos├®e</span>\r\n                                    <span className=\"text-3xl font-black text-white\">{mass.toFixed(3)}<span className=\"text-sm font-normal text-gray-500 ml-1\">g</span></span>\r\n                                </div>\r\n                                <div className=\"text-right\">\r\n                                    <span className=\"text-[10px] text-gray-500 font-black uppercase tracking-widest leading-none block mb-1\">Rendement</span>\r\n                                    <span className=\"text-sm font-black text-emerald-400\">100% ID├ëAL</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {phase === 'mission' && (\r\n                            <button onClick={checkMission}\r\n                                className=\"w-full py-4 rounded-xl bg-blue-600 shadow-lg shadow-blue-900/40 font-black text-xs uppercase tracking-widest active:scale-95 transition-transform\"\r\n                            >\r\n                                Finaliser le Placage ÔÜí\r\n                            </button>\r\n                        )}\r\n\r\n                        <div className=\"p-3 bg-blue-500/5 rounded-xl border border-blue-500/20\">\r\n                            <p className=\"text-[10px] font-black text-blue-300 mb-1 uppercase tracking-tighter\">Formule de Faraday</p>\r\n                            <div className=\"font-mono text-[10px] text-white\">\r\n                                m = (I ├ù t ├ù M) / (n ├ù F)\r\n                            </div>\r\n                        </div>\r\n\r\n                        <XPBar current={score % 1000} nextLevel={1000} />\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay show={showSuccess} message={mission?.title || \"D├®p├┤t Parfait !\"} points={500} onNext={nextMission} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// ==========================================\r\n// C11: VOIE S├êCHE (Aluminothermie)\r\n// ==========================================\r\nexport function VoieSecheSimulation() {\r\n    const [phase, setPhase] = useState('explore');\r\n    const [isReacting, setIsReacting] = useState(false);\r\n    const [temp, setTemp] = useState(25);\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Fusion de l\\'Aluminium', objective: 'Atteignez la temp├®rature de r├®action critique (> 1200┬░C) pour lib├®rer le fer liquide.', targetTemp: 1200 }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            setMission(missions[0]);\r\n            setTimeLeft(45);\r\n        }\r\n    }, [phase, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        let timer;\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess && mission) {\r\n            timer = setInterval(() => setTimeLeft(prev => prev - 1), 1000);\r\n        }\r\n        return () => clearInterval(timer);\r\n    }, [phase, timeLeft, showSuccess, mission]);\r\n\r\n    const handleReaction = () => {\r\n        setIsReacting(true);\r\n        setTemp(25);\r\n        let currentTemp = 25;\r\n        const interval = setInterval(() => {\r\n            currentTemp += 25;\r\n            setTemp(currentTemp);\r\n            if (currentTemp > 2500) {\r\n                clearInterval(interval);\r\n                setIsReacting(false);\r\n                if (phase === 'mission' && currentTemp >= mission.targetTemp) {\r\n                    setScore(s => s + 600);\r\n                    setShowSuccess(true);\r\n                }\r\n            }\r\n        }, 20);\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        setTemp(25);\r\n        const nextIdx = missions.findIndex(m => m.id === mission.id) + 1;\r\n        if (nextIdx < missions.length) {\r\n            setMission(missions[nextIdx]);\r\n            setTimeLeft(45);\r\n        } else {\r\n            setPhase('explore');\r\n            setMission(null);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            <OrbitControls enableZoom={false} />\r\n            <ambientLight intensity={0.4} />\r\n            <pointLight position={[5, 10, 5]} intensity={1.5} color={temp > 1000 ? '#F97316' : '#FFFFFF'} />\r\n\r\n            {/* Creuset */}\r\n            <mesh position={[0, -1, 0]}>\r\n                <cylinderGeometry args={[1.2, 0.8, 2, 32]} />\r\n                <meshStandardMaterial color=\"#333\" roughness={1} metalness={0.1} />\r\n            </mesh>\r\n\r\n            {/* M├®lange r├®actionnel */}\r\n            <mesh position={[0, -0.2, 0]}>\r\n                <cylinderGeometry args={[1.15, 0.75, 1.5, 32]} />\r\n                <meshStandardMaterial color={temp > 1000 ? '#FF4400' : '#888'} emissive={temp > 1000 ? '#FF2200' : '#000'} emissiveIntensity={temp / 2000} />\r\n            </mesh>\r\n\r\n            {/* ├ëtincelles/Lumi├¿re de r├®action */}\r\n            {isReacting && temp > 1000 && (\r\n                <Float speed={10} rotationIntensity={5} floatIntensity={2}>\r\n                    <mesh position={[0, 1, 0]}>\r\n                        <sphereGeometry args={[0.5]} />\r\n                        <MeshDistortMaterial color=\"#FFDD00\" emissive=\"#FF8800\" emissiveIntensity={5} distort={0.6} speed={5} />\r\n                    </mesh>\r\n                </Float>\r\n            )}\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒöÑ Four ├á Voie S├¿che\" className=\"w-[380px] border-orange-500/30 text-white\" defaultPosition=\"bottom-right\">\r\n                    <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                    <div className=\"flex justify-between items-center mb-4 border-b border-white/10 pb-2\">\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-[10px] text-orange-400 font-black uppercase tracking-widest leading-tight\">Aluminothermie</span>\r\n                            <span className=\"text-lg font-black\">{phase === 'explore' ? 'R├®action Thermite' : 'Mission Extraction ­ƒÄ»'}</span>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {phase === 'mission' && mission && (\r\n                        <div className=\"mb-4 space-y-2\">\r\n                            <ChallengeTimer timeLeft={timeLeft} />\r\n                            <MissionObjective objective={mission.objective} icon=\"­ƒöÑ\" />\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"p-4 bg-gray-950 rounded-2xl border border-white/5 relative overflow-hidden text-center group\">\r\n                            <p className=\"text-[10px] text-gray-500 font-black uppercase tracking-widest mb-1\">Temp├®rature de Reaction</p>\r\n                            <span className={`text-4xl font-black transition-colors duration-500 ${temp > 1200 ? 'text-red-500' : 'text-orange-400'}`}>\r\n                                {temp}<span className=\"text-lg ml-1\">┬░C</span>\r\n                            </span>\r\n                            <div className=\"absolute inset-0 bg-red-500/10 opacity-0 group-hover:opacity-100 animate-pulse transition-opacity\" style={{ opacity: temp / 2500 }} />\r\n                        </div>\r\n\r\n                        <button\r\n                            onClick={handleReaction}\r\n                            disabled={isReacting}\r\n                            className={`w-full py-4 rounded-xl font-black text-xs uppercase tracking-widest transition-all shadow-lg active:scale-95 ${isReacting\r\n                                ? 'bg-orange-950 text-orange-500 grayscale cursor-not-allowed'\r\n                                : 'bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-500 hover:to-red-500'}`}\r\n                        >\r\n                            {isReacting ? 'R├®action en cours...' : 'Amorcer la Thermite ÔÜí'}\r\n                        </button>\r\n\r\n                        <div className=\"p-4 bg-black/40 rounded-2xl border border-white/5 space-y-3\">\r\n                            <p className=\"text-[10px] font-black text-yellow-400 uppercase tracking-widest flex items-center gap-2\">\r\n                                <span>­ƒº¬</span> ├ëQUATION BILAN\r\n                            </p>\r\n                            <div className=\"font-mono text-[11px] text-white overflow-x-auto whitespace-nowrap scrollbar-hide py-1\">\r\n                                <span className=\"text-gray-400\">FeÔééOÔéâ</span>\r\n                                <span className=\"mx-1.5\">+</span>\r\n                                <span className=\"text-blue-400 font-black\">2Al</span>\r\n                                <span className=\"mx-2 text-red-500\">ÔåÆ</span>\r\n                                <span className=\"text-orange-400 font-black\">2Fe</span>\r\n                                <span className=\"mx-1.5\">+</span>\r\n                                <span className=\"text-gray-400\">AlÔééOÔéâ</span>\r\n                                <span className=\"ml-2 text-red-500 font-black\">+ Q</span>\r\n                            </div>\r\n                            <p className=\"text-[9px] text-gray-500 leading-relaxed font-bold\">\r\n                                Note: La r├®action est extr├¬mement exothermique, la chaleur lib├®r├®e (Q) permet la fusion du fer.\r\n                            </p>\r\n                        </div>\r\n\r\n                        <XPBar current={score % 1000} nextLevel={1000} />\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay show={showSuccess} message=\"Fer Liquide Extrait !\" points={600} onNext={nextMission} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// Keep old exports for compatibility\r\nexport { ChimieOrgaGeneralSim as ChimieOrganiqueSim };\r\nexport { RedoxGammaSim as RedoxElectrolyseSim };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\Chimie2SAdvanced.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\Chimie2SAdvancedPart2.js","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":909,"column":110,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[46916,46940],"text":"En attente d&apos;analyses..."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[46916,46940],"text":"En attente d&lsquo;analyses..."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[46916,46940],"text":"En attente d&#39;analyses..."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[46916,46940],"text":"En attente d&rsquo;analyses..."},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport React, { useState, useRef, useEffect, useMemo } from 'react';\r\nimport { useFrame } from '@react-three/fiber';\r\nimport { Html, Text, Float, OrbitControls } from '@react-three/drei';\r\nimport * as THREE from 'three';\r\nimport DraggableHtmlPanel from './DraggableHtmlPanel';\r\nimport {\r\n    PhaseSelector,\r\n    GradeBadge,\r\n    MissionObjective,\r\n    XPBar,\r\n    ChallengeTimer,\r\n    SuccessOverlay,\r\n    ConfettiExplosion\r\n} from './GamificationUtils';\r\n\r\n// =========================================================\r\n// CHIMIE 2NDE S - SIMULATIONS AVANC├ëES C6-C10\r\n// Solutions Aqueuses, Acides, Bases, pH, Tests d'Ions\r\n// =========================================================\r\n\r\n\r\n// =========================================================\r\n// C6. SOLUTIONS & CONCENTRATION - DILUTION AVANC├ëE\r\n// =========================================================\r\nexport function DilutionAdvanced() {\r\n    const [Ci, setCi] = useState(2.0); // Concentration initiale mol/L\r\n    const [Vi, setVi] = useState(50);  // Volume pr├®lev├® mL\r\n    const [Vf, setVf] = useState(200); // Volume final mL\r\n    const [phase, setPhase] = useState('mission');\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(60);\r\n\r\n    const Cf = (Ci * Vi) / Vf; // Concentration finale\r\n\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Dilution au Quart', objective: 'Pr├®parez une solution de 0.25 mol/L ├á partir de 1 mol/L (Vf=100mL).', targetCf: 0.25, ci: 1, vf: 100, points: 300 },\r\n        { id: 2, title: 'Pr├®cision Labo', objective: 'Ajustez Vi pour obtenir Cf = 0.4 mol/L (Ci=2, Vf=250).', targetCf: 0.4, ci: 2, vf: 250, points: 350 },\r\n        { id: 3, title: 'Facteur 10', objective: 'R├®alisez une dilution au dixi├¿me : 0.1 mol/L ├á partir de 1 mol/L (Vf=500mL).', targetCf: 0.1, ci: 1, vf: 500, points: 400 }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            setMission(missions[0]);\r\n            setTimeLeft(60);\r\n        }\r\n    }, [phase, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        let timer;\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess && mission) {\r\n            timer = setInterval(() => setTimeLeft(prev => prev - 1), 1000);\r\n        }\r\n        return () => clearInterval(timer);\r\n    }, [phase, timeLeft, showSuccess, mission]);\r\n\r\n    const handleAction = () => {\r\n        if (phase === 'mission' && mission && Math.abs(Cf - mission.targetCf) < 0.01) {\r\n            setScore(s => s + (mission.points || 300));\r\n            setShowSuccess(true);\r\n        }\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        const nextIdx = missions.findIndex(m => m.id === mission.id) + 1;\r\n        if (nextIdx < missions.length) {\r\n            setMission(missions[nextIdx]);\r\n            setTimeLeft(60);\r\n        } else {\r\n            setPhase('explore');\r\n            setMission(null);\r\n        }\r\n    };\r\n\r\n    const liquidRef = useRef();\r\n    useFrame((state) => {\r\n        if (liquidRef.current) {\r\n            liquidRef.current.position.y = Math.sin(state.clock.elapsedTime * 2) * 0.02 - 0.2;\r\n        }\r\n    });\r\n\r\n    return (\r\n        <group>\r\n            <OrbitControls enableZoom={false} />\r\n            <ambientLight intensity={0.6} />\r\n            <pointLight position={[5, 10, 5]} intensity={1.5} />\r\n\r\n            <Text position={[0, 3.8, 0]} fontSize={0.25} color=\"#60A5FA\" font=\"/fonts/Inter-Bold.woff\" anchorX=\"center\">\r\n                ­ƒº¬ CI ├ù VI = CF ├ù VF\r\n            </Text>\r\n\r\n            {/* Fiole m├¿re */}\r\n            <group position={[-2.2, 0, 0]}>\r\n                <mesh>\r\n                    <cylinderGeometry args={[0.4, 0.5, 1.8, 32]} />\r\n                    <meshPhysicalMaterial color=\"#E8F4F8\" transmission={0.9} thickness={0.5} transparent opacity={0.3} side={THREE.DoubleSide} />\r\n                </mesh>\r\n                <mesh position={[0, -0.3, 0]} ref={liquidRef}>\r\n                    <cylinderGeometry args={[0.38, 0.48, 1.0, 32]} />\r\n                    <meshStandardMaterial color=\"#3B82F6\" emissive=\"#3B82F6\" emissiveIntensity={0.2} transparent opacity={0.8} />\r\n                </mesh>\r\n                <Text position={[0, -1.3, 0]} fontSize={0.15} color=\"white\" font=\"/fonts/Inter-Bold.woff\">SOLUTION M├êRE</Text>\r\n                <Text position={[0, -1.6, 0]} fontSize={0.12} color=\"#60A5FA\">Ci : {Ci} mol/L</Text>\r\n            </group>\r\n\r\n            {/* Pipette */}\r\n            <group position={[0, 1.2, 0]}>\r\n                <mesh rotation={[0, 0, Math.PI / 10]}>\r\n                    <cylinderGeometry args={[0.04, 0.05, 1.8, 12]} />\r\n                    <meshPhysicalMaterial color=\"#E8F4F8\" transmission={0.9} transparent opacity={0.4} />\r\n                </mesh>\r\n                <mesh position={[0.1, -0.6, 0]} rotation={[0, 0, Math.PI / 10]}>\r\n                    <cylinderGeometry args={[0.03, 0.04, 0.4, 12]} />\r\n                    <meshStandardMaterial color=\"#3B82F6\" />\r\n                </mesh>\r\n                <Text position={[0.8, 0, 0]} fontSize={0.12} color=\"white\" font=\"/fonts/Inter-Bold.woff\">Vi : {Vi} mL</Text>\r\n            </group>\r\n\r\n            {/* Fiole jaug├®e */}\r\n            <group position={[2.2, 0, 0]}>\r\n                <mesh>\r\n                    <sphereGeometry args={[0.7, 32, 16, 0, Math.PI * 2, 0, Math.PI * 0.75]} />\r\n                    <meshPhysicalMaterial color=\"#E8F4F8\" transmission={0.9} transparent opacity={0.3} side={THREE.DoubleSide} />\r\n                </mesh>\r\n                <mesh position={[0, 0.8, 0]}>\r\n                    <cylinderGeometry args={[0.12, 0.18, 0.8, 24]} />\r\n                    <meshPhysicalMaterial color=\"#E8F4F8\" transmission={0.9} transparent opacity={0.3} />\r\n                </mesh>\r\n                <mesh position={[0, 1.0, 0]}>\r\n                    <torusGeometry args={[0.13, 0.01, 8, 32]} />\r\n                    <meshStandardMaterial color=\"#EF4444\" emissive=\"#EF4444\" emissiveIntensity={1} />\r\n                </mesh>\r\n                <mesh position={[0, -0.1, 0]}>\r\n                    <sphereGeometry args={[0.65, 32, 16, 0, Math.PI * 2, Math.PI * 0.35, Math.PI * 0.5]} />\r\n                    <meshStandardMaterial color=\"#93C5FD\" transparent opacity={0.7} emissive=\"#93C5FD\" emissiveIntensity={0.1} />\r\n                </mesh>\r\n                <Text position={[0, -1.3, 0]} fontSize={0.15} color=\"white\" font=\"/fonts/Inter-Bold.woff\">SOLUTION FILLE</Text>\r\n                <Text position={[0, -1.6, 0]} fontSize={0.12} color=\"#22C55E\">Cf : {Cf.toFixed(3)} mol/L</Text>\r\n            </group>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒº¬ Expert en Dilution\" className=\"w-[400px] border-blue-500/30 text-white\" defaultPosition=\"bottom-right\">\r\n                    <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                    <div className=\"flex justify-between items-center mb-4 border-b border-white/10 pb-2\">\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-[10px] text-blue-400 font-black uppercase tracking-widest leading-tight\">Verrerie de Pr├®cision</span>\r\n                            <span className=\"text-lg font-black\">{phase === 'explore' ? 'Mod├®lisation' : 'Mission Pr├®paration ­ƒÄ»'}</span>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {phase === 'mission' && mission && (\r\n                        <div className=\"mb-4 space-y-2\">\r\n                            <ChallengeTimer timeLeft={timeLeft} />\r\n                            <MissionObjective objective={mission.objective} icon=\"­ƒîí´©Å\" />\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"bg-gray-950 p-4 rounded-2xl border border-white/5 space-y-4\">\r\n                            <div className=\"space-y-1\">\r\n                                <div className=\"flex justify-between text-[10px] font-black uppercase tracking-widest text-gray-500\">\r\n                                    <span>Concentration M├¿re (Ci)</span>\r\n                                    <span className=\"text-blue-400 font-mono\">{Ci} mol/L</span>\r\n                                </div>\r\n                                <input type=\"range\" min=\"0.1\" max=\"5\" step=\"0.1\" value={Ci} onChange={(e) => setCi(Number(e.target.value))} className=\"w-full h-1.5 bg-gray-800 rounded-full appearance-none cursor-pointer accent-blue-500\" />\r\n                            </div>\r\n\r\n                            <div className=\"space-y-1\">\r\n                                <div className=\"flex justify-between text-[10px] font-black uppercase tracking-widest text-gray-500\">\r\n                                    <span>Volume Pipet├® (Vi)</span>\r\n                                    <span className=\"text-green-400 font-mono\">{Vi} mL</span>\r\n                                </div>\r\n                                <input type=\"range\" min=\"5\" max=\"100\" step=\"1\" value={Vi} onChange={(e) => setVi(Number(e.target.value))} className=\"w-full h-1.5 bg-gray-800 rounded-full appearance-none cursor-pointer accent-green-500\" />\r\n                            </div>\r\n\r\n                            <div className=\"space-y-1\">\r\n                                <div className=\"flex justify-between text-[10px] font-black uppercase tracking-widest text-gray-500\">\r\n                                    <span>Fiole Jaug├®e (Vf)</span>\r\n                                    <span className=\"text-purple-400 font-mono\">{Vf} mL</span>\r\n                                </div>\r\n                                <div className=\"flex gap-2\">\r\n                                    {[50, 100, 200, 250, 500].map(v => (\r\n                                        <button key={v} onClick={() => setVf(v)} className={`flex-1 py-1 rounded-lg text-[10px] font-bold border ${Vf === v ? 'bg-purple-600 border-white text-white' : 'bg-gray-900 border-white/5 text-gray-500 hover:bg-gray-800'}`}>\r\n                                            {v}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"bg-black/60 p-5 rounded-2xl border border-white/10 text-center group\">\r\n                            <p className=\"text-[10px] text-gray-500 font-black uppercase tracking-widest mb-1\">Concentration Finale de la Fiole</p>\r\n                            <div className=\"text-4xl font-black font-mono text-white tracking-tighter\">\r\n                                {Cf.toFixed(4)} <span className=\"text-xs text-blue-500\">mol/L</span>\r\n                            </div>\r\n                            <div className=\"flex justify-center items-center gap-2 mt-2 text-[10px] font-bold text-gray-600 tracking-widest uppercase\">\r\n                                <span>Facteur</span>\r\n                                <span className=\"px-2 py-0.5 bg-gray-900 rounded-full text-blue-400\">{(Vf / Vi).toFixed(1)}x</span>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <button\r\n                            onClick={handleAction}\r\n                            className={`w-full py-4 rounded-xl font-black text-xs uppercase tracking-widest transition-all shadow-xl active:scale-95 ${phase === 'mission' ? 'bg-gradient-to-r from-blue-600 to-indigo-600 text-white' : 'bg-gray-800 text-gray-500'}`}\r\n                        >\r\n                            {phase === 'mission' ? 'Valider la Pr├®paration Ô×í´©Å' : 'Mode Exploration Libre'}\r\n                        </button>\r\n\r\n                        <XPBar current={score % 1000} nextLevel={1000} />\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay show={showSuccess} message=\"Dilution Parfaite !\" points={mission?.points || 300} onNext={nextMission} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// =========================================================\r\n// C7 & C8. ACIDES ET BASES - TITRAGE AVANC├ë\r\n// =========================================================\r\nexport function TitrageAdvanced() {\r\n    const [volumeBase, setVolumeBase] = useState(0);\r\n    const [concentrationBase] = useState(0.1);\r\n    const [concentrationAcide, setConcentrationAcide] = useState(0.1);\r\n    const [volumeAcide] = useState(20);\r\n    const [phase, setPhase] = useState('mission');\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(60);\r\n    const [isDropping, setIsDropping] = useState(false);\r\n\r\n    const Veq = (concentrationAcide * volumeAcide) / concentrationBase;\r\n\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Neutralisation Simple', objective: 'Neutralisez 20mL d\\'acide ├á 0.1M avec de la soude ├á 0.1M (Veq = 20mL).', targetVeq: 20, ca: 0.1, points: 300 },\r\n        { id: 2, title: 'Acide Concentr├®', objective: 'Trouvez le point d\\'├®quivalence pour un acide ├á 0.15M (Veq = 30mL).', targetVeq: 30, ca: 0.15, points: 400 },\r\n        { id: 3, title: 'Solution Inconnue', objective: 'Neutralisez avec pr├®cision la solution myst├¿re (Veq = 25mL).', targetVeq: 25, ca: 0.125, points: 500 }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            setMission(missions[0]);\r\n            setTimeLeft(60);\r\n            setConcentrationAcide(missions[0].ca);\r\n            setVolumeBase(0);\r\n        }\r\n    }, [phase, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        let timer;\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess && mission) {\r\n            timer = setInterval(() => setTimeLeft(prev => prev - 1), 1000);\r\n        }\r\n        return () => clearInterval(timer);\r\n    }, [phase, timeLeft, showSuccess, mission]);\r\n\r\n    const handleEquivalence = () => {\r\n        if (phase === 'mission' && mission && Math.abs(volumeBase - mission.targetVeq) < 0.5) {\r\n            setScore(s => s + mission.points);\r\n            setShowSuccess(true);\r\n        }\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        const nextIdx = missions.findIndex(m => m.id === mission.id) + 1;\r\n        if (nextIdx < missions.length) {\r\n            setMission(missions[nextIdx]);\r\n            setConcentrationAcide(missions[nextIdx].ca);\r\n            setVolumeBase(0);\r\n            setTimeLeft(60);\r\n        } else {\r\n            setPhase('explore');\r\n            setMission(null);\r\n        }\r\n    };\r\n\r\n    const addDrop = () => {\r\n        if (volumeBase < 40) {\r\n            setIsDropping(true);\r\n            setTimeout(() => {\r\n                setVolumeBase(v => Math.min(40, v + 0.5));\r\n                setIsDropping(false);\r\n            }, 200);\r\n        }\r\n    };\r\n\r\n    // Calcul pH simplifi├®\r\n    const moleAcide = (concentrationAcide * volumeAcide) / 1000;\r\n    const moleBase = (concentrationBase * volumeBase) / 1000;\r\n    const volumeTotal = (volumeAcide + volumeBase) / 1000;\r\n\r\n    let pH;\r\n    if (volumeBase < Veq) {\r\n        const excessH = (moleAcide - moleBase) / volumeTotal;\r\n        pH = excessH > 0 ? -Math.log10(excessH) : 7;\r\n    } else if (volumeBase > Veq) {\r\n        const excessOH = (moleBase - moleAcide) / volumeTotal;\r\n        const pOH = excessOH > 0 ? -Math.log10(excessOH) : 7;\r\n        pH = 14 - pOH;\r\n    } else {\r\n        pH = 7;\r\n    }\r\n    pH = Math.max(0, Math.min(14, pH));\r\n\r\n    let indicatorColor = '#22C55E';\r\n    if (pH < 6.0) indicatorColor = '#FACC15';\r\n    else if (pH > 8.0) indicatorColor = '#3B82F6';\r\n\r\n    return (\r\n        <group>\r\n            <OrbitControls enableZoom={false} />\r\n            <ambientLight intensity={0.6} />\r\n            <pointLight position={[5, 10, 5]} intensity={1.5} />\r\n\r\n            {/* Burette */}\r\n            <group position={[0, 2.5, 0]}>\r\n                <mesh>\r\n                    <cylinderGeometry args={[0.15, 0.15, 3.5, 16]} />\r\n                    <meshPhysicalMaterial color=\"white\" transmission={0.9} transparent opacity={0.3} />\r\n                </mesh>\r\n                <mesh position={[0, (40 - volumeBase) / 23 - 0.8, 0]}>\r\n                    <cylinderGeometry args={[0.13, 0.13, (40 - volumeBase) / 11.5, 16]} />\r\n                    <meshStandardMaterial color=\"#E0E7FF\" transparent opacity={0.6} />\r\n                </mesh>\r\n                <Text position={[0.4, 1.5, 0]} fontSize={0.15} color=\"white\" font=\"/fonts/Inter-Bold.woff\" anchorX=\"left\">BURETTE (NaOH)</Text>\r\n            </group>\r\n\r\n            {/* Goutte */}\r\n            {isDropping && (\r\n                <Float speed={5} rotationIntensity={0} floatIntensity={0.5}>\r\n                    <mesh position={[0, 0.5, 0]}>\r\n                        <sphereGeometry args={[0.05]} />\r\n                        <meshStandardMaterial color=\"#E0E7FF\" emissive=\"#E0E7FF\" emissiveIntensity={0.5} />\r\n                    </mesh>\r\n                </Float>\r\n            )}\r\n\r\n            {/* Erlenmeyer */}\r\n            <group position={[0, -1.8, 0]}>\r\n                <mesh>\r\n                    <cylinderGeometry args={[0.4, 1.0, 2.2, 32]} />\r\n                    <meshPhysicalMaterial color=\"white\" transmission={0.9} transparent opacity={0.2} side={THREE.DoubleSide} />\r\n                </mesh>\r\n                <mesh position={[0, -0.4, 0]}>\r\n                    <cylinderGeometry args={[0.38, 0.9, 1.4, 32]} />\r\n                    <meshStandardMaterial color={indicatorColor} transparent opacity={0.8} emissive={indicatorColor} emissiveIntensity={0.2} />\r\n                </mesh>\r\n                <Text position={[0, -1.5, 0]} fontSize={0.15} color=\"white\" font=\"/fonts/Inter-Bold.woff\">ERLENMEYER (HCl + BBT)</Text>\r\n            </group>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"ÔÜù´©Å Expert en Titrage\" className=\"w-[380px] border-emerald-500/30 text-white\" defaultPosition=\"bottom-right\">\r\n                    <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                    <div className=\"flex justify-between items-center mb-4 border-b border-white/10 pb-2\">\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-[10px] text-emerald-400 font-black uppercase tracking-widest leading-tight\">Analyse Quantitative</span>\r\n                            <span className=\"text-lg font-black\">{phase === 'explore' ? 'Titrage Acide-Base' : 'Mission Neutralisation ­ƒÄ»'}</span>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {phase === 'mission' && mission && (\r\n                        <div className=\"mb-4 space-y-2\">\r\n                            <ChallengeTimer timeLeft={timeLeft} />\r\n                            <MissionObjective objective={mission.objective} icon=\"­ƒöì\" />\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"grid grid-cols-2 gap-3\">\r\n                            <button\r\n                                onClick={addDrop}\r\n                                disabled={volumeBase >= 40}\r\n                                className=\"py-4 bg-emerald-600 hover:bg-emerald-500 rounded-2xl font-black text-xs shadow-lg shadow-emerald-900/20 transform active:scale-95 transition-all text-white\"\r\n                            >\r\n                                ­ƒÆº VERSER GOUTTE (+0.5mL)\r\n                            </button>\r\n                            <button\r\n                                onClick={() => setVolumeBase(0)}\r\n                                className=\"py-4 bg-gray-800 hover:bg-gray-700 rounded-2xl border border-white/5 transition-colors font-black text-xs text-white\"\r\n                            >\r\n                                ­ƒöä R├ëINITIALISER\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-3 gap-2\">\r\n                            <div className=\"bg-gray-900/50 p-3 rounded-xl border border-white/5 text-center\">\r\n                                <div className=\"text-[9px] text-gray-500 font-black uppercase tracking-widest\">Base (mL)</div>\r\n                                <div className=\"text-xl font-black font-mono text-emerald-400\">{volumeBase.toFixed(1)}</div>\r\n                            </div>\r\n                            <div className=\"bg-gray-900/50 p-3 rounded-xl border border-white/5 text-center\">\r\n                                <div className=\"text-[9px] text-gray-500 font-black uppercase tracking-widest\">Ca (M)</div>\r\n                                <div className=\"text-xl font-black font-mono text-blue-400\">{concentrationAcide.toFixed(2)}</div>\r\n                            </div>\r\n                            <div className=\"bg-gray-900/50 p-3 rounded-xl border border-white/5 text-center\">\r\n                                <div className=\"text-[9px] text-gray-500 font-black uppercase tracking-widest\">Veq (mL)</div>\r\n                                <div className=\"text-xl font-black font-mono text-white\">{Veq.toFixed(1)}</div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Digital pH Meter */}\r\n                        <div className=\"bg-black/80 p-4 rounded-2xl border border-white/10 shadow-inner\">\r\n                            <div className=\"flex justify-between items-center mb-2\">\r\n                                <span className=\"text-[9px] text-gray-500 font-black uppercase tracking-widest\">pH DIGITRE</span>\r\n                                <span className={`px-2 py-0.5 rounded text-[8px] font-black uppercase ${pH < 6.5 ? 'bg-yellow-500/20 text-yellow-500' : pH > 7.5 ? 'bg-blue-500/20 text-blue-500' : 'bg-green-500/20 text-green-500'}`}>\r\n                                    {pH < 6.5 ? 'Acide' : pH > 7.5 ? 'Basique' : 'Neutre'}\r\n                                </span>\r\n                            </div>\r\n                            <div className=\"text-5xl font-black font-mono text-center text-white drop-shadow-[0_0_10px_rgba(255,255,255,0.2)]\">\r\n                                {pH.toFixed(2)}\r\n                            </div>\r\n                        </div>\r\n\r\n                        <button\r\n                            onClick={handleEquivalence}\r\n                            className={`w-full py-4 rounded-xl font-black text-xs uppercase tracking-widest transition-all shadow-xl active:scale-95 ${phase === 'mission' ? 'bg-gradient-to-r from-blue-600 to-indigo-600 text-white' : 'bg-gray-800 text-gray-500'}`}\r\n                        >\r\n                            {phase === 'mission' ? 'Valider l\\'├ëquivalence ­ƒÄ»' : 'Mode Exploration Libre'}\r\n                        </button>\r\n\r\n                        <XPBar current={score % 1000} nextLevel={1000} />\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay show={showSuccess} message=\"Titrage R├®ussi !\" points={mission?.points || 300} onNext={nextMission} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// =========================================================\r\n// C9. pH ET INDICATEURS - AVANC├ë\r\n// =========================================================\r\nexport function PHIndicateursAdvanced() {\r\n    const [pH, setPH] = useState(7);\r\n    const [phase, setPhase] = useState('mission');\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(60);\r\n\r\n    const solutions = [\r\n        { name: 'Acide gastrique', pH: 1.5, color: '#EF4444' },\r\n        { name: 'Citron', pH: 2.4, color: '#FACC15' },\r\n        { name: 'Vinaigre', pH: 3, color: '#F97316' },\r\n        { name: 'Caf├®', pH: 5, color: '#92400E' },\r\n        { name: 'Eau pure', pH: 7, color: '#60A5FA' },\r\n        { name: 'Sang', pH: 7.4, color: '#DC2626' },\r\n        { name: 'Eau de mer', pH: 8.2, color: '#0EA5E9' },\r\n        { name: 'Savon', pH: 10, color: '#F9A8D4' },\r\n        { name: 'Eau de Javel', pH: 12, color: '#A3E635' },\r\n        { name: 'Soude', pH: 14, color: '#8B5CF6' },\r\n    ];\r\n\r\n    const indicators = {\r\n        BBT: { name: 'Bleu de Bromothymol', zones: [{ max: 6, color: '#FACC15' }, { max: 7.6, color: '#22C55E' }, { max: 14, color: '#3B82F6' }] },\r\n        Phenol: { name: 'Ph├®nolphtal├®ine', zones: [{ max: 8.2, color: 'transparent' }, { max: 14, color: '#EC4899' }] },\r\n        Helianthine: { name: 'H├®lianthine', zones: [{ max: 3.1, color: '#EF4444' }, { max: 4.4, color: '#F97316' }, { max: 14, color: '#FACC15' }] },\r\n    };\r\n\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Acidit├® Gastrique', objective: 'Ajustez le pH ├á 1.5 pour simuler l\\'acide gastrique.', targetPH: 1.5 },\r\n        { id: 2, title: 'Neutralit├® Parfaite', objective: 'Atteignez un pH de 7.0 (Eau pure).', targetPH: 7.0 },\r\n        { id: 3, title: 'Basique Intense', objective: 'Pr├®parez une solution de Soude (pH 14).', targetPH: 14.0 }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            setMission(missions[0]);\r\n            setTimeLeft(60);\r\n        }\r\n    }, [phase, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        let timer;\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess && mission) {\r\n            timer = setInterval(() => setTimeLeft(prev => prev - 1), 1000);\r\n        }\r\n        return () => clearInterval(timer);\r\n    }, [phase, timeLeft, showSuccess, mission]);\r\n\r\n    const getIndicatorColor = (indicator, pH) => {\r\n        for (const zone of indicators[indicator].zones) {\r\n            if (pH <= zone.max) return zone.color;\r\n        }\r\n        return '#888';\r\n    };\r\n\r\n    const handlePHChange = (newPH) => {\r\n        setPH(newPH);\r\n        if (phase === 'mission' && mission && Math.abs(newPH - mission.targetPH) < 0.2) {\r\n            setScore(s => s + 350);\r\n            setShowSuccess(true);\r\n        }\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        const nextIdx = missions.findIndex(m => m.id === mission.id) + 1;\r\n        if (nextIdx < missions.length) {\r\n            setMission(missions[nextIdx]);\r\n            setTimeLeft(60);\r\n        } else {\r\n            setPhase('explore');\r\n            setMission(null);\r\n        }\r\n    };\r\n\r\n    const nature = pH < 7 ? 'ACIDE' : pH === 7 ? 'NEUTRE' : 'BASIQUE';\r\n    const natureColor = pH < 7 ? '#EF4444' : pH === 7 ? '#22C55E' : '#3B82F6';\r\n\r\n    return (\r\n        <group>\r\n            <OrbitControls enableZoom={false} />\r\n            <ambientLight intensity={0.6} />\r\n            <pointLight position={[10, 10, 10]} intensity={1.5} />\r\n\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            {/* ├ëchelle pH visuelle Premium */}\r\n            <group position={[0, 1.8, 0]}>\r\n                {[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14].map(p => {\r\n                    const hue = (14 - p) / 14 * 240;\r\n                    return (\r\n                        <group key={p} position={[(p - 7) * 0.45, 0, 0]}>\r\n                            <mesh>\r\n                                <boxGeometry args={[0.4, 0.8, 0.15]} />\r\n                                <meshStandardMaterial\r\n                                    color={`hsl(${hue}, 80%, 50%)`}\r\n                                    emissive={`hsl(${hue}, 80%, 20%)`}\r\n                                    emissiveIntensity={Math.abs(pH - p) < 0.5 ? 2 : 0}\r\n                                />\r\n                            </mesh>\r\n                            <Text position={[0, -0.6, 0.1]} fontSize={0.15} color=\"white\">{p}</Text>\r\n                        </group>\r\n                    );\r\n                })}\r\n                {/* Labels de zones */}\r\n                <Text position={[-3, 0.8, 0]} fontSize={0.2} color=\"#EF4444\" font=\"/fonts/Inter-Bold.woff\">ACIDE</Text>\r\n                <Text position={[0, 0.8, 0]} fontSize={0.2} color=\"#22C55E\" font=\"/fonts/Inter-Bold.woff\">NEUTRE</Text>\r\n                <Text position={[3, 0.8, 0]} fontSize={0.2} color=\"#3B82F6\" font=\"/fonts/Inter-Bold.woff\">BASIQUE</Text>\r\n\r\n                {/* Curseur Premium */}\r\n                <Float speed={5} rotationIntensity={0} floatIntensity={0.5}>\r\n                    <mesh position={[(pH - 7) * 0.45, 1.2, 0]} rotation={[Math.PI, 0, 0]}>\r\n                        <coneGeometry args={[0.15, 0.3, 32]} />\r\n                        <meshStandardMaterial color=\"white\" emissive=\"#fff\" emissiveIntensity={0.5} />\r\n                    </mesh>\r\n                </Float>\r\n            </group>\r\n\r\n            {/* Tubes indicateurs Premium */}\r\n            <group position={[0, -1, 0]}>\r\n                {Object.entries(indicators).map(([key, ind], i) => (\r\n                    <group key={key} position={[(i - 1) * 2, 0, 0]}>\r\n                        <mesh>\r\n                            <cylinderGeometry args={[0.3, 0.3, 1.5, 32, 1, true]} />\r\n                            <meshPhysicalMaterial color=\"#fff\" transmission={0.9} thickness={0.5} transparent opacity={0.3} side={THREE.DoubleSide} />\r\n                        </mesh>\r\n                        {/* Solution color├®e */}\r\n                        <mesh position={[0, -0.3, 0]}>\r\n                            <cylinderGeometry args={[0.28, 0.28, 0.8, 24]} />\r\n                            <meshStandardMaterial\r\n                                color={getIndicatorColor(key, pH)}\r\n                                transparent\r\n                                opacity={getIndicatorColor(key, pH) === 'transparent' ? 0.1 : 0.8}\r\n                                emissive={getIndicatorColor(key, pH) === 'transparent' ? '#000' : getIndicatorColor(key, pH)}\r\n                                emissiveIntensity={0.2}\r\n                            />\r\n                        </mesh>\r\n                        <Text position={[0, -1, 0.3]} fontSize={0.15} color=\"white\" font=\"/fonts/Inter-Bold.woff\">{key}</Text>\r\n                        <Text position={[0, -1.2, 0.3]} fontSize={0.1} color=\"gray\" maxWidth={1.2} textAlign=\"center\">\r\n                            {ind.name}\r\n                        </Text>\r\n                    </group>\r\n                ))}\r\n            </group>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒôè Expert en pH\" className=\"w-[400px] border-purple-500/30 text-white\" defaultPosition=\"bottom-right\">\r\n                    <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                    <div className=\"flex justify-between items-center mb-4 border-b border-white/10 pb-2\">\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-[10px] text-purple-400 font-black uppercase tracking-widest leading-tight\">├ëchelle de Sorensen</span>\r\n                            <span className=\"text-lg font-black\">{phase === 'explore' ? 'Exploration pH' : 'D├®fi Colorim├®trique ­ƒÄ»'}</span>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {phase === 'mission' && mission && (\r\n                        <div className=\"mb-4 space-y-2\">\r\n                            <ChallengeTimer timeLeft={timeLeft} />\r\n                            <MissionObjective objective={mission.objective} icon=\"­ƒôè\" />\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"space-y-5\">\r\n                        <div className=\"bg-gray-950 p-5 rounded-3xl border border-white/5 relative overflow-hidden text-center group\">\r\n                            <div className=\"relative z-10\">\r\n                                <p className=\"text-[10px] text-gray-500 font-black uppercase tracking-widest mb-1\">Potentiel Hydrog├¿ne (pH)</p>\r\n                                <span className=\"text-6xl font-black transition-colors duration-500\" style={{ color: natureColor }}>\r\n                                    {pH.toFixed(1)}\r\n                                </span>\r\n                                <div className=\"text-sm font-black mt-2 tracking-[0.2em]\" style={{ color: natureColor }}>{nature}</div>\r\n                            </div>\r\n                            <div className=\"absolute inset-0 opacity-10 animate-pulse transition-colors\" style={{ backgroundColor: natureColor }} />\r\n                        </div>\r\n\r\n                        <div className=\"space-y-4 px-1\">\r\n                            <input\r\n                                type=\"range\"\r\n                                min=\"0\"\r\n                                max=\"14\"\r\n                                step=\"0.1\"\r\n                                value={pH}\r\n                                onChange={(e) => handlePHChange(Number(e.target.value))}\r\n                                className=\"w-full h-2.5 bg-gray-800 rounded-full appearance-none cursor-pointer accent-purple-500 ring-4 ring-purple-500/10\"\r\n                            />\r\n\r\n                            <div className=\"grid grid-cols-5 gap-1\">\r\n                                {solutions.map((s, idx) => (\r\n                                    <button\r\n                                        key={s.name}\r\n                                        onClick={() => handlePHChange(s.pH)}\r\n                                        className=\"py-2 bg-gray-900 hover:bg-white hover:text-black border border-white/5 rounded-lg text-[8px] font-black transition-all transform active:scale-95 uppercase leading-tight\"\r\n                                    >\r\n                                        {s.name.split(' ')[0]}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"p-4 bg-black/40 rounded-2xl border border-white/5 space-y-3\">\r\n                            <p className=\"text-[10px] font-black text-blue-400 uppercase tracking-widest flex items-center gap-2\">\r\n                                <span>­ƒº¬</span> CONCENTRATION [HÔéâOÔü║]\r\n                            </p>\r\n                            <div className=\"font-mono text-xs text-white bg-black/60 p-3 rounded-xl border border-white/10 text-center\">\r\n                                <span className=\"text-gray-500\">10^{(-pH).toFixed(1)} = </span>\r\n                                <span className=\"text-blue-400 font-black\">{Math.pow(10, -pH).toExponential(2)}</span>\r\n                                <span className=\"text-gray-500 ml-1 text-[10px]\">mol/L</span>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <XPBar current={score % 1000} nextLevel={1000} />\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay show={showSuccess} message={mission?.title || \"pH Valid├® !\"} points={350} onNext={nextMission} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// =========================================================\r\n// C10. TESTS D'IONS - AVANC├ë GAMIFI├ë\r\n// =========================================================\r\nexport function TestsIonsAdvanced() {\r\n    const [selectedSolution, setSelectedSolution] = useState(null);\r\n    const [selectedReactif, setSelectedReactif] = useState(null);\r\n    const [result, setResult] = useState(null);\r\n\r\n    // Gamification\r\n    const [phase, setPhase] = useState('mission');\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(60);\r\n    const [testsResults, setTestsResults] = useState([]);\r\n\r\n    const solutions = [\r\n        { id: 'A', ions: ['Cu2+'], color: '#93C5FD', name: 'Sulfate de Cuivre (II)' },\r\n        { id: 'B', ions: ['Fe3+'], color: '#FCD34D', name: 'Chlorure de Fer (III)' },\r\n        { id: 'C', ions: ['Cl-'], color: '#F3F4F6', name: 'Eau Sal├®e (Ions ClÔü╗)' },\r\n        { id: 'D', ions: ['Fe2+'], color: '#6EE7B7', name: 'Sulfate de Fer (II)' },\r\n        { id: 'E', ions: ['SO42-'], color: '#C7D2FE', name: 'Sulfate de Sodium' },\r\n    ];\r\n\r\n    const reactifs = {\r\n        NaOH: {\r\n            name: 'Soude (NaOH)',\r\n            icon: '­ƒìÂ',\r\n            tests: {\r\n                'Cu2+': { precipitate: 'BLEU GEL', color: '#3B82F6', formula: 'Cu(OH)Ôéé' },\r\n                'Fe2+': { precipitate: 'VERT FONC├ë', color: '#166534', formula: 'Fe(OH)Ôéé' },\r\n                'Fe3+': { precipitate: 'ROUILLE', color: '#92400E', formula: 'Fe(OH)Ôéâ' },\r\n            }\r\n        },\r\n        AgNO3: {\r\n            name: 'Nitrate d\\'Argent',\r\n            icon: '­ƒº¬',\r\n            tests: {\r\n                'Cl-': { precipitate: 'BLANC (Puri)', color: '#F5F5F5', formula: 'AgCl' },\r\n            }\r\n        },\r\n        BaCl2: {\r\n            name: 'Chlorure de Baryum',\r\n            icon: 'ÔÜù´©Å',\r\n            tests: {\r\n                'SO42-': { precipitate: 'BLANC CRAYEUX', color: '#FFFFFF', formula: 'BaSOÔéä' },\r\n            }\r\n        },\r\n    };\r\n\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Identification du Cuivre', objective: 'Identifiez l\\'ion Cu┬▓Ôü║ dans la solution A.', targetIon: 'Cu2+', points: 400 },\r\n        { id: 2, title: 'Le Fer Oxyd├®', objective: 'D├®tectez les ions Fe┬│Ôü║ (couleur rouille).', targetIon: 'Fe3+', points: 450 },\r\n        { id: 3, title: 'Myst├¿re Chlor├®', objective: 'Trouvez l\\'ion Halog├®nure ClÔü╗ avec le nitrate d\\'argent.', targetIon: 'Cl-', points: 500 }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            setMission(missions[0]);\r\n            setTimeLeft(60);\r\n        }\r\n    }, [phase, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        let timer;\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess && mission) {\r\n            timer = setInterval(() => setTimeLeft(prev => prev - 1), 1000);\r\n        }\r\n        return () => clearInterval(timer);\r\n    }, [phase, timeLeft, showSuccess, mission]);\r\n\r\n    const runTest = () => {\r\n        if (!selectedSolution || !selectedReactif) return;\r\n\r\n        const solution = solutions.find(s => s.id === selectedSolution);\r\n        const reactif = reactifs[selectedReactif];\r\n\r\n        let found = null;\r\n        for (const ion of solution.ions) {\r\n            if (reactif.tests[ion]) {\r\n                found = { ion, ...reactif.tests[ion] };\r\n                break;\r\n            }\r\n        }\r\n\r\n        const res = found || { precipitate: 'AUCUN', color: null };\r\n        setResult(res);\r\n        setTestsResults(prev => [...prev.slice(-4), { reactif: selectedReactif, result: res }]);\r\n    };\r\n\r\n    const identifyIon = (ion) => {\r\n        if (phase === 'mission' && mission) {\r\n            if (ion === mission.targetIon) {\r\n                setScore(s => s + mission.points);\r\n                setShowSuccess(true);\r\n            }\r\n        }\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        const nextIdx = missions.findIndex(m => m.id === mission.id) + 1;\r\n        if (nextIdx < missions.length) {\r\n            setMission(missions[nextIdx]);\r\n            setTimeLeft(60);\r\n            reset();\r\n        } else {\r\n            setPhase('explore');\r\n            setMission(null);\r\n        }\r\n    };\r\n\r\n    const reset = () => {\r\n        setSelectedSolution(null);\r\n        setSelectedReactif(null);\r\n        setResult(null);\r\n        setTestsResults([]);\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            <OrbitControls enableZoom={false} />\r\n            <ambientLight intensity={0.7} />\r\n            <pointLight position={[10, 10, 10]} intensity={1.5} />\r\n\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            {/* Tubes ├á essai Premium */}\r\n            <group position={[-2.8, -0.5, 0]}>\r\n                {solutions.map((sol, i) => (\r\n                    <group key={sol.id} position={[i * 1.4, 0, 0]}>\r\n                        <mesh onClick={() => setSelectedSolution(sol.id)}>\r\n                            <cylinderGeometry args={[0.25, 0.25, 2.2, 32, 1, true]} />\r\n                            <meshPhysicalMaterial\r\n                                color=\"#fff\"\r\n                                transmission={0.95}\r\n                                thickness={0.5}\r\n                                roughness={0.05}\r\n                                transparent\r\n                                opacity={0.3}\r\n                                side={THREE.DoubleSide}\r\n                            />\r\n                        </mesh>\r\n                        {/* Liquide */}\r\n                        <mesh position={[0, -0.2, 0]}>\r\n                            <cylinderGeometry args={[0.23, 0.23, 1.6, 24]} />\r\n                            <meshStandardMaterial\r\n                                color={sol.color}\r\n                                transparent\r\n                                opacity={selectedSolution === sol.id ? 0.8 : 0.4}\r\n                            />\r\n                        </mesh>\r\n                        <Text position={[0, -1.6, 0]} fontSize={0.2} color=\"white\" font=\"/fonts/Inter-Bold.woff\">{sol.id}</Text>\r\n\r\n                        {selectedSolution === sol.id && (\r\n                            <Float speed={5} rotationIntensity={0} floatIntensity={0.5}>\r\n                                <mesh position={[0, 1.4, 0]}>\r\n                                    <ringGeometry args={[0.3, 0.35, 32]} />\r\n                                    <meshBasicMaterial color=\"#3B82F6\" side={THREE.DoubleSide} />\r\n                                </mesh>\r\n                            </Float>\r\n                        )}\r\n                    </group>\r\n                ))}\r\n            </group>\r\n\r\n            {/* Zone de M├®lange (Zoom├®) */}\r\n            {result && (\r\n                <group position={[4, 0, 0]}>\r\n                    <mesh>\r\n                        <cylinderGeometry args={[0.5, 0.5, 2.5, 32, 1, true]} />\r\n                        <meshPhysicalMaterial color=\"#fff\" transmission={0.9} transparent opacity={0.3} side={THREE.DoubleSide} />\r\n                    </mesh>\r\n                    {/* Pr├®cipit├® visuel */}\r\n                    <mesh position={[0, -0.5, 0]}>\r\n                        <dodecahedronGeometry args={[0.35]} />\r\n                        <meshStandardMaterial\r\n                            color={result.color || '#fff'}\r\n                            transparent\r\n                            opacity={result.color ? 0.9 : 0.1}\r\n                            emissive={result.color || '#000'}\r\n                            emissiveIntensity={0.5}\r\n                        />\r\n                    </mesh>\r\n                    <Text position={[0, -1.8, 0]} fontSize={0.18} color={result.color || '#888'}>\r\n                        {result.precipitate}\r\n                    </Text>\r\n                    {result.formula && (\r\n                        <Text position={[0, -2.1, 0]} fontSize={0.12} color=\"gray\">\r\n                            ({result.formula})\r\n                        </Text>\r\n                    )}\r\n                </group>\r\n            )}\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒö¼ Expert en Ions\" className=\"w-[420px] border-blue-500/30 text-white\" defaultPosition=\"bottom-right\">\r\n                    <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                    <div className=\"flex justify-between items-center mb-4 border-b border-white/10 pb-2\">\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-[10px] text-blue-400 font-black uppercase tracking-widest leading-tight\">Analyses Qualitatives</span>\r\n                            <span className=\"text-lg font-black\">{phase === 'explore' ? 'Recherche d\\'Ions' : 'D├®fi Identification ­ƒÄ»'}</span>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {phase === 'mission' && mission && (\r\n                        <div className=\"mb-4 space-y-2\">\r\n                            <ChallengeTimer timeLeft={timeLeft} />\r\n                            <MissionObjective objective={mission.objective} icon=\"­ƒº¬\" />\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"grid grid-cols-3 gap-2\">\r\n                            {Object.entries(reactifs).map(([key, r]) => (\r\n                                <button\r\n                                    key={key}\r\n                                    onClick={() => setSelectedReactif(key)}\r\n                                    className={`py-3 rounded-xl text-[10px] font-black uppercase transition-all flex flex-col items-center gap-1 border-b-4 active:border-b-0 active:translate-y-1 ${selectedReactif === key\r\n                                        ? 'bg-blue-600 border-blue-800 text-white shadow-lg'\r\n                                        : 'bg-gray-800 border-black/40 text-gray-400 hover:bg-gray-700'}`}\r\n                                >\r\n                                    <span className=\"text-xl\">{r.icon}</span>\r\n                                    {r.name.split(' ')[0]}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n\r\n                        <button\r\n                            onClick={runTest}\r\n                            disabled={!selectedSolution || !selectedReactif}\r\n                            className={`w-full py-4 rounded-xl font-black text-xs uppercase tracking-widest transition-all shadow-xl active:scale-95 ${!selectedSolution || !selectedReactif\r\n                                ? 'bg-gray-800 text-gray-600 cursor-not-allowed'\r\n                                : 'bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-blue-900/40 hover:from-blue-500 hover:to-indigo-500'}`}\r\n                        >\r\n                            ­ƒöì Initier le Test Chimique\r\n                        </button>\r\n\r\n                        <div className=\"bg-gray-950 p-4 rounded-2xl border border-white/5 space-y-3\">\r\n                            <h4 className=\"text-[10px] font-black text-gray-500 uppercase tracking-widest border-b border-white/10 pb-1\">Journal de Bord</h4>\r\n                            {testsResults.length === 0 ? (\r\n                                <p className=\"text-[10px] text-gray-700 italic text-center py-2\">En attente d'analyses...</p>\r\n                            ) : (\r\n                                <div className=\"space-y-1.5\">\r\n                                    {testsResults.map((t, i) => (\r\n                                        <div key={i} className=\"flex justify-between items-center bg-black/40 p-2 rounded-lg border border-white/5 animate-in slide-in-from-left duration-300\">\r\n                                            <span className=\"text-[10px] font-bold text-blue-400\">{t.reactif}</span>\r\n                                            <span className=\"text-[10px] font-black\" style={{ color: t.result.color || '#666' }}>\r\n                                                {t.result.precipitate}\r\n                                            </span>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {phase === 'mission' && (\r\n                            <div className=\"grid grid-cols-5 gap-1.5\">\r\n                                {['Cu2+', 'Fe2+', 'Fe3+', 'Cl-', 'SO42-'].map(ion => (\r\n                                    <button\r\n                                        key={ion}\r\n                                        onClick={() => identifyIon(ion)}\r\n                                        className=\"py-2.5 bg-gray-900 hover:bg-white hover:text-black border border-white/10 rounded-lg text-[9px] font-black transition-all transform active:scale-95\"\r\n                                    >\r\n                                        {ion}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n\r\n                        <XPBar current={score % 1000} nextLevel={1000} />\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay show={showSuccess} message={mission?.title || \"Ion Identifi├® !\"} points={mission?.points || 400} onNext={nextMission} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\Chimie2SImmersive.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'mission' and 'nextMission'. Either include them or remove the dependency array.","line":279,"column":8,"nodeType":"ArrayExpression","endLine":279,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [mission, nextMission, phase]","fix":{"range":[9573,9580],"text":"[mission, nextMission, phase]"}}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":669,"column":77,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[27190,27191],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[27190,27191],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[27190,27191],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[27190,27191],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":669,"column":95,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[27208,27209],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[27208,27209],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[27208,27209],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[27208,27209],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":734,"column":41,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[31888,31968],"text":"\r\n                                LANCER L&apos;ANALYSE\r\n                            "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[31888,31968],"text":"\r\n                                LANCER L&lsquo;ANALYSE\r\n                            "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[31888,31968],"text":"\r\n                                LANCER L&#39;ANALYSE\r\n                            "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[31888,31968],"text":"\r\n                                LANCER L&rsquo;ANALYSE\r\n                            "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":743,"column":45,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[32365,32452],"text":"\r\n                                ­ƒöä REFAIRE L&apos;EXP├ëRIENCE\r\n                            "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[32365,32452],"text":"\r\n                                ­ƒöä REFAIRE L&lsquo;EXP├ëRIENCE\r\n                            "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[32365,32452],"text":"\r\n                                ­ƒöä REFAIRE L&#39;EXP├ëRIENCE\r\n                            "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[32365,32452],"text":"\r\n                                ­ƒöä REFAIRE L&rsquo;EXP├ëRIENCE\r\n                            "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport React, { useState, useRef, useEffect, useMemo } from 'react';\r\nimport { useFrame } from '@react-three/fiber';\r\nimport { Html, Text, Float, OrbitControls } from '@react-three/drei';\r\nimport * as THREE from 'three';\r\nimport DraggableHtmlPanel from './DraggableHtmlPanel';\r\nimport {\r\n    PhaseSelector,\r\n    GradeBadge,\r\n    MissionObjective,\r\n    XPBar,\r\n    ChallengeTimer,\r\n    SuccessOverlay,\r\n    ConfettiExplosion\r\n} from './GamificationUtils';\r\n\r\n// =========================================================\r\n// ­ƒº¬ LABORATOIRE VIRTUEL DE S├ëPARATION - AVEC MODE D├ëFI\r\n// Chapitres C1-C5 Chimie 2nde S\r\n// =========================================================\r\n\r\n\r\n// === SC├ëNARIOS DE BASE ===\r\nconst BASE_SCENARIOS = {\r\n    filtration: {\r\n        id: 'filtration',\r\n        title: '­ƒº½ Filtration',\r\n        technique: 'Filtration',\r\n        description: 'S├®pare un solide d\\'un liquide gr├óce ├á un filtre',\r\n        basePoints: 100,\r\n    },\r\n    decantation: {\r\n        id: 'decantation',\r\n        title: 'ÔÜù´©Å D├®cantation',\r\n        technique: 'D├®cantation',\r\n        description: 'S├®pare deux liquides non miscibles par leur densit├®',\r\n        basePoints: 120,\r\n    },\r\n    distillation: {\r\n        id: 'distillation',\r\n        title: '­ƒöÑ Distillation',\r\n        technique: 'Distillation',\r\n        description: 'S├®pare des liquides miscibles par leur point d\\'├®bullition',\r\n        basePoints: 150,\r\n    },\r\n    chromatographie: {\r\n        id: 'chromatographie',\r\n        title: '­ƒÄ¿ Chromatographie',\r\n        technique: 'Chromatographie',\r\n        description: 'S├®pare les composants d\\'un m├®lange par migration',\r\n        basePoints: 130,\r\n    }\r\n};\r\n\r\n// === D├ëFIS AL├ëATOIRES (Mode D├®fi) ===\r\nconst CHALLENGES = [\r\n    // Filtration\r\n    {\r\n        id: 'c1',\r\n        technique: 'filtration',\r\n        title: '­ƒÅû´©Å Eau de Mer + Sable',\r\n        context: 'Tu reviens de la plage de Ngor avec une bouteille d\\'eau pleine de sable.',\r\n        question: 'Quelle technique utiliser ?',\r\n        answer: 'filtration',\r\n        hints: ['Le sable est un solide', 'L\\'eau est un liquide', 'Un filtre peut retenir les solides'],\r\n        points: 100,\r\n        timeLimit: 30,\r\n    },\r\n    {\r\n        id: 'c2',\r\n        technique: 'filtration',\r\n        title: 'Ôÿò Caf├® + Marc',\r\n        context: 'Tu as pr├®par├® du caf├® mais il y a du marc dedans.',\r\n        question: 'Comment r├®cup├®rer le caf├® clair ?',\r\n        answer: 'filtration',\r\n        hints: ['Le marc est solide', 'Le caf├® liquide doit passer'],\r\n        points: 100,\r\n        timeLimit: 25,\r\n    },\r\n    // D├®cantation\r\n    {\r\n        id: 'c3',\r\n        technique: 'decantation',\r\n        title: '­ƒì│ Huile de Friture',\r\n        context: 'Apr├¿s avoir frit du poisson, il y a de l\\'huile et de l\\'eau m├®lang├®es.',\r\n        question: 'Comment r├®cup├®rer l\\'huile propre ?',\r\n        answer: 'decantation',\r\n        hints: ['L\\'huile flotte sur l\\'eau', 'Les deux liquides ne se m├®langent pas'],\r\n        points: 120,\r\n        timeLimit: 30,\r\n    },\r\n    {\r\n        id: 'c4',\r\n        technique: 'decantation',\r\n        title: '­ƒÑù Vinaigrette',\r\n        context: 'Ta vinaigrette s\\'est s├®par├®e en deux couches.',\r\n        question: 'Quel ph├®nom├¿ne explique cela ?',\r\n        answer: 'decantation',\r\n        hints: ['L\\'huile et le vinaigre ont des densit├®s diff├®rentes'],\r\n        points: 110,\r\n        timeLimit: 25,\r\n    },\r\n    // Distillation\r\n    {\r\n        id: 'c5',\r\n        technique: 'distillation',\r\n        title: '­ƒºé Eau Sal├®e ÔåÆ Eau Potable',\r\n        context: 'Tu es sur un bateau en mer. Comment obtenir de l\\'eau potable ?',\r\n        question: 'Quelle technique permet de dessaler l\\'eau ?',\r\n        answer: 'distillation',\r\n        hints: ['L\\'eau bout ├á 100┬░C', 'Le sel reste quand l\\'eau s\\'├®vapore'],\r\n        points: 150,\r\n        timeLimit: 35,\r\n    },\r\n    {\r\n        id: 'c6',\r\n        technique: 'distillation',\r\n        title: '­ƒî┐ Huile Essentielle',\r\n        context: 'Tu veux extraire l\\'huile essentielle de la menthe.',\r\n        question: 'Quelle technique utiliser ?',\r\n        answer: 'distillation',\r\n        hints: ['La vapeur emporte les mol├®cules volatiles', 'On refroidit ensuite la vapeur'],\r\n        points: 160,\r\n        timeLimit: 40,\r\n    },\r\n    // Chromatographie\r\n    {\r\n        id: 'c7',\r\n        technique: 'chromatographie',\r\n        title: '­ƒÄ¿ Feutre Noir',\r\n        context: 'Le noir est-il vraiment une seule couleur ?',\r\n        question: 'Comment d├®couvrir les colorants cach├®s ?',\r\n        answer: 'chromatographie',\r\n        hints: ['Les colorants migrent ├á des vitesses diff├®rentes', 'On utilise du papier et un solvant'],\r\n        points: 130,\r\n        timeLimit: 30,\r\n    },\r\n    {\r\n        id: 'c8',\r\n        technique: 'chromatographie',\r\n        title: '­ƒìâ Pigments de Feuille',\r\n        context: 'Une feuille verte contient-elle seulement de la chlorophylle ?',\r\n        question: 'Comment s├®parer les pigments ?',\r\n        answer: 'chromatographie',\r\n        hints: ['Les pigments ont des affinit├®s diff├®rentes', 'On peut voir du jaune et de l\\'orange'],\r\n        points: 140,\r\n        timeLimit: 35,\r\n    },\r\n];\r\n\r\nexport function SeparationLab() {\r\n    // ├ëtats Globaux & Gamification\r\n    const [phase, setPhase] = useState('mission');\r\n    const [score, setScore] = useState(0);\r\n    const [level, setLevel] = useState(1);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n    const [streak, setStreak] = useState(0);\r\n\r\n    // ├ëtats Physiques & Exp├®rience\r\n    const [scenario, setScenario] = useState(null);\r\n    const [isRunning, setIsRunning] = useState(false);\r\n    const [progress, setProgress] = useState(0);\r\n    const [currentStep, setCurrentStep] = useState(0);\r\n    const [completedScenarios, setCompletedScenarios] = useState([]);\r\n    const [challengeCompleted, setChallengeCompleted] = useState([]);\r\n\r\n    // Timer pour le mode mission\r\n    useEffect(() => {\r\n        let timer;\r\n        if (phase === 'mission' && mission && timeLeft > 0 && !showSuccess) {\r\n            timer = setInterval(() => setTimeLeft(t => t - 1), 1000);\r\n        }\r\n        return () => clearInterval(timer);\r\n    }, [phase, mission, timeLeft, showSuccess]);\r\n\r\n    // Animation de progression\r\n    useFrame((state, delta) => {\r\n        if (isRunning && progress < 1) {\r\n            const newProgress = Math.min(1, progress + delta * 0.15);\r\n            setProgress(newProgress);\r\n\r\n            const stepIndex = Math.floor(newProgress * 4);\r\n            if (stepIndex !== currentStep && stepIndex < 4) {\r\n                setCurrentStep(stepIndex);\r\n            }\r\n\r\n            if (newProgress >= 1) {\r\n                setIsRunning(false);\r\n                handleComplete();\r\n            }\r\n        }\r\n    });\r\n\r\n    const handleComplete = () => {\r\n        if (scenario) {\r\n            if (phase === 'explore') {\r\n                if (!completedScenarios.includes(scenario.id)) {\r\n                    setCompletedScenarios(prev => [...prev, scenario.id]);\r\n                    setScore(prev => prev + (scenario.basePoints || 100));\r\n                }\r\n                setShowSuccess(true);\r\n            } else if (phase === 'mission' && mission) {\r\n                // Validation de la mission\r\n                handleMissionSuccess();\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleMissionSuccess = () => {\r\n        const bonusTime = Math.floor(timeLeft / 2);\r\n        const bonusStreak = streak * 20;\r\n        const totalPoints = (mission.points || 100) + bonusTime + bonusStreak;\r\n\r\n        setScore(prev => prev + totalPoints);\r\n        setStreak(prev => prev + 1);\r\n        setChallengeCompleted(prev => [...prev, mission.id]);\r\n        setShowSuccess(true);\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        const available = CHALLENGES.filter(c => !challengeCompleted.includes(c.id));\r\n\r\n        if (available.length === 0) {\r\n            setPhase('explore');\r\n            setMission(null);\r\n            setScenario(null);\r\n            return;\r\n        }\r\n\r\n        const next = available[Math.floor(Math.random() * available.length)];\r\n        setMission(next);\r\n        setScenario(BASE_SCENARIOS[next.technique]);\r\n        setTimeLeft(next.timeLimit || 45);\r\n        resetExperiment();\r\n    };\r\n\r\n    const handleAnswer = (techniqueId) => {\r\n        if (phase !== 'mission' || !mission) return;\r\n\r\n        if (techniqueId === mission.technique) {\r\n            // Bonne technique choisie, maintenant l'├®l├¿ve doit lancer l'exp├®rience\r\n            // On peut soit valider directement, soit forcer le \"Lancer\"\r\n            // Ici on va forcer le \"Lancer\" pour voir l'animation 3D\r\n            setScenario(BASE_SCENARIOS[techniqueId]);\r\n            startExperiment();\r\n        } else {\r\n            setStreak(0);\r\n            // On pourrait ajouter un feedback visuel d'erreur ici\r\n        }\r\n    };\r\n\r\n    const startExperiment = () => {\r\n        if (!scenario) return;\r\n        setIsRunning(true);\r\n        setProgress(0);\r\n        setCurrentStep(0);\r\n    };\r\n\r\n    const resetExperiment = () => {\r\n        setIsRunning(false);\r\n        setProgress(0);\r\n        setCurrentStep(0);\r\n    };\r\n\r\n    const selectScenario = (s) => {\r\n        if (phase === 'mission') return;\r\n        setScenario(s);\r\n        resetExperiment();\r\n    };\r\n\r\n    // Initialisation Mission\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            nextMission();\r\n        }\r\n    }, [phase]);\r\n\r\n    // ├ëtapes pour chaque technique\r\n    const getSteps = (technique) => {\r\n        const steps = {\r\n            filtration: [\r\n                \"1. Pr├®pare le filtre dans l'entonnoir\",\r\n                \"2. Verse le m├®lange doucement\",\r\n                \"3. Le solide reste dans le filtre\",\r\n                \"4. Le liquide est r├®cup├®r├®\"\r\n            ],\r\n            decantation: [\r\n                \"1. Verse dans l'ampoule ├á d├®canter\",\r\n                \"2. Attends la s├®paration des phases\",\r\n                \"3. Le plus dense va en bas\",\r\n                \"4. Ouvre le robinet pour r├®cup├®rer\"\r\n            ],\r\n            distillation: [\r\n                \"1. Chauffe le m├®lange\",\r\n                \"2. La vapeur monte dans le condenseur\",\r\n                \"3. La vapeur se refroidit et condense\",\r\n                \"4. Le liquide pur est collect├®\"\r\n            ],\r\n            chromatographie: [\r\n                \"1. D├®pose l'├®chantillon sur le papier\",\r\n                \"2. Trempe dans l'├®luant\",\r\n                \"3. Les composants migrent\",\r\n                \"4. Observe la s├®paration\"\r\n            ]\r\n        };\r\n        return steps[technique] || [];\r\n    };\r\n\r\n    // === RENDU FILTRATION ===\r\n    const renderFiltration = () => (\r\n        <group position={[0, 0, 0]}>\r\n            {/* Support */}\r\n            <mesh position={[0, 0.5, 0]}>\r\n                <cylinderGeometry args={[0.04, 0.04, 2, 8]} />\r\n                <meshStandardMaterial color=\"#555\" metalness={0.7} />\r\n            </mesh>\r\n            <mesh position={[0, 1.5, 0]}>\r\n                <boxGeometry args={[1.2, 0.08, 0.2]} />\r\n                <meshStandardMaterial color=\"#555\" metalness={0.7} />\r\n            </mesh>\r\n\r\n            {/* Entonnoir */}\r\n            <mesh position={[0.4, 1.2, 0]}>\r\n                <coneGeometry args={[0.35, 0.5, 32, 1, true]} />\r\n                <meshPhysicalMaterial color=\"#E8F4F8\" transparent opacity={0.5} side={THREE.DoubleSide} />\r\n            </mesh>\r\n\r\n            {/* Papier filtre */}\r\n            <mesh position={[0.4, 1.15, 0]}>\r\n                <coneGeometry args={[0.3, 0.4, 32, 1, true]} />\r\n                <meshStandardMaterial color=\"white\" side={THREE.DoubleSide} />\r\n            </mesh>\r\n\r\n            {/* Erlenmeyer */}\r\n            <mesh position={[0.4, 0.35, 0]}>\r\n                <cylinderGeometry args={[0.12, 0.4, 0.6, 32]} />\r\n                <meshPhysicalMaterial color=\"#E8F4F8\" transparent opacity={0.3} side={THREE.DoubleSide} />\r\n            </mesh>\r\n\r\n            {/* Liquide filtr├® */}\r\n            {progress > 0.25 && (\r\n                <mesh position={[0.4, 0.15 + progress * 0.15, 0]}>\r\n                    <cylinderGeometry args={[0.35 * progress, 0.38, progress * 0.35, 32]} />\r\n                    <meshStandardMaterial color=\"#87CEEB\" transparent opacity={0.7} />\r\n                </mesh>\r\n            )}\r\n\r\n            {/* B├®cher source */}\r\n            <group position={[-0.6, 0.9, 0]} rotation={isRunning ? [0, 0, -0.6] : [0, 0, 0]}>\r\n                <mesh>\r\n                    <cylinderGeometry args={[0.25, 0.3, 0.5, 32]} />\r\n                    <meshPhysicalMaterial color=\"#E8F4F8\" transparent opacity={0.4} side={THREE.DoubleSide} />\r\n                </mesh>\r\n                {progress < 0.8 && (\r\n                    <mesh position={[0, -0.1, 0]}>\r\n                        <cylinderGeometry args={[0.22, 0.27, 0.3 - progress * 0.3, 32]} />\r\n                        <meshStandardMaterial color=\"#C4A27C\" transparent opacity={0.8} />\r\n                    </mesh>\r\n                )}\r\n            </group>\r\n\r\n            {/* R├®sidu */}\r\n            {progress > 0.3 && (\r\n                <mesh position={[0.4, 1.0, 0]}>\r\n                    <coneGeometry args={[0.12 + progress * 0.08, 0.08, 32]} />\r\n                    <meshStandardMaterial color=\"#8B7355\" />\r\n                </mesh>\r\n            )}\r\n\r\n            {/* Gouttes */}\r\n            {isRunning && progress > 0.2 && progress < 0.9 && (\r\n                <mesh position={[0.4, 0.9 - (progress * 2 % 0.5), 0]}>\r\n                    <sphereGeometry args={[0.03, 8, 8]} />\r\n                    <meshStandardMaterial color=\"#87CEEB\" transparent opacity={0.8} />\r\n                </mesh>\r\n            )}\r\n\r\n            <Text position={[0, -0.5, 0]} fontSize={0.15} color=\"#60A5FA\" anchorX=\"center\">\r\n                ­ƒº½ FILTRATION\r\n            </Text>\r\n        </group>\r\n    );\r\n\r\n    // === RENDU D├ëCANTATION ===\r\n    const renderDecantation = () => (\r\n        <group position={[0, 0, 0]}>\r\n            <mesh position={[0, -0.2, 0]}>\r\n                <cylinderGeometry args={[0.4, 0.5, 0.12, 32]} />\r\n                <meshStandardMaterial color=\"#444\" />\r\n            </mesh>\r\n            <mesh position={[0, 0.8, -0.12]}>\r\n                <cylinderGeometry args={[0.03, 0.03, 2, 8]} />\r\n                <meshStandardMaterial color=\"#444\" metalness={0.7} />\r\n            </mesh>\r\n\r\n            <group position={[0, 0.6, 0]}>\r\n                <mesh>\r\n                    <sphereGeometry args={[0.4, 32, 32]} />\r\n                    <meshPhysicalMaterial color=\"#E8F4F8\" transparent opacity={0.3} side={THREE.DoubleSide} />\r\n                </mesh>\r\n\r\n                {/* Huile */}\r\n                <mesh position={[0, 0.1, 0]}>\r\n                    <sphereGeometry args={[0.37, 32, 16, 0, Math.PI * 2, 0, Math.PI * (0.45 - progress * 0.15)]} />\r\n                    <meshStandardMaterial color=\"#FCD34D\" transparent opacity={0.75} />\r\n                </mesh>\r\n\r\n                {/* Eau */}\r\n                <mesh position={[0, -0.1, 0]}>\r\n                    <sphereGeometry args={[0.37, 32, 16, 0, Math.PI * 2, Math.PI * 0.5, Math.PI * (0.5 - progress * 0.35)]} />\r\n                    <meshStandardMaterial color=\"#60A5FA\" transparent opacity={0.7} />\r\n                </mesh>\r\n\r\n                <mesh position={[0, -0.55, 0]}>\r\n                    <cylinderGeometry args={[0.04, 0.04, 0.35, 16]} />\r\n                    <meshPhysicalMaterial color=\"#E8F4F8\" transparent opacity={0.4} />\r\n                </mesh>\r\n\r\n                <mesh position={[0, -0.7, 0]}>\r\n                    <cylinderGeometry args={[0.05, 0.05, 0.1, 16]} />\r\n                    <meshStandardMaterial color=\"#333\" />\r\n                </mesh>\r\n                <mesh position={[0.08, -0.7, 0]} rotation={[0, 0, Math.PI / 2]}>\r\n                    <cylinderGeometry args={[0.02, 0.02, 0.12, 8]} />\r\n                    <meshStandardMaterial color={isRunning ? '#22C55E' : '#EF4444'} />\r\n                </mesh>\r\n            </group>\r\n\r\n            <mesh position={[0, -0.55, 0]}>\r\n                <cylinderGeometry args={[0.2, 0.25, 0.35, 32]} />\r\n                <meshPhysicalMaterial color=\"#E8F4F8\" transparent opacity={0.3} side={THREE.DoubleSide} />\r\n            </mesh>\r\n\r\n            {progress > 0.3 && (\r\n                <mesh position={[0, -0.65 + progress * 0.08, 0]}>\r\n                    <cylinderGeometry args={[0.18, 0.22, progress * 0.2, 32]} />\r\n                    <meshStandardMaterial color=\"#60A5FA\" transparent opacity={0.7} />\r\n                </mesh>\r\n            )}\r\n\r\n            <Text position={[0, -1, 0]} fontSize={0.15} color=\"#F59E0B\" anchorX=\"center\">\r\n                ÔÜù´©Å D├ëCANTATION\r\n            </Text>\r\n        </group>\r\n    );\r\n\r\n    // === RENDU DISTILLATION ===\r\n    const renderDistillation = () => (\r\n        <group position={[0, 0, 0]}>\r\n            <mesh position={[-0.4, -0.3, 0]}>\r\n                <cylinderGeometry args={[0.3, 0.35, 0.15, 32]} />\r\n                <meshStandardMaterial color=\"#1F2937\" />\r\n            </mesh>\r\n\r\n            {isRunning && (\r\n                <group position={[-0.4, -0.15, 0]}>\r\n                    <mesh>\r\n                        <coneGeometry args={[0.08, 0.25, 16]} />\r\n                        <meshStandardMaterial color=\"#FF6B00\" emissive=\"#FF6B00\" emissiveIntensity={0.8} transparent opacity={0.9} />\r\n                    </mesh>\r\n                    <mesh position={[0, 0.15, 0]}>\r\n                        <coneGeometry args={[0.04, 0.12, 8]} />\r\n                        <meshStandardMaterial color=\"#FFFF00\" emissive=\"#FFFF00\" emissiveIntensity={0.8} transparent opacity={0.7} />\r\n                    </mesh>\r\n                </group>\r\n            )}\r\n\r\n            <group position={[-0.4, 0.2, 0]}>\r\n                <mesh>\r\n                    <sphereGeometry args={[0.3, 32, 32]} />\r\n                    <meshPhysicalMaterial color=\"#E8F4F8\" transparent opacity={0.3} side={THREE.DoubleSide} />\r\n                </mesh>\r\n                <mesh position={[0, -0.05, 0]}>\r\n                    <sphereGeometry args={[0.27, 32, 16, 0, Math.PI * 2, Math.PI * 0.4, Math.PI * 0.6]} />\r\n                    <meshStandardMaterial color=\"#93C5FD\" transparent opacity={0.6} />\r\n                </mesh>\r\n                <mesh position={[0.08, 0.35, 0]} rotation={[0, 0, -0.3]}>\r\n                    <cylinderGeometry args={[0.05, 0.06, 0.25, 16]} />\r\n                    <meshPhysicalMaterial color=\"#E8F4F8\" transparent opacity={0.3} />\r\n                </mesh>\r\n\r\n                {isRunning && progress > 0.2 && (\r\n                    <>\r\n                        <mesh position={[-0.05, -0.1 + (progress * 3 % 0.3), 0.05]}>\r\n                            <sphereGeometry args={[0.02, 8, 8]} />\r\n                            <meshStandardMaterial color=\"white\" transparent opacity={0.4} />\r\n                        </mesh>\r\n                        <mesh position={[0.08, -0.15 + (progress * 2 % 0.25), -0.03]}>\r\n                            <sphereGeometry args={[0.015, 8, 8]} />\r\n                            <meshStandardMaterial color=\"white\" transparent opacity={0.3} />\r\n                        </mesh>\r\n                    </>\r\n                )}\r\n            </group>\r\n\r\n            <group position={[0.25, 0.6, 0]} rotation={[0, 0, -0.35]}>\r\n                <mesh>\r\n                    <cylinderGeometry args={[0.08, 0.08, 0.9, 16]} />\r\n                    <meshPhysicalMaterial color=\"#E8F4F8\" transparent opacity={0.3} side={THREE.DoubleSide} />\r\n                </mesh>\r\n                <mesh>\r\n                    <cylinderGeometry args={[0.03, 0.03, 1, 16]} />\r\n                    <meshPhysicalMaterial color=\"#E8F4F8\" transparent opacity={0.2} />\r\n                </mesh>\r\n                {isRunning && progress > 0.3 && (\r\n                    <mesh position={[0, -0.2 + progress * 0.3, 0]}>\r\n                        <cylinderGeometry args={[0.025, 0.025, progress * 0.5, 8]} />\r\n                        <meshStandardMaterial color=\"#ADD8E6\" transparent opacity={0.5} />\r\n                    </mesh>\r\n                )}\r\n            </group>\r\n\r\n            <mesh position={[0.7, -0.15, 0]}>\r\n                <cylinderGeometry args={[0.08, 0.2, 0.35, 32]} />\r\n                <meshPhysicalMaterial color=\"#E8F4F8\" transparent opacity={0.3} side={THREE.DoubleSide} />\r\n            </mesh>\r\n\r\n            {progress > 0.4 && (\r\n                <mesh position={[0.7, -0.25 + progress * 0.08, 0]}>\r\n                    <cylinderGeometry args={[0.15 * progress, 0.18, progress * 0.2, 32]} />\r\n                    <meshStandardMaterial color=\"#E0F2FE\" transparent opacity={0.6} />\r\n                </mesh>\r\n            )}\r\n\r\n            <Text position={[0.15, -0.7, 0]} fontSize={0.15} color=\"#3B82F6\" anchorX=\"center\">\r\n                ­ƒöÑ DISTILLATION\r\n            </Text>\r\n        </group>\r\n    );\r\n\r\n    // === RENDU CHROMATOGRAPHIE ===\r\n    const renderChromatographie = () => (\r\n        <group position={[0, 0, 0]}>\r\n            <mesh position={[0, 0.2, 0]}>\r\n                <boxGeometry args={[0.9, 0.7, 0.4]} />\r\n                <meshPhysicalMaterial color=\"#E8F4F8\" transparent opacity={0.25} side={THREE.DoubleSide} />\r\n            </mesh>\r\n\r\n            <mesh position={[0, 0.58, 0]}>\r\n                <boxGeometry args={[0.95, 0.05, 0.45]} />\r\n                <meshPhysicalMaterial color=\"#E8F4F8\" transparent opacity={0.3} />\r\n            </mesh>\r\n\r\n            <mesh position={[0, -0.1, 0]}>\r\n                <boxGeometry args={[0.85, 0.12, 0.35]} />\r\n                <meshStandardMaterial color=\"#C7D2FE\" transparent opacity={0.5} />\r\n            </mesh>\r\n\r\n            <mesh position={[0, 0.25, 0]}>\r\n                <planeGeometry args={[0.4, 0.75]} />\r\n                <meshStandardMaterial color=\"#FAFAFA\" side={THREE.DoubleSide} />\r\n            </mesh>\r\n\r\n            {progress < 0.25 && (\r\n                <mesh position={[0, -0.1, 0.01]}>\r\n                    <circleGeometry args={[0.05, 32]} />\r\n                    <meshStandardMaterial color=\"#22C55E\" />\r\n                </mesh>\r\n            )}\r\n\r\n            {progress > 0.2 && (\r\n                <>\r\n                    <mesh position={[-0.05, -0.1 + progress * 0.45, 0.01]}>\r\n                        <circleGeometry args={[0.04, 32]} />\r\n                        <meshStandardMaterial color=\"#3B82F6\" />\r\n                    </mesh>\r\n                    <mesh position={[0.05, -0.1 + progress * 0.3, 0.01]}>\r\n                        <circleGeometry args={[0.035, 32]} />\r\n                        <meshStandardMaterial color=\"#FACC15\" />\r\n                    </mesh>\r\n                </>\r\n            )}\r\n\r\n            {progress > 0.15 && (\r\n                <mesh position={[0, -0.15 + progress * 0.55, 0.005]}>\r\n                    <planeGeometry args={[0.38, 0.01]} />\r\n                    <meshStandardMaterial color=\"#93C5FD\" />\r\n                </mesh>\r\n            )}\r\n\r\n            {progress > 0.85 && (\r\n                <>\r\n                    <Text position={[-0.22, -0.1 + progress * 0.45, 0]} fontSize={0.04} color=\"#3B82F6\">\r\n                        Bleu\r\n                    </Text>\r\n                    <Text position={[0.22, -0.1 + progress * 0.3, 0]} fontSize={0.04} color=\"#CA8A04\">\r\n                        Jaune\r\n                    </Text>\r\n                </>\r\n            )}\r\n\r\n            <Text position={[0, -0.5, 0]} fontSize={0.15} color=\"#22C55E\" anchorX=\"center\">\r\n                ­ƒÄ¿ CHROMATOGRAPHIE\r\n            </Text>\r\n        </group>\r\n    );\r\n\r\n    return (\r\n        <group>\r\n            <OrbitControls enableZoom={false} />\r\n            <ambientLight intensity={0.6} />\r\n            <pointLight position={[5, 5, 5]} intensity={1.5} />\r\n            <pointLight position={[-3, 3, 2]} intensity={0.5} color=\"#93C5FD\" />\r\n\r\n            {/* Paillasse */}\r\n            <mesh position={[0, -0.75, 0]} rotation={[-Math.PI / 2, 0, 0]}>\r\n                <planeGeometry args={[6, 4]} />\r\n                <meshStandardMaterial color=\"#1E293B\" metalness={0.4} roughness={0.6} />\r\n            </mesh>\r\n\r\n            {/* Fond Immersif */}\r\n            <mesh position={[0, 1.5, -3]}>\r\n                <planeGeometry args={[10, 6]} />\r\n                <meshStandardMaterial color=\"#0F172A\" emissive=\"#111827\" emissiveIntensity={0.5} />\r\n            </mesh>\r\n\r\n            {/* Rendu du montage */}\r\n            <Float speed={1.5} rotationIntensity={0.2} floatIntensity={0.2}>\r\n                <group scale={1.2}>\r\n                    {scenario?.id === 'filtration' && renderFiltration()}\r\n                    {scenario?.id === 'decantation' && renderDecantation()}\r\n                    {scenario?.id === 'distillation' && renderDistillation()}\r\n                    {scenario?.id === 'chromatographie' && renderChromatographie()}\r\n                </group>\r\n            </Float>\r\n\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            {/* Message initial si aucun sc├®nario */}\r\n            {!scenario && (\r\n                <Float speed={2} floatIntensity={0.5}>\r\n                    <Text position={[0, 0.5, 0]} fontSize={0.16} color=\"#60A5FA\" font=\"Inter\" anchorX=\"center\">\r\n                        {phase === 'mission' ? \"Choisissez la technique adapt├®e au d├®fi !\" : \"S├®lectionnez une technique pour explorer\"}\r\n                    </Text>\r\n                </Float>\r\n            )}\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel\r\n                    title=\"­ƒº¬ Expert en S├®paration\"\r\n                    className=\"w-[400px] border-blue-500/30\"\r\n                >\r\n                    <div className=\"text-white\">\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <GradeBadge score={score} />\r\n                            {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={45} />}\r\n                        </div>\r\n\r\n                        <XPBar current={score} nextLevel={level * 1000} />\r\n\r\n                        <div className=\"h-[1px] bg-gradient-to-r from-transparent via-blue-500/50 to-transparent my-4\" />\r\n\r\n                        <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                        {phase === 'mission' && mission && (\r\n                            <MissionObjective objective={mission.question} icon=\"­ƒÄ»\" />\r\n                        )}\r\n\r\n                        {/* Contexte du d├®fi en mode mission */}\r\n                        {phase === 'mission' && mission && !isRunning && progress === 0 && (\r\n                            <div className=\"bg-blue-900/30 border border-blue-500/20 p-3 rounded-xl mb-4 animate-in fade-in slide-in-from-top-2 duration-500\">\r\n                                <div className=\"text-[10px] text-blue-400 font-bold uppercase tracking-widest mb-1 flex items-center gap-2\">\r\n                                    <span className=\"w-2 h-2 bg-blue-500 rounded-full animate-pulse\" />\r\n                                    Briefing de Mission\r\n                                </div>\r\n                                <p className=\"text-sm text-gray-200 italic\">\"{mission.context}\"</p>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Protocole en mode explore */}\r\n                        {phase === 'explore' && scenario && !isRunning && (\r\n                            <div className=\"space-y-2 mb-4\">\r\n                                <div className=\"text-[10px] text-gray-400 uppercase font-bold tracking-widest\">­ƒôï Protocole</div>\r\n                                {getSteps(scenario.id).map((step, i) => (\r\n                                    <div key={i} className=\"flex items-center gap-2 p-2 bg-white/5 rounded-lg text-xs border border-white/5\">\r\n                                        <span className=\"w-4 h-4 rounded-full bg-blue-600/50 flex items-center justify-center text-[10px] font-bold\">{i + 1}</span>\r\n                                        {step}\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Barre de Progression pendant l'exp├®rience */}\r\n                        {isRunning && (\r\n                            <div className=\"bg-black/40 p-4 rounded-xl border border-blue-500/20 mb-4\">\r\n                                <div className=\"flex justify-between items-end mb-2\">\r\n                                    <div>\r\n                                        <div className=\"text-[10px] text-blue-400 font-mono italic\">DATA_LINK_ACTIVE</div>\r\n                                        <div className=\"text-xs font-bold\">{getSteps(scenario?.id)[currentStep]}</div>\r\n                                    </div>\r\n                                    <div className=\"text-xl font-black text-blue-400\">{Math.round(progress * 100)}%</div>\r\n                                </div>\r\n                                <div className=\"h-2 bg-gray-800 rounded-full overflow-hidden border border-white/5\">\r\n                                    <div\r\n                                        className=\"h-full bg-gradient-to-r from-blue-600 via-cyan-400 to-emerald-500 transition-all duration-300 shadow-[0_0_10px_rgba(59,130,246,0.5)]\"\r\n                                        style={{ width: `${progress * 100}%` }}\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Grille de s├®lection des techniques */}\r\n                        <div className=\"grid grid-cols-2 gap-3 mt-4\">\r\n                            {Object.values(BASE_SCENARIOS).map(s => (\r\n                                <button\r\n                                    key={s.id}\r\n                                    onClick={() => phase === 'mission' ? handleAnswer(s.id) : selectScenario(s)}\r\n                                    disabled={isRunning}\r\n                                    className={`p-3 rounded-xl text-left transition-all duration-300 border ${scenario?.id === s.id\r\n                                            ? 'bg-blue-600/20 border-blue-500 shadow-[0_0_15px_rgba(59,130,246,0.2)]'\r\n                                            : 'bg-white/5 border-white/10 hover:bg-white/10'\r\n                                        } ${isRunning ? 'opacity-50 cursor-not-allowed' : 'active:scale-95'}`}\r\n                                >\r\n                                    <div className=\"flex justify-between items-start mb-1\">\r\n                                        <span className=\"text-base\">{s.title.split(' ')[0]}</span>\r\n                                        {completedScenarios.includes(s.id) && <span className=\"text-emerald-400 text-[10px] font-bold\">Ô£ô</span>}\r\n                                    </div>\r\n                                    <div className=\"font-bold text-xs\">{s.title.split(' ')[1]}</div>\r\n                                    <div className=\"text-[9px] text-gray-500 mt-1 uppercase font-bold tracking-tighter\">+{s.basePoints} XP</div>\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n\r\n                        {/* Actions Principales */}\r\n                        {scenario && !isRunning && progress === 0 && (\r\n                            <button\r\n                                onClick={startExperiment}\r\n                                className=\"w-full mt-4 py-4 rounded-xl font-black text-sm uppercase tracking-widest bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 shadow-lg shadow-blue-600/20 transition-all active:scale-95 flex items-center justify-center gap-3\"\r\n                            >\r\n                                <span className=\"text-xl\">ÔûÂ</span>\r\n                                LANCER L'ANALYSE\r\n                            </button>\r\n                        )}\r\n\r\n                        {progress === 1 && (\r\n                            <button\r\n                                onClick={resetExperiment}\r\n                                className=\"w-full mt-4 py-3 rounded-xl font-bold text-xs uppercase tracking-widest bg-gray-800 hover:bg-gray-700 transition-all border border-white/10\"\r\n                            >\r\n                                ­ƒöä REFAIRE L'EXP├ëRIENCE\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay\r\n                show={showSuccess}\r\n                message={phase === 'mission' ? `Mission r├®ussie ! ${scenario?.title} effectu├®e.` : `Technique ${scenario?.title} ma├«tris├®e !`}\r\n                points={phase === 'mission' ? (mission?.points || 150) : (scenario?.basePoints || 100)}\r\n                onNext={phase === 'mission' ? nextMission : () => { setShowSuccess(false); setScenario(null); }}\r\n            />\r\n        </group>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\Chimie2SSimulations.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\ChimieTSSimulations.js","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":135,"column":128,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[6112,6127],"text":"Classe d&apos;Alcool"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[6112,6127],"text":"Classe d&lsquo;Alcool"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[6112,6127],"text":"Classe d&#39;Alcool"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[6112,6127],"text":"Classe d&rsquo;Alcool"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":252,"column":94,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[12250,12252],"text":"R&apos;"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[12250,12252],"text":"R&lsquo;"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[12250,12252],"text":"R&#39;"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[12250,12252],"text":"R&rsquo;"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":258,"column":94,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[12639,12642],"text":"R&apos;'"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[12639,12642],"text":"R&lsquo;'"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[12639,12642],"text":"R&#39;'"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[12639,12642],"text":"R&rsquo;'"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":258,"column":95,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[12639,12642],"text":"R'&apos;"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[12639,12642],"text":"R'&lsquo;"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[12639,12642],"text":"R'&#39;"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[12639,12642],"text":"R'&rsquo;"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":293,"column":128,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[14451,14465],"text":"Classe d&apos;Amine"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[14451,14465],"text":"Classe d&lsquo;Amine"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[14451,14465],"text":"Classe d&#39;Amine"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[14451,14465],"text":"Classe d&rsquo;Amine"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":648,"column":33,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[33410,33520],"text":"\r\n                                &quot;Deux ├®nantiom├¿res ne sont pas superposables.\"\r\n                            "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[33410,33520],"text":"\r\n                                &ldquo;Deux ├®nantiom├¿res ne sont pas superposables.\"\r\n                            "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[33410,33520],"text":"\r\n                                &#34;Deux ├®nantiom├¿res ne sont pas superposables.\"\r\n                            "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[33410,33520],"text":"\r\n                                &rdquo;Deux ├®nantiom├¿res ne sont pas superposables.\"\r\n                            "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":648,"column":78,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[33410,33520],"text":"\r\n                                \"Deux ├®nantiom├¿res ne sont pas superposables.&quot;\r\n                            "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[33410,33520],"text":"\r\n                                \"Deux ├®nantiom├¿res ne sont pas superposables.&ldquo;\r\n                            "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[33410,33520],"text":"\r\n                                \"Deux ├®nantiom├¿res ne sont pas superposables.&#34;\r\n                            "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[33410,33520],"text":"\r\n                                \"Deux ├®nantiom├¿res ne sont pas superposables.&rdquo;\r\n                            "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":1138,"column":109,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[57641,57692],"text":"La r├®action avec l&apos;eau est consid├®r├®e comme totale."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[57641,57692],"text":"La r├®action avec l&lsquo;eau est consid├®r├®e comme totale."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[57641,57692],"text":"La r├®action avec l&#39;eau est consid├®r├®e comme totale."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[57641,57692],"text":"La r├®action avec l&rsquo;eau est consid├®r├®e comme totale."},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useRef, useState, useMemo, useEffect, useCallback } from 'react';\r\nimport * as THREE from 'three';\r\nimport { useFrame } from '@react-three/fiber';\r\nimport { Text, Line, Html, Sphere, Box, Cylinder } from '@react-three/drei';\r\nimport DraggableHtmlPanel from './DraggableHtmlPanel';\r\nimport { SuccessOverlay, ConfettiExplosion, ChallengeTimer, GradeBadge, XPBar, PhaseSelector, MissionObjective } from './GamificationUtils';\r\n\r\n// =========================================\r\n// C1. ALCOOLS ET OXYDATION\r\n// =========================================\r\nexport function AlcoolsOxydation() {\r\n    // ├ëtats Globaux & Gamification\r\n    const [phase, setPhase] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [level, setLevel] = useState(1);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n\r\n    // ├ëtats Physiques\r\n    const [alcoholType, setAlcoholType] = useState('primaire');\r\n    const [oxidizing, setOxidizing] = useState(false);\r\n    const [oxidationStage, setOxidationStage] = useState(0);\r\n\r\n    // Missions Config\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Transformation M├®nag├®e', objective: 'Obtenez un Ald├®hyde ├á partir d\\'un alcool primaire.', targetStage: 1, type: 'primaire' },\r\n        { id: 2, title: 'Oxydation Pouss├®e', objective: 'Atteignez le stade Acide Carboxylique.', targetStage: 2, type: 'primaire' },\r\n        { id: 3, title: 'C├®tone Parfaite', objective: 'Synth├®tisez une C├®tone ├á partir d\\'un alcool secondaire.', targetStage: 1, type: 'secondaire' }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            setMission(missions[Math.min(level - 1, missions.length - 1)]);\r\n            setTimeLeft(45);\r\n        }\r\n    }, [phase, level, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [timeLeft, phase, showSuccess]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && mission && !showSuccess) {\r\n            if (alcoholType === mission.type && Math.floor(oxidationStage) === mission.targetStage) {\r\n                handleSuccess();\r\n            }\r\n        }\r\n    }, [oxidationStage, alcoholType, mission, phase, showSuccess]);\r\n\r\n    useFrame((state, delta) => {\r\n        if (oxidizing && oxidationStage < 2) {\r\n            setOxidationStage(s => Math.min(2, s + delta * 0.5));\r\n        }\r\n    });\r\n\r\n    const getProduct = () => {\r\n        if (alcoholType === 'primaire') {\r\n            if (oxidationStage < 0.5) return 'Alcool Primaire';\r\n            if (oxidationStage < 1.5) return 'Ald├®hyde';\r\n            return 'Acide Carboxylique';\r\n        } else if (alcoholType === 'secondaire') {\r\n            return oxidationStage > 0.5 ? 'C├®tone' : 'Alcool Secondaire';\r\n        }\r\n        return 'Alcool Tertiaire (Stable)';\r\n    };\r\n\r\n    const handleSuccess = () => {\r\n        setScore(s => s + 500);\r\n        setShowSuccess(true);\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        setLevel(l => Math.min(l + 1, 3));\r\n        setMission(null);\r\n        reset();\r\n    };\r\n\r\n    const reset = () => { setOxidizing(false); setOxidationStage(0); };\r\n\r\n    return (\r\n        <group>\r\n            {/* Sc├¿ne 3D Am├®lior├®e */}\r\n            <group position={[0, 0, 0]}>\r\n                <Cylinder args={[1.5, 1.2, 2.5, 32]} position={[0, -1, 0]}>\r\n                    <meshPhysicalMaterial color=\"#ffffff\" transmission={0.9} roughness={0.1} />\r\n                </Cylinder>\r\n                <Cylinder args={[1.4, 1.1, 2 * (oxidationStage / 2 + 0.1), 32]} position={[0, -1.2, 0]}>\r\n                    <meshStandardMaterial\r\n                        color={oxidationStage > 1.5 ? '#ef4444' : oxidationStage > 0.5 ? '#f59e0b' : '#3b82f6'}\r\n                        transparent opacity={0.6}\r\n                    />\r\n                </Cylinder>\r\n\r\n                {/* Mol├®cules Symboliques */}\r\n                <group position={[-2, 0, 0]}>\r\n                    <Sphere args={[0.3]}><meshStandardMaterial color=\"#333\" /></Sphere>\r\n                    <Html distanceFactor={10} position={[0, 0.5, 0]}>\r\n                        <div className=\"text-[8px] font-bold text-white bg-black/50 px-1 rounded\">C-OH</div>\r\n                    </Html>\r\n                </group>\r\n\r\n                {oxidizing && (\r\n                    <group position={[0, 1.5, 0]}>\r\n                        <Sphere args={[0.1]}><meshStandardMaterial color=\"#8b5cf6\" emissive=\"#8b5cf6\" /></Sphere>\r\n                        <Text position={[0, 0.3, 0]} fontSize={0.15} color=\"#8b5cf6\">MnOÔéäÔü╗</Text>\r\n                    </group>\r\n                )}\r\n            </group>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒº¬ Laboratoire d'Oxydation\" className=\"w-[400px] border-emerald-500/30\">\r\n                    <div className=\"text-white\">\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <GradeBadge score={score} />\r\n                            {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={45} />}\r\n                        </div>\r\n\r\n                        <XPBar current={score} nextLevel={2000} />\r\n\r\n                        <div className=\"h-[1px] bg-gradient-to-r from-transparent via-emerald-500/50 to-transparent my-4\" />\r\n\r\n                        <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                        {phase === 'mission' && mission && (\r\n                            <MissionObjective objective={mission.objective} icon=\"­ƒº¬\" />\r\n                        )}\r\n\r\n                        <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                            <div className=\"space-y-3\">\r\n                                <label className=\"text-[10px] text-gray-400 block uppercase font-bold tracking-widest\">Classe d'Alcool</label>\r\n                                <div className=\"flex flex-col gap-2\">\r\n                                    {['primaire', 'secondaire', 'tertiaire'].map(t => (\r\n                                        <button key={t} onClick={() => { setAlcoholType(t); reset(); }}\r\n                                            className={`py-1 rounded text-[10px] font-bold transition-all ${alcoholType === t ? 'bg-emerald-500 shadow-lg shadow-emerald-500/30' : 'bg-gray-800 hover:bg-gray-700'}`}>\r\n                                            {t.toUpperCase()}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"bg-black/40 rounded-xl p-3 border border-emerald-500/20 flex flex-col justify-between\">\r\n                                <div className=\"space-y-1\">\r\n                                    <div className=\"text-[9px] text-emerald-400 font-mono italic mb-1\">DATA_STREAM_01</div>\r\n                                    <div className=\"text-[10px]\"><span className=\"text-gray-400\">PRODUIT:</span> <span className=\"font-bold text-cyan-400\">{getProduct()}</span></div>\r\n                                    <div className=\"text-[10px]\"><span className=\"text-gray-400\">STADE:</span> {Math.floor(oxidationStage * 50)}%</div>\r\n                                </div>\r\n                                <button onClick={() => setOxidizing(true)} disabled={alcoholType === 'tertiaire' || oxidizing}\r\n                                    className={`w-full py-2 rounded text-[10px] font-black mt-2 transition-all ${alcoholType === 'tertiaire' ? 'bg-gray-700 opacity-50 cursor-not-allowed' : 'bg-orange-600 hover:bg-orange-500 active:scale-95'}`}>\r\n                                    ­ƒöÑ OXYDER (KMnOÔéä)\r\n                                </button>\r\n                                <button onClick={reset} className=\"w-full py-1 text-[9px] text-gray-400 hover:text-white mt-1 uppercase\">R├®initialiser</button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay\r\n                show={showSuccess}\r\n                message={`Synth├¿se r├®ussie ! ${getProduct()} obtenu.`}\r\n                points={500}\r\n                onNext={nextMission}\r\n            />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// =========================================\r\n// C2. AMINES\r\n// =========================================\r\nexport function AminesProprietes() {\r\n    // ├ëtats Globaux & Gamification\r\n    const [phase, setPhase] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [level, setLevel] = useState(1);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n\r\n    // ├ëtats Physiques\r\n    const [amineClass, setAmineClass] = useState('primaire');\r\n    const [showProtonation, setShowProtonation] = useState(false);\r\n\r\n    // Missions Config\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Basique par nature', objective: 'Affichez le caract├¿re basique en protonant une amine primaire.', type: 'primaire', proton: true },\r\n        { id: 2, title: 'Structure Secondaire', objective: 'Configurez une amine secondaire proton├®e.', type: 'secondaire', proton: true },\r\n        { id: 3, title: 'Ammonium Quaternaire', objective: 'Protonnez une amine tertiaire pour former un ion ammonium.', type: 'tertiaire', proton: true }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            setMission(missions[Math.min(level - 1, missions.length - 1)]);\r\n            setTimeLeft(45);\r\n        }\r\n    }, [phase, level, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [timeLeft, phase, showSuccess]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && mission && !showSuccess) {\r\n            if (amineClass === mission.type && showProtonation === mission.proton) {\r\n                handleSuccess();\r\n            }\r\n        }\r\n    }, [amineClass, showProtonation, mission, phase, showSuccess]);\r\n\r\n    const handleSuccess = () => {\r\n        setScore(s => s + 500);\r\n        setShowSuccess(true);\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        setLevel(l => Math.min(l + 1, 3));\r\n        setMission(null);\r\n        setShowProtonation(false);\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            {/* Sc├¿ne 3D Am├®lior├®e */}\r\n            <group position={[0, 0, 0]}>\r\n                <Sphere args={[0.6]}><meshStandardMaterial color=\"#3b82f6\" emissive=\"#1d4ed8\" emissiveIntensity={0.5} /></Sphere>\r\n                <Text position={[0, 0, 0.7]} fontSize={0.4} color=\"white\">N</Text>\r\n\r\n                {/* Doublet non-liant interactif */}\r\n                <group position={[0, 1, 0]}>\r\n                    <Sphere args={[0.15]} position={[-0.15, 0, 0]}><meshStandardMaterial color=\"#fbbf24\" emissive=\"#fbbf24\" /></Sphere>\r\n                    <Sphere args={[0.15]} position={[0.15, 0, 0]}><meshStandardMaterial color=\"#fbbf24\" emissive=\"#fbbf24\" /></Sphere>\r\n                </group>\r\n\r\n                {/* Liaisons R anim├®es */}\r\n                <group rotation={[0, 0, 0]}>\r\n                    <Line points={[[0, 0, 0], [-1.2, -0.6, 0]]} color=\"white\" lineWidth={3} />\r\n                    <Text position={[-1.5, -0.7, 0]} fontSize={0.3} color=\"#94a3b8\">R</Text>\r\n\r\n                    {amineClass !== 'primaire' && (\r\n                        <group rotation={[0, (2 * Math.PI) / 3, 0]}>\r\n                            <Line points={[[0, 0, 0], [-1.2, -0.6, 0]]} color=\"white\" lineWidth={3} />\r\n                            <Text position={[-1.5, -0.7, 0]} fontSize={0.3} color=\"#94a3b8\">R'</Text>\r\n                        </group>\r\n                    )}\r\n                    {amineClass === 'tertiaire' && (\r\n                        <group rotation={[0, (4 * Math.PI) / 3, 0]}>\r\n                            <Line points={[[0, 0, 0], [-1.2, -0.6, 0]]} color=\"white\" lineWidth={3} />\r\n                            <Text position={[-1.5, -0.7, 0]} fontSize={0.3} color=\"#94a3b8\">R''</Text>\r\n                        </group>\r\n                    )}\r\n                </group>\r\n\r\n                {/* Protonation Effect */}\r\n                {showProtonation && (\r\n                    <group position={[0, 1.8, 0]}>\r\n                        <Sphere args={[0.2]}><meshStandardMaterial color=\"#ef4444\" emissive=\"#ef4444\" /></Sphere>\r\n                        <Text position={[0.4, 0, 0]} fontSize={0.2} color=\"#ef4444\">HÔü║</Text>\r\n                        <Line points={[[0, -0.8, 0], [0, 0, 0]]} color=\"#fbbf24\" lineWidth={2} dashed />\r\n                    </group>\r\n                )}\r\n            </group>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒö¼ ├ëtude des Amines\" className=\"w-[380px] border-purple-500/30\">\r\n                    <div className=\"text-white\">\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <GradeBadge score={score} />\r\n                            {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={45} />}\r\n                        </div>\r\n\r\n                        <XPBar current={score} nextLevel={2000} />\r\n\r\n                        <div className=\"h-[1px] bg-gradient-to-r from-transparent via-purple-500/50 to-transparent my-4\" />\r\n\r\n                        <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                        {phase === 'mission' && mission && (\r\n                            <MissionObjective objective={mission.objective} icon=\"­ƒº¼\" />\r\n                        )}\r\n\r\n                        <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                            <div className=\"space-y-3\">\r\n                                <label className=\"text-[10px] text-gray-400 block uppercase font-bold tracking-widest\">Classe d'Amine</label>\r\n                                <div className=\"flex gap-2\">\r\n                                    {['primaire', 'secondaire', 'tertiaire'].map(c => (\r\n                                        <button key={c} onClick={() => setAmineClass(c)}\r\n                                            className={`flex-1 py-1 rounded text-[10px] font-bold transition-all ${amineClass === c ? 'bg-purple-500 shadow-lg shadow-purple-500/30' : 'bg-gray-800 hover:bg-gray-700'}`}>\r\n                                            {c.charAt(0).toUpperCase()}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                                <button onClick={() => setShowProtonation(!showProtonation)}\r\n                                    className={`w-full py-2 rounded text-[10px] font-black transition-all ${showProtonation ? 'bg-red-600 hover:bg-red-500' : 'bg-blue-600 hover:bg-blue-500'}`}>\r\n                                    {showProtonation ? 'RETIRER PROTON' : 'FIXER PROTON (HÔü║)'}\r\n                                </button>\r\n                            </div>\r\n\r\n                            <div className=\"bg-black/40 rounded-xl p-3 border border-purple-500/20\">\r\n                                <p className=\"text-[9px] text-yellow-500 mb-2 font-mono\">NEURAL_LINK_ACTIVE</p>\r\n                                <div className=\"space-y-1 text-[10px]\">\r\n                                    <p className=\"text-emerald-400\">Ô£ô Doublet libre dispo</p>\r\n                                    <p className=\"text-emerald-400\">Ô£ô Caract├¿re Basique</p>\r\n                                    <p className=\"text-emerald-400\">Ô£ô Caract├¿re Nucl├®ophile</p>\r\n                                    {showProtonation && <p className=\"text-blue-400\">ÔåÆ Forme Ammonium Ionique</p>}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay\r\n                show={showSuccess}\r\n                message={`Configuration correcte ! Ion ammonium ${amineClass} form├®.`}\r\n                points={500}\r\n                onNext={nextMission}\r\n            />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// =========================================\r\n// C3. EST├ëRIFICATION\r\n// =========================================\r\nexport function Esterification() {\r\n    // ├ëtats Globaux & Gamification\r\n    const [phase, setPhase] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [level, setLevel] = useState(1);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n\r\n    // ├ëtats Physiques\r\n    const [reacting, setReacting] = useState(false);\r\n    const [progress, setProgress] = useState(0);\r\n    const [catalyst, setCatalyst] = useState(false);\r\n\r\n    // Missions Config\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Synth├¿se Lente', objective: 'Lancez l\\'est├®rification sans catalyseur.', targetProgress: 0.3, reqCatalyst: false },\r\n        { id: 2, title: 'Acc├®l├®rateur Chimique', objective: 'Atteignez 80% d\\'avancement avec HÔééSOÔéä.', targetProgress: 0.8, reqCatalyst: true },\r\n        { id: 3, title: '├ëquilibre Dynamique', objective: 'Stabilisez la r├®action ├á son rendement maximal.', targetProgress: 0.95, reqCatalyst: true }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            setMission(missions[Math.min(level - 1, missions.length - 1)]);\r\n            setTimeLeft(45);\r\n        }\r\n    }, [phase, level, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [timeLeft, phase, showSuccess]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && mission && !showSuccess) {\r\n            if (progress >= mission.targetProgress && catalyst === mission.reqCatalyst) {\r\n                handleSuccess();\r\n            }\r\n        }\r\n    }, [progress, catalyst, mission, phase, showSuccess]);\r\n\r\n    useFrame((state, delta) => {\r\n        if (reacting && progress < 1) {\r\n            const speed = catalyst ? 3 : 1;\r\n            setProgress(p => Math.min(1, p + delta * 0.1 * speed));\r\n        }\r\n    });\r\n\r\n    const handleSuccess = () => {\r\n        setScore(s => s + 600);\r\n        setShowSuccess(true);\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        setLevel(l => Math.min(l + 1, 3));\r\n        setMission(null);\r\n        reset();\r\n    };\r\n\r\n    const reset = () => { setReacting(false); setProgress(0); };\r\n\r\n    return (\r\n        <group>\r\n            {/* Sc├¿ne 3D Am├®lior├®e */}\r\n            <group position={[0, 0, 0]}>\r\n                {/* Ballon de r├®action */}\r\n                <Sphere args={[1.2, 32]} position={[0, -0.5, 0]}>\r\n                    <meshPhysicalMaterial color=\"#ffffff\" transmission={0.9} roughness={0} />\r\n                </Sphere>\r\n                <Sphere args={[1.1, 32]} position={[0, -0.6, 0]} scale={[1, progress * 0.9 + 0.1, 1]}>\r\n                    <meshStandardMaterial color={progress > 0.5 ? '#3b82f6' : '#f97316'} transparent opacity={0.5} />\r\n                </Sphere>\r\n\r\n                {/* R├®actifs Symboliques */}\r\n                <group position={[-2.5, 1, 0]} scale={1 - progress * 0.8}>\r\n                    <Box args={[0.8, 0.8, 0.8]}><meshStandardMaterial color=\"#ef4444\" /></Box>\r\n                    <Text position={[0, 0.6, 0]} fontSize={0.2} color=\"white\">Acide</Text>\r\n                </group>\r\n                <group position={[-1.5, 1, 0]} scale={1 - progress * 0.8}>\r\n                    <Box args={[0.8, 0.8, 0.8]}><meshStandardMaterial color=\"#22c55e\" /></Box>\r\n                    <Text position={[0, 0.6, 0]} fontSize={0.2} color=\"white\">Alcool</Text>\r\n                </group>\r\n\r\n                {/* Produits Symboliques */}\r\n                {progress > 0.2 && (\r\n                    <group position={[2, 1, 0]} scale={progress}>\r\n                        <Box args={[1, 0.8, 0.8]}><meshStandardMaterial color=\"#3b82f6\" emissive=\"#3b82f6\" emissiveIntensity={0.5} /></Box>\r\n                        <Text position={[0, 0.6, 0]} fontSize={0.2} color=\"white\">Ester</Text>\r\n                    </group>\r\n                )}\r\n            </group>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"ÔÜù´©Å Unit├® d'Est├®rification\" className=\"w-[420px] border-orange-500/30\">\r\n                    <div className=\"text-white\">\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <GradeBadge score={score} />\r\n                            {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={45} />}\r\n                        </div>\r\n\r\n                        <XPBar current={score} nextLevel={2000} />\r\n\r\n                        <div className=\"h-[1px] bg-gradient-to-r from-transparent via-orange-500/50 to-transparent my-4\" />\r\n\r\n                        <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                        {phase === 'mission' && mission && (\r\n                            <MissionObjective objective={mission.objective} icon=\"ÔÜù´©Å\" />\r\n                        )}\r\n\r\n                        <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                            <div className=\"space-y-4\">\r\n                                <div className=\"flex items-center gap-3 bg-white/5 p-2 rounded-lg border border-white/10\">\r\n                                    <input type=\"checkbox\" checked={catalyst} onChange={e => setCatalyst(e.target.checked)} className=\"w-4 h-4 accent-orange-500\" />\r\n                                    <label className=\"text-[10px] font-bold uppercase tracking-tighter text-orange-400\">Ajouter HÔééSOÔéä</label>\r\n                                </div>\r\n                                <button onClick={() => setReacting(true)} disabled={reacting}\r\n                                    className={`w-full py-3 rounded-lg font-black text-[12px] transition-all ${reacting ? 'bg-gray-700 opacity-50' : 'bg-gradient-to-r from-orange-600 to-red-600 hover:scale-105 active:scale-95 shadow-lg shadow-orange-600/20'}`}>\r\n                                    {reacting ? 'R├ëACTION EN COURS...' : '­ƒöÑ LANCER LA CHAUFFE'}\r\n                                </button>\r\n                                <button onClick={reset} className=\"w-full py-1 text-[9px] text-gray-400 hover:text-white uppercase font-bold tracking-widest\">R├®initialiser</button>\r\n                            </div>\r\n\r\n                            <div className=\"bg-black/60 rounded-xl p-4 border border-orange-500/20 shadow-inner\">\r\n                                <div className=\"space-y-3\">\r\n                                    <div>\r\n                                        <div className=\"text-[9px] text-orange-500 font-mono mb-1 tracking-widest\">AVANCEMENT x(t)</div>\r\n                                        <div className=\"w-full bg-gray-800 h-1.5 rounded-full overflow-hidden\">\r\n                                            <div className=\"bg-gradient-to-r from-orange-500 to-blue-500 h-full transition-all duration-300\" style={{ width: `${progress * 100}%` }} />\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"grid grid-cols-2 gap-2\">\r\n                                        <div className=\"text-center p-1 bg-white/5 rounded border border-white/10\">\r\n                                            <div className=\"text-[8px] text-gray-500 uppercase\">Rendement</div>\r\n                                            <div className=\"text-[14px] font-black text-blue-400\">{(progress * 67).toFixed(1)}%</div>\r\n                                        </div>\r\n                                        <div className=\"text-center p-1 bg-white/5 rounded border border-white/10\">\r\n                                            <div className=\"text-[8px] text-gray-500 uppercase\">Vitesse</div>\r\n                                            <div className=\"text-[14px] font-black text-orange-400\">{catalyst ? 'MAX' : 'LENTE'}</div>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay\r\n                show={showSuccess}\r\n                message={`Synth├¿se valid├®e ! L'ester est pr├¬t.`}\r\n                points={600}\r\n                onNext={nextMission}\r\n            />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// =========================================\r\n// C4. ACIDES AMIN├ëS ET CHIRALIT├ë\r\n// =========================================\r\nexport function AcidesAminesChiralite() {\r\n    // ├ëtats Globaux & Gamification\r\n    const [phase, setPhase] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [level, setLevel] = useState(1);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(30);\r\n\r\n    // ├ëtats Physiques\r\n    const [showMirror, setShowMirror] = useState(false);\r\n    const [rotation, setRotation] = useState(0);\r\n    const moleculeRef = useRef();\r\n\r\n    // Missions Config\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Sym├®trie Optique', objective: 'Activez le miroir pour observer l\\'├®nantiom├¿re.', showMirror: true },\r\n        { id: 2, title: 'Analyse Spatiale', objective: 'Identifiez le carbone asym├®trique (C╬▒).', showMirror: true },\r\n        { id: 3, title: 'Zwitterion Explorer', objective: 'Analysez la structure avec le miroir actif.', showMirror: true }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            setMission(missions[Math.min(level - 1, missions.length - 1)]);\r\n            setTimeLeft(30);\r\n        }\r\n    }, [phase, level, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [timeLeft, phase, showSuccess]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && mission && !showSuccess) {\r\n            if (showMirror === mission.showMirror) {\r\n                handleSuccess();\r\n            }\r\n        }\r\n    }, [showMirror, mission, phase, showSuccess]);\r\n\r\n    useFrame((state, delta) => {\r\n        if (moleculeRef.current) {\r\n            setRotation(r => r + delta * 0.5);\r\n            moleculeRef.current.rotation.y = rotation;\r\n        }\r\n    });\r\n\r\n    const handleSuccess = () => {\r\n        setScore(s => s + 400);\r\n        setShowSuccess(true);\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        setLevel(l => Math.min(l + 1, 3));\r\n        setMission(null);\r\n        setShowMirror(false);\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            {/* Sc├¿ne 3D Am├®lior├®e */}\r\n            <group position={[0, 0, 0]}>\r\n                {/* Mol├®cule Source (L) */}\r\n                <group ref={moleculeRef} position={showMirror ? [-2.5, 0, 0] : [0, 0, 0]}>\r\n                    <Sphere args={[0.4]}><meshStandardMaterial color=\"#333\" metalness={0.8} roughness={0.2} /></Sphere>\r\n                    <Text position={[0, 0.6, 0]} fontSize={0.2} color=\"white\">C╬▒</Text>\r\n\r\n                    {/* Groupements */}\r\n                    <group position={[1, 0.5, 0]}>\r\n                        <Sphere args={[0.25]}><meshStandardMaterial color=\"#ef4444\" /></Sphere>\r\n                        <Text position={[0.4, 0, 0]} fontSize={0.15} color=\"#ef4444\">COOH</Text>\r\n                    </group>\r\n                    <group position={[-1, 0.5, 0]}>\r\n                        <Sphere args={[0.25]}><meshStandardMaterial color=\"#3b82f6\" /></Sphere>\r\n                        <Text position={[-0.4, 0, 0]} fontSize={0.15} color=\"#3b82f6\">NHÔéé</Text>\r\n                    </group>\r\n                    <group position={[0, -0.8, 0.5]}>\r\n                        <Sphere args={[0.3]}><meshStandardMaterial color=\"#22c55e\" /></Sphere>\r\n                        <Text position={[0, -0.5, 0]} fontSize={0.15} color=\"#22c55e\">R</Text>\r\n                    </group>\r\n                    <group position={[0, -0.8, -0.5]}>\r\n                        <Sphere args={[0.15]}><meshStandardMaterial color=\"#ffffff\" /></Sphere>\r\n                        <Text position={[0, -0.3, 0]} fontSize={0.15} color=\"#ffffff\">H</Text>\r\n                    </group>\r\n                </group>\r\n\r\n                {/* Miroir avec effet Glow */}\r\n                {showMirror && (\r\n                    <>\r\n                        <mesh position={[0, 0, 0]}>\r\n                            <planeGeometry args={[0.1, 5]} />\r\n                            <meshStandardMaterial color=\"#ec4899\" emissive=\"#ec4899\" emissiveIntensity={2} transparent opacity={0.8} />\r\n                        </mesh>\r\n\r\n                        {/* Image Miroir (D) */}\r\n                        <group position={[2.5, 0, 0]} scale={[-1, 1, 1]} rotation={[0, -rotation, 0]}>\r\n                            <Sphere args={[0.4]}><meshStandardMaterial color=\"#333\" metalness={0.8} roughness={0.2} /></Sphere>\r\n                            <group position={[1, 0.5, 0]}><Sphere args={[0.25]}><meshStandardMaterial color=\"#ef4444\" /></Sphere></group>\r\n                            <group position={[-1, 0.5, 0]}><Sphere args={[0.25]}><meshStandardMaterial color=\"#3b82f6\" /></Sphere></group>\r\n                            <group position={[0, -0.8, 0.5]}><Sphere args={[0.3]}><meshStandardMaterial color=\"#22c55e\" /></Sphere></group>\r\n                            <group position={[0, -0.8, -0.5]}><Sphere args={[0.15]}><meshStandardMaterial color=\"#ffffff\" /></Sphere></group>\r\n                        </group>\r\n                    </>\r\n                )}\r\n            </group>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒö¼ Stereo-Isom├®rie\" className=\"w-[380px] border-pink-500/30\">\r\n                    <div className=\"text-white\">\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <GradeBadge score={score} />\r\n                            {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={30} />}\r\n                        </div>\r\n\r\n                        <XPBar current={score} nextLevel={2000} />\r\n\r\n                        <div className=\"h-[1px] bg-gradient-to-r from-transparent via-pink-500/50 to-transparent my-4\" />\r\n\r\n                        <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                        {phase === 'mission' && mission && (\r\n                            <MissionObjective objective={mission.objective} icon=\"­ƒ¬×\" />\r\n                        )}\r\n\r\n                        <div className=\"space-y-4 mt-4\">\r\n                            <button onClick={() => setShowMirror(!showMirror)}\r\n                                className={`w-full py-3 rounded-xl font-black text-[12px] transition-all flex items-center justify-center gap-2 ${showMirror ? 'bg-pink-600 hover:bg-pink-500' : 'bg-gradient-to-r from-purple-600 to-pink-600 hover:scale-105 active:scale-95 shadow-lg shadow-pink-600/20'}`}>\r\n                                <span>{showMirror ? 'MASQUER LE MIROIR' : 'ACTIVER CHAMP MIROIR'}</span>\r\n                                {showMirror && <span className=\"animate-pulse\">ÔùÅ</span>}\r\n                            </button>\r\n\r\n                            <div className=\"bg-black/60 rounded-xl p-4 border border-pink-500/20 grid grid-cols-2 gap-3 items-center\">\r\n                                <div className=\"text-center\">\r\n                                    <p className=\"text-[10px] text-pink-400 font-mono uppercase\">Forme S/L</p>\r\n                                    <p className=\"text-[8px] text-gray-500\">Naturelle</p>\r\n                                </div>\r\n                                <div className=\"text-center border-l border-white/10\">\r\n                                    <p className=\"text-[10px] text-cyan-400 font-mono uppercase\">Forme R/D</p>\r\n                                    <p className=\"text-[8px] text-gray-500\">Synth├®tique</p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <p className=\"text-[9px] text-gray-400 text-center italic bg-white/5 py-1 rounded\">\r\n                                \"Deux ├®nantiom├¿res ne sont pas superposables.\"\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay\r\n                show={showSuccess}\r\n                message={`Analyse chirale termin├®e !`}\r\n                points={400}\r\n                onNext={nextMission}\r\n            />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// =========================================\r\n// C5. CIN├ëTIQUE CHIMIQUE\r\n// =========================================\r\nexport function CinetiqueChimique() {\r\n    // ├ëtats Globaux & Gamification\r\n    const [phase, setPhase] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [level, setLevel] = useState(1);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(60);\r\n\r\n    // ├ëtats Physiques\r\n    const [temperature, setTemperature] = useState(25);\r\n    const [concentration, setConcentration] = useState(1);\r\n    const [time, setTime] = useState(0);\r\n    const [running, setRunning] = useState(false);\r\n\r\n    const k = 0.1 * Math.exp((temperature - 25) / 10) * concentration;\r\n    const advancement = 1 - Math.exp(-k * time);\r\n    const velocity = k * (1 - advancement);\r\n\r\n    // Missions Config\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'R├®action Rapide', objective: 'Atteignez 50% d\\'avancement en moins de 5s.', targetAdv: 0.5, maxTime: 5, temp: 60, conc: 1.5 },\r\n        { id: 2, title: 'Facteur Cin├®tique', objective: 'Observez l\\'effet de la temp├®rature sur k.', targetAdv: 0.8, temp: 80, conc: 2 },\r\n        { id: 3, title: 'Temps de Demi-R├®action', objective: 'Identifiez t1/2 ├á haute concentration.', targetAdv: 0.9, temp: 40, conc: 2 }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            setMission(missions[Math.min(level - 1, missions.length - 1)]);\r\n            setTimeLeft(60);\r\n        }\r\n    }, [phase, level, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [timeLeft, phase, showSuccess]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && mission && !showSuccess) {\r\n            if (advancement >= mission.targetAdv) {\r\n                if (mission.maxTime && time > mission.maxTime) {\r\n                    // ├ëchec mission temps\r\n                } else {\r\n                    handleSuccess();\r\n                }\r\n            }\r\n        }\r\n    }, [advancement, mission, phase, showSuccess, time]);\r\n\r\n    useFrame((state, delta) => {\r\n        if (running) {\r\n            setTime(t => t + delta);\r\n        }\r\n    });\r\n\r\n    const handleSuccess = () => {\r\n        setScore(s => s + 700);\r\n        setShowSuccess(true);\r\n        setRunning(false);\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        setLevel(l => Math.min(l + 1, 3));\r\n        setMission(null);\r\n        reset();\r\n    };\r\n\r\n    const reset = () => { setTime(0); setRunning(false); };\r\n\r\n    const curvePoints = useMemo(() => {\r\n        const pts = [];\r\n        for (let t = 0; t <= 10; t += 0.2) {\r\n            const x = (t / 10) * 6 - 3;\r\n            const adv = 1 - Math.exp(-k * t);\r\n            const y = adv * 2 - 1.5;\r\n            pts.push(new THREE.Vector3(x, y, 0));\r\n        }\r\n        return pts;\r\n    }, [k]);\r\n\r\n    return (\r\n        <group>\r\n            {/* Sc├¿ne 3D - Moniteur de Cin├®tique */}\r\n            <group position={[0, 0, 0]}>\r\n                {/* Axes Holographiques */}\r\n                <Line points={[[-3.5, -1.5, 0], [4, -1.5, 0]]} color=\"#3b82f6\" lineWidth={2} />\r\n                <Line points={[[-3.5, -1.5, 0], [-3.5, 2.5, 0]]} color=\"#3b82f6\" lineWidth={2} />\r\n\r\n                {/* Courbe x(t) */}\r\n                <Line points={curvePoints} color=\"#10b981\" lineWidth={4} />\r\n\r\n                {/* Curseurs t1/2 interactif */}\r\n                {advancement > 0.5 && (\r\n                    <group position={[Math.log(2) / k * 0.6 - 3.5, -1.5, 0]}>\r\n                        <Line points={[[0, 0, 0], [0, 1.5, 0]]} color=\"#f59e0b\" lineWidth={1} dashed />\r\n                        <Text position={[0, -0.3, 0]} fontSize={0.15} color=\"#f59e0b\">t┬¢</Text>\r\n                    </group>\r\n                )}\r\n\r\n                {/* Tracking Point */}\r\n                <mesh position={[Math.min(3.5, (time / 10) * 6 - 3), advancement * 2 - 1.5, 0]}>\r\n                    <sphereGeometry args={[0.15]} />\r\n                    <meshStandardMaterial color=\"#ef4444\" emissive=\"#ef4444\" emissiveIntensity={2} />\r\n                </mesh>\r\n            </group>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"ÔÅ▒´©Å Contr├┤le Cin├®tique\" className=\"w-[420px] border-amber-500/30\">\r\n                    <div className=\"text-white\">\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <GradeBadge score={score} />\r\n                            {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={60} />}\r\n                        </div>\r\n\r\n                        <XPBar current={score} nextLevel={2000} />\r\n\r\n                        <div className=\"h-[1px] bg-gradient-to-r from-transparent via-amber-500/50 to-transparent my-4\" />\r\n\r\n                        <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                        {phase === 'mission' && mission && (\r\n                            <MissionObjective objective={mission.objective} icon=\"ÔÅ▒´©Å\" />\r\n                        )}\r\n\r\n                        <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                            <div className=\"space-y-4\">\r\n                                <div className=\"space-y-1\">\r\n                                    <div className=\"flex justify-between text-[10px] text-gray-400\">\r\n                                        <span>TEMP├ëRATURE</span>\r\n                                        <span className=\"text-amber-400 font-bold\">{temperature}┬░C</span>\r\n                                    </div>\r\n                                    <input type=\"range\" min=\"0\" max=\"80\" value={temperature}\r\n                                        onChange={e => { setTemperature(Number(e.target.value)); reset(); }}\r\n                                        className=\"w-full h-1.5 bg-gray-800 rounded-lg accent-amber-500\" />\r\n                                </div>\r\n                                <div className=\"space-y-1\">\r\n                                    <div className=\"flex justify-between text-[10px] text-gray-400\">\r\n                                        <span>CONCENTRATION</span>\r\n                                        <span className=\"text-blue-400 font-bold\">{concentration} mol/L</span>\r\n                                    </div>\r\n                                    <input type=\"range\" min=\"0.1\" max=\"2\" step=\"0.1\" value={concentration}\r\n                                        onChange={e => { setConcentration(Number(e.target.value)); reset(); }}\r\n                                        className=\"w-full h-1.5 bg-gray-800 rounded-lg accent-blue-500\" />\r\n                                </div>\r\n                                <button onClick={() => setRunning(!running)}\r\n                                    className={`w-full py-2.5 rounded-lg font-black text-[12px] transition-all ${running ? 'bg-red-600 hover:bg-red-500 shadow-lg shadow-red-600/20' : 'bg-emerald-600 hover:bg-emerald-500 shadow-lg shadow-emerald-600/20'}`}>\r\n                                    {running ? 'PAUSE ANALYSE' : 'D├ëMARRER R├ëACTION'}\r\n                                </button>\r\n                            </div>\r\n\r\n                            <div className=\"bg-black/60 rounded-xl p-4 border border-amber-500/20 grid grid-rows-3 gap-2\">\r\n                                <div className=\"flex justify-between items-center bg-white/5 px-2 rounded\">\r\n                                    <div className=\"text-[8px] text-gray-500\">TEMPS</div>\r\n                                    <div className=\"text-[12px] font-mono font-bold text-amber-400\">{time.toFixed(2)}s</div>\r\n                                </div>\r\n                                <div className=\"flex justify-between items-center bg-white/5 px-2 rounded\">\r\n                                    <div className=\"text-[8px] text-gray-500\">AVANCEMENT</div>\r\n                                    <div className=\"text-[12px] font-mono font-bold text-emerald-400\">{(advancement * 100).toFixed(1)}%</div>\r\n                                </div>\r\n                                <div className=\"flex justify-between items-center bg-white/5 px-2 rounded\">\r\n                                    <div className=\"text-[8px] text-gray-500\">VITESSE v</div>\r\n                                    <div className=\"text-[10px] font-mono font-bold text-cyan-400\">{velocity.toFixed(3)} u.a</div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay\r\n                show={showSuccess}\r\n                message={`R├®action analys├®e avec succ├¿s !`}\r\n                points={700}\r\n                onNext={nextMission}\r\n            />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// =========================================\r\n// C6. pH ET AUTOPROTOLYSE\r\n// =========================================\r\nexport function PHAutoprotolyse() {\r\n    // ├ëtats Globaux & Gamification\r\n    const [phase, setPhase] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [level, setLevel] = useState(1);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n\r\n    // ├ëtats Physiques\r\n    const [hydronium, setHydronium] = useState(1e-7);\r\n    const hydroxide = 1e-14 / hydronium;\r\n    const pH = -Math.log10(hydronium);\r\n\r\n    // Missions Config\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Neutralit├® Pure', objective: 'Ajustez la solution ├á pH 7.00 exactly.', targetPH: 7.0, tolerance: 0.1 },\r\n        { id: 2, title: 'Acidit├® Gastrique', objective: 'Simulez un milieu tr├¿s acide (pH < 2).', targetPH: 1.5, maxPH: 2 },\r\n        { id: 3, title: 'Base Forte', objective: 'Atteignez un pH de base forte (pH > 12).', targetPH: 13, minPH: 12 }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            setMission(missions[Math.min(level - 1, missions.length - 1)]);\r\n            setTimeLeft(45);\r\n        }\r\n    }, [phase, level, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [timeLeft, phase, showSuccess]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && mission && !showSuccess) {\r\n            const success = mission.maxPH ? pH < mission.maxPH :\r\n                mission.minPH ? pH > mission.minPH :\r\n                    Math.abs(pH - mission.targetPH) < (mission.tolerance || 0.1);\r\n            if (success) handleSuccess();\r\n        }\r\n    }, [pH, mission, phase, showSuccess]);\r\n\r\n    const handleSuccess = () => {\r\n        setScore(s => s + 500);\r\n        setShowSuccess(true);\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        setLevel(l => Math.min(l + 1, 3));\r\n        setMission(null);\r\n    };\r\n\r\n    const getMilieu = () => {\r\n        if (pH < 6.8) return { text: 'ACIDE', color: '#EF4444', icon: '­ƒìï' };\r\n        if (pH > 7.2) return { text: 'BASIQUE', color: '#3B82F6', icon: '­ƒº╝' };\r\n        return { text: 'NEUTRE', color: '#22C55E', icon: '­ƒÆº' };\r\n    };\r\n\r\n    const milieu = getMilieu();\r\n\r\n    return (\r\n        <group>\r\n            {/* Sc├¿ne 3D - Analyseur de pH */}\r\n            <group position={[0, -0.5, 0]}>\r\n                {/* B├®cher Holographique */}\r\n                <Cylinder args={[1.5, 1.2, 3, 32]} openEnded>\r\n                    <meshPhysicalMaterial color=\"#ffffff\" transmission={0.9} roughness={0.1} />\r\n                </Cylinder>\r\n                <Cylinder args={[1.4, 1.1, 2.5, 32]} position={[0, -0.2, 0]}>\r\n                    <meshStandardMaterial color={milieu.color} transparent opacity={0.6} emissive={milieu.color} emissiveIntensity={0.2} />\r\n                </Cylinder>\r\n\r\n                {/* Particules d'Ions */}\r\n                {Array.from({ length: 15 }).map((_, i) => (\r\n                    <Sphere key={i} args={[0.06]} position={[\r\n                        (Math.random() - 0.5) * 2,\r\n                        (Math.random() - 0.5) * 2,\r\n                        (Math.random() - 0.5) * 2\r\n                    ]}>\r\n                        <meshStandardMaterial color={i % 2 === 0 ? '#ef4444' : '#3b82f6'} emissive={i % 2 === 0 ? '#ef4444' : '#3b82f6'} />\r\n                    </Sphere>\r\n                ))}\r\n            </group>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒº¬ Analyseur de pH\" className=\"w-[400px] border-cyan-500/30\">\r\n                    <div className=\"text-white\">\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <GradeBadge score={score} />\r\n                            {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={45} />}\r\n                        </div>\r\n\r\n                        <XPBar current={score} nextLevel={2000} />\r\n\r\n                        <div className=\"h-[1px] bg-gradient-to-r from-transparent via-cyan-500/50 to-transparent my-4\" />\r\n\r\n                        <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                        {phase === 'mission' && mission && (\r\n                            <MissionObjective objective={mission.objective} icon=\"­ƒîí´©Å\" />\r\n                        )}\r\n\r\n                        <div className=\"mt-4 space-y-4\">\r\n                            <div className=\"bg-black/40 rounded-xl p-4 border border-cyan-500/20\">\r\n                                <div className=\"flex justify-between items-end mb-2\">\r\n                                    <div className=\"text-[10px] text-gray-400 uppercase font-bold tracking-widest\">Sonde pH-m├®trique</div>\r\n                                    <div className=\"text-3xl font-black font-mono\" style={{ color: milieu.color }}>{pH.toFixed(2)}</div>\r\n                                </div>\r\n                                <input type=\"range\" min=\"0\" max=\"14\" step=\"0.01\" value={pH}\r\n                                    onChange={e => setHydronium(Math.pow(10, -Number(e.target.value)))}\r\n                                    className=\"w-full h-2 bg-gray-800 rounded-lg accent-cyan-500\" />\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-3\">\r\n                                <div className=\"p-3 rounded-xl border border-white/10 bg-white/5 flex items-center justify-between\">\r\n                                    <div>\r\n                                        <div className=\"text-[8px] text-gray-500\">Ions HÔéâOÔü║</div>\r\n                                        <div className=\"text-[10px] font-mono text-red-400\">{hydronium.toExponential(2)}</div>\r\n                                    </div>\r\n                                    <div className=\"text-xl\">­ƒìï</div>\r\n                                </div>\r\n                                <div className=\"p-3 rounded-xl border border-white/10 bg-white/5 flex items-center justify-between\">\r\n                                    <div>\r\n                                        <div className=\"text-[8px] text-gray-500\">Ions HOÔü╗</div>\r\n                                        <div className=\"text-[10px] font-mono text-blue-400\">{hydroxide.toExponential(2)}</div>\r\n                                    </div>\r\n                                    <div className=\"text-xl\">­ƒº╝</div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"py-2 text-center rounded-lg font-black text-[12px] uppercase tracking-tighter\"\r\n                                style={{ backgroundColor: `${milieu.color}20`, border: `1px solid ${milieu.color}50`, color: milieu.color }}>\r\n                                Milieu {milieu.text} detected\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay\r\n                show={showSuccess}\r\n                message={`Milieu stabilis├® avec succ├¿s !`}\r\n                points={500}\r\n                onNext={nextMission}\r\n            />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// =========================================\r\n// C7. ACIDES ET BASES FORTS\r\n// =========================================\r\nexport function AcidesBasesForts() {\r\n    // ├ëtats Globaux & Gamification\r\n    const [phase, setPhase] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [level, setLevel] = useState(1);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n\r\n    // ├ëtats Physiques\r\n    const [type, setType] = useState('acide');\r\n    const [concentration, setConcentration] = useState(0.01);\r\n\r\n    const pH = type === 'acide' ? -Math.log10(concentration) : 14 + Math.log10(concentration);\r\n\r\n    // Missions Config\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Solution Acide 10Ôü╗┬▓', objective: 'Pr├®parez une solution de HCl ├á pH 2.00.', type: 'acide', conc: 0.01 },\r\n        { id: 2, title: 'Soude D├®capante', objective: 'Pr├®parez une solution de NaOH ├á pH 13.00.', type: 'base', conc: 0.1 },\r\n        { id: 3, title: 'Acidit├® extr├¬me', objective: 'Atteignez un pH de 1.00 avec HCl.', type: 'acide', conc: 0.1 }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            setMission(missions[Math.min(level - 1, missions.length - 1)]);\r\n            setTimeLeft(45);\r\n        }\r\n    }, [phase, level, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [timeLeft, phase, showSuccess]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && mission && !showSuccess) {\r\n            if (type === mission.type && Math.abs(concentration - mission.conc) < 0.001) {\r\n                handleSuccess();\r\n            }\r\n        }\r\n    }, [concentration, type, mission, phase, showSuccess]);\r\n\r\n    const handleSuccess = () => {\r\n        setScore(s => s + 500);\r\n        setShowSuccess(true);\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        setLevel(l => Math.min(l + 1, 3));\r\n        setMission(null);\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            {/* Sc├¿ne 3D - R├®acteur de Dissociation */}\r\n            <group position={[0, -0.5, 0]}>\r\n                <Cylinder args={[1.5, 1.2, 3, 32]} openEnded>\r\n                    <meshPhysicalMaterial color=\"#ffffff\" transmission={1} roughness={0} />\r\n                </Cylinder>\r\n                <Cylinder args={[1.4, 1.1, 2.8, 32]} position={[0, -0.1, 0]}>\r\n                    <meshStandardMaterial\r\n                        color={type === 'acide' ? '#fca5a5' : '#93c5fd'}\r\n                        transparent opacity={0.6}\r\n                    />\r\n                </Cylinder>\r\n\r\n                {/* Ions en mouvement */}\r\n                {Array.from({ length: 20 }).map((_, i) => (\r\n                    <IonParticle key={i} color={type === 'acide' ? '#ef4444' : '#3b82f6'} />\r\n                ))}\r\n            </group>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒÆº Acides/Bases Forts\" className=\"w-[400px] border-blue-500/30\">\r\n                    <div className=\"text-white\">\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <GradeBadge score={score} />\r\n                            {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={45} />}\r\n                        </div>\r\n\r\n                        <XPBar current={score} nextLevel={2000} />\r\n\r\n                        <div className=\"h-[1px] bg-gradient-to-r from-transparent via-blue-500/50 to-transparent my-4\" />\r\n\r\n                        <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                        {phase === 'mission' && mission && (\r\n                            <MissionObjective objective={mission.objective} icon=\"­ƒº¬\" />\r\n                        )}\r\n\r\n                        <div className=\"mt-4 space-y-4\">\r\n                            <div className=\"flex gap-2\">\r\n                                <button onClick={() => setType('acide')}\r\n                                    className={`flex-1 py-2 rounded-lg font-black text-[10px] transition-all ${type === 'acide' ? 'bg-red-600 shadow-lg shadow-red-600/30' : 'bg-gray-800'}`}>\r\n                                    ACIDE FORT (HCl)\r\n                                </button>\r\n                                <button onClick={() => setType('base')}\r\n                                    className={`flex-1 py-2 rounded-lg font-black text-[10px] transition-all ${type === 'base' ? 'bg-blue-600 shadow-lg shadow-blue-600/30' : 'bg-gray-800'}`}>\r\n                                    BASE FORTE (NaOH)\r\n                                </button>\r\n                            </div>\r\n\r\n                            <div className=\"bg-black/40 rounded-xl p-4 border border-blue-500/20\">\r\n                                <div className=\"flex justify-between items-center mb-2\">\r\n                                    <span className=\"text-[10px] text-gray-400\">CONCENTRATION C</span>\r\n                                    <span className=\"text-cyan-400 font-mono font-bold\">{concentration.toPrecision(2)} mol/L</span>\r\n                                </div>\r\n                                <input type=\"range\" min=\"-4\" max=\"-1\" step=\"0.1\" value={Math.log10(concentration)}\r\n                                    onChange={e => setConcentration(Math.pow(10, Number(e.target.value)))}\r\n                                    className=\"w-full h-2 bg-gray-800 rounded-lg accent-cyan-500\" />\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-3\">\r\n                                <div className=\"bg-white/5 p-3 rounded-xl border border-white/10 text-center\">\r\n                                    <div className=\"text-[8px] text-gray-500 uppercase tracking-widest\">Calcul pH</div>\r\n                                    <div className=\"text-[10px] text-gray-400 mb-1\">{type === 'acide' ? '-log C' : '14 + log C'}</div>\r\n                                    <div className=\"text-2xl font-black text-cyan-400\">{pH.toFixed(2)}</div>\r\n                                </div>\r\n                                <div className=\"bg-white/5 p-3 rounded-xl border border-white/10 flex flex-col justify-center\">\r\n                                    <div className=\"flex items-center gap-2 mb-1\">\r\n                                        <div className=\"w-2 h-2 rounded-full bg-emerald-500 animate-pulse\" />\r\n                                        <span className=\"text-[8px] text-emerald-400 font-bold\">TOTAL_DISSOCIATION</span>\r\n                                    </div>\r\n                                    <p className=\"text-[9px] text-gray-400 leading-tight\">La r├®action avec l'eau est consid├®r├®e comme totale.</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay\r\n                show={showSuccess}\r\n                message={`Solution calibr├®e ! pH = ${pH.toFixed(2)}`}\r\n                points={500}\r\n                onNext={nextMission}\r\n            />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\nfunction IonParticle({ color }) {\r\n    const meshRef = useRef();\r\n    const [pos] = useState(() => [\r\n        (Math.random() - 0.5) * 2,\r\n        (Math.random() - 0.5) * 2,\r\n        (Math.random() - 0.5) * 2\r\n    ]);\r\n\r\n    useFrame((state) => {\r\n        if (meshRef.current) {\r\n            meshRef.current.position.y += Math.sin(state.clock.elapsedTime + pos[0]) * 0.005;\r\n            meshRef.current.position.x += Math.cos(state.clock.elapsedTime + pos[1]) * 0.005;\r\n        }\r\n    });\r\n\r\n    return (\r\n        <Sphere ref={meshRef} args={[0.07]} position={pos}>\r\n            <meshStandardMaterial color={color} emissive={color} emissiveIntensity={0.5} />\r\n        </Sphere>\r\n    );\r\n}\r\n\r\n// =========================================\r\n// C8. ACIDES FAIBLES ET Ka\r\n// =========================================\r\nexport function AcidesFaiblesKa() {\r\n    // ├ëtats Globaux & Gamification\r\n    const [phase, setPhase] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [level, setLevel] = useState(1);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n\r\n    // ├ëtats Physiques\r\n    const [pKa, setPKa] = useState(4.75);\r\n    const [pH, setPH] = useState(4.75);\r\n\r\n    const ratio = Math.pow(10, pH - pKa);\r\n    const percentBase = (ratio / (1 + ratio)) * 100;\r\n    const percentAcid = 100 - percentBase;\r\n\r\n    // Missions Config\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Demi-├ëquivalence', objective: '├ëquilibrez la solution (50% Acide, 50% Base).', targetAdv: 50, tolerance: 1 },\r\n        { id: 2, title: 'Domaine de Pr├®dominance', objective: 'Ajustez le pH pour avoir plus de 90% d\\'Acide (AH).', minAcid: 90 },\r\n        { id: 3, title: 'Esp├¿ce Basique', objective: 'Atteignez 99% de Base conjugu├®e (AÔü╗).', minBase: 99 }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            setMission(missions[Math.min(level - 1, missions.length - 1)]);\r\n            setTimeLeft(45);\r\n        }\r\n    }, [phase, level, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [timeLeft, phase, showSuccess]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && mission && !showSuccess) {\r\n            const success = mission.minAcid ? percentAcid >= mission.minAcid :\r\n                mission.minBase ? percentBase >= mission.minBase :\r\n                    Math.abs(percentAcid - mission.targetAdv) < (mission.tolerance || 1);\r\n            if (success) handleSuccess();\r\n        }\r\n    }, [percentAcid, percentBase, mission, phase, showSuccess]);\r\n\r\n    const handleSuccess = () => {\r\n        setScore(s => s + 600);\r\n        setShowSuccess(true);\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        setLevel(l => Math.min(l + 1, 3));\r\n        setMission(null);\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            {/* Sc├¿ne 3D - Diagramme de Distribution */}\r\n            <group position={[0, 0, 0]}>\r\n                {/* Zone Acide AH */}\r\n                <Box args={[3.5, percentAcid * 0.04, 0.5]} position={[-2, (percentAcid * 0.04) / 2 - 2, 0]}>\r\n                    <meshStandardMaterial color=\"#ef4444\" transparent opacity={0.6} emissive=\"#ef4444\" emissiveIntensity={0.2} />\r\n                </Box>\r\n                <Text position={[-2, 0.5, 0]} fontSize={0.3} color=\"#ef4444\">AH (Acide)</Text>\r\n\r\n                {/* Zone Base A- */}\r\n                <Box args={[3.5, percentBase * 0.04, 0.5]} position={[2, (percentBase * 0.04) / 2 - 2, 0]}>\r\n                    <meshStandardMaterial color=\"#3b82f6\" transparent opacity={0.6} emissive=\"#3b82f6\" emissiveIntensity={0.2} />\r\n                </Box>\r\n                <Text position={[2, 0.5, 0]} fontSize={0.3} color=\"#3b82f6\">AÔü╗ (Base)</Text>\r\n\r\n                {/* Marqueur pKa Central */}\r\n                <Line points={[[0, -2.5, 0], [0, 2, 0]]} color=\"#f59e0b\" lineWidth={2} dashed />\r\n                <Text position={[0, 2.3, 0]} fontSize={0.25} color=\"#f59e0b\">pKa = {pKa}</Text>\r\n            </group>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"ÔÜû´©Å ├ëquilibre Faible (Ka)\" className=\"w-[420px] border-purple-500/30\">\r\n                    <div className=\"text-white\">\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <GradeBadge score={score} />\r\n                            {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={45} />}\r\n                        </div>\r\n\r\n                        <XPBar current={score} nextLevel={2000} />\r\n\r\n                        <div className=\"h-[1px] bg-gradient-to-r from-transparent via-purple-500/50 to-transparent my-4\" />\r\n\r\n                        <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                        {phase === 'mission' && mission && (\r\n                            <MissionObjective objective={mission.objective} icon=\"ÔÜû´©Å\" />\r\n                        )}\r\n\r\n                        <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                            <div className=\"space-y-4\">\r\n                                <div className=\"space-y-1\">\r\n                                    <div className=\"flex justify-between text-[10px] text-gray-400\">\r\n                                        <span>constante pKa</span>\r\n                                        <span className=\"text-amber-400 font-bold\">{pKa.toFixed(1)}</span>\r\n                                    </div>\r\n                                    <input type=\"range\" min=\"1\" max=\"10\" step=\"0.1\" value={pKa}\r\n                                        onChange={e => setPKa(Number(e.target.value))}\r\n                                        className=\"w-full h-1.5 bg-gray-800 rounded-lg accent-amber-500\" />\r\n                                </div>\r\n                                <div className=\"space-y-1\">\r\n                                    <div className=\"flex justify-between text-[10px] text-gray-400\">\r\n                                        <span>MESURE pH</span>\r\n                                        <span className=\"text-emerald-400 font-bold\">{pH.toFixed(2)}</span>\r\n                                    </div>\r\n                                    <input type=\"range\" min=\"0\" max=\"14\" step=\"0.1\" value={pH}\r\n                                        onChange={e => setPH(Number(e.target.value))}\r\n                                        className=\"w-full h-1.5 bg-gray-800 rounded-lg accent-emerald-500\" />\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"bg-black/60 rounded-xl p-4 border border-purple-500/20 flex flex-col justify-center gap-3\">\r\n                                <div>\r\n                                    <div className=\"flex justify-between text-[8px] text-gray-500 uppercase mb-1\">\r\n                                        <span>[AH] / [Ctotal]</span>\r\n                                        <span className=\"text-red-400\">{percentAcid.toFixed(1)}%</span>\r\n                                    </div>\r\n                                    <div className=\"w-full bg-gray-800 h-1 rounded-full overflow-hidden\">\r\n                                        <div className=\"bg-red-500 h-full\" style={{ width: `${percentAcid}%` }} />\r\n                                    </div>\r\n                                </div>\r\n                                <div>\r\n                                    <div className=\"flex justify-between text-[8px] text-gray-500 uppercase mb-1\">\r\n                                        <span>[AÔü╗] / [Ctotal]</span>\r\n                                        <span className=\"text-blue-400\">{percentBase.toFixed(1)}%</span>\r\n                                    </div>\r\n                                    <div className=\"w-full bg-gray-800 h-1 rounded-full overflow-hidden\">\r\n                                        <div className=\"bg-blue-500 h-full\" style={{ width: `${percentBase}%` }} />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"mt-4 p-2 bg-purple-900/20 border border-purple-500/30 rounded text-center\">\r\n                            <p className=\"text-[10px] font-mono text-purple-300\">pH = pKa + log([AÔü╗]/[AH])</p>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay\r\n                show={showSuccess}\r\n                message={`├ëquilibre valid├® !`}\r\n                points={600}\r\n                onNext={nextMission}\r\n            />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// =========================================\r\n// C9. SOLUTIONS TAMPONS\r\n// =========================================\r\nexport function SolutionsTampons() {\r\n    // ├ëtats Globaux & Gamification\r\n    const [phase, setPhase] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [level, setLevel] = useState(1);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n\r\n    // ├ëtats Physiques\r\n    const [pKa] = useState(4.75);\r\n    const [addedAcid, setAddedAcid] = useState(0);\r\n    const [addedBase, setAddedBase] = useState(0);\r\n\r\n    const pHInitial = pKa;\r\n    const pHChange = (addedBase - addedAcid) * 0.12;\r\n    const pH = Math.max(1, Math.min(14, pHInitial + pHChange));\r\n\r\n    // Missions Config\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'R├®sistance Acide', objective: 'Ajoutez 5 doses d\\'acide et observez la stabilit├® du pH.', reqAcid: 5 },\r\n        { id: 2, title: 'Effet Tampon Base', objective: 'Neutralisez l\\'acide ajout├® puis ajoutez 3 doses de base.', reqBase: 3, reqAcid: 0 },\r\n        { id: 3, title: 'Limite du Pouvoir Tampon', objective: 'Ajoutez plus de 10 doses au total et analysez la d├®rive.', totalDoses: 10 }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            setMission(missions[Math.min(level - 1, missions.length - 1)]);\r\n            setTimeLeft(45);\r\n        }\r\n    }, [phase, level, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [timeLeft, phase, showSuccess]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && mission && !showSuccess) {\r\n            const success = mission.totalDoses ? (addedAcid + addedBase) >= mission.totalDoses :\r\n                (addedAcid === mission.reqAcid && addedBase === (mission.reqBase || 0));\r\n            if (success) handleSuccess();\r\n        }\r\n    }, [addedAcid, addedBase, mission, phase, showSuccess]);\r\n\r\n    const handleSuccess = () => {\r\n        setScore(s => s + 500);\r\n        setShowSuccess(true);\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        setLevel(l => Math.min(l + 1, 3));\r\n        setMission(null);\r\n        reset();\r\n    };\r\n\r\n    const reset = () => { setAddedAcid(0); setAddedBase(0); };\r\n\r\n    return (\r\n        <group>\r\n            {/* Sc├¿ne 3D - Syst├¿me Tampon */}\r\n            <group position={[0, -0.5, 0]}>\r\n                <Cylinder args={[1.5, 1.2, 3, 32]} openEnded>\r\n                    <meshPhysicalMaterial color=\"#ffffff\" transmission={0.9} roughness={0.1} />\r\n                </Cylinder>\r\n                <Cylinder args={[1.4, 1.1, 2.5, 32]} position={[0, -0.2, 0]}>\r\n                    <meshStandardMaterial color=\"#86efac\" transparent opacity={0.6} />\r\n                </Cylinder>\r\n\r\n                {/* Afficheur Holo pH */}\r\n                <group position={[2.5, 1, 0]}>\r\n                    <Box args={[1.2, 0.8, 0.1]}><meshStandardMaterial color=\"#1f2937\" emissive=\"#10b981\" emissiveIntensity={0.2} /></Box>\r\n                    <Text position={[0, 0, 0.1]} fontSize={0.4} color=\"#10b981\" font=\"monospace\">{pH.toFixed(2)}</Text>\r\n                    <Text position={[0, 0.5, 0]} fontSize={0.15} color=\"#10b981\">SYSTEM_PH</Text>\r\n                </group>\r\n\r\n                {/* Injecteurs */}\r\n                <group position={[-2, 1.5, 0]}>\r\n                    <Box args={[0.4, 1.5, 0.4]}><meshStandardMaterial color=\"#ef4444\" emissive=\"#ef4444\" emissiveIntensity={0.3} /></Box>\r\n                    <Text position={[0, 1, 0]} fontSize={0.2} color=\"#ef4444\">HÔü║</Text>\r\n                </group>\r\n                <group position={[-1, 1.5, 0]}>\r\n                    <Box args={[0.4, 1.5, 0.4]}><meshStandardMaterial color=\"#3b82f6\" emissive=\"#3b82f6\" emissiveIntensity={0.3} /></Box>\r\n                    <Text position={[0, 1, 0]} fontSize={0.2} color=\"#3b82f6\">OHÔü╗</Text>\r\n                </group>\r\n            </group>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒº¬ Stabilit├® Tampon\" className=\"w-[400px] border-emerald-500/30\">\r\n                    <div className=\"text-white\">\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <GradeBadge score={score} />\r\n                            {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={45} />}\r\n                        </div>\r\n\r\n                        <XPBar current={score} nextLevel={2000} />\r\n\r\n                        <div className=\"h-[1px] bg-gradient-to-r from-transparent via-emerald-500/50 to-transparent my-4\" />\r\n\r\n                        <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                        {phase === 'mission' && mission && (\r\n                            <MissionObjective objective={mission.objective} icon=\"­ƒº¬\" />\r\n                        )}\r\n\r\n                        <div className=\"mt-4 space-y-4\">\r\n                            <div className=\"bg-emerald-900/20 border border-emerald-500/30 p-3 rounded-xl flex justify-between items-center\">\r\n                                <div>\r\n                                    <div className=\"text-[10px] text-emerald-400 font-bold uppercase tracking-widest\">Tampon Actif</div>\r\n                                    <div className=\"text-[9px] text-gray-400 italic\">CHÔéâCOOH / CHÔéâCOOÔü╗</div>\r\n                                </div>\r\n                                <div className=\"text-right\">\r\n                                    <div className=\"text-[8px] text-gray-400\">pKa</div>\r\n                                    <div className=\"text-[14px] font-black\">{pKa}</div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-3\">\r\n                                <button onClick={() => setAddedAcid(a => a + 1)}\r\n                                    className=\"py-3 rounded-xl bg-gradient-to-b from-red-600 to-red-800 font-black text-[12px] shadow-lg shadow-red-600/20 hover:scale-105 active:scale-95 transition-all\">\r\n                                    + INJECT HCl\r\n                                </button>\r\n                                <button onClick={() => setAddedBase(b => b + 1)}\r\n                                    className=\"py-3 rounded-xl bg-gradient-to-b from-blue-600 to-blue-800 font-black text-[12px] shadow-lg shadow-blue-600/20 hover:scale-105 active:scale-95 transition-all\">\r\n                                    + INJECT NaOH\r\n                                </button>\r\n                            </div>\r\n\r\n                            <div className=\"bg-black/40 p-3 rounded-xl border border-white/5 grid grid-cols-3 gap-2\">\r\n                                <div className=\"text-center\">\r\n                                    <div className=\"text-[8px] text-gray-400 uppercase\">Doses HÔü║</div>\r\n                                    <div className=\"font-mono text-red-400 font-bold\">{addedAcid}</div>\r\n                                </div>\r\n                                <div className=\"text-center\">\r\n                                    <div className=\"text-[8px] text-gray-400 uppercase\">Doses OHÔü╗</div>\r\n                                    <div className=\"font-mono text-blue-400 font-bold\">{addedBase}</div>\r\n                                </div>\r\n                                <button onClick={reset} className=\"text-[8px] bg-gray-800 rounded font-bold hover:bg-gray-700 transition-colors\">RESET</button>\r\n                            </div>\r\n\r\n                            <div className=\"text-center py-1.5 bg-white/5 rounded border border-white/10\">\r\n                                <span className=\"text-[10px] text-gray-400\">Variation Totale: </span>\r\n                                <span className={`text-[10px] font-bold ${Math.abs(pHChange) < 0.5 ? 'text-emerald-400' : 'text-orange-400'}`}>\r\n                                    {pHChange > 0 ? '+' : ''}{pHChange.toFixed(2)} pH\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay\r\n                show={showSuccess}\r\n                message={`Mission termin├®e ! Pouvoir Tampon d├®montr├®.`}\r\n                points={500}\r\n                onNext={nextMission}\r\n            />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\DraggableHtmlPanel.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'defaultPosition'. Either include it or remove the dependency array.","line":51,"column":8,"nodeType":"ArrayExpression","endLine":51,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [defaultPosition, initialPos]","fix":{"range":[2282,2294],"text":"[defaultPosition, initialPos]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { createPortal } from 'react-dom';\r\n\r\n/**\r\n * Composant Panneau Draggable COMPL├êTEMENT D├ëTACH├ë de la sc├¿ne 3D\r\n * Utilise un portail React pour ├¬tre rendu en dehors du Canvas Three.js\r\n * \r\n * IMPORTANT: Ce composant est con├ºu pour ├¬tre utilis├® ├á l'int├®rieur de composants\r\n * qui sont rendus dans le Canvas R3F. Il utilise un portail pour \"s'├®chapper\"\r\n * du contexte Three.js et rendre son contenu HTML dans document.body.\r\n * \r\n * Features:\r\n * - Draggable (d├®pla├ºable avec souris et touch)\r\n * - Minimisable (r├®ductible)\r\n * - Fermable\r\n * - Position initiale intelligente (c├┤t├® droit sur desktop, en haut sur mobile)\r\n */\r\nconst DraggableHtmlPanel = ({ children, title, className = \"\", initialPos = null, onClose, usePortal = true, showCloseButton = false, defaultPosition = \"top-right\" }) => {\r\n    const [mounted, setMounted] = useState(false);\r\n    const [position, setPosition] = useState({ x: 20, y: 100 });\r\n    const [isDragging, setIsDragging] = useState(false);\r\n    const [dragStart, setDragStart] = useState({ x: 0, y: 0 });\r\n    const [isMinimized, setIsMinimized] = useState(false);\r\n    const [isClosed, setIsClosed] = useState(false);\r\n    const panelRef = useRef(null);\r\n\r\n    // Monter le composant c├┤t├® client uniquement\r\n    useEffect(() => {\r\n        // Utiliser un d├®lai court pour s'assurer que le DOM est pr├¬t\r\n        const timer = setTimeout(() => {\r\n            setMounted(true);\r\n            // D├®finir la position initiale c├┤t├® client\r\n            if (initialPos) {\r\n                setPosition(initialPos);\r\n            } else if (typeof window !== 'undefined') {\r\n                let x, y;\r\n                if (defaultPosition === \"bottom-center\") {\r\n                    x = window.innerWidth / 2 - 190; // Centr├® (largeur approx 380)\r\n                    y = window.innerHeight - 300; // En bas\r\n                } else {\r\n                    // Default top-right\r\n                    x = window.innerWidth > 768 ? window.innerWidth - 380 : 10;\r\n                    y = window.innerHeight > 600 ? 100 : 60;\r\n                }\r\n                setPosition({ x, y });\r\n            }\r\n        }, 50);\r\n\r\n        return () => clearTimeout(timer);\r\n    }, [initialPos]);\r\n\r\n    const handleMouseDown = useCallback((e) => {\r\n        if (e.target.closest('.no-drag')) return;\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        setIsDragging(true);\r\n        setDragStart({\r\n            x: e.clientX - position.x,\r\n            y: e.clientY - position.y\r\n        });\r\n    }, [position]);\r\n\r\n    const handleMouseMove = useCallback((e) => {\r\n        if (!isDragging) return;\r\n        e.preventDefault();\r\n\r\n        // Limiter le panneau dans les limites de l'├®cran\r\n        const newX = Math.max(0, Math.min(window.innerWidth - 100, e.clientX - dragStart.x));\r\n        const newY = Math.max(0, Math.min(window.innerHeight - 50, e.clientY - dragStart.y));\r\n\r\n        setPosition({ x: newX, y: newY });\r\n    }, [isDragging, dragStart]);\r\n\r\n    const handleMouseUp = useCallback(() => {\r\n        setIsDragging(false);\r\n    }, []);\r\n\r\n    const handleTouchStart = useCallback((e) => {\r\n        if (e.target.closest('.no-drag')) return;\r\n        const touch = e.touches[0];\r\n        setIsDragging(true);\r\n        setDragStart({\r\n            x: touch.clientX - position.x,\r\n            y: touch.clientY - position.y\r\n        });\r\n    }, [position]);\r\n\r\n    const handleTouchMove = useCallback((e) => {\r\n        if (!isDragging) return;\r\n        const touch = e.touches[0];\r\n\r\n        // Limiter le panneau dans les limites de l'├®cran\r\n        const newX = Math.max(0, Math.min(window.innerWidth - 100, touch.clientX - dragStart.x));\r\n        const newY = Math.max(0, Math.min(window.innerHeight - 50, touch.clientY - dragStart.y));\r\n\r\n        setPosition({ x: newX, y: newY });\r\n    }, [isDragging, dragStart]);\r\n\r\n    const handleClose = useCallback(() => {\r\n        setIsClosed(true);\r\n        if (onClose) onClose();\r\n    }, [onClose]);\r\n\r\n    useEffect(() => {\r\n        if (isDragging) {\r\n            // Utiliser l'option passive: false pour permettre preventDefault\r\n            const options = { passive: false };\r\n            window.addEventListener('mousemove', handleMouseMove, options);\r\n            window.addEventListener('mouseup', handleMouseUp);\r\n            window.addEventListener('touchmove', handleTouchMove, options);\r\n            window.addEventListener('touchend', handleMouseUp);\r\n        }\r\n        return () => {\r\n            window.removeEventListener('mousemove', handleMouseMove);\r\n            window.removeEventListener('mouseup', handleMouseUp);\r\n            window.removeEventListener('touchmove', handleTouchMove);\r\n            window.removeEventListener('touchend', handleMouseUp);\r\n        };\r\n    }, [isDragging, handleMouseMove, handleMouseUp, handleTouchMove]);\r\n\r\n    const [mountNode, setMountNode] = useState(null);\r\n\r\n    useEffect(() => {\r\n        if (typeof document === 'undefined') return;\r\n\r\n        // Initial set\r\n        setMountNode(document.fullscreenElement || document.body);\r\n\r\n        const handleFullscreenChange = () => {\r\n            setMountNode(document.fullscreenElement || document.body);\r\n        };\r\n\r\n        // Listen for fullscreen changes to re-parent the portal\r\n        document.addEventListener('fullscreenchange', handleFullscreenChange);\r\n        document.addEventListener('webkitfullscreenchange', handleFullscreenChange);\r\n        document.addEventListener('mozfullscreenchange', handleFullscreenChange);\r\n        document.addEventListener('msfullscreenchange', handleFullscreenChange);\r\n\r\n        return () => {\r\n            document.removeEventListener('fullscreenchange', handleFullscreenChange);\r\n            document.removeEventListener('webkitfullscreenchange', handleFullscreenChange);\r\n            document.removeEventListener('mozfullscreenchange', handleFullscreenChange);\r\n            document.removeEventListener('msfullscreenchange', handleFullscreenChange);\r\n        };\r\n    }, []);\r\n\r\n    // Ne pas rendre tant que le client n'est pas mont├® ou si ferm├®\r\n    // Retourne un fragment vide pour ├®viter les erreurs R3F avec les enfants null\r\n    if (!mounted || isClosed) return <></>;\r\n\r\n    // Ne pas essayer de cr├®er le portail si mountNode n'est pas d├®termin├®\r\n    if (!mountNode) return <></>;\r\n\r\n    const panelContent = (\r\n        <div\r\n            ref={panelRef}\r\n            className={`fixed bg-black/95 backdrop-blur-xl rounded-xl border border-white/30 shadow-2xl overflow-hidden transition-all duration-200 z-[9999] ${isDragging ? 'scale-[1.02] shadow-[0_0_30px_rgba(0,245,212,0.3)] cursor-grabbing' : ''} ${className}`}\r\n            style={{\r\n                left: `${position.x}px`,\r\n                top: `${position.y}px`,\r\n                minWidth: isMinimized ? '150px' : '240px',\r\n                maxWidth: '380px',\r\n                pointerEvents: 'auto',\r\n                userSelect: isDragging ? 'none' : 'auto'\r\n            }}\r\n            onMouseDown={(e) => e.stopPropagation()}\r\n            onClick={(e) => e.stopPropagation()}\r\n        >\r\n            {/* Header draggable */}\r\n            <div\r\n                className=\"flex items-center justify-between px-3 py-2 bg-gradient-to-r from-[#00F5D4]/30 to-purple-500/30 border-b border-white/20 cursor-grab active:cursor-grabbing select-none\"\r\n                onMouseDown={handleMouseDown}\r\n                onTouchStart={handleTouchStart}\r\n            >\r\n                <span className=\"text-sm font-bold text-[#00F5D4] flex items-center gap-1.5\">\r\n                    <span className=\"text-base\">Ôÿ░</span>\r\n                    {title || 'Contr├┤les'}\r\n                </span>\r\n                <div className=\"flex items-center gap-1\">\r\n                    {/* Bouton Minimiser */}\r\n                    <button\r\n                        onClick={() => setIsMinimized(!isMinimized)}\r\n                        className=\"no-drag w-6 h-6 rounded bg-white/10 hover:bg-white/20 flex items-center justify-center text-xs transition-all\"\r\n                        title={isMinimized ? \"Agrandir\" : \"R├®duire\"}\r\n                    >\r\n                        {isMinimized ? '­ƒö╝' : '­ƒö¢'}\r\n                    </button>\r\n                    {/* Bouton Fermer (Conditionnel) */}\r\n                    {showCloseButton && (\r\n                        <button\r\n                            onClick={handleClose}\r\n                            className=\"no-drag w-6 h-6 rounded bg-red-500/20 hover:bg-red-500/40 flex items-center justify-center text-xs text-red-400 transition-all\"\r\n                            title=\"Fermer\"\r\n                        >\r\n                            Ô£ò\r\n                        </button>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Contenu (cach├® si minimis├®) */}\r\n            {!isMinimized && (\r\n                <div className=\"p-3 max-h-[60vh] overflow-y-auto no-drag custom-scrollbar\">\r\n                    {children}\r\n                </div>\r\n            )}\r\n\r\n            {/* Indicateur de drag */}\r\n            {isDragging && (\r\n                <div className=\"absolute inset-0 border-2 border-[#00F5D4] rounded-xl pointer-events-none animate-pulse\" />\r\n            )}\r\n        </div>\r\n    );\r\n\r\n    // Si usePortal est false, rendre directement (pour compatibilit├® avec <Html> de drei)\r\n    if (!usePortal) {\r\n        return panelContent;\r\n    }\r\n\r\n    // Utiliser createPortal pour d├®tacher du contexte R3F\r\n    return createPortal(panelContent, mountNode);\r\n};\r\n\r\nexport default DraggableHtmlPanel;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\DraggableHtmlPanelWrapper.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\EnhancedQuiz.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\ExternalControlPanel.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\FeatureCard.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\Footer.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\GamificationUtils.js","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":39,"column":40,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[2436,2515],"text":"\r\n                            Continuer l&apos;aventure ­ƒÜÇ\r\n                        "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[2436,2515],"text":"\r\n                            Continuer l&lsquo;aventure ­ƒÜÇ\r\n                        "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[2436,2515],"text":"\r\n                            Continuer l&#39;aventure ­ƒÜÇ\r\n                        "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[2436,2515],"text":"\r\n                            Continuer l&rsquo;aventure ­ƒÜÇ\r\n                        "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport React, { useRef, useState, useEffect } from 'react';\r\nimport { useFrame } from '@react-three/fiber';\r\nimport { Html, Sphere } from '@react-three/drei';\r\nimport * as THREE from 'three';\r\n\r\n// ============================================================\r\n// COMPOSANTS GAMIFICATION PARTAG├ëS\r\n// ============================================================\r\n\r\n/**\r\n * Overlay de succ├¿s affich├® via un portail HTML\r\n * @param {boolean} show - Afficher l'overlay\r\n * @param {string} message - Message de f├®licitations\r\n * @param {number} points - Points gagn├®s\r\n * @param {function} onNext - Fonction callback pour continuer\r\n */\r\nexport function SuccessOverlay({ show, message, points, onNext }) {\r\n    if (!show) return null;\r\n    return (\r\n        <Html center style={{ pointerEvents: 'none' }} zIndexRange={[1000, 0]}>\r\n            <div className=\"flex flex-col items-center justify-center p-4\" style={{ width: '100vw', height: '100vh', pointerEvents: 'none' }}>\r\n                <div className=\"bg-black/90 backdrop-blur-md p-8 rounded-3xl border-4 border-yellow-500 text-center shadow-[0_0_50px_rgba(234,179,8,0.5)] transform transition-all animate-in zoom-in slide-in-from-bottom-10 fade-in duration-500 pointer-events-auto\">\r\n                    <div className=\"text-6xl mb-4 animate-bounce\">­ƒÅå</div>\r\n                    <div className=\"text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 via-orange-400 to-yellow-300 mb-2\">\r\n                        EXCELLENT !\r\n                    </div>\r\n                    <div className=\"text-white text-xl mb-6 font-medium max-w-md mx-auto\">{message}</div>\r\n\r\n                    {points && (\r\n                        <div className=\"bg-gradient-to-r from-yellow-900/50 to-orange-900/50 rounded-xl p-4 mb-6 border border-yellow-500/30\">\r\n                            <div className=\"text-yellow-400 font-mono text-xs uppercase tracking-wider mb-1\">R├®compense</div>\r\n                            <div className=\"text-4xl font-bold text-white drop-shadow-md\">+{points} XP</div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {onNext && (\r\n                        <button onClick={onNext} className=\"w-full py-4 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl text-white font-bold text-xl hover:scale-105 hover:shadow-lg hover:shadow-green-500/30 transition-all flex items-center justify-center gap-2\">\r\n                            Continuer l'aventure ­ƒÜÇ\r\n                        </button>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </Html>\r\n    );\r\n}\r\n\r\n/**\r\n * Timer visuel pour les d├®fis\r\n * @param {number} timeLeft - Temps restant en secondes\r\n * @param {number} maxTime - Temps total initial (pour la barre de progression)\r\n */\r\nexport function ChallengeTimer({ timeLeft, maxTime }) {\r\n    const progress = Math.max(0, Math.min(1, timeLeft / maxTime));\r\n    const color = progress > 0.5 ? '#4ADE80' : progress > 0.25 ? '#FBBF24' : '#EF4444';\r\n\r\n    return (\r\n        <div className=\"flex items-center gap-2 bg-black/40 rounded-lg px-3 py-1\">\r\n            <div className=\"text-lg\">ÔÅ▒´©Å</div>\r\n            <div className=\"w-24 h-2 bg-gray-700 rounded-full overflow-hidden\">\r\n                <div\r\n                    className=\"h-full transition-all duration-300 transform origin-left\"\r\n                    style={{ width: `${progress * 100}%`, backgroundColor: color }}\r\n                />\r\n            </div>\r\n            <div className=\"font-mono text-sm w-8 text-right\" style={{ color }}>{timeLeft}s</div>\r\n        </div>\r\n    );\r\n}\r\n\r\n/**\r\n * Explosion de confettis en 3D\r\n * @param {boolean} active - D├®clenche l'animation\r\n */\r\nexport function ConfettiExplosion({ active }) {\r\n    if (!active) return null;\r\n    return (\r\n        <group>\r\n            {Array.from({ length: 80 }).map((_, i) => (\r\n                <ConfettiParticle key={i} />\r\n            ))}\r\n            <pointLight position={[0, 5, 0]} intensity={2} color=\"#FFD700\" distance={10} decay={2} />\r\n        </group>\r\n    );\r\n}\r\n\r\nfunction ConfettiParticle() {\r\n    const ref = useRef();\r\n    const [data] = useState(() => ({\r\n        pos: [0, 0, 0],\r\n        vel: [(Math.random() - 0.5) * 8, Math.random() * 8 + 5, (Math.random() - 0.5) * 8],\r\n        rot: [Math.random(), Math.random(), Math.random()],\r\n        color: ['#FCD34D', '#F472B6', '#60A5FA', '#34D399', '#A78BFA'][Math.floor(Math.random() * 5)],\r\n        spin: [(Math.random() - 0.5) * 10, (Math.random() - 0.5) * 10]\r\n    }));\r\n\r\n    useFrame((state, delta) => {\r\n        if (ref.current) {\r\n            ref.current.position.x += data.vel[0] * delta;\r\n            ref.current.position.y += data.vel[1] * delta;\r\n            ref.current.position.z += data.vel[2] * delta;\r\n            ref.current.rotation.x += data.spin[0] * delta;\r\n            ref.current.rotation.y += data.spin[1] * delta;\r\n            data.vel[1] -= 9.8 * delta; // Gravity\r\n        }\r\n    });\r\n\r\n    return (\r\n        <mesh ref={ref} position={data.pos} rotation={data.rot}>\r\n            <planeGeometry args={[0.15, 0.15]} />\r\n            <meshBasicMaterial color={data.color} side={THREE.DoubleSide} />\r\n        </mesh>\r\n    );\r\n}\r\n\r\n/**\r\n * Tra├«n├®e de particules pour les objets en mouvement\r\n * @param {boolean} active - Active l'├®mission\r\n * @param {string} color - Couleur des particules\r\n * @param {number} count - Nombre de particules\r\n */\r\nexport function ParticleTrail({ active, color = '#FFD700', count = 30 }) {\r\n    const particles = useRef([]);\r\n\r\n    useFrame((state) => {\r\n        if (!active) return;\r\n        particles.current.forEach((p, i) => {\r\n            if (p) {\r\n                p.position.y += Math.sin(state.clock.elapsedTime * 2 + i) * 0.02;\r\n                p.rotation.z += 0.05;\r\n            }\r\n        });\r\n    });\r\n\r\n    if (!active) return null;\r\n\r\n    return (\r\n        <group>\r\n            {Array.from({ length: count }).map((_, i) => (\r\n                <Sphere\r\n                    key={i}\r\n                    ref={el => particles.current[i] = el}\r\n                    args={[0.05]}\r\n                    position={[\r\n                        (Math.random() - 0.5) * 6,\r\n                        (Math.random() - 0.5) * 4,\r\n                        (Math.random() - 0.5) * 2\r\n                    ]}\r\n                >\r\n                    <meshStandardMaterial color={color} emissive={color} emissiveIntensity={0.8} transparent opacity={0.7} />\r\n                </Sphere>\r\n            ))}\r\n        </group>\r\n    );\r\n}\r\n/**\r\n * Badge de Grade dynamique\r\n */\r\nexport function GradeBadge({ score }) {\r\n    const getGrade = (s) => {\r\n        if (s >= 2000) return { name: 'Ma├«tre des Sciences ­ƒºá', color: '#f59e0b', bg: 'rgba(245,158,11,0.2)' };\r\n        if (s >= 1000) return { name: 'Expert Scientifique ­ƒæ¿ÔÇì­ƒö¼', color: '#8b5cf6', bg: 'rgba(139,92,246,0.2)' };\r\n        if (s >= 500) return { name: 'Ing├®nieur Senior ­ƒøá´©Å', color: '#22d3ee', bg: 'rgba(34,211,238,0.2)' };\r\n        return { name: 'Apprenti Chercheur ­ƒö¡', color: '#4ade80', bg: 'rgba(74,222,128,0.2)' };\r\n    };\r\n\r\n    const grade = getGrade(score);\r\n\r\n    return (\r\n        <div style={{\r\n            background: grade.bg,\r\n            border: `1px solid ${grade.color}`,\r\n            color: grade.color,\r\n            padding: '4px 12px',\r\n            borderRadius: '20px',\r\n            fontSize: '11px',\r\n            fontWeight: 'bold',\r\n            textTransform: 'uppercase',\r\n            letterSpacing: '1px',\r\n            display: 'inline-flex',\r\n            alignItems: 'center',\r\n            gap: '6px'\r\n        }}>\r\n            {grade.name}\r\n        </div>\r\n    );\r\n}\r\n\r\n/**\r\n * Barre d'XP fluide\r\n */\r\nexport function XPBar({ current, nextLevel }) {\r\n    const progress = Math.min(100, (current / nextLevel) * 100);\r\n    return (\r\n        <div className=\"w-full mt-2\">\r\n            <div className=\"flex justify-between text-[10px] text-gray-400 mb-1 px-1\">\r\n                <span>XP PROGRESSION</span>\r\n                <span>{current} / {nextLevel}</span>\r\n            </div>\r\n            <div className=\"w-full h-1 bg-gray-800 rounded-full overflow-hidden\">\r\n                <div\r\n                    className=\"h-full bg-gradient-to-r from-blue-500 via-cyan-400 to-emerald-400 transition-all duration-1000\"\r\n                    style={{ width: `${progress}%` }}\r\n                />\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n/**\r\n * S├®lecteur de phase (Exploration / Entra├«nement / Mission)\r\n */\r\nexport function PhaseSelector({ currentPhase, onSelect }) {\r\n    const phases = [\r\n        { id: 'explore', label: '­ƒö¡ Explorer', color: '#94a3b8' },\r\n        { id: 'train', label: '­ƒÄô S\\'entra├«ner', color: '#6366f1' },\r\n        { id: 'mission', label: 'ÔÜí MISSION', color: '#f59e0b', bold: true }\r\n    ];\r\n\r\n    return (\r\n        <div className=\"flex p-1 bg-black/40 rounded-xl mb-4\">\r\n            {phases.map(p => (\r\n                <button\r\n                    key={p.id}\r\n                    onClick={() => onSelect(p.id)}\r\n                    className={`flex-1 py-1.5 px-2 rounded-lg text-[10px] font-bold transition-all ${currentPhase === p.id\r\n                        ? 'bg-white/10 text-white shadow-lg'\r\n                        : 'text-gray-500 hover:text-gray-300'\r\n                        }`}\r\n                    style={{ color: currentPhase === p.id ? (p.bold ? p.color : 'white') : '' }}\r\n                >\r\n                    {p.label}\r\n                </button>\r\n            ))}\r\n        </div>\r\n    );\r\n}\r\n\r\n/**\r\n * Objectif de mission holographique\r\n */\r\nexport function MissionObjective({ objective, icon = \"­ƒÄ»\" }) {\r\n    return (\r\n        <div className=\"relative overflow-hidden group\">\r\n            <div className=\"absolute inset-0 bg-blue-500/5 group-hover:bg-blue-500/10 transition-colors\" />\r\n            <div className=\"relative p-3 border-l-4 border-blue-500 bg-gradient-to-r from-blue-500/10 to-transparent\">\r\n                <div className=\"flex items-start gap-2\">\r\n                    <span className=\"text-xl animate-pulse\">{icon}</span>\r\n                    <div>\r\n                        <div className=\"text-[10px] font-bold text-blue-400 uppercase tracking-tighter\">Objectif en cours</div>\r\n                        <div className=\"text-white text-sm font-medium leading-tight\">{objective}</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            {/* Holographic scanline effect */}\r\n            <div className=\"absolute inset-0 pointer-events-none opacity-20\">\r\n                <div className=\"w-full h-[1px] bg-blue-400 animate-[scan_3s_linear_infinite]\" />\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\HeroSection.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\MathDisplay.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\MobileBottomNav.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\ModuleBlock.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\ModuleCard.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\Navbar.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\PC3eChapter1to5.js","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":82,"column":122,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[4097,4118],"text":"Laboratoire d&apos;Optique"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[4097,4118],"text":"Laboratoire d&lsquo;Optique"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[4097,4118],"text":"Laboratoire d&#39;Optique"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[4097,4118],"text":"Laboratoire d&rsquo;Optique"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":202,"column":108,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[12678,12680],"text":"F&apos;"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[12678,12680],"text":"F&lsquo;"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[12678,12680],"text":"F&#39;"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[12678,12680],"text":"F&rsquo;"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":228,"column":120,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[14292,14302],"text":"IMAGE (A&apos;)"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[14292,14302],"text":"IMAGE (A&lsquo;)"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[14292,14302],"text":"IMAGE (A&#39;)"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[14292,14302],"text":"IMAGE (A&rsquo;)"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":363,"column":131,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[22406,22435],"text":"Afficher l&apos;├®talement spectral"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[22406,22435],"text":"Afficher l&lsquo;├®talement spectral"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[22406,22435],"text":"Afficher l&#39;├®talement spectral"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[22406,22435],"text":"Afficher l&rsquo;├®talement spectral"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":929,"column":90,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[55459,55479],"text":"ÔÜí FROTTER L&apos;OBJET ! "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[55459,55479],"text":"ÔÜí FROTTER L&lsquo;OBJET ! "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[55459,55479],"text":"ÔÜí FROTTER L&#39;OBJET ! "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[55459,55479],"text":"ÔÜí FROTTER L&rsquo;OBJET ! "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport { useState, useRef, useEffect, useMemo } from 'react';\r\nimport { useFrame } from '@react-three/fiber';\r\nimport { Text, Html, Sphere, Box, Cylinder, Line, Float } from '@react-three/drei';\r\nimport DraggableHtmlPanel from './DraggableHtmlPanel';\r\nimport { SuccessOverlay, ConfettiExplosion, ChallengeTimer, GradeBadge, XPBar, PhaseSelector, MissionObjective } from './GamificationUtils';\r\nimport * as THREE from 'three';\r\n\r\n// ============================================================\r\n// CHAPITRE 1: LENTILLES MINCES (PC 3e)\r\n// ============================================================\r\nexport function Chap1LentillesMCE() {\r\n    const [lensType, setLensType] = useState('convergente');\r\n    const [focalLength, setFocalLength] = useState(3);\r\n    const [objectDistance, setObjectDistance] = useState(6);\r\n    const [showRays, setShowRays] = useState(true);\r\n    const [mode, setMode] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [challenge, setChallenge] = useState(null);\r\n\r\n    const scenarios = {\r\n        loupe: { name: 'Loupe', icon: '­ƒöì', f: 2, d: 4, type: 'convergente', desc: 'Grossir un texte' },\r\n        oeil: { name: '┼Æil Humain', icon: '­ƒæü´©Å', f: 1.7, d: 10, type: 'convergente', desc: 'Vision normale' },\r\n        myope: { name: 'Correction', icon: '­ƒæô', f: -3, d: 8, type: 'divergente', desc: 'Lentille divergente' },\r\n        appareil: { name: 'Cam├®ra', icon: '­ƒôÀ', f: 5, d: 20, type: 'convergente', desc: 'Focus infini' }\r\n    };\r\n\r\n    const challenges = [\r\n        { q: \"Une lentille convergente est plus ├®paisse :\", options: [\"Au bord\", \"Au centre\", \"Au centre et au bord\"], ans: 1, icon: \"­ƒöì\" },\r\n        { q: \"Les rayons parall├¿les convergent vers :\", options: [\"Le centre O\", \"Le foyer image F'\", \"Le foyer objet F\"], ans: 1, icon: \"­ƒÄ»\" },\r\n        { q: \"Un rayon passant par le centre O est :\", options: [\"D├®vi├® vers F'\", \"Non d├®vi├®\", \"R├®fl├®chi ├á 90┬░\"], ans: 1, icon: \"­ƒôÅ\" },\r\n        { q: \"La vergence C = 1/f est exprim├®e en :\", options: [\"M├¿tres\", \"Dioptries (╬┤)\", \"Newtons\"], ans: 1, icon: \"ÔÜí\" }\r\n    ];\r\n\r\n    const applyScenario = (key) => {\r\n        const sc = scenarios[key];\r\n        setLensType(sc.type);\r\n        setFocalLength(Math.abs(sc.f));\r\n        setObjectDistance(sc.d);\r\n    };\r\n\r\n    const startChallenge = () => {\r\n        setMode('challenge');\r\n        setScore(0);\r\n        nextQuestion();\r\n    };\r\n\r\n    const nextQuestion = () => {\r\n        const rand = Math.floor(Math.random() * challenges.length);\r\n        setChallenge({ ...challenges[rand], answered: false });\r\n        setShowSuccess(false);\r\n    };\r\n\r\n    const checkAnswer = (idx) => {\r\n        if (!challenge || challenge.answered) return;\r\n        if (idx === challenge.ans) {\r\n            setScore(s => s + 25);\r\n            setShowSuccess(true);\r\n        } else {\r\n            alert(\"Analyse incorrecte. R├®vise les propri├®t├®s des rayons !\");\r\n        }\r\n        setChallenge({ ...challenge, answered: true });\r\n    };\r\n\r\n    const isConvergent = lensType === 'convergente';\r\n    const f = isConvergent ? focalLength : -focalLength;\r\n    const imageDistance = objectDistance * f / (objectDistance - f);\r\n    const magnification = -imageDistance / objectDistance;\r\n    const isRealImage = isConvergent && objectDistance > focalLength;\r\n\r\n    return (\r\n        <group>\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒö¡ Opticien Expert\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[400px] border-cyan-500/30 text-white\">\r\n                    <div className=\"mb-4\">\r\n                        <PhaseSelector currentPhase={mode} onSelect={(m) => m === 'challenge' ? startChallenge() : setMode('explore')} />\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-between items-center mb-4 border-b border-white/10 pb-2\">\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-[10px] text-cyan-400 font-bold uppercase tracking-widest\">Laboratoire d'Optique</span>\r\n                            <span className=\"text-lg font-black\">{mode === 'explore' ? '├ëtude des Lentilles' : 'D├®fi de Focalisation ­ƒºá'}</span>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {mode === 'explore' ? (\r\n                        <div className=\"space-y-4\">\r\n                            <MissionObjective objective=\"Trouvez la configuration id├®ale pour projeter une image nette.\" icon=\"­ƒöì\" />\r\n\r\n                            <div className=\"grid grid-cols-4 gap-2\">\r\n                                {Object.entries(scenarios).map(([key, sc]) => (\r\n                                    <button key={key} onClick={() => applyScenario(key)}\r\n                                        className=\"p-2 bg-gray-900 border border-white/5 rounded-xl flex flex-col items-center gap-1 hover:bg-cyan-900/40 transition-all\">\r\n                                        <span className=\"text-xl\">{sc.icon}</span>\r\n                                        <span className=\"text-[8px] font-black uppercase text-center\">{sc.name}</span>\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n\r\n                            <div className=\"space-y-4 bg-black/40 p-4 rounded-xl border border-white/5\">\r\n                                <div className=\"flex gap-2\">\r\n                                    <button onClick={() => setLensType('convergente')}\r\n                                        className={`flex-1 py-3 rounded-lg text-[10px] font-black uppercase tracking-tighter transition-all ${lensType === 'convergente' ? 'bg-cyan-500 text-white shadow-lg' : 'bg-gray-800 text-gray-500'}`}>\r\n                                        Ôèò Convergente\r\n                                    </button>\r\n                                    <button onClick={() => setLensType('divergente')}\r\n                                        className={`flex-1 py-3 rounded-lg text-[10px] font-black uppercase tracking-tighter transition-all ${lensType === 'divergente' ? 'bg-red-500 text-white shadow-lg' : 'bg-gray-800 text-gray-500'}`}>\r\n                                        Ôèû Divergente\r\n                                    </button>\r\n                                </div>\r\n\r\n                                <div>\r\n                                    <div className=\"flex justify-between text-[10px] font-bold text-gray-500 mb-2\">\r\n                                        <span>DISTANCE FOCALE (f)</span>\r\n                                        <span className=\"text-cyan-400\">{focalLength} CM</span>\r\n                                    </div>\r\n                                    <input type=\"range\" min=\"1\" max=\"8\" step=\"0.5\" value={focalLength} onChange={(e) => setFocalLength(parseFloat(e.target.value))}\r\n                                        className=\"w-full h-2 bg-gray-800 rounded-lg appearance-none cursor-pointer accent-cyan-500\" />\r\n                                </div>\r\n\r\n                                <div>\r\n                                    <div className=\"flex justify-between text-[10px] font-bold text-gray-500 mb-2\">\r\n                                        <span>DISTANCE OBJET (OA)</span>\r\n                                        <span className=\"text-orange-400\">{objectDistance} CM</span>\r\n                                    </div>\r\n                                    <input type=\"range\" min=\"2\" max=\"15\" step=\"0.5\" value={objectDistance} onChange={(e) => setObjectDistance(parseFloat(e.target.value))}\r\n                                        className=\"w-full h-2 bg-gray-800 rounded-lg appearance-none cursor-pointer accent-orange-500\" />\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-2\">\r\n                                <div className=\"p-3 bg-cyan-950/30 rounded-lg border border-cyan-500/20 text-center\">\r\n                                    <div className=\"text-[8px] text-cyan-400 font-black uppercase\">Position Image</div>\r\n                                    <div className=\"text-xl font-mono font-black\">{imageDistance.toFixed(1)} cm</div>\r\n                                </div>\r\n                                <div className=\"p-3 bg-indigo-950/30 rounded-lg border border-indigo-500/20 text-center\">\r\n                                    <div className=\"text-[8px] text-indigo-400 font-black uppercase\">Grandissement</div>\r\n                                    <div className=\"text-xl font-mono font-black\">╬│ = {magnification.toFixed(2)}</div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className={`p-3 rounded-xl text-center text-[10px] font-black uppercase tracking-wider ${isRealImage ? 'bg-green-500/20 text-green-400 border border-green-500/30' : 'bg-orange-500/20 text-orange-400 border border-orange-500/30'}`}>\r\n                                {isRealImage ? 'Ô£à IMAGE R├ëELLE : PROJETABLE SUR ├ëCRAN' : 'ÔÜí IMAGE VIRTUELLE : OBSERVABLE ├Ç TRAVERS LA LENTILLE'}\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"space-y-4\">\r\n                            {challenge && <MissionObjective objective={challenge.q} icon={challenge.icon} />}\r\n                            <div className=\"space-y-2\">\r\n                                {challenge?.options.map((opt, idx) => (\r\n                                    <button key={idx} onClick={() => checkAnswer(idx)}\r\n                                        disabled={challenge.answered}\r\n                                        className={`w-full p-4 rounded-xl text-left text-sm font-bold transition-all flex justify-between items-center group\r\n                                            ${challenge.answered\r\n                                                ? idx === challenge.ans ? 'bg-green-500 text-white' : 'bg-gray-800/50 text-gray-500'\r\n                                                : 'bg-white/5 hover:bg-cyan-500 hover:text-white border border-white/10'\r\n                                            }`}>\r\n                                        {opt}\r\n                                        {challenge.answered && idx === challenge.ans ? 'Ô£à' : 'Ô×£'}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n                            {challenge?.answered && (\r\n                                <button onClick={nextQuestion} className=\"w-full py-4 bg-cyan-600 rounded-xl font-black uppercase text-xs tracking-widest shadow-lg shadow-cyan-900/40\">\r\n                                    Mission Suivante Ô×£\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <XPBar current={score % 100} nextLevel={100} />\r\n            <SuccessOverlay show={showSuccess} message=\"Alignement Optique R├®ussi ! Ton image est d'une nettet├® absolue.\" points={25} onNext={nextQuestion} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            <Line points={[[-10, 0, 0], [10, 0, 0]]} color=\"white\" lineWidth={1} dashed dashScale={10} transparent opacity={0.3} />\r\n\r\n            <group position={[0, 0, 0]}>\r\n                <mesh rotation={[0, Math.PI / 2, 0]}>\r\n                    <torusGeometry args={[2, 0.05, 16, 64]} />\r\n                    <meshStandardMaterial color={isConvergent ? \"#22D3EE\" : \"#F43F5E\"} transparent opacity={0.8} />\r\n                </mesh>\r\n                <Text position={[0, 3, 0]} fontSize={0.3} color=\"white\" font=\"/fonts/Inter-Bold.ttf\">\r\n                    LENTILLE {lensType.toUpperCase()}\r\n                </Text>\r\n            </group>\r\n\r\n            <group position={[-focalLength, 0, 0]}>\r\n                <Sphere args={[0.1]}>\r\n                    <meshStandardMaterial color=\"yellow\" emissive=\"yellow\" emissiveIntensity={2} />\r\n                </Sphere>\r\n                <Text position={[0, -0.5, 0]} fontSize={0.25} color=\"yellow\" font=\"/fonts/Inter-Bold.ttf\">F</Text>\r\n            </group>\r\n\r\n            <group position={[focalLength, 0, 0]}>\r\n                <Sphere args={[0.1]}>\r\n                    <meshStandardMaterial color=\"orange\" emissive=\"orange\" emissiveIntensity={2} />\r\n                </Sphere>\r\n                <Text position={[0, -0.5, 0]} fontSize={0.25} color=\"orange\" font=\"/fonts/Inter-Bold.ttf\">F'</Text>\r\n            </group>\r\n\r\n            <group position={[-objectDistance, 0, 0]}>\r\n                <Line points={[[0, 0, 0], [0, 1.5, 0]]} color=\"#F59E0B\" lineWidth={5} />\r\n                <mesh position={[0, 1.6, 0]}>\r\n                    <coneGeometry args={[0.15, 0.3, 8]} />\r\n                    <meshStandardMaterial color=\"#F59E0B\" />\r\n                </mesh>\r\n                <Text position={[0, -0.5, 0]} fontSize={0.25} color=\"#F59E0B\" font=\"/fonts/Inter-Bold.ttf\">OBJET (A)</Text>\r\n            </group>\r\n\r\n            {showRays && isConvergent && (\r\n                <group>\r\n                    <Line points={[[-objectDistance, 1.5, 0], [0, 1.5, 0], [focalLength * 3, -1.5, 0]]} color=\"yellow\" lineWidth={2} transparent opacity={0.6} />\r\n                    <Line points={[[-objectDistance, 1.5, 0], [0, 0, 0], [imageDistance, -1.5 * (imageDistance / objectDistance), 0]]} color=\"cyan\" lineWidth={2} transparent opacity={0.6} />\r\n                </group>\r\n            )}\r\n\r\n            {isRealImage && (\r\n                <group position={[imageDistance, 0, 0]}>\r\n                    <Line points={[[0, 0, 0], [0, 1.5 * magnification, 0]]} color=\"#22D3EE\" lineWidth={5} />\r\n                    <mesh position={[0, 1.5 * magnification + (magnification < 0 ? -0.1 : 0.1), 0]} rotation={[0, 0, magnification < 0 ? Math.PI : 0]}>\r\n                        <coneGeometry args={[0.15, 0.3, 8]} />\r\n                        <meshStandardMaterial color=\"#22D3EE\" />\r\n                    </mesh>\r\n                    <Text position={[0, -0.5, 0]} fontSize={0.25} color=\"#22D3EE\" font=\"/fonts/Inter-Bold.ttf\">IMAGE (A')</Text>\r\n                </group>\r\n            )}\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// CHAPITRE 2: DISPERSION DE LA LUMI├êRE (PC 3e)\r\n// ============================================================\r\nexport function Chap2DispersionLumiere() {\r\n    const [prismAngle, setPrismAngle] = useState(60);\r\n    const [lightType, setLightType] = useState('white');\r\n    const [showSpectrum, setShowSpectrum] = useState(true);\r\n    const [mode, setMode] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [challenge, setChallenge] = useState(null);\r\n\r\n    const spectrumColors = ['#ff0000', '#ff7700', '#ffff00', '#00ff00', '#0000ff', '#4b0082', '#9400d3'];\r\n    const colorNames = ['Rouge', 'Orange', 'Jaune', 'Vert', 'Bleu', 'Indigo', 'Violet'];\r\n\r\n    const scenarios = {\r\n        arcenciel: { name: 'Arc-en-ciel', icon: '­ƒîê', angle: 42, light: 'white', desc: 'Dispersion de l\\'eau' },\r\n        prisme: { name: 'Prisme Newton', icon: '­ƒö║', angle: 60, light: 'white', desc: 'Lumi├¿re blanche' },\r\n        laser: { name: 'Laser Rouge', icon: '­ƒö┤', angle: 60, light: 'red', desc: 'Monochromatique' },\r\n        cd: { name: 'CD / DVD', icon: '­ƒÆ┐', angle: 20, light: 'white', desc: 'Effet iris├®' }\r\n    };\r\n\r\n    const challenges = [\r\n        { q: \"Combien de couleurs principales compte l'arc-en-ciel ?\", options: [\"5\", \"7\", \"9\"], ans: 1, icon: \"­ƒîê\" },\r\n        { q: \"Quelle couleur du spectre est la plus d├®vi├®e par un prisme ?\", options: [\"Le Rouge\", \"Le Vert\", \"Le Violet\"], ans: 2, icon: \"­ƒôÉ\" },\r\n        { q: \"La lumi├¿re blanche est qualifi├®e de :\", options: [\"Monochromatique\", \"Polychromatique\", \"Infrarouge\"], ans: 1, icon: \"ÔÿÇ´©Å\" },\r\n        { q: \"Le sigle ROY G. BIV aide ├á m├®moriser :\", options: [\"Les plan├¿tes\", \"L'ordre des couleurs\", \"Les gaz nobles\"], ans: 1, icon: \"­ƒºá\" }\r\n    ];\r\n\r\n    const applyScenario = (key) => {\r\n        const sc = scenarios[key];\r\n        setPrismAngle(sc.angle);\r\n        setLightType(sc.light);\r\n    };\r\n\r\n    const startChallenge = () => {\r\n        setMode('challenge');\r\n        setScore(0);\r\n        nextQuestion();\r\n    };\r\n\r\n    const nextQuestion = () => {\r\n        const rand = Math.floor(Math.random() * challenges.length);\r\n        setChallenge({ ...challenges[rand], answered: false });\r\n        setShowSuccess(false);\r\n    };\r\n\r\n    const checkAnswer = (idx) => {\r\n        if (!challenge || challenge.answered) return;\r\n        if (idx === challenge.ans) {\r\n            setScore(s => s + 25);\r\n            setShowSuccess(true);\r\n        } else {\r\n            alert(\"R├®ponse incorrecte. Rappelle-toi : VIBGYOR !\");\r\n        }\r\n        setChallenge({ ...challenge, answered: true });\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒîê Expert en Lumi├¿re\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[400px] border-purple-500/30 text-white\">\r\n                    <div className=\"mb-4\">\r\n                        <PhaseSelector currentPhase={mode} onSelect={(m) => m === 'challenge' ? startChallenge() : setMode('explore')} />\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-between items-center mb-4 border-b border-white/10 pb-2\">\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-[10px] text-purple-400 font-bold uppercase tracking-widest\">Ph├®nom├¿nes Optiques</span>\r\n                            <span className=\"text-lg font-black\">{mode === 'explore' ? 'Dispersion & Spectres' : 'D├®fi Spectroscopie ­ƒºá'}</span>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {mode === 'explore' ? (\r\n                        <div className=\"space-y-4\">\r\n                            <MissionObjective objective=\"Utilisez le prisme pour d├®composer la lumi├¿re blanche.\" icon=\"ÔÿÇ´©Å\" />\r\n\r\n                            <div className=\"grid grid-cols-4 gap-2\">\r\n                                {Object.entries(scenarios).map(([key, sc]) => (\r\n                                    <button key={key} onClick={() => applyScenario(key)}\r\n                                        className=\"p-2 bg-gray-900 border border-white/5 rounded-xl flex flex-col items-center gap-1 hover:bg-purple-900/40 transition-all\">\r\n                                        <span className=\"text-xl\">{sc.icon}</span>\r\n                                        <span className=\"text-[8px] font-black uppercase text-center\">{sc.name}</span>\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n\r\n                            <div className=\"space-y-4 bg-black/40 p-4 rounded-xl border border-white/5\">\r\n                                <div>\r\n                                    <div className=\"flex justify-between text-[10px] font-bold text-gray-500 mb-2\">\r\n                                        <span>ANGLE DU PRISME</span>\r\n                                        <span className=\"text-purple-400\">{prismAngle}┬░</span>\r\n                                    </div>\r\n                                    <input type=\"range\" min=\"30\" max=\"90\" value={prismAngle} onChange={(e) => setPrismAngle(parseInt(e.target.value))}\r\n                                        className=\"w-full h-2 bg-gray-800 rounded-lg appearance-none cursor-pointer accent-purple-500\" />\r\n                                </div>\r\n\r\n                                <div className=\"flex gap-1\">\r\n                                    {['white', 'red', 'green', 'blue'].map((type) => (\r\n                                        <button key={type} onClick={() => setLightType(type)}\r\n                                            className={`flex-1 py-2 rounded-lg text-[8px] font-black uppercase transition-all ${lightType === type ? 'bg-white text-black' : 'bg-gray-800 text-gray-400'}`}>\r\n                                            {type === 'white' ? 'Blanche' : type}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n\r\n                            {showSpectrum && lightType === 'white' && (\r\n                                <div className=\"p-4 bg-black/60 rounded-xl border border-white/10 space-y-3\">\r\n                                    <div className=\"text-[8px] text-gray-400 font-black uppercase tracking-widest text-center\">Spectre du Visible</div>\r\n                                    <div className=\"flex h-10 rounded-lg overflow-hidden shadow-inner\">\r\n                                        {spectrumColors.map((color, i) => (\r\n                                            <div key={i} className=\"flex-1 transition-transform hover:scale-110\" style={{ backgroundColor: color }} />\r\n                                        ))}\r\n                                    </div>\r\n                                    <div className=\"flex justify-between px-2\">\r\n                                        <span className=\"text-[8px] text-red-500 font-bold\">~780nm</span>\r\n                                        <span className=\"text-[8px] text-purple-500 font-bold\">~380nm</span>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n\r\n                            <label className=\"flex items-center gap-2 cursor-pointer group px-1\">\r\n                                <div className={`w-5 h-5 rounded border-2 flex items-center justify-center transition-all ${showSpectrum ? 'border-purple-400 bg-purple-400' : 'border-white/20'}`}\r\n                                    onClick={() => setShowSpectrum(!showSpectrum)}>\r\n                                    {showSpectrum && <span className=\"text-black text-[10px]\">Ô£ö</span>}\r\n                                </div>\r\n                                <span className=\"text-[10px] font-black uppercase text-gray-400 group-hover:text-white\">Afficher l'├®talement spectral</span>\r\n                            </label>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"space-y-4\">\r\n                            {challenge && <MissionObjective objective={challenge.q} icon={challenge.icon} />}\r\n                            <div className=\"space-y-2\">\r\n                                {challenge?.options.map((opt, idx) => (\r\n                                    <button key={idx} onClick={() => checkAnswer(idx)}\r\n                                        disabled={challenge.answered}\r\n                                        className={`w-full p-4 rounded-xl text-left text-sm font-bold transition-all flex justify-between items-center group\r\n                                            ${challenge.answered\r\n                                                ? idx === challenge.ans ? 'bg-green-500 text-white' : 'bg-gray-800/50 text-gray-500'\r\n                                                : 'bg-white/5 hover:bg-purple-500 hover:text-white border border-white/10'\r\n                                            }`}>\r\n                                        {opt}\r\n                                        {challenge.answered && idx === challenge.ans ? 'Ô£à' : 'Ô×£'}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n                            {challenge?.answered && (\r\n                                <button onClick={nextQuestion} className=\"w-full py-4 bg-purple-600 rounded-xl font-black uppercase text-xs tracking-widest shadow-lg shadow-purple-900/40\">\r\n                                    Mission Suivante Ô×£\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <XPBar current={score % 100} nextLevel={100} />\r\n            <SuccessOverlay show={showSuccess} message=\"Analyse Spectrale Termin├®e ! Tu ma├«trises la d├®composition de la lumi├¿re.\" points={25} onNext={nextQuestion} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            {/* Prisme 3D */}\r\n            <group position={[0, 0, 0]} rotation={[0, 0, Math.PI / 6]}>\r\n                <mesh>\r\n                    <cylinderGeometry args={[2, 2, 0.5, 3]} />\r\n                    <meshStandardMaterial color=\"#818CF8\" transparent opacity={0.4} metalness={0.9} roughness={0.1} />\r\n                </mesh>\r\n                <mesh scale={[1.05, 1.05, 1.1]}>\r\n                    <cylinderGeometry args={[2, 2, 0.5, 3]} />\r\n                    <meshBasicMaterial color=\"white\" wireframe transparent opacity={0.1} />\r\n                </mesh>\r\n            </group>\r\n\r\n            {/* Rayon incident */}\r\n            <Line points={[[-6, 1.5, 0], [-1, 0, 0]]} color={lightType === 'white' ? 'white' : lightType} lineWidth={5} transparent opacity={0.8} />\r\n\r\n            <Float speed={2} rotationIntensity={0.5} floatIntensity={0.5}>\r\n                <Text position={[0, 3, 0]} fontSize={0.3} color=\"white\" font=\"/fonts/Inter-Bold.ttf\">\r\n                    {lightType === 'white' ? 'LUMI├êRE POLYCHROMATIQUE' : 'LUMI├êRE MONOCHROMATIQUE'}\r\n                </Text>\r\n            </Float>\r\n\r\n            {/* Rayons dispers├®s */}\r\n            {lightType === 'white' && showSpectrum && spectrumColors.map((color, i) => (\r\n                <Line key={i}\r\n                    points={[[1, 0, 0], [6, -1.5 + i * 0.5, 0]]}\r\n                    color={color}\r\n                    lineWidth={3}\r\n                    transparent\r\n                    opacity={0.6}\r\n                />\r\n            ))}\r\n\r\n            {lightType !== 'white' && (\r\n                <Line points={[[1, 0, 0], [6, -0.5, 0]]} color={lightType} lineWidth={5} transparent opacity={0.8} />\r\n            )}\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// CHAPITRE 3: FORCES ET VECTEURS (PC 3e)\r\n// ============================================================\r\nexport function Chap3ForcesVecteurs() {\r\n    const [mass, setMass] = useState(5);\r\n    const [planet, setPlanet] = useState('terre');\r\n    const [mode, setMode] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [challenge, setChallenge] = useState(null);\r\n\r\n    const planets = {\r\n        terre: { name: 'Terre', icon: '­ƒîì', g: 10, color: '#3B82F6' },\r\n        lune: { name: 'Lune', icon: '­ƒîÖ', g: 1.6, color: '#94A3B8' },\r\n        mars: { name: 'Mars', icon: '­ƒö┤', g: 3.7, color: '#EF4444' },\r\n        jupiter: { name: 'Jupiter', icon: '­ƒƒá', g: 25, color: '#F59E0B' }\r\n    };\r\n\r\n    const scenarios = {\r\n        sac: { name: 'Sac de riz', icon: '­ƒÄÆ', mass: 50, planet: 'terre', desc: '50 kg sur Terre' },\r\n        astronaute: { name: 'Explorateur', icon: '­ƒæ¿ÔÇì­ƒÜÇ', mass: 80, planet: 'lune', desc: '80 kg sur la Lune' },\r\n        voiture: { name: 'V├®hicule', icon: '­ƒÜù', mass: 1000, planet: 'terre', desc: '1 tonne sur Terre' },\r\n        pomme: { name: 'L├ócher libre', icon: '­ƒìÄ', mass: 0.2, planet: 'terre', desc: '200g d\\'acc├®l├®ration' }\r\n    };\r\n\r\n    const challenges = [\r\n        { q: \"Quelle est l'unit├® internationale de l'intensit├® d'une force ?\", options: [\"Le Kilogramme (kg)\", \"Le Newton (N)\", \"Le Joule (J)\"], ans: 1, icon: \"­ƒôÅ\" },\r\n        { q: \"La formule du poids est P = m ├ù g. Que repr├®sente 'g' ?\", options: [\"La gravit├®\", \"L'intensit├® de pesanteur\", \"Le grandissement\"], ans: 1, icon: \"­ƒ¬É\" },\r\n        { q: \"Si la masse d'un objet est de 10 kg, son poids sur Terre est environ :\", options: [\"1 N\", \"10 N\", \"100 N\"], ans: 2, icon: \"­ƒÄ»\" },\r\n        { q: \"La masse d'un astronaute est de 80kg sur Terre. Sur la Lune, elle est de :\", options: [\"13 kg\", \"80 kg\", \"0 kg\"], ans: 1, icon: \"­ƒºá\" }\r\n    ];\r\n\r\n    const applyScenario = (key) => {\r\n        const sc = scenarios[key];\r\n        setMass(sc.mass);\r\n        setPlanet(sc.planet);\r\n    };\r\n\r\n    const startChallenge = () => {\r\n        setMode('challenge');\r\n        setScore(0);\r\n        nextQuestion();\r\n    };\r\n\r\n    const nextQuestion = () => {\r\n        const rand = Math.floor(Math.random() * challenges.length);\r\n        setChallenge({ ...challenges[rand], answered: false });\r\n        setShowSuccess(false);\r\n    };\r\n\r\n    const checkAnswer = (idx) => {\r\n        if (!challenge || challenge.answered) return;\r\n        if (idx === challenge.ans) {\r\n            setScore(s => s + 25);\r\n            setShowSuccess(true);\r\n        } else {\r\n            alert(\"Erreur de calcul. Relis la loi de Newton !\");\r\n        }\r\n        setChallenge({ ...challenge, answered: true });\r\n    };\r\n\r\n    const gValue = planets[planet].g;\r\n    const weight = mass * gValue;\r\n    const forceScale = Math.min(weight / 100, 3);\r\n\r\n    return (\r\n        <group>\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒª¥ Ing├®nieur M├®canique\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[400px] border-emerald-500/30 text-white\">\r\n                    <div className=\"mb-4\">\r\n                        <PhaseSelector currentPhase={mode} onSelect={(m) => m === 'challenge' ? startChallenge() : setMode('explore')} />\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-between items-center mb-4 border-b border-white/10 pb-2\">\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-[10px] text-emerald-400 font-bold uppercase tracking-widest\">├ëtude de la Gravit├®</span>\r\n                            <span className=\"text-lg font-black\">{mode === 'explore' ? 'Dynamique des Forces' : 'D├®fi Newton ­ƒºá'}</span>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {mode === 'explore' ? (\r\n                        <div className=\"space-y-4\">\r\n                            <MissionObjective objective=\"Analysez l'influence de la masse et de la gravit├® sur le poids.\" icon=\"­ƒ¬É\" />\r\n\r\n                            <div className=\"grid grid-cols-4 gap-2\">\r\n                                {Object.entries(scenarios).map(([key, sc]) => (\r\n                                    <button key={key} onClick={() => applyScenario(key)}\r\n                                        className=\"p-2 bg-gray-900 border border-white/5 rounded-xl flex flex-col items-center gap-1 hover:bg-emerald-900/40 transition-all\">\r\n                                        <span className=\"text-xl\">{sc.icon}</span>\r\n                                        <span className=\"text-[8px] font-black uppercase text-center leading-none\">{sc.name}</span>\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n\r\n                            <div className=\"space-y-4 bg-black/40 p-4 rounded-xl border border-white/5\">\r\n                                <div className=\"grid grid-cols-2 gap-2\">\r\n                                    {Object.entries(planets).map(([key, p]) => (\r\n                                        <button key={key} onClick={() => setPlanet(key)}\r\n                                            className={`p-2 rounded-lg text-[10px] font-bold border transition-all flex items-center gap-2 ${planet === key ? 'bg-emerald-500 border-emerald-400 text-white shadow-lg' : 'bg-gray-800 border-white/5 text-gray-400'}`}>\r\n                                            <span>{p.icon}</span>\r\n                                            <span>{p.name}</span>\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n\r\n                                <div>\r\n                                    <div className=\"flex justify-between text-[10px] font-bold text-gray-500 mb-2\">\r\n                                        <span>MASSE IDENTIFI├ëE (m)</span>\r\n                                        <span className=\"text-emerald-400\">{mass} KG</span>\r\n                                    </div>\r\n                                    <input type=\"range\" min={0.1} max={100} step={0.1} value={mass} onChange={(e) => setMass(parseFloat(e.target.value))}\r\n                                        className=\"w-full h-2 bg-gray-800 rounded-lg appearance-none cursor-pointer accent-emerald-500\" />\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"p-4 bg-emerald-950/30 rounded-xl border border-emerald-500/30 text-center relative overflow-hidden\">\r\n                                <div className=\"text-[10px] text-emerald-400 font-black uppercase tracking-widest mb-1\">Intensit├® du Poids</div>\r\n                                <div className=\"text-4xl font-black text-white\">{weight.toFixed(1)} <span className=\"text-xl\">N</span></div>\r\n                                <div className=\"mt-2 text-[10px] font-mono text-gray-500\">P = {mass}kg ├ù {gValue}N/kg</div>\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"space-y-4\">\r\n                            {challenge && <MissionObjective objective={challenge.q} icon={challenge.icon} />}\r\n                            <div className=\"space-y-2\">\r\n                                {challenge?.options.map((opt, idx) => (\r\n                                    <button key={idx} onClick={() => checkAnswer(idx)}\r\n                                        disabled={challenge.answered}\r\n                                        className={`w-full p-4 rounded-xl text-left text-sm font-bold transition-all flex justify-between items-center group\r\n                                            ${challenge.answered\r\n                                                ? idx === challenge.ans ? 'bg-green-500 text-white' : 'bg-gray-800/50 text-gray-500'\r\n                                                : 'bg-white/5 hover:bg-emerald-500 hover:text-white border border-white/10'\r\n                                            }`}>\r\n                                        {opt}\r\n                                        {challenge.answered && idx === challenge.ans ? 'Ô£à' : 'Ô×£'}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n                            {challenge?.answered && (\r\n                                <button onClick={nextQuestion} className=\"w-full py-4 bg-emerald-600 rounded-xl font-black uppercase text-xs tracking-widest shadow-lg shadow-emerald-900/40\">\r\n                                    D├®fi Suivant Ô×£\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <XPBar current={score % 100} nextLevel={100} />\r\n            <SuccessOverlay show={showSuccess} message=\"Succ├¿s M├®canique ! Les lois de la physique n'ont plus de secret pour toi.\" points={25} onNext={nextQuestion} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            {/* Objet */}\r\n            <Box args={[1.5, 1.5, 1.5]} position={[0, 1, 0]}>\r\n                <meshStandardMaterial color={planets[planet].color} roughness={0.3} metalness={0.2} />\r\n            </Box>\r\n            <Text position={[0, 2.2, 0]} fontSize={0.3} color=\"white\" font=\"/fonts/Inter-Bold.ttf\">MASSE = {mass} KG</Text>\r\n\r\n            {/* Vecteur Poids */}\r\n            <group position={[0, 0.5, 0]}>\r\n                <Line points={[[0, 0, 0], [0, -forceScale, 0]]} color=\"#EF4444\" lineWidth={8} />\r\n                <mesh position={[0, -forceScale - 0.2, 0]} rotation={[0, 0, Math.PI]}>\r\n                    <coneGeometry args={[0.2, 0.4, 16]} />\r\n                    <meshStandardMaterial color=\"#EF4444\" />\r\n                </mesh>\r\n                <Text position={[0.8, -forceScale / 2, 0]} fontSize={0.3} color=\"#EF4444\" font=\"/fonts/Inter-Bold.ttf\">\r\n                    P = {weight.toFixed(0)} N\r\n                </Text>\r\n            </group>\r\n\r\n            {/* Sol */}\r\n            <mesh position={[0, -0.5, 0]} rotation={[-Math.PI / 2, 0, 0]}>\r\n                <planeGeometry args={[12, 12]} />\r\n                <meshStandardMaterial color=\"#1E293B\" />\r\n            </mesh>\r\n            <gridHelper args={[12, 12, \"#334155\", \"#0F172A\"]} position={[0, -0.49, 0]} rotation={[0, 0, 0]} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// CHAPITRE 4: TRAVAIL ET PUISSANCE (PC 3e)\r\n// ============================================================\r\nexport function Chap4TravailPuissance() {\r\n    const [force, setForce] = useState(100);\r\n    const [distance, setDistance] = useState(10);\r\n    const [time, setTime] = useState(5);\r\n    const [angle, setAngle] = useState(0);\r\n    const [mode, setMode] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [challenge, setChallenge] = useState(null);\r\n    const [animProgress, setAnimProgress] = useState(0);\r\n\r\n    const scenarios = {\r\n        porteur: { name: 'Porteur', icon: '­ƒÅï´©Å', force: 500, distance: 10, time: 10, angle: 0, desc: 'Transport horizontal' },\r\n        escalier: { name: 'Escalier', icon: '­ƒ¬£', force: 700, distance: 5, time: 20, angle: 0, desc: 'Lutte contre le poids' },\r\n        voiture: { name: 'V├®hicule', icon: '­ƒÜù', force: 200, distance: 20, time: 60, angle: 30, desc: 'Pousser en diagonale' },\r\n        athlete: { name: 'Sprinter', icon: '­ƒÅâ', force: 800, distance: 100, time: 10, angle: 0, desc: 'Explosion de puissance' }\r\n    };\r\n\r\n    const challenges = [\r\n        { q: \"L'unit├® l├®gale du travail m├®canique est :\", options: [\"Le Newton (N)\", \"Le Watt (W)\", \"Le Joule (J)\"], ans: 2, icon: \"ÔÜí\" },\r\n        { q: \"La puissance est d├®finie par le rapport :\", options: [\"P = W ├ù t\", \"P = W / t\", \"P = F / d\"], ans: 1, icon: \"ÔÅ▒´©Å\" },\r\n        { q: \"Si la force est perpendiculaire au d├®placement, le travail est :\", options: [\"Maximum\", \"Nul\", \"N├®gatif\"], ans: 1, icon: \"­ƒôÉ\" },\r\n        { q: \"Un moteur de 2 kW d├®veloppe une puissance de :\", options: [\"200 W\", \"2000 W\", \"20000 W\"], ans: 1, icon: \"­ƒºá\" }\r\n    ];\r\n\r\n    const applyScenario = (key) => {\r\n        const sc = scenarios[key];\r\n        setForce(sc.force);\r\n        setDistance(sc.distance);\r\n        setTime(sc.time);\r\n        setAngle(sc.angle);\r\n    };\r\n\r\n    const startChallenge = () => {\r\n        setMode('challenge');\r\n        setScore(0);\r\n        nextQuestion();\r\n    };\r\n\r\n    const nextQuestion = () => {\r\n        const rand = Math.floor(Math.random() * challenges.length);\r\n        setChallenge({ ...challenges[rand], answered: false });\r\n        setShowSuccess(false);\r\n    };\r\n\r\n    const checkAnswer = (idx) => {\r\n        if (!challenge || challenge.answered) return;\r\n        if (idx === challenge.ans) {\r\n            setScore(s => s + 25);\r\n            setShowSuccess(true);\r\n        } else {\r\n            alert(\"Erreur de calcul ! Analyse les unit├®s.\");\r\n        }\r\n        setChallenge({ ...challenge, answered: true });\r\n    };\r\n\r\n    const cosAngle = Math.cos(angle * Math.PI / 180);\r\n    const work = force * distance * cosAngle;\r\n    const power = work / time;\r\n\r\n    useFrame((_, delta) => {\r\n        setAnimProgress(p => (p + delta * 0.2) % 1);\r\n    });\r\n\r\n    return (\r\n        <group>\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"ÔÜí Ing├®nieur ├ënergie\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[400px] border-yellow-500/30 text-white\">\r\n                    <div className=\"mb-4\">\r\n                        <PhaseSelector currentPhase={mode} onSelect={(m) => m === 'challenge' ? startChallenge() : setMode('explore')} />\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-between items-center mb-4 border-b border-white/10 pb-2\">\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-[10px] text-yellow-400 font-bold uppercase tracking-widest\">Dynamique & Performance</span>\r\n                            <span className=\"text-lg font-black\">{mode === 'explore' ? '├ëtude du Travail' : 'D├®fi Puissance ­ƒºá'}</span>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {mode === 'explore' ? (\r\n                        <div className=\"space-y-4\">\r\n                            <MissionObjective objective=\"Optimisez le rendement en ajustant la force et le temps.\" icon=\"ÔÜí\" />\r\n\r\n                            <div className=\"grid grid-cols-4 gap-2\">\r\n                                {Object.entries(scenarios).map(([key, sc]) => (\r\n                                    <button key={key} onClick={() => applyScenario(key)}\r\n                                        className=\"p-2 bg-gray-900 border border-white/5 rounded-xl flex flex-col items-center gap-1 hover:bg-yellow-900/40 transition-all\">\r\n                                        <span className=\"text-xl\">{sc.icon}</span>\r\n                                        <span className=\"text-[8px] font-black uppercase text-center leading-none\">{sc.name}</span>\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n\r\n                            <div className=\"space-y-4 bg-black/40 p-4 rounded-xl border border-white/5\">\r\n                                <div>\r\n                                    <div className=\"flex justify-between text-[10px] font-bold text-gray-500 mb-2\">\r\n                                        <span>FORCE APPLIQU├ëE (F)</span>\r\n                                        <span className=\"text-yellow-400\">{force} N</span>\r\n                                    </div>\r\n                                    <input type=\"range\" min={10} max={1000} value={force} onChange={(e) => setForce(parseInt(e.target.value))}\r\n                                        className=\"w-full h-2 bg-gray-800 rounded-lg appearance-none cursor-pointer accent-yellow-500\" />\r\n                                </div>\r\n                                <div>\r\n                                    <div className=\"flex justify-between text-[10px] font-bold text-gray-500 mb-2\">\r\n                                        <span>DISTANCE (d)</span>\r\n                                        <span className=\"text-emerald-400\">{distance} M</span>\r\n                                    </div>\r\n                                    <input type=\"range\" min={1} max={100} value={distance} onChange={(e) => setDistance(parseInt(e.target.value))}\r\n                                        className=\"w-full h-2 bg-gray-800 rounded-lg appearance-none cursor-pointer accent-emerald-500\" />\r\n                                </div>\r\n                                <div>\r\n                                    <div className=\"flex justify-between text-[10px] font-bold text-gray-500 mb-2\">\r\n                                        <span>DUR├ëE (t)</span>\r\n                                        <span className=\"text-cyan-400\">{time} S</span>\r\n                                    </div>\r\n                                    <input type=\"range\" min={1} max={120} value={time} onChange={(e) => setTime(parseInt(e.target.value))}\r\n                                        className=\"w-full h-2 bg-gray-800 rounded-lg appearance-none cursor-pointer accent-cyan-500\" />\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-2\">\r\n                                <div className=\"p-3 bg-yellow-950/30 rounded-lg border border-yellow-500/20 text-center\">\r\n                                    <div className=\"text-[8px] text-yellow-400 font-black uppercase\">Travail (W)</div>\r\n                                    <div className=\"text-xl font-mono font-black\">{work.toFixed(0)} J</div>\r\n                                </div>\r\n                                <div className=\"p-3 bg-red-950/30 rounded-lg border border-red-500/20 text-center\">\r\n                                    <div className=\"text-[8px] text-red-400 font-black uppercase\">Puissance (P)</div>\r\n                                    <div className=\"text-xl font-mono font-black\">{power.toFixed(0)} W</div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"space-y-4\">\r\n                            {challenge && <MissionObjective objective={challenge.q} icon={challenge.icon} />}\r\n                            <div className=\"space-y-2\">\r\n                                {challenge?.options.map((opt, idx) => (\r\n                                    <button key={idx} onClick={() => checkAnswer(idx)}\r\n                                        disabled={challenge.answered}\r\n                                        className={`w-full p-4 rounded-xl text-left text-sm font-bold transition-all flex justify-between items-center group\r\n                                            ${challenge.answered\r\n                                                ? idx === challenge.ans ? 'bg-green-500 text-white' : 'bg-gray-800/50 text-gray-500'\r\n                                                : 'bg-white/5 hover:bg-yellow-500 hover:text-white border border-white/10'\r\n                                            }`}>\r\n                                        {opt}\r\n                                        {challenge.answered && idx === challenge.ans ? 'Ô£à' : 'Ô×£'}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n                            {challenge?.answered && (\r\n                                <button onClick={nextQuestion} className=\"w-full py-4 bg-yellow-600 rounded-xl font-black uppercase text-xs tracking-widest shadow-lg shadow-yellow-900/40\">\r\n                                    D├®fi Suivant Ô×£\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <XPBar current={score % 100} nextLevel={100} />\r\n            <SuccessOverlay show={showSuccess} message=\"├ënergie Ma├«tris├®e ! Ton analyse de la puissance est parfaite.\" points={25} onNext={nextQuestion} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            {/* Animation objet */}\r\n            <Box args={[1.2, 1.2, 1.2]} position={[-4 + animProgress * 8, 0.6, 0]}>\r\n                <meshStandardMaterial color=\"#F59E0B\" metalness={0.5} roughness={0.2} />\r\n            </Box>\r\n\r\n            {/* Vecteur Force */}\r\n            <group position={[-4 + animProgress * 8, 0.6, 0]} rotation={[0, 0, angle * Math.PI / 180]}>\r\n                <Line points={[[0, 0, 0], [2, 0, 0]]} color=\"#FACC15\" lineWidth={6} />\r\n                <mesh position={[2.1, 0, 0]} rotation={[0, 0, -Math.PI / 2]}>\r\n                    <coneGeometry args={[0.15, 0.3, 16]} />\r\n                    <meshStandardMaterial color=\"#FACC15\" emissive=\"#FACC15\" emissiveIntensity={2} />\r\n                </mesh>\r\n            </group>\r\n\r\n            {/* Distance Scale */}\r\n            <Line points={[[-4, -0.5, 0], [4, -0.5, 0]]} color=\"#10B981\" lineWidth={2} dashed dashScale={1} transparent opacity={0.3} />\r\n            <Text position={[0, -1, 0]} fontSize={0.3} color=\"#10B981\" font=\"/fonts/Inter-Bold.ttf\">DISTANCE = {distance} M</Text>\r\n\r\n            {/* Sol */}\r\n            <mesh position={[0, -0.05, 0]} rotation={[-Math.PI / 2, 0, 0]}>\r\n                <planeGeometry args={[14, 6]} />\r\n                <meshStandardMaterial color=\"#0F172A\" />\r\n            </mesh>\r\n            <gridHelper args={[14, 6, \"#1E293B\", \"#334155\"]} position={[0, 0, 0]} rotation={[0, 0, 0]} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// CHAPITRE 5: ├ëLECTRISATION PAR FROTTEMENT (PC 3e)\r\n// ============================================================\r\nexport function Chap5Electrisation() {\r\n    const [object1, setObject1] = useState('regle');\r\n    const [object2, setObject2] = useState('tissu');\r\n    const [frictionCount, setFrictionCount] = useState(0);\r\n    const [mode, setMode] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [challenge, setChallenge] = useState(null);\r\n\r\n    const objects = {\r\n        regle: { name: 'R├¿gle', icon: '­ƒôÅ', charge: 'negative', color: '#F87171', desc: 'Plastique' },\r\n        ballon: { name: 'Ballon', icon: '­ƒÄê', charge: 'negative', color: '#FB923C', desc: 'Caoutchouc' },\r\n        verre: { name: 'Verre', icon: '­ƒÑâ', charge: 'positive', color: '#60A5FA', desc: 'B├óton' },\r\n        ebonite: { name: '├ëbonite', icon: 'Ô¼ø', charge: 'negative', color: '#4B5563', desc: 'Isolant dur' }\r\n    };\r\n\r\n    const frictionMaterials = {\r\n        tissu: { name: 'Tissu', icon: '­ƒæò', effect: 'Don' },\r\n        laine: { name: 'Laine', icon: '­ƒºÂ', effect: 'Perte' },\r\n        cheveux: { name: 'Cheveux', icon: '­ƒæ®', effect: 'Perte' },\r\n        soie: { name: 'Soie', icon: '­ƒºú', effect: 'Don' }\r\n    };\r\n\r\n    const challenges = [\r\n        { q: \"Deux corps portant des charges de m├¬me signe :\", options: [\"S'attirent\", \"Se repoussent\", \"S'annulent\"], ans: 1, icon: \"ÔÜí\" },\r\n        { q: \"Quel constituant de l'atome porte une charge n├®gative ?\", options: [\"Le Proton\", \"Le Neutron\", \"L'├ëlectron\"], ans: 2, icon: \"ÔÜø´©Å\" },\r\n        { q: \"Un corps ├®lectriquement neutre poss├¿de :\", options: [\"Autant de + que de -\", \"Uniquement des +\", \"Aucune charge\"], ans: 0, icon: \"ÔÜû´©Å\" },\r\n        { q: \"Lors d'un frottement, ce sont les ... qui se d├®placent :\", options: [\"Protons\", \"├ëlectrons\", \"Neutrons\"], ans: 1, icon: \"­ƒÅâ\" }\r\n    ];\r\n\r\n    const doFriction = () => {\r\n        setFrictionCount(c => Math.min(c + 1, 10));\r\n    };\r\n\r\n    const resetCharges = () => {\r\n        setFrictionCount(0);\r\n    };\r\n\r\n    const startChallenge = () => {\r\n        setMode('challenge');\r\n        setScore(0);\r\n        nextQuestion();\r\n    };\r\n\r\n    const nextQuestion = () => {\r\n        const rand = Math.floor(Math.random() * challenges.length);\r\n        setChallenge({ ...challenges[rand], answered: false });\r\n        setShowSuccess(false);\r\n    };\r\n\r\n    const checkAnswer = (idx) => {\r\n        if (!challenge || challenge.answered) return;\r\n        if (idx === challenge.ans) {\r\n            setScore(s => s + 25);\r\n            setShowSuccess(true);\r\n        } else {\r\n            alert(\"Analyse de charge incorrecte. R├®vise la statique !\");\r\n        }\r\n        setChallenge({ ...challenge, answered: true });\r\n    };\r\n\r\n    const chargeLevel = frictionCount / 10;\r\n    const isCharged = frictionCount > 0;\r\n\r\n    return (\r\n        <group>\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"ÔÜí Ma├«tre des Charges\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[400px] border-blue-500/30 text-white\">\r\n                    <div className=\"mb-4\">\r\n                        <PhaseSelector currentPhase={mode} onSelect={(m) => m === 'challenge' ? startChallenge() : setMode('explore')} />\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-between items-center mb-4 border-b border-white/10 pb-2\">\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-[10px] text-blue-400 font-bold uppercase tracking-widest\">├ëlectricit├® Statique</span>\r\n                            <span className=\"text-lg font-black\">{mode === 'explore' ? 'Atelier d\\'├ëlectrisation' : 'D├®fi Atomique ­ƒºá'}</span>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {mode === 'explore' ? (\r\n                        <div className=\"space-y-4\">\r\n                            <MissionObjective objective=\"Frottez les mat├®riaux pour transf├®rer des ├®lectrons.\" icon=\"ÔÜí\" />\r\n\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <div className=\"space-y-2\">\r\n                                    <span className=\"text-[8px] text-gray-500 font-black uppercase\">Objet ├á charger</span>\r\n                                    <div className=\"grid grid-cols-2 gap-2\">\r\n                                        {Object.entries(objects).map(([k, o]) => (\r\n                                            <button key={k} onClick={() => { setObject1(k); resetCharges(); }}\r\n                                                className={`p-2 rounded-xl flex flex-col items-center border transition-all ${object1 === k ? 'bg-blue-600 border-blue-400 shadow-lg' : 'bg-gray-900 border-white/5 opacity-50'}`}>\r\n                                                <span className=\"text-xl\">{o.icon}</span>\r\n                                                <span className=\"text-[8px] font-black uppercase\">{o.name}</span>\r\n                                            </button>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"space-y-2\">\r\n                                    <span className=\"text-[8px] text-gray-500 font-black uppercase\">Frotter avec</span>\r\n                                    <div className=\"grid grid-cols-2 gap-2\">\r\n                                        {Object.entries(frictionMaterials).map(([k, m]) => (\r\n                                            <button key={k} onClick={() => { setObject2(k); resetCharges(); }}\r\n                                                className={`p-2 rounded-xl flex flex-col items-center border transition-all ${object2 === k ? 'bg-indigo-600 border-indigo-400 shadow-lg' : 'bg-gray-900 border-white/5 opacity-50'}`}>\r\n                                                <span className=\"text-xl\">{m.icon}</span>\r\n                                                <span className=\"text-[8px] font-black uppercase\">{m.name}</span>\r\n                                            </button>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <button onClick={doFriction}\r\n                                className=\"w-full py-6 rounded-2xl font-black text-xl bg-gradient-to-r from-blue-600 to-indigo-600 hover:scale-[1.02] active:scale-95 transition-all shadow-xl shadow-blue-900/40 relative overflow-hidden group\">\r\n                                <div className=\"flex flex-col items-center\">\r\n                                    <span className=\"text-[10px] text-blue-200 uppercase tracking-[0.2em] mb-1\">Action de Frottement</span>\r\n                                    <span className=\"flex items-center gap-3\">ÔÜí FROTTER L'OBJET ! <span className=\"bg-black/20 px-3 py-1 rounded-full text-xs\">{frictionCount}/10</span></span>\r\n                                </div>\r\n                                <div className=\"absolute inset-0 bg-white/20 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700 ease-in-out\" />\r\n                            </button>\r\n\r\n                            <div className=\"bg-black/40 p-4 rounded-2xl border border-white/10\">\r\n                                <div className=\"flex justify-between items-center mb-2\">\r\n                                    <div className=\"flex flex-col\">\r\n                                        <span className=\"text-[8px] text-gray-500 font-black uppercase\">Polarit├® acquise</span>\r\n                                        <span className={`text-xs font-black ${isCharged ? (objects[object1].charge === 'negative' ? 'text-red-400' : 'text-emerald-400') : 'text-gray-600'}`}>\r\n                                            {isCharged ? (objects[object1].charge === 'negative' ? 'ÔèØ EXC├êS D\\'├ëLECTRONS' : 'Ôèò D├ëFICIT D\\'├ëLECTRONS') : 'SYST├êME NEUTRE'}\r\n                                        </span>\r\n                                    </div>\r\n                                    <button onClick={resetCharges} className=\"p-2 bg-gray-800 hover:bg-gray-700 rounded-lg text-xs\">­ƒöä</button>\r\n                                </div>\r\n                                <div className=\"h-2 bg-gray-900 rounded-full overflow-hidden\">\r\n                                    <div className={`h-full transition-all duration-300 ${objects[object1].charge === 'negative' ? 'bg-red-500' : 'bg-emerald-500'}`}\r\n                                        style={{ width: `${chargeLevel * 100}%` }} />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"space-y-4\">\r\n                            {challenge && <MissionObjective objective={challenge.q} icon={challenge.icon} />}\r\n                            <div className=\"space-y-2\">\r\n                                {challenge?.options.map((opt, idx) => (\r\n                                    <button key={idx} onClick={() => checkAnswer(idx)}\r\n                                        disabled={challenge.answered}\r\n                                        className={`w-full p-4 rounded-xl text-left text-sm font-bold transition-all flex justify-between items-center group\r\n                                            ${challenge.answered\r\n                                                ? idx === challenge.ans ? 'bg-green-500 text-white' : 'bg-gray-800/50 text-gray-500'\r\n                                                : 'bg-white/5 hover:bg-blue-500 hover:text-white border border-white/10'\r\n                                            }`}>\r\n                                        {opt}\r\n                                        {challenge.answered && idx === challenge.ans ? 'Ô£à' : 'Ô×£'}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n                            {challenge?.answered && (\r\n                                <button onClick={nextQuestion} className=\"w-full py-4 bg-blue-600 rounded-xl font-black uppercase text-xs tracking-widest shadow-lg shadow-blue-900/40\">\r\n                                    Question Suivante Ô×£\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <XPBar current={score % 100} nextLevel={100} />\r\n            <SuccessOverlay show={showSuccess} message=\"Analyse Atomique R├®ussie ! Tu as parfaitement stabilis├® les charges.\" points={25} onNext={nextQuestion} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            {/* Objet */}\r\n            <Box args={[4, 0.3, 0.6]} position={[0, 0, 0]}>\r\n                <meshStandardMaterial color={objects[object1].color} roughness={0.1} metalness={0.8} />\r\n            </Box>\r\n\r\n            {/* Charges */}\r\n            {isCharged && Array.from({ length: Math.floor(frictionCount) }).map((_, i) => (\r\n                <Float key={i} speed={4} floatIntensity={0.8}>\r\n                    <Text\r\n                        position={[-1.5 + i * 0.4, 0.5, 0]}\r\n                        fontSize={0.3}\r\n                        color={objects[object1].charge === 'negative' ? \"#F87171\" : \"#34D399\"}\r\n                        font=\"/fonts/Inter-Bold.ttf\">\r\n                        {objects[object1].charge === 'negative' ? 'ÔêÆ' : '+'}\r\n                    </Text>\r\n                </Float>\r\n            ))}\r\n\r\n            {/* Effet d'attraction */}\r\n            {isCharged && chargeLevel > 0.4 && (\r\n                <group position={[0, -1.8, 0]}>\r\n                    {[...Array(5)].map((_, i) => (\r\n                        <Float key={i} speed={5} rotationIntensity={2} floatIntensity={1.5}>\r\n                            <Box args={[0.2, 0.2, 0.05]} position={[-1 + i * 0.5, chargeLevel * 1.2, 0]}>\r\n                                <meshStandardMaterial color=\"white\" emissive=\"white\" emissiveIntensity={0.5} />\r\n                            </Box>\r\n                        </Float>\r\n                    ))}\r\n                    <Text position={[0, -0.5, 0]} fontSize={0.25} color=\"#60A5FA\" font=\"/fonts/Inter-Bold.ttf\">ATTRACTION ├ëLECTROSTATIQUE</Text>\r\n                </group>\r\n            )}\r\n\r\n            <Float speed={2} rotationIntensity={0.1}>\r\n                <Text position={[0, 2, 0]} fontSize={0.4} color=\"white\" font=\"/fonts/Inter-Bold.ttf\">\r\n                    {objects[object1].name.toUpperCase()}\r\n                </Text>\r\n            </Float>\r\n        </group>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\PC3eChapter6to11.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\PC4eChapter1to5.js","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":180,"column":114,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[10477,10498],"text":"Journal d&apos;observation"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[10477,10498],"text":"Journal d&lsquo;observation"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[10477,10498],"text":"Journal d&#39;observation"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[10477,10498],"text":"Journal d&rsquo;observation"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":449,"column":119,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[23401,23417],"text":"1. Objet d&apos;├®tude"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[23401,23417],"text":"1. Objet d&lsquo;├®tude"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[23401,23417],"text":"1. Objet d&#39;├®tude"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[23401,23417],"text":"1. Objet d&rsquo;├®tude"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":491,"column":38,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[26634,26709],"text":"\r\n                            MESURER L&apos;OBJET\r\n                            "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[26634,26709],"text":"\r\n                            MESURER L&lsquo;OBJET\r\n                            "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[26634,26709],"text":"\r\n                            MESURER L&#39;OBJET\r\n                            "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[26634,26709],"text":"\r\n                            MESURER L&rsquo;OBJET\r\n                            "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":648,"column":122,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[35195,35218],"text":"Laboratoire d&apos;Archim├¿de"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[35195,35218],"text":"Laboratoire d&lsquo;Archim├¿de"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[35195,35218],"text":"Laboratoire d&#39;Archim├¿de"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[35195,35218],"text":"Laboratoire d&rsquo;Archim├¿de"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":682,"column":138,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[37827,37852],"text":"2. Choix de l&apos;├ëchantillon"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[37827,37852],"text":"2. Choix de l&lsquo;├ëchantillon"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[37827,37852],"text":"2. Choix de l&#39;├ëchantillon"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[37827,37852],"text":"2. Choix de l&rsquo;├ëchantillon"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'resetCircuit'. Either include it or remove the dependency array.","line":947,"column":8,"nodeType":"ArrayExpression","endLine":947,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [resetCircuit, topology]","fix":{"range":[54428,54438],"text":"[resetCircuit, topology]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has missing dependencies: 'getCompInfo' and 'showSuccess'. Either include them or remove the dependency array.","line":1026,"column":8,"nodeType":"ArrayExpression","endLine":1026,"endColumn":56,"suggestions":[{"desc":"Update the dependencies array to be: [switchState, phase, challenge, showSuccess, topology, getCompInfo, slots]","fix":{"range":[57450,57498],"text":"[switchState, phase, challenge, showSuccess, topology, getCompInfo, slots]"}}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport { useState, useRef, useEffect, useMemo } from 'react';\r\nimport { useFrame } from '@react-three/fiber';\r\nimport { Text, Html, useGLTF, Float, Sphere, Box, Cylinder, Torus, Line } from '@react-three/drei';\r\nimport DraggableHtmlPanel from './DraggableHtmlPanel';\r\nimport * as THREE from 'three';\r\nimport { SuccessOverlay, ConfettiExplosion, ChallengeTimer, GradeBadge, XPBar, PhaseSelector, MissionObjective } from './GamificationUtils';\r\n\r\n// Images et ic├┤nes\r\nconst ICONS = {\r\n    science: '­ƒö¼', measure: '­ƒôÅ', density: 'ÔøÁ', weight: 'ÔÜû´©Å', elec: 'ÔÜí',\r\n    idea: '­ƒÆí', check: 'Ô£à', warning: 'ÔÜá´©Å', obs: '­ƒæü´©Å'\r\n};\r\n\r\n// ============================================================\r\n// CHAPITRE 1: LA D├ëMARCHE SCIENTIFIQUE (ENRICHI)\r\n// ============================================================\r\nexport function Chap1ScienceIntro() {\r\n    const [scenario, setScenario] = useState('chimie');\r\n    const [step, setStep] = useState(0);\r\n    const [experimentDone, setExperimentDone] = useState(false);\r\n    const [observationLog, setObservationLog] = useState([]);\r\n    const [phase, setPhase] = useState('explore'); // 'explore' | 'challenge'\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [challenge, setChallenge] = useState(null);\r\n\r\n    const groupRef = useRef();\r\n\r\n    const scenarios = {\r\n        chimie: {\r\n            id: 'mission-volcan',\r\n            title: '­ƒîï L\\'├ëruption Chimique',\r\n            desc: 'D├®couvrez la r├®action Acide-Base.',\r\n            objectives: ['Observer les r├®actifs', 'Formuler une hypoth├¿se', 'R├®aliser le m├®lange', 'Conclure sur le gaz'],\r\n            steps: [\r\n                { name: 'Observer', text: 'On a du vinaigre (Acide) et du bicarbonate (Base).', color: '#3B82F6', icon: '­ƒöì' },\r\n                { name: 'Hypoth├¿se', text: 'Je pense que le m├®lange va produire une mousse effervescente !', color: '#F59E0B', icon: '­ƒÆí' },\r\n                { name: 'Exp├®rience', text: 'M├®langeons les poudres avec le liquide...', color: '#10B981', action: 'Lancer R├®action', icon: '­ƒº¬' },\r\n                { name: 'Conclusion', text: 'Une r├®action chimique a eu lieu, cr├®ant du dioxyde de carbone (COÔéé).', color: '#8B5CF6', icon: 'Ô£à' }\r\n            ],\r\n            color: '#ef4444'\r\n        },\r\n        plante: {\r\n            id: 'mission-vie',\r\n            title: '­ƒî┐ Le Secret de la Croissance',\r\n            desc: 'De quoi la plante a-t-elle besoin ?',\r\n            objectives: ['Observer la plante saine', 'Hypoth├¿se sur la lumi├¿re', 'Priver de lumi├¿re', 'Conclure sur la photosynth├¿se'],\r\n            steps: [\r\n                { name: 'Observer', text: 'La plante est verte et en pleine sant├®.', color: '#22C55E', icon: '­ƒöì' },\r\n                { name: 'Hypoth├¿se', text: 'Sans lumi├¿re, la plante ne pourra pas se nourrir.', color: '#F59E0B', icon: '­ƒÆí' },\r\n                { name: 'Exp├®rience', text: 'Pla├ºons la plante dans une bo├«te noire...', color: '#10B981', action: 'Mettre sous bo├«te', icon: '­ƒôª' },\r\n                { name: 'Conclusion', text: 'La lumi├¿re est indispensable ├á la survie du v├®g├®tal.', color: '#8B5CF6', icon: 'Ô£à' }\r\n            ],\r\n            color: '#22c55e'\r\n        },\r\n        flotte: {\r\n            id: 'mission-mer',\r\n            title: 'ÔÜô Le Myst├¿re de Flottaison',\r\n            desc: 'Pourquoi certains objets flottent-ils ?',\r\n            objectives: ['Observer l\\'┼ôuf qui coule', 'Hypoth├¿se sur le sel', 'Ajouter du sel', 'Conclure sur la densit├®'],\r\n            steps: [\r\n                { name: 'Observer', text: 'L\\'┼ôuf coule directement au fond de l\\'eau douce.', color: '#3B82F6', icon: '­ƒöì' },\r\n                { name: 'Hypoth├¿se', text: 'L\\'ajout de sel va augmenter la pouss├®e de l\\'eau.', color: '#F59E0B', icon: '­ƒÆí' },\r\n                { name: 'Exp├®rience', text: 'Versons le sel dans le b├®cher...', color: '#10B981', action: 'Saler l\\'eau', icon: '­ƒºé' },\r\n                { name: 'Conclusion', text: 'L\\'eau sal├®e est plus dense et fait flotter l\\'┼ôuf.', color: '#8B5CF6', icon: 'Ô£à' }\r\n            ],\r\n            color: '#3b82f6'\r\n        }\r\n    };\r\n\r\n    const currentScenario = scenarios[scenario];\r\n\r\n    const handleNextStep = () => {\r\n        if (step < 3) {\r\n            setStep(s => s + 1);\r\n            if (step === 1) setExperimentDone(true);\r\n            setObservationLog(prev => [...prev, currentScenario.steps[step].text]);\r\n        }\r\n    };\r\n\r\n    const challenges = [\r\n        { q: \"Quelle ├®tape consiste ├á proposer une explication ?\", options: [\"Analyse\", \"Hypoth├¿se\", \"Exp├®rience\"], ans: 1 },\r\n        { q: \"L'observation se fait g├®n├®ralement avec...\", options: [\"Les yeux\", \"Le hasard\", \"La conclusion\"], ans: 0 },\r\n        { q: \"Une exp├®rience sert ├á v├®rifier...\", options: [\"Le titre\", \"La m├®t├®o\", \"L'hypoth├¿se\"], ans: 2 },\r\n        { q: \"La conclusion vient...\", options: [\"Au d├®but\", \"Apr├¿s l'analyse\", \"Avant l'hypoth├¿se\"], ans: 1 }\r\n    ];\r\n\r\n    const startChallenge = () => {\r\n        setPhase('challenge');\r\n        setScore(0);\r\n        nextQuestion();\r\n    };\r\n\r\n    const nextQuestion = () => {\r\n        const rand = Math.floor(Math.random() * challenges.length);\r\n        setChallenge({ ...challenges[rand], answered: false });\r\n        setShowSuccess(false);\r\n    };\r\n\r\n    const checkAnswer = (idx) => {\r\n        if (!challenge) return;\r\n        if (idx === challenge.ans) {\r\n            setScore(s => s + 25);\r\n            setShowSuccess(true);\r\n        } else {\r\n            alert(\"R├®essaie, ce n'est pas tout ├á fait ├ºa !\");\r\n        }\r\n    };\r\n\r\n    const reset = () => {\r\n        setStep(0);\r\n        setExperimentDone(false);\r\n        setObservationLog([]);\r\n    };\r\n\r\n    return (\r\n        <group ref={groupRef}>\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒö¼ Mission: D├®marche Scientifique\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[420px] border-blue-500/30 text-white\">\r\n                    <div className=\"mb-4\">\r\n                        <PhaseSelector currentPhase={phase} onSelect={(p) => { setPhase(p); if (p === 'challenge') startChallenge(); }} />\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-between items-center mb-4 border-b border-white/10 pb-2\">\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-[10px] text-blue-400 font-bold tracking-widest uppercase leading-tight\">Expert Scientifique</span>\r\n                            <span className=\"text-lg font-black tracking-tight\">{currentScenario.title}</span>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {phase === 'explore' ? (\r\n                        <>\r\n                            <div className=\"grid grid-cols-3 gap-2 mb-4\">\r\n                                {Object.entries(scenarios).map(([key, sc]) => (\r\n                                    <button key={key} onClick={() => { setScenario(key); reset(); }}\r\n                                        className={`py-2 rounded-xl text-[10px] font-black transition-all border-2 ${scenario === key ? 'bg-blue-600 border-white shadow-lg' : 'bg-gray-800 border-transparent hover:bg-gray-700'}`}>\r\n                                        {key.toUpperCase()}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n\r\n                            <MissionObjective objective={currentScenario.objectives[step]} icon={currentScenario.steps[step].icon} />\r\n\r\n                            <div className=\"mt-4 bg-black/40 p-4 rounded-xl border border-white/5 min-h-[100px] flex flex-col justify-center relative overflow-hidden\">\r\n                                <div className=\"absolute top-2 right-2 text-[10px] font-mono text-gray-600\">STEP {step + 1}/4</div>\r\n                                <p className=\"text-base font-medium leading-relaxed\" style={{ color: currentScenario.steps[step].color }}>\r\n                                    {currentScenario.steps[step].text}\r\n                                </p>\r\n                            </div>\r\n\r\n                            {/* Progress bar with labels */}\r\n                            <div className=\"mt-4 flex gap-1 h-1.5\">\r\n                                {[0, 1, 2, 3].map(i => (\r\n                                    <div key={i} className={`flex-1 rounded-full transition-all duration-500 ${i <= step ? 'bg-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.5)]' : 'bg-gray-800'}`} />\r\n                                ))}\r\n                            </div>\r\n\r\n                            <div className=\"mt-6\">\r\n                                {step < 3 ? (\r\n                                    <button onClick={handleNextStep}\r\n                                        className=\"w-full py-4 rounded-xl font-black text-lg shadow-xl transform transition-all hover:scale-[1.02] active:scale-95 flex items-center justify-center gap-3\"\r\n                                        style={{ backgroundColor: currentScenario.steps[step].color, color: 'black' }}>\r\n                                        {step === 2 ? `­ƒÜÇ ${currentScenario.steps[step].action.toUpperCase()}` : '├ëtape Suivante Ô×í´©Å'}\r\n                                    </button>\r\n                                ) : (\r\n                                    <div className=\"p-4 bg-green-500/20 rounded-xl border border-green-500/50 text-center animate-in zoom-in\">\r\n                                        <div className=\"text-4xl mb-2\">­ƒÄë</div>\r\n                                        <div className=\"font-black text-green-400 uppercase tracking-widest text-sm mb-1\">Mission Accomplie !</div>\r\n                                        <div className=\"text-xs text-green-200/70 italic\">Vous avez valid├® la d├®marche scientifique.</div>\r\n                                        <button onClick={reset} className=\"mt-3 text-xs text-white/50 hover:text-white underline font-bold\">Refaire la mission</button>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            {/* Logbook snippet */}\r\n                            {observationLog.length > 0 && (\r\n                                <div className=\"mt-4 p-3 bg-white/5 rounded-lg border border-white/10\">\r\n                                    <div className=\"text-[10px] text-gray-500 font-bold uppercase mb-2\">Journal d'observation</div>\r\n                                    <div className=\"space-y-1\">\r\n                                        {observationLog.map((log, i) => (\r\n                                            <div key={i} className=\"text-[10px] text-blue-300 flex items-start gap-2\">\r\n                                                <span>ÔÇó</span> <span className=\"truncate\">{log}</span>\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </>\r\n                    ) : (\r\n                        <div className=\"space-y-6\">\r\n                            <XPBar current={score} nextLevel={100} />\r\n                            <div className=\"bg-gray-900/80 p-5 rounded-2xl border border-blue-500/30 shadow-2xl\">\r\n                                <h3 className=\"text-blue-300 font-black mb-4 flex items-center gap-2 text-sm uppercase tracking-wider\">\r\n                                    <span>­ƒºá</span> ├ëvaluation des connaissances\r\n                                </h3>\r\n                                {challenge && (\r\n                                    <div className=\"space-y-5\">\r\n                                        <div className=\"text-lg font-bold leading-tight\">{challenge.q}</div>\r\n                                        <div className=\"grid gap-3\">\r\n                                            {challenge.options.map((opt, idx) => (\r\n                                                <button key={idx} onClick={() => checkAnswer(idx)}\r\n                                                    className=\"w-full text-left p-4 rounded-xl bg-white/5 hover:bg-blue-600/20 border border-white/10 hover:border-blue-500/50 transition-all text-sm font-medium group\">\r\n                                                    <span className=\"opacity-0 group-hover:opacity-100 mr-2 transition-opacity\">Ô×í´©Å</span>\r\n                                                    {opt}\r\n                                                </button>\r\n                                            ))}\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <Text position={[0, 4, 0]} fontSize={0.3} anchorX=\"center\" color=\"white\" font=\"/fonts/Inter-Bold.ttf\">\r\n                MISSION : {currentScenario.id.toUpperCase()}\r\n            </Text>\r\n\r\n            {/* SC├êNE 3D DYNAMIQUE */}\r\n            <group position={[0, -1, 0]}>\r\n                {scenario === 'chimie' && <ChimieScene active={experimentDone && step >= 2} />}\r\n                {scenario === 'plante' && <PlanteScene active={experimentDone && step >= 2} step={step} />}\r\n                {scenario === 'flotte' && <FlotteScene active={experimentDone && step >= 2} />}\r\n            </group>\r\n\r\n            <SuccessOverlay show={showSuccess} message=\"Analyse Correcte !\" points={25} onNext={nextQuestion} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// Sous-composants Sc├¿nes 3D\r\nfunction ChimieScene({ active }) {\r\n    const [bubbles, setBubbles] = useState([]);\r\n\r\n    useEffect(() => {\r\n        if (active) {\r\n            setBubbles(Array.from({ length: 40 }).map(() => ({\r\n                x: (Math.random() - 0.5) * 1.5,\r\n                y: Math.random() * 3,\r\n                scale: Math.random() * 0.1 + 0.05,\r\n                speed: Math.random() * 2 + 1\r\n            })));\r\n        } else {\r\n            setBubbles([]);\r\n        }\r\n    }, [active]);\r\n\r\n    return (\r\n        <group>\r\n            {/* B├®cher */}\r\n            <mesh position={[0, 0, 0]}>\r\n                <cylinderGeometry args={[1, 1, 2.5, 32, 1, true]} />\r\n                <meshPhysicalMaterial color=\"#A5F3FC\" transmission={0.9} opacity={0.5} transparent roughness={0} thickness={0.5} side={THREE.DoubleSide} />\r\n            </mesh>\r\n            {/* Liquide */}\r\n            <mesh position={[0, -0.5, 0]}>\r\n                <cylinderGeometry args={[0.95, 0.9, 1.4, 32]} />\r\n                <meshStandardMaterial color={active ? \"#FCD34D\" : \"#E5E7EB\"} transparent opacity={0.8} />\r\n            </mesh>\r\n            {/* Mousse/Bulles si actif */}\r\n            {active && (\r\n                <group position={[0, 0.5, 0]}>\r\n                    <mesh position={[0, 0.5, 0]} scale={[1.1, 0.5, 1.1]}>\r\n                        <sphereGeometry args={[1, 32, 32]} />\r\n                        <meshStandardMaterial color=\"white\" roughness={0.4} />\r\n                    </mesh>\r\n                    {bubbles.map((b, i) => (\r\n                        <Float key={i} speed={b.speed} rotationIntensity={0} floatIntensity={2} floatingRange={[b.y, b.y + 2]}>\r\n                            <mesh position={[b.x, b.y, b.x]}>\r\n                                <sphereGeometry args={[b.scale]} />\r\n                                <meshStandardMaterial color=\"white\" transparent opacity={0.6} />\r\n                            </mesh>\r\n                        </Float>\r\n                    ))}\r\n                </group>\r\n            )}\r\n        </group>\r\n    );\r\n}\r\n\r\nfunction PlanteScene({ active, step }) {\r\n    // Si step >= 2 (Exp├®rience), la plante est sous une bo├«te (visible ou non)\r\n    // Si active (Step 2 pass├® vers 3), la plante change d'├®tat\r\n    return (\r\n        <group>\r\n            {/* Pot */}\r\n            <mesh position={[0, -1, 0]}>\r\n                <cylinderGeometry args={[0.6, 0.4, 1, 8]} />\r\n                <meshStandardMaterial color=\"#78350F\" />\r\n            </mesh>\r\n            {/* Plante */}\r\n            <group position={[0, -0.5, 0]}>\r\n                <mesh position={[0, 1, 0]} scale={active && step === 3 ? [0.8, 0.6, 0.8] : [1, 1, 1]}> {/* Plante fletrie si fin */}\r\n                    <cylinderGeometry args={[0.05, 0.05, 2]} />\r\n                    <meshStandardMaterial color={active && step === 3 ? \"#D97706\" : \"#15803D\"} />\r\n                </mesh>\r\n                <mesh position={[0, 1.8, 0]} scale={active && step === 3 ? 0.5 : 1}>\r\n                    <dodecahedronGeometry args={[0.8]} />\r\n                    <meshStandardMaterial color={active && step === 3 ? \"#F59E0B\" : \"#22C55E\"} />\r\n                </mesh>\r\n            </group>\r\n            {/* Bo├«te Noire (Cache) */}\r\n            {step === 2 && (\r\n                <mesh position={[0, 0.5, 0]}>\r\n                    <boxGeometry args={[2, 4, 2]} />\r\n                    <meshStandardMaterial color=\"#1F2937\" opacity={0.9} transparent wireframe={false} />\r\n                </mesh>\r\n            )}\r\n            {/* Soleil */}\r\n            <pointLight position={[3, 3, 2]} intensity={2} color=\"#FDB813\" />\r\n        </group>\r\n    );\r\n}\r\n\r\nfunction FlotteScene({ active }) {\r\n    const [saltParticles, setSaltParticles] = useState(null);\r\n\r\n    useEffect(() => {\r\n        if (active) {\r\n            const particles = new Float32Array(300).map(() => (Math.random() - 0.5) * 3);\r\n            setSaltParticles(particles);\r\n        } else {\r\n            setSaltParticles(null);\r\n        }\r\n    }, [active]);\r\n\r\n    return (\r\n        <group>\r\n            {/* Aquarium */}\r\n            <mesh position={[0, 0, 0]}>\r\n                <boxGeometry args={[3, 3, 2]} />\r\n                <meshPhysicalMaterial color=\"#BFDBFE\" transmission={0.8} opacity={0.3} transparent side={THREE.DoubleSide} />\r\n            </mesh>\r\n            {/* Eau */}\r\n            <mesh position={[0, -0.5, 0]}>\r\n                <boxGeometry args={[2.9, 2, 1.9]} />\r\n                <meshStandardMaterial color=\"#3B82F6\" transparent opacity={0.5} />\r\n            </mesh>\r\n            {/* Particules de sel si actif */}\r\n            {active && saltParticles && (\r\n                <points position={[0, -1, 0]}>\r\n                    <bufferGeometry>\r\n                        <bufferAttribute attach=\"attributes-position\" count={100} array={saltParticles} itemSize={3} />\r\n                    </bufferGeometry>\r\n                    <pointsMaterial size={0.05} color=\"white\" />\r\n                </points>\r\n            )}\r\n            {/* ┼Æuf */}\r\n            <Float floatIntensity={active ? 2 : 0} speed={2}>\r\n                <mesh position={[0, active ? 0.2 : -1.2, 0]} rotation={[0, 0, 0.2]}>\r\n                    <sphereGeometry args={[0.4, 32, 32]} />\r\n                    <meshStandardMaterial color=\"#FEF3C7\" roughness={0.5} />\r\n                </mesh>\r\n            </Float>\r\n        </group>\r\n    );\r\n}\r\n\r\n\r\n// ============================================================\r\n// CHAPITRE 2: MESURES ET INCERTITUDES (ENRICHI)\r\n// ============================================================\r\nexport function Chap2Mesures() {\r\n    const [tool, setTool] = useState('ruler');\r\n    const [object, setObject] = useState('block');\r\n    const [measurement, setMeasurement] = useState(null);\r\n    const [precision, setPrecision] = useState(false);\r\n    const [phase, setPhase] = useState('explore');\r\n    const [mission, setMission] = useState(null);\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n\r\n    const tools = {\r\n        ruler: { name: 'R├¿gle', unit: 'cm', color: '#F59E0B', error: 0.1, icon: '­ƒôÅ' },\r\n        balance: { name: 'Balance', unit: 'g', color: '#3B82F6', error: 0.5, icon: 'ÔÜû´©Å' },\r\n        cylinder: { name: '├ëprouvette', unit: 'mL', color: '#10B981', error: 1, icon: '­ƒº¬' },\r\n        chrono: { name: 'Chrono', unit: 's', color: '#8B5CF6', error: 0.01, icon: 'ÔÅ▒´©Å' }\r\n    };\r\n\r\n    const objects = {\r\n        block: { name: 'Bloc de Bois', dim: 12.5, mass: 150, vol: 250, color: '#92400E' },\r\n        apple: { name: 'Pomme Rouge', dim: 8.2, mass: 120, vol: 130, color: '#EF4444' },\r\n        key: { name: 'Cl├® en Fer', dim: 5.5, mass: 25, vol: 3.2, color: '#9CA3AF' },\r\n        water: { name: 'Fiole d\\'Eau', dim: 10, mass: 100, vol: 100, color: '#3B82F6' }\r\n    };\r\n\r\n    const missions = [\r\n        { id: 'arch├®o', text: \"Trouve un objet de ~150 g\", target: 150, tolerance: 5, unit: 'g', icon: '­ƒÅ║', color: '#fbbf24' },\r\n        { id: 'bricolage', text: \"Mesure un objet de ~12.5 cm\", target: 12.5, tolerance: 0.5, unit: 'cm', icon: '­ƒö¿', color: '#60a5fa' },\r\n        { id: 'chimie', text: \"Isole exactement 100 mL\", target: 100, tolerance: 2, unit: 'mL', icon: '­ƒº¬', color: '#34d399' },\r\n    ];\r\n\r\n    const handleMeasure = () => {\r\n        const obj = objects[object];\r\n        let baseVal = 0;\r\n        if (tool === 'ruler') baseVal = obj.dim;\r\n        if (tool === 'balance') baseVal = obj.mass;\r\n        if (tool === 'cylinder') baseVal = obj.vol;\r\n        if (tool === 'chrono') baseVal = 10.5;\r\n\r\n        const errorMargin = precision ? tools[tool].error / 2 : tools[tool].error * 2;\r\n        const randomError = (Math.random() - 0.5) * errorMargin;\r\n        const val = parseFloat((baseVal + randomError).toFixed(precision ? 2 : 1));\r\n        setMeasurement(val);\r\n\r\n        if (phase === 'challenge' && mission) {\r\n            if (tools[tool].unit === mission.unit && Math.abs(val - mission.target) <= mission.tolerance) {\r\n                setScore(s => s + 50);\r\n                setShowSuccess(true);\r\n            }\r\n        }\r\n    };\r\n\r\n    const nextMission = () => {\r\n        const m = missions[Math.floor(Math.random() * missions.length)];\r\n        setMission(m);\r\n        setShowSuccess(false);\r\n        setMeasurement(null);\r\n    };\r\n\r\n    const startChallenge = () => {\r\n        setPhase('challenge');\r\n        nextMission();\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒôÅ Expert en Mesures\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[400px] border-cyan-500/30 text-white\">\r\n                    <div className=\"mb-4\">\r\n                        <PhaseSelector currentPhase={phase} onSelect={(p) => p === 'challenge' ? startChallenge() : setPhase('explore')} />\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-between items-center mb-4 border-b border-white/10 pb-2\">\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-[10px] text-cyan-400 font-bold uppercase tracking-widest leading-tight\">Contr├┤le Labo</span>\r\n                            <span className=\"text-lg font-black\">{phase === 'explore' ? 'Exploration Libre' : 'Mission : ' + mission?.id.toUpperCase()}</span>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {phase === 'explore' ? (\r\n                        <div className=\"space-y-4\">\r\n                            <div>\r\n                                <label className=\"text-[10px] text-gray-500 font-bold uppercase mb-2 block\">1. Objet d'├®tude</label>\r\n                                <div className=\"grid grid-cols-2 gap-2\">\r\n                                    {Object.entries(objects).map(([k, o]) => (\r\n                                        <button key={k} onClick={() => { setObject(k); setMeasurement(null); }}\r\n                                            className={`px-3 py-2 rounded-xl text-xs font-black transition-all border-2 ${object === k ? 'bg-cyan-600 border-white shadow-lg' : 'bg-gray-800 border-transparent hover:bg-gray-700'}`}>\r\n                                            {o.name}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"text-[10px] text-gray-500 font-bold uppercase mb-2 block\">2. Instrument</label>\r\n                                <div className=\"grid grid-cols-4 gap-2\">\r\n                                    {Object.entries(tools).map(([k, t]) => (\r\n                                        <button key={k} onClick={() => { setTool(k); setMeasurement(null); }}\r\n                                            className={`p-2 rounded-xl flex flex-col items-center gap-1 transition-all border-2 ${tool === k ? 'bg-white text-black border-cyan-400 scale-105 shadow-xl' : 'bg-gray-800 text-gray-400 border-transparent hover:bg-gray-750'}`}>\r\n                                            <span className=\"text-xl\">{t.icon}</span>\r\n                                            <span className=\"text-[8px] uppercase font-black\">{t.name}</span>\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"space-y-4\">\r\n                            {mission && <MissionObjective objective={mission.text} icon={mission.icon} />}\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"mt-4 p-4 bg-black/40 rounded-xl border border-white/5\">\r\n                        <div className=\"flex items-center justify-between mb-2\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <input type=\"checkbox\" checked={precision} onChange={() => setPrecision(!precision)}\r\n                                    className=\"w-4 h-4 rounded bg-gray-800 border-gray-700 text-cyan-500 focus:ring-cyan-500\" />\r\n                                <span className=\"text-xs font-bold text-gray-300\">Mode Haute Pr├®cision</span>\r\n                            </div>\r\n                            <span className=\"text-[10px] font-mono text-gray-500\">┬▒ {precision ? tools[tool].error / 2 : tools[tool].error * 2} {tools[tool].unit}</span>\r\n                        </div>\r\n\r\n                        <button onClick={handleMeasure}\r\n                            className=\"w-full py-4 rounded-xl font-black text-lg bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 shadow-[0_0_20px_rgba(8,145,178,0.3)] transform transition-active group\">\r\n                            MESURER L'OBJET\r\n                            <span className=\"ml-2 transition-transform group-hover:translate-x-1 inline-block\">Ô×í´©Å</span>\r\n                        </button>\r\n                    </div>\r\n\r\n                    {measurement && (\r\n                        <div className=\"mt-4 p-5 bg-cyan-950/30 rounded-2xl border border-cyan-500/40 text-center animate-in zoom-in slide-in-from-bottom-2 duration-300\">\r\n                            <div className=\"text-[10px] text-cyan-400 font-black uppercase tracking-[0.2em] mb-1\">Affichage Digital</div>\r\n                            <div className=\"text-5xl font-mono font-black text-white drop-shadow-[0_0_15px_rgba(255,255,255,0.3)]\">\r\n                                {measurement} <span className=\"text-2xl text-cyan-400\">{tools[tool].unit}</span>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <XPBar current={score % 100} nextLevel={100} />\r\n\r\n            <Text position={[0, 4, 0]} fontSize={0.4} color=\"#22D3EE\" font=\"/fonts/Inter-Bold.ttf\" outlineWidth={0.02} outlineColor=\"black\">\r\n                LABO DE M├ëTROLOGIE\r\n            </Text>\r\n\r\n            {/* Visualisation 3D */}\r\n            <group position={[0, -1, 0]}>\r\n                {/* L'Objet */}\r\n                <group position={[0, 0.5, 0]}>\r\n                    <Float speed={2} rotationIntensity={0.5} floatIntensity={0.5}>\r\n                        {object === 'block' && <Box args={[2, 2, 2]}><meshStandardMaterial color={objects.block.color} roughness={0.7} /></Box>}\r\n                        {object === 'apple' && <Sphere args={[0.8, 32, 32]}><meshStandardMaterial color={objects.apple.color} roughness={0.3} /></Sphere>}\r\n                        {object === 'key' && <Box args={[0.8, 0.2, 1.8]}><meshStandardMaterial color={objects.key.color} metalness={0.8} roughness={0.2} /></Box>}\r\n                        {object === 'water' && (\r\n                            <group>\r\n                                <Cylinder args={[0.7, 0.7, 2, 32]} position={[0, 0, 0]}>\r\n                                    <meshPhysicalMaterial color=\"#3B82F6\" transmission={0.5} opacity={0.6} transparent roughness={0} />\r\n                                </Cylinder>\r\n                                <Cylinder args={[0.75, 0.75, 2.1, 32, 1, true]}>\r\n                                    <meshPhysicalMaterial color=\"white\" transmission={0.9} opacity={0.3} transparent thickness={0.2} />\r\n                                </Cylinder>\r\n                            </group>\r\n                        )}\r\n                    </Float>\r\n                </group>\r\n\r\n                {/* Instrument */}\r\n                <group position={[-3, 0.5, 0]}>\r\n                    {tool === 'ruler' && (\r\n                        <group rotation={[0, 0, Math.PI / 2]} position={[2, 0, 1.2]}>\r\n                            <Box args={[5, 0.5, 0.1]}><meshStandardMaterial color=\"#F59E0B\" /></Box>\r\n                            {Array.from({ length: 11 }).map((_, i) => (\r\n                                <group key={i} position={[-2.5 + i * 0.5, 0.25, 0.06]}>\r\n                                    <Box args={[0.02, 0.1, 0.01]} material-color=\"black\" />\r\n                                    {i % 2 === 0 && <Text position={[0, 0.15, 0]} fontSize={0.1} color=\"black\">{i * 5}</Text>}\r\n                                </group>\r\n                            ))}\r\n                        </group>\r\n                    )}\r\n\r\n                    {tool === 'balance' && (\r\n                        <group position={[3, -1.2, 0]}>\r\n                            <Box args={[3.5, 0.4, 3]}><meshStandardMaterial color=\"#1f2937\" /></Box>\r\n                            <Box args={[3.2, 0.1, 2.8]} position={[0, 0.25, 0]}><meshStandardMaterial color=\"#9ca3af\" metalness={0.8} /></Box>\r\n                            <Text position={[0, 0.1, 1.2]} rotation={[-Math.PI / 2, 0, 0]} fontSize={0.4} color=\"#00ff00\" font=\"/fonts/Digital.ttf\">\r\n                                {measurement && tool === 'balance' ? measurement : '0.00'}\r\n                            </Text>\r\n                        </group>\r\n                    )}\r\n\r\n                    {tool === 'cylinder' && (\r\n                        <group position={[3, 0.5, 0]}>\r\n                            <Cylinder args={[0.8, 0.8, 3, 32, 1, true]}><meshPhysicalMaterial color=\"white\" transmission={0.9} opacity={0.2} transparent /></Cylinder>\r\n                            <Cylinder args={[0.78, 0.78, 1.5, 32]} position={[0, -0.75, 0]}><meshStandardMaterial color=\"#3b82f6\" opacity={0.6} transparent /></Cylinder>\r\n                        </group>\r\n                    )}\r\n                </group>\r\n            </group>\r\n\r\n            <SuccessOverlay show={showSuccess} message=\"Mesure Pr├®cise !\" points={50} onNext={nextMission} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// CHAPITRE 3: DENSIT├ë & ARCHIM├êDE\r\n// ============================================================\r\nexport function Chap3Densite() {\r\n    const [liquid, setLiquid] = useState('water');\r\n    const [object, setObject] = useState('wood');\r\n    const [showForces, setShowForces] = useState(false);\r\n    const [mode, setMode] = useState('explore');\r\n    const [mysteryMaterial, setMysteryMaterial] = useState(null);\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [history, setHistory] = useState([]);\r\n\r\n    const liquids = {\r\n        water: { name: 'Eau Distill├®e', density: 1.0, color: '#3B82F6', icon: '­ƒÆº' },\r\n        oil: { name: 'Huile V├®g├®tale', density: 0.9, color: '#FBBF24', icon: '­ƒî╗' },\r\n        honey: { name: 'Miel Liquide', density: 1.4, color: '#D97706', icon: '­ƒì»' },\r\n        mercury: { name: 'Mercure Pur', density: 13.6, color: '#9CA3AF', icon: '­ƒº¬' }\r\n    };\r\n\r\n    const objects = {\r\n        wood: { name: 'Bois Ch├¬ne', density: 0.6, color: '#92400E', icon: '­ƒ¬Á' },\r\n        ice: { name: 'Glace Vive', density: 0.92, color: '#A5F3FC', icon: '­ƒºè' },\r\n        plastic: { name: 'PVC Rouge', density: 1.1, color: '#EF4444', icon: '­ƒö┤' },\r\n        iron: { name: 'Acier Brut', density: 7.8, color: '#4B5563', icon: '­ƒö®' },\r\n        gold: { name: 'Or Pur', density: 19.3, color: '#FFD700', icon: '­ƒææ' }\r\n    };\r\n\r\n    const startDetective = () => {\r\n        const mats = Object.keys(objects);\r\n        const secret = mats[Math.floor(Math.random() * mats.length)];\r\n        setMysteryMaterial(secret);\r\n        setObject('mystery');\r\n        setMode('challenge');\r\n        setShowSuccess(false);\r\n    };\r\n\r\n    const currentObjKey = object === 'mystery' ? mysteryMaterial : object;\r\n    const currentObjProps = object === 'mystery' ?\r\n        { name: 'Bloc Myst├¿re', density: objects[mysteryMaterial]?.density, color: '#333' }\r\n        : objects[object];\r\n\r\n    const liq = liquids[liquid];\r\n    const obj = currentObjProps;\r\n\r\n    const guessMaterial = (matKey) => {\r\n        if (matKey === mysteryMaterial) {\r\n            setScore(s => s + 100);\r\n            setShowSuccess(true);\r\n        } else {\r\n            alert(\"Erreur d'analyse ! Cette mati├¿re ne correspond pas ├á la densit├® observ├®e.\");\r\n        }\r\n    };\r\n\r\n    const densityRatio = obj.density / liq.density;\r\n    let immersionLevel = densityRatio < 1 ? 1.5 - (densityRatio * 1.0) : -1.5;\r\n\r\n    const logMeasurement = () => {\r\n        const last = history[history.length - 1];\r\n        if (last && last.obj === obj.name && last.liq === liq.name) return;\r\n        setHistory(prev => [...prev.slice(-4), {\r\n            obj: obj.name, liq: liq.name, dObj: obj.density, dLiq: liq.density, floats: obj.density < liq.density\r\n        }]);\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒº¬ Expert en Densit├®\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[420px] border-blue-500/30 text-white\">\r\n                    <div className=\"mb-4\">\r\n                        <PhaseSelector currentPhase={mode} onSelect={(m) => m === 'challenge' ? startDetective() : setMode('explore')} />\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-between items-center mb-4 border-b border-white/10 pb-2\">\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-[10px] text-blue-400 font-bold uppercase tracking-widest\">Laboratoire d'Archim├¿de</span>\r\n                            <span className=\"text-lg font-black\">{mode === 'explore' ? 'Simulateur de Flottaison' : 'Enqu├¬te de Mati├¿re ­ƒòÁ´©Å'}</span>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {mode === 'challenge' ? (\r\n                        <div className=\"space-y-4\">\r\n                            <MissionObjective objective=\"Identifiez la mati├¿re cach├®e en observant comment elle flotte dans diff├®rents liquides.\" icon=\"­ƒöì\" />\r\n                            <div className=\"grid grid-cols-3 gap-2\">\r\n                                {Object.entries(objects).map(([k, o]) => (\r\n                                    <button key={k} onClick={() => guessMaterial(k)}\r\n                                        className=\"p-3 bg-gray-900 border border-white/5 rounded-xl flex flex-col items-center gap-1 hover:bg-blue-900/40 transition-all\">\r\n                                        <span className=\"text-xl\">{o.icon}</span>\r\n                                        <span className=\"text-[10px] font-black uppercase text-center leading-none\">{o.name}</span>\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"space-y-4\">\r\n                            <div>\r\n                                <label className=\"text-[10px] text-gray-500 font-bold uppercase mb-2 block tracking-widest\">1. S├®lection du Liquide</label>\r\n                                <div className=\"grid grid-cols-4 gap-2\">\r\n                                    {Object.entries(liquids).map(([k, l]) => (\r\n                                        <button key={k} onClick={() => setLiquid(k)}\r\n                                            className={`p-2 rounded-xl flex flex-col items-center gap-1 transition-all border ${liquid === k ? 'bg-blue-600 border-blue-400 shadow-lg scale-105' : 'bg-gray-900 border-white/5 opacity-50'}`}>\r\n                                            <span className=\"text-xl\">{l.icon}</span>\r\n                                            <span className=\"text-[8px] font-black uppercase text-center leading-none\">{l.name}</span>\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-[10px] text-gray-500 font-bold uppercase mb-2 block tracking-widest\">2. Choix de l'├ëchantillon</label>\r\n                                <div className=\"grid grid-cols-5 gap-2\">\r\n                                    {Object.entries(objects).map(([k, o]) => (\r\n                                        <button key={k} onClick={() => setObject(k)}\r\n                                            className={`p-2 rounded-xl flex flex-col items-center gap-1 transition-all border ${object === k ? 'bg-white text-black border-white shadow-lg scale-105' : 'bg-gray-900 border-white/5 opacity-50'}`}>\r\n                                            <span className=\"text-xl\">{o.icon}</span>\r\n                                            <span className=\"text-[8px] font-black uppercase text-center leading-none\">{o.name}</span>\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"mt-6 flex gap-2\">\r\n                        <button onClick={() => setShowForces(!showForces)} className={`flex-1 py-4 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${showForces ? 'bg-purple-600 shadow-lg shadow-purple-900/40' : 'bg-gray-800 text-gray-400 hover:bg-gray-700'}`}>\r\n                            {showForces ? '­ƒæü´©Å Forces Visibles' : 'Afficher les Forces'}\r\n                        </button>\r\n                        <button onClick={logMeasurement} className=\"flex-1 py-4 rounded-xl text-[10px] font-black uppercase tracking-widest bg-emerald-600/20 text-emerald-400 border border-emerald-500/30 hover:bg-emerald-600 hover:text-white transition-all\">\r\n                            ­ƒôô Noter R├®sultat\r\n                        </button>\r\n                    </div>\r\n\r\n                    <div className=\"mt-4 bg-black/40 p-4 rounded-xl border border-white/5 relative overflow-hidden\">\r\n                        <div className=\"flex justify-between items-center text-[10px] font-black uppercase tracking-widest mb-2\">\r\n                            <span className=\"text-gray-500\">Ratio de Densit├® (¤üo/¤ül)</span>\r\n                            <span className={densityRatio < 1 ? 'text-emerald-400' : 'text-rose-400'}>{densityRatio.toFixed(2)}</span>\r\n                        </div>\r\n                        <div className=\"w-full bg-gray-800 h-1.5 rounded-full overflow-hidden mb-4\">\r\n                            <div className={`h-full transition-all duration-1000 ${densityRatio < 1 ? 'bg-emerald-500' : 'bg-rose-500'}`} style={{ width: `${Math.min(100, densityRatio * 50)}%` }} />\r\n                        </div>\r\n                        <div className={`py-3 rounded-2xl font-black text-center text-xs uppercase tracking-[0.2em] shadow-inner ${densityRatio < 1 ? 'bg-emerald-500/20 text-emerald-400 border border-emerald-500/20' : 'bg-rose-500/20 text-rose-400 border border-rose-500/20'}`}>\r\n                            {densityRatio < 1 ? 'L\\'objet Flotte ­ƒ½º' : 'L\\'objet Coule ÔÜô'}\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <XPBar current={score % 100} nextLevel={100} />\r\n            <SuccessOverlay show={showSuccess} message={`Eur├¬ka ! La mati├¿re ├®tait bien : ${objects[mysteryMaterial]?.name}`} points={100} onNext={startDetective} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            <group position={[0, -1, 0]}>\r\n                {/* Cuve */}\r\n                <Box args={[4.2, 4.2, 3.2]}><meshPhysicalMaterial color=\"#30507a\" transmission={0.9} thickness={0.2} roughness={0} transparent opacity={0.2} side={THREE.BackSide} /></Box>\r\n                <Box args={[4, 4, 3]} position={[0, 0, 0]}><meshPhysicalMaterial color=\"#88CCFF\" transmission={0.7} thickness={0.5} roughness={0.1} transparent opacity={0.3} /></Box>\r\n\r\n                {/* Liquide */}\r\n                <Box position={[0, -0.5, 0]} args={[3.9, 2.9, 2.9]}>\r\n                    <meshStandardMaterial color={liq.color} transparent opacity={0.5} emissive={liq.color} emissiveIntensity={0.2} />\r\n                </Box>\r\n\r\n                <Float speed={densityRatio < 1 ? 2 : 0} rotationIntensity={0.2} floatIntensity={0.5} position={[0, immersionLevel, 0]}>\r\n                    <mesh>\r\n                        <boxGeometry args={[1, 1, 1]} />\r\n                        <meshStandardMaterial color={obj.color} metalness={object === 'iron' || object === 'gold' ? 0.8 : 0} roughness={0.4} />\r\n                    </mesh>\r\n\r\n                    {showForces && (\r\n                        <group>\r\n                            {/* Poids (Gravit├®) */}\r\n                            <arrowHelper args={[new THREE.Vector3(0, -1, 0), new THREE.Vector3(0, 0, 0), 1.2 + obj.density / 10, 0xef4444, 0.2, 0.1]} />\r\n                            {/* Pouss├®e d'Archim├¿de */}\r\n                            <arrowHelper args={[new THREE.Vector3(0, 1, 0), new THREE.Vector3(0, 0, 0), 1.2 + (densityRatio < 1 ? obj.density : liq.density) / 10, 0x22c55e, 0.2, 0.1]} />\r\n                        </group>\r\n                    )}\r\n                </Float>\r\n            </group>\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// CHAPITRE 4: POIDS ET MASSE (ENRICHI)\r\n// ============================================================\r\nexport function Chap4PoidsMasse() {\r\n    const [planet, setPlanet] = useState('earth');\r\n    const [mass, setMass] = useState(50);\r\n    const [phase, setPhase] = useState('explore');\r\n    const [targetWeight, setTargetWeight] = useState(null);\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [useCustomG, setUseCustomG] = useState(false);\r\n    const [customG, setCustomG] = useState(9.8);\r\n\r\n    const planets = {\r\n        mercury: { name: 'Mercure', g: 3.7, color: '#9CA3AF', icon: '­ƒ¬É' },\r\n        venus: { name: 'V├®nus', g: 8.87, color: '#FCD34D', icon: 'Ô£¿' },\r\n        earth: { name: 'Terre', g: 9.81, color: '#3B82F6', icon: '­ƒîì' },\r\n        moon: { name: 'Lune', g: 1.62, color: '#D1D5DB', icon: '­ƒîÖ' },\r\n        mars: { name: 'Mars', g: 3.71, color: '#EF4444', icon: '­ƒö┤' },\r\n        jupiter: { name: 'Jupiter', g: 24.79, color: '#D97706', icon: '­ƒîÇ' },\r\n        saturn: { name: 'Saturne', g: 10.44, color: '#FDE047', icon: '­ƒ¬É' },\r\n        void: { name: 'Espace', g: 0.1, color: '#111827', icon: '­ƒîî' }\r\n    };\r\n\r\n    const startMission = () => {\r\n        const keys = Object.keys(planets).filter(k => k !== 'void');\r\n        const targetPKey = keys[Math.floor(Math.random() * keys.length)];\r\n        const targetP = planets[targetPKey];\r\n        const randomMass = 50 + Math.floor(Math.random() * 50);\r\n        const w = Math.round(randomMass * targetP.g);\r\n\r\n        setMass(randomMass);\r\n        setTargetWeight({ val: w, planetKey: targetPKey });\r\n        setPhase('challenge');\r\n        setPlanet('earth');\r\n        setUseCustomG(false);\r\n        setShowSuccess(false);\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (phase === 'challenge' && targetWeight && planet === targetWeight.planetKey) {\r\n            setScore(s => s + 50);\r\n            setShowSuccess(true);\r\n        }\r\n    }, [planet, phase, targetWeight]);\r\n\r\n    const g = useCustomG ? customG : planets[planet].g;\r\n    const weight = mass * g;\r\n\r\n    return (\r\n        <group>\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒÜÇ Mission Gravit├®\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[400px] border-indigo-500/30 text-white\">\r\n                    <div className=\"mb-4\">\r\n                        <PhaseSelector currentPhase={phase} onSelect={(p) => p === 'challenge' ? startMission() : setPhase('explore')} />\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-between items-center mb-4 border-b border-white/10 pb-2\">\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-[10px] text-indigo-400 font-bold uppercase tracking-widest leading-tight\">Astrophysique Interactive</span>\r\n                            <span className=\"text-lg font-black\">{phase === 'explore' ? 'Simulateur de Poids' : 'D├®fi Interstellaire ­ƒîî'}</span>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {phase === 'challenge' && targetWeight && (\r\n                        <div className=\"mb-4\">\r\n                            <MissionObjective objective={`Sur quel astre un objet de ${mass} kg p├¿se-t-il environ ${targetWeight.val} N ?`} icon=\"­ƒôí\" />\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"grid grid-cols-4 gap-2\">\r\n                            {Object.entries(planets).map(([k, p]) => (\r\n                                <button key={k} onClick={() => setPlanet(k)}\r\n                                    className={`p-2 rounded-xl flex flex-col items-center gap-1 transition-all border-2 ${planet === k && !useCustomG ? 'border-indigo-500 bg-indigo-500/20 scale-105' : 'border-gray-800 bg-gray-900/50 hover:bg-gray-800'}`}>\r\n                                    <span className=\"text-xl\">{p.icon}</span>\r\n                                    <span className=\"text-[8px] font-black uppercase text-center\">{p.name}</span>\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n\r\n                        <div className=\"bg-black/40 p-4 rounded-xl border border-white/5 space-y-4\">\r\n                            <div className=\"flex items-center justify-between gap-4\">\r\n                                <div className=\"flex-1\">\r\n                                    <div className=\"flex justify-between text-[10px] font-bold text-gray-500 mb-2\">\r\n                                        <span>MASSE (Constant)</span>\r\n                                        <span className=\"text-white\">{mass} KG</span>\r\n                                    </div>\r\n                                    <input type=\"range\" min=\"10\" max=\"200\" value={mass} disabled={phase === 'challenge'} onChange={(e) => setMass(Number(e.target.value))}\r\n                                        className=\"w-full h-2 bg-gray-800 rounded-lg appearance-none cursor-pointer accent-indigo-500 disabled:opacity-50\" />\r\n                                </div>\r\n                                <div className=\"w-px h-10 bg-white/10\" />\r\n                                <div className=\"flex flex-col items-center\">\r\n                                    <button onClick={() => setUseCustomG(!useCustomG)} disabled={phase === 'challenge'}\r\n                                        className={`p-2 rounded-lg border flex flex-col items-center gap-1 transition-all ${useCustomG ? 'border-purple-500 bg-purple-500/20' : 'border-gray-700 opacity-50'}`}>\r\n                                        <span className=\"text-sm\">­ƒøá´©Å</span>\r\n                                        <span className=\"text-[8px] font-bold uppercase\">Manuel g</span>\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {useCustomG && (\r\n                                <div className=\"animate-in slide-in-from-top-2\">\r\n                                    <div className=\"flex justify-between text-[10px] font-bold text-purple-400 mb-2\">\r\n                                        <span>ACC├ëL├ëRATION GRAVITATIONNELLE (G)</span>\r\n                                        <span className=\"text-white\">{customG.toFixed(2)} N/KG</span>\r\n                                    </div>\r\n                                    <input type=\"range\" min=\"0.1\" max=\"25\" step=\"0.1\" value={customG} onChange={(e) => setCustomG(Number(e.target.value))}\r\n                                        className=\"w-full h-2 bg-gray-800 rounded-lg appearance-none cursor-pointer accent-purple-500\" />\r\n                                </div>\r\n                            )}\r\n\r\n                            <div className=\"p-3 bg-indigo-950/30 rounded-lg border border-indigo-500/30 text-center relative overflow-hidden group\">\r\n                                <div className=\"relative z-10\">\r\n                                    <div className=\"text-[10px] text-indigo-400 font-black mb-1\">DYNAMOM├êTRE DIGITAL</div>\r\n                                    <div className=\"text-4xl font-mono font-black text-white\">\r\n                                        {weight.toFixed(1)} <span className=\"text-xl text-indigo-400\">N</span>\r\n                                    </div>\r\n                                </div>\r\n                                <div className={`absolute inset-0 bg-indigo-500/5 transition-all ${weight > 1000 ? 'opacity-20 animate-pulse' : 'opacity-0'}`} />\r\n                                <div className=\"absolute top-0 right-0 p-1\">\r\n                                    <div className={`w-2 h-2 rounded-full ${weight > 1000 ? 'bg-red-500 animate-pulse' : 'bg-green-500'}`} />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"flex justify-between items-center text-[10px] font-bold text-gray-400 bg-gray-900/50 p-2 rounded-lg\">\r\n                            <span>FORMULE : P = m ├ù g</span>\r\n                            <span className=\"text-indigo-400\">G LOCAL : {g.toFixed(2)} N/kg</span>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <XPBar current={score % 100} nextLevel={100} />\r\n\r\n            <SuccessOverlay show={showSuccess} message=\"Succ├¿s ! La gravit├® correspond exactement aux mesures.\" points={50} onNext={startMission} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            <Text position={[0, 4, 0]} fontSize={0.4} color=\"#818CF8\" font=\"/fonts/Inter-Bold.ttf\" outlineWidth={0.02} outlineColor=\"black\">\r\n                STATION DE PESAGE SPATIALE\r\n            </Text>\r\n\r\n            <group position={[0, -2, 0]}>\r\n                {/* Surface de la plan├¿te */}\r\n                <mesh rotation={[-Math.PI / 2, 0, 0]}>\r\n                    <planeGeometry args={[25, 25]} />\r\n                    <meshStandardMaterial color={planets[planet].color} roughness={0.8} />\r\n                </mesh>\r\n                <gridHelper args={[25, 15, planets[planet].color, '#333']} rotation={[0, 0, 0]} />\r\n\r\n                <Float speed={1.5} rotationIntensity={0.5} floatIntensity={0.5}>\r\n                    <group position={[0, 2, 0]}>\r\n                        <mesh>\r\n                            <boxGeometry args={[1, 1, 1]} />\r\n                            <meshStandardMaterial color=\"#374151\" metalness={0.8} roughness={0.2} />\r\n                        </mesh>\r\n                        <Text position={[0, 0.7, 0]} fontSize={0.25} color=\"white\" font=\"/fonts/Inter-Bold.ttf\">{mass}kg</Text>\r\n\r\n                        {/* Vecteur Poids */}\r\n                        <group position={[0, -0.6, 0]}>\r\n                            <arrowHelper args={[new THREE.Vector3(0, -1, 0), new THREE.Vector3(0, 0, 0), 0.5 + weight / 500, 0xef4444, 0.2, 0.1]} />\r\n                            <Text position={[0.4, -0.5, 0]} fontSize={0.2} color=\"#ef4444\">P</Text>\r\n                        </group>\r\n                    </group>\r\n                </Float>\r\n            </group>\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// CHAPITRE 5: ├ëLECTRICIT├ë (ENRICHI)\r\n// ============================================================\r\n// ============================================================\r\n// CHAPITRE 5: ├ëLECTRICIT├ë (ULTIMATE EDITION)\r\n// ============================================================\r\nexport function Chap5Electricite() {\r\n    const [topology, setTopology] = useState('series'); // 'series' | 'parallel'\r\n    const [slots, setSlots] = useState({}); // { 0: 'lamp', 1: 'wire', ... }\r\n    const [switchState, setSwitchState] = useState(false);\r\n    const [showMenu, setShowMenu] = useState(null); // Slot ID being edited\r\n\r\n    // Gamification\r\n    const [phase, setPhase] = useState('explore'); // 'explore' | 'challenge'\r\n    const [challenge, setChallenge] = useState(null);\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n\r\n    // Initialisation\r\n    useEffect(() => {\r\n        resetCircuit();\r\n    }, [topology]);\r\n\r\n    const resetCircuit = () => {\r\n        if (topology === 'series') {\r\n            setSlots({ 0: 'lamp', 1: 'wire', 2: 'wire' });\r\n        } else {\r\n            setSlots({ 0: 'lamp', 1: 'wire', 2: 'motor', 3: 'wire' });\r\n        }\r\n        setSwitchState(false);\r\n        setPhase('explore');\r\n    };\r\n\r\n    // --- DATA COMPONENTS ---\r\n    const standardComponents = [\r\n        { id: 'wire', name: 'Fil', icon: 'Ô×û', r: 0.1, type: 'basic' },\r\n        { id: 'lamp', name: 'Lampe', icon: '­ƒÆí', r: 10, type: 'basic' },\r\n        { id: 'motor', name: 'Moteur', icon: 'ÔÜÖ´©Å', r: 15, type: 'basic' },\r\n        { id: 'open', name: 'Vide', icon: '­ƒÜ½', r: Infinity, type: 'basic' }\r\n    ];\r\n\r\n    const resistorsList = [\r\n        { val: 10, colors: ['­ƒƒñ', 'ÔÜ½', 'ÔÜ½'] },\r\n        { val: 100, colors: ['­ƒƒñ', 'ÔÜ½', '­ƒƒñ'] },\r\n        { val: 220, colors: ['­ƒö┤', '­ƒö┤', '­ƒƒñ'] },\r\n        { val: 1000, colors: ['­ƒƒñ', 'ÔÜ½', '­ƒö┤'] },\r\n    ];\r\n\r\n    const getCompInfo = (id) => {\r\n        if (!id) return standardComponents[3];\r\n        if (id.startsWith('resistor_')) {\r\n            const val = parseInt(id.split('_')[1]);\r\n            return { id, name: `R ${val}╬®`, icon: 'Ôûå', r: val, type: 'resistor' };\r\n        }\r\n        return standardComponents.find(c => c.id === id) || standardComponents[3];\r\n    };\r\n\r\n    // --- CIRCUIT ANALYSIS ---\r\n    const analysis = useMemo(() => {\r\n        if (!switchState) return { status: 'open', msg: 'Circuit ouvert', current: 0 };\r\n\r\n        let status = 'ok';\r\n        let msg = 'Valide';\r\n        let current = 0;\r\n\r\n        try {\r\n            if (topology === 'series') {\r\n                const rTotal = [0, 1, 2].reduce((acc, slotId) => acc + getCompInfo(slots[slotId]).r, 0);\r\n                if (rTotal < 1) throw 'short';\r\n                if (rTotal === Infinity) throw 'open';\r\n                current = 4.5 / rTotal;\r\n            } else {\r\n                const rB1 = getCompInfo(slots[0]).r + getCompInfo(slots[1]).r;\r\n                const rB2 = getCompInfo(slots[2]).r + getCompInfo(slots[3]).r;\r\n\r\n                if (rB1 < 1 || rB2 < 1) throw 'short';\r\n                if (rB1 === Infinity && rB2 === Infinity) throw 'open';\r\n\r\n                current = (rB1 !== Infinity ? 4.5 / rB1 : 0) + (rB2 !== Infinity ? 4.5 / rB2 : 0);\r\n            }\r\n        } catch (e) {\r\n            status = e;\r\n            msg = e === 'short' ? 'ÔÜá´©Å COURT-CIRCUIT !' : 'Circuit Ouvert';\r\n        }\r\n\r\n        // Check Challenge Success\r\n        if (phase === 'challenge' && challenge && !showSuccess) {\r\n            if (challenge.type === 'color_code') {\r\n                if (Object.values(slots).includes(`resistor_${challenge.targetVal}`)) {\r\n                    triggerSuccess();\r\n                }\r\n            }\r\n            if (challenge.type === 'target_current') {\r\n                if (status === 'ok' && Math.abs(current - challenge.targetI) < 0.01) {\r\n                    triggerSuccess();\r\n                }\r\n            }\r\n        }\r\n\r\n        return { status, msg, current };\r\n    }, [topology, slots, switchState, phase, challenge]);\r\n\r\n    const triggerSuccess = () => {\r\n        setScore(s => s + 100);\r\n        setShowSuccess(true);\r\n    };\r\n\r\n    const nextChallenge = () => {\r\n        setShowSuccess(false);\r\n        const types = ['color_code', 'target_current'];\r\n        const type = types[Math.floor(Math.random() * types.length)];\r\n\r\n        if (type === 'color_code') {\r\n            const r = resistorsList[Math.floor(Math.random() * resistorsList.length)];\r\n            setChallenge({\r\n                type,\r\n                header: \"D├®fi : Code Couleur\",\r\n                text: `Ins├¿re la r├®sistance : ${getResistorColorName(r.val)}`,\r\n                hint: `Cherche les bandes : ${r.colors.join(' ')}`,\r\n                targetVal: r.val\r\n            });\r\n        } else {\r\n            const targets = [\r\n                { i: 0.04, val: 100, txt: \"~0.04 A\" },\r\n                { i: 0.02, val: 220, txt: \"~0.02 A\" },\r\n                { i: 0.45, val: 0, txt: \"Maximize (0.45 A)\" }\r\n            ];\r\n            const t = targets[Math.floor(Math.random() * targets.length)];\r\n            setSwitchState(true);\r\n            setTopology('series');\r\n            setSlots({ 0: 'lamp', 1: 'wire', 2: 'wire' });\r\n            setChallenge({\r\n                type,\r\n                header: \"D├®fi : Ing├®nieur\",\r\n                text: `R├¿gle l'intensit├® du circuit ├á ${t.txt}`,\r\n                hint: \"Utilise la loi d'Ohm : I = U / R\",\r\n                targetI: t.i\r\n            });\r\n        }\r\n    };\r\n\r\n    const startChallengeMode = () => {\r\n        setPhase('challenge');\r\n        setScore(0);\r\n        nextChallenge();\r\n    };\r\n\r\n    const setSlotComponent = (id, type) => {\r\n        setSlots(prev => ({ ...prev, [id]: type }));\r\n        setShowMenu(null);\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"ÔÜí Expert en ├ëlectricit├®\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[400px] border-yellow-500/30 text-white\">\r\n                    <div className=\"mb-4\">\r\n                        <PhaseSelector currentPhase={phase} onSelect={(p) => p === 'challenge' ? startChallengeMode() : setPhase('explore')} />\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-between items-center mb-4 border-b border-white/10 pb-2\">\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-[10px] text-yellow-400 font-bold uppercase tracking-widest leading-tight\">G├®nie ├ëlectrique</span>\r\n                            <span className=\"text-lg font-black\">{phase === 'explore' ? 'Laboratoire Ouvert' : 'Maintenance Critique ­ƒøá´©Å'}</span>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {phase === 'challenge' && challenge && (\r\n                        <div className=\"mb-4\">\r\n                            <MissionObjective objective={challenge.text} icon=\"­ƒôƒ\" />\r\n                            <div className=\"mt-1 text-[10px] text-white/50 italic px-2\">Indice : {challenge.hint}</div>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"flex gap-2 p-1 bg-gray-900/50 rounded-xl border border-white/5\">\r\n                            <button onClick={() => setTopology('series')}\r\n                                className={`flex-1 py-2 text-[10px] font-bold rounded-lg transition-all ${topology === 'series' ? 'bg-yellow-600 text-white shadow-lg' : 'text-gray-400 hover:bg-white/5'}`}>\r\n                                CIRCUIT S├ëRIE\r\n                            </button>\r\n                            <button onClick={() => setTopology('parallel')}\r\n                                className={`flex-1 py-2 text-[10px] font-bold rounded-lg transition-all ${topology === 'parallel' ? 'bg-yellow-600 text-white shadow-lg' : 'text-gray-400 hover:bg-white/5'}`}>\r\n                                CIRCUIT D├ëRIVATION\r\n                            </button>\r\n                        </div>\r\n\r\n                        <button onClick={() => setSwitchState(!switchState)}\r\n                            className={`w-full py-3 rounded-xl font-black text-lg shadow-xl transform transition-all active:scale-95 ${switchState ? 'bg-green-600 hover:bg-green-500 shadow-green-900/20' : 'bg-red-600 hover:bg-red-500 shadow-red-900/20'}`}>\r\n                            {switchState ? '­ƒöî CIRCUIT FERM├ë (ON)' : 'Ô¡ò CIRCUIT OUVERT (OFF)'}\r\n                        </button>\r\n\r\n                        <div className=\"grid grid-cols-2 gap-3\">\r\n                            <div className=\"bg-gray-800/80 p-3 rounded-xl border border-white/5 text-center\">\r\n                                <div className=\"text-[10px] text-gray-400 uppercase font-black mb-1 tracking-tighter\">Diagnostic</div>\r\n                                <div className={`font-mono text-sm font-bold ${analysis.status === 'short' ? 'text-red-500 animate-pulse' : 'text-green-400'}`}>\r\n                                    {analysis.msg}\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"bg-gray-800/80 p-3 rounded-xl border border-white/5 text-center\">\r\n                                <div className=\"text-[10px] text-gray-400 uppercase font-black mb-1 tracking-tighter\">Amp├¿rem├¿tre</div>\r\n                                <div className=\"font-mono text-lg font-black text-cyan-400\">\r\n                                    {(analysis.current ?? 0).toFixed(3)} <span className=\"text-xs\">A</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {showMenu !== null && (\r\n                            <div className=\"absolute top-1/2 left-4 right-4 -translate-y-1/2 bg-gray-900/95 border border-white/10 p-4 rounded-2xl shadow-2xl z-50 backdrop-blur-xl animate-in zoom-in duration-200\">\r\n                                <div className=\"text-[10px] text-gray-500 text-center uppercase font-black mb-3 tracking-widest\">Choisir un composant</div>\r\n                                <div className=\"grid grid-cols-4 gap-2 mb-4\">\r\n                                    {standardComponents.map(c => (\r\n                                        <button key={c.id} onClick={() => setSlotComponent(showMenu, c.id)}\r\n                                            className=\"flex flex-col items-center gap-1 bg-white/5 p-2 rounded-xl border border-transparent hover:border-yellow-500/50 hover:bg-white/10 transition-all\">\r\n                                            <span className=\"text-xl\">{c.icon}</span>\r\n                                            <span className=\"text-[8px] font-bold uppercase\">{c.name}</span>\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n\r\n                                <div className=\"text-[10px] text-gray-500 text-center uppercase font-black border-t border-white/10 pt-3 mb-3 tracking-widest\">R├®sistances Ohmiques</div>\r\n                                <div className=\"grid grid-cols-4 gap-2\">\r\n                                    {resistorsList.map(r => (\r\n                                        <button key={r.val} onClick={() => setSlotComponent(showMenu, `resistor_${r.val}`)}\r\n                                            className=\"flex flex-col items-center gap-1 bg-white/5 p-2 rounded-xl border border-transparent hover:border-yellow-500/50 hover:bg-white/10 transition-all\">\r\n                                            <div className=\"flex gap-[1px] h-2 w-6 bg-[#D2B48C] items-center justify-center rounded-sm overflow-hidden\">\r\n                                                {r.colors.map((c, i) => <div key={i} className=\"w-1 h-full\" style={{ backgroundColor: colorEmojiToHex(c) }}></div>)}\r\n                                            </div>\r\n                                            <span className=\"text-[8px] font-mono font-bold\">{r.val}╬®</span>\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                                <button onClick={() => setShowMenu(null)} className=\"w-full mt-4 py-2 bg-gray-800 rounded-lg text-xs font-bold text-red-400 hover:bg-gray-750\">ANNULER</button>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <XPBar current={score % 100} nextLevel={100} />\r\n            <SuccessOverlay show={showSuccess} message=\"C'est exact ! Le circuit est parfaitement ├®quilibr├®.\" points={100} onNext={nextChallenge} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            {/* SC├êNE 3D */}\r\n            <group position={[0, 0, 0]}>\r\n                <group position={[-3.5, 0, 0]}>\r\n                    <Box args={[1, 1.5, 1]} material-color=\"#111\" />\r\n                    <Box args={[0.9, 1.4, 0.9]} material-color=\"#333\" />\r\n                    <Text position={[0, 0.2, 0.6]} fontSize={0.5} color=\"#EF4444\" font=\"/fonts/Inter-Bold.ttf\">+</Text>\r\n                    <Text position={[0, -0.2, 0.6]} fontSize={0.5} color=\"#3B82F6\" font=\"/fonts/Inter-Bold.ttf\">-</Text>\r\n                    <Text position={[0, 1.1, 0]} fontSize={0.2} color=\"white\">G├ëN├ëRATEUR</Text>\r\n                </group>\r\n\r\n                {topology === 'series' && (\r\n                    <group>\r\n                        <CircuitSegment p1={[-3, 0, 0]} p2={[-1.5, 0, 0]} active={analysis.status === 'ok'} />\r\n                        <Slot3D id={0} pos={[-1, 0, 0]} type={slots[0]} active={analysis.status === 'ok'} onClick={() => setShowMenu(0)} error={analysis.status === 'short'} />\r\n                        <CircuitSegment p1={[-0.5, 0, 0]} p2={[0.5, 0, 0]} active={analysis.status === 'ok'} />\r\n                        <Slot3D id={1} pos={[1, 0, 0]} type={slots[1]} active={analysis.status === 'ok'} onClick={() => setShowMenu(1)} error={analysis.status === 'short'} />\r\n                        <CircuitSegment p1={[1.5, 0, 0]} p2={[2.5, 0, 0]} active={analysis.status === 'ok'} />\r\n                        <Slot3D id={2} pos={[3, 0, 0]} type={slots[2]} active={analysis.status === 'ok'} onClick={() => setShowMenu(2)} error={analysis.status === 'short'} />\r\n\r\n                        <group position={[0, -1, 0]}>\r\n                            <CircuitSegment p1={[3.5, 1, 0]} p2={[3.5, 0, 0]} vertical active={analysis.status === 'ok'} />\r\n                            <CircuitSegment p1={[3.5, 0, 0]} p2={[0.2, 0, 0]} active={analysis.status === 'ok'} />\r\n                            <Switch3D position={[0, 0, 0]} closed={switchState} />\r\n                            <CircuitSegment p1={[-0.2, 0, 0]} p2={[-3.5, 0, 0]} active={analysis.status === 'ok'} />\r\n                            <CircuitSegment p1={[-3.5, 0, 0]} p2={[-3.5, 0.5, 0]} vertical active={analysis.status === 'ok'} />\r\n                        </group>\r\n                    </group>\r\n                )}\r\n\r\n                {topology === 'parallel' && (\r\n                    <group>\r\n                        <CircuitSegment p1={[-3, 0, 0]} p2={[-1, 0, 0]} active={analysis.status === 'ok'} />\r\n                        <CircuitSegment p1={[-1, 1, 0]} p2={[-1, -1, 0]} vertical active={analysis.status === 'ok'} />\r\n\r\n                        <Slot3D id={0} pos={[0, 1, 0]} type={slots[0]} active={analysis.status === 'ok'} onClick={() => setShowMenu(0)} error={analysis.status === 'short'} />\r\n                        <Slot3D id={1} pos={[0, -1, 0]} type={slots[1]} active={analysis.status === 'ok'} onClick={() => setShowMenu(1)} error={analysis.status === 'short'} />\r\n\r\n                        <CircuitSegment p1={[1, 1, 0]} p2={[1, -1, 0]} vertical active={analysis.status === 'ok'} />\r\n                        <CircuitSegment p1={[1, 1, 0]} p2={[2.5, 1, 0]} active={analysis.status === 'ok'} />\r\n                        <CircuitSegment p1={[1, -1, 0]} p2={[2.5, -1, 0]} active={analysis.status === 'ok'} />\r\n\r\n                        <Slot3D id={2} pos={[3, 1, 0]} type={slots[2]} active={analysis.status === 'ok'} onClick={() => setShowMenu(2)} error={analysis.status === 'short'} />\r\n                        <Slot3D id={3} pos={[3, -1, 0]} type={slots[3]} active={analysis.status === 'ok'} onClick={() => setShowMenu(3)} error={analysis.status === 'short'} />\r\n\r\n                        <CircuitSegment p1={[3.5, 1, 0]} p2={[3.5, -1, 0]} vertical active={analysis.status === 'ok'} />\r\n                        <group position={[0, -2.5, 0]}>\r\n                            <CircuitSegment p1={[3.5, 1.5, 0]} p2={[3.5, 0, 0]} vertical active={analysis.status === 'ok'} />\r\n                            <CircuitSegment p1={[3.5, 0, 0]} p2={[0, 0, 0]} active={analysis.status === 'ok'} />\r\n                            <Switch3D position={[0, 0, 0]} closed={switchState} />\r\n                            <CircuitSegment p1={[-0.5, 0, 0]} p2={[-3.5, 0, 0]} active={analysis.status === 'ok'} />\r\n                            <CircuitSegment p1={[-3.5, 0, 0]} p2={[-3.5, 2.5, 0]} vertical active={analysis.status === 'ok'} />\r\n                        </group>\r\n                    </group>\r\n                )}\r\n            </group>\r\n        </group>\r\n    );\r\n}\r\n\r\n// --- HELPER FUNCTIONS ---\r\nfunction colorEmojiToHex(emoji) {\r\n    const map = { '­ƒƒñ': '#8B4513', 'ÔÜ½': '#000000', '­ƒö┤': '#FF0000', '­ƒƒá': '#FFA500', '­ƒƒí': '#FFFF00', '­ƒƒó': '#008000', '­ƒöÁ': '#0000FF', '­ƒƒú': '#800080', 'ÔÜ¬': '#FFFFFF' };\r\n    return map[emoji] || '#888';\r\n}\r\n\r\nfunction getResistorColorName(val) {\r\n    if (val === 10) return \"Marron-Noir-Noir\";\r\n    if (val === 100) return \"Marron-Noir-Marron\";\r\n    if (val === 220) return \"Rouge-Rouge-Marron\";\r\n    if (val === 1000) return \"Marron-Noir-Rouge\";\r\n    return \"\";\r\n}\r\n\r\n// --- 3D COMPONENTS ---\r\nfunction Slot3D({ id, pos, type, active, onClick, error }) {\r\n    const isResistor = type && type.startsWith('resistor_');\r\n    const color = error ? '#EF4444' : (active ? '#FCD34D' : '#374151');\r\n\r\n    return (\r\n        <group position={pos} onClick={(e) => { e.stopPropagation(); onClick(); }}\r\n            onPointerOver={() => document.body.style.cursor = 'pointer'}\r\n            onPointerOut={() => document.body.style.cursor = 'auto'}>\r\n\r\n            {/* Socket Base */}\r\n            <mesh rotation={[Math.PI / 2, 0, 0]}>\r\n                <cylinderGeometry args={[0.35, 0.35, 0.1, 32]} />\r\n                <meshStandardMaterial color={error ? '#EF4444' : '#1F2937'} />\r\n            </mesh>\r\n            <mesh position={[0, 0.06, 0]} rotation={[Math.PI / 2, 0, 0]}>\r\n                <ringGeometry args={[0.35, 0.4, 32]} />\r\n                <meshBasicMaterial color={active ? '#FBBF24' : '#4B5563'} />\r\n            </mesh>\r\n\r\n            {/* Component Visualization */}\r\n            <group position={[0, 0, 0]}>\r\n                {!type || type === 'open' ? (\r\n                    <Text fontSize={0.3} color=\"#EF4444\" position={[0, 0.3, 0]}>?</Text>\r\n                ) : type === 'wire' ? (\r\n                    <Box args={[0.6, 0.05, 0.05]} position={[0, 0.1, 0]} material-color=\"#B87333\" />\r\n                ) : type === 'lamp' ? (\r\n                    <Lamp3D active={active} intensity={active ? 2 : 0} />\r\n                ) : type === 'motor' ? (\r\n                    <Motor3D active={active} speed={10} />\r\n                ) : isResistor ? (\r\n                    <group position={[0, 0.2, 0]}>\r\n                        <Resistor3D value={parseInt(type.split('_')[1])} />\r\n                    </group>\r\n                ) : null}\r\n            </group>\r\n\r\n            {/* Label */}\r\n            <Text position={[0, -0.6, 0]} fontSize={0.12} color=\"gray\">Slot {id + 1}</Text>\r\n        </group>\r\n    );\r\n}\r\n\r\nfunction Resistor3D({ value }) {\r\n    // Decode value to colors (Simplified 3 bands logic for 3D)\r\n    // 10 -> Brown Black Black\r\n    // 100 -> Brown Black Brown\r\n    // 220 -> Red Red Brown\r\n    // 1000 -> Brown Black Red\r\n    let colors = [];\r\n    if (value === 10) colors = ['#8B4513', 'black', 'black'];\r\n    else if (value === 100) colors = ['#8B4513', 'black', '#8B4513'];\r\n    else if (value === 220) colors = ['red', 'red', '#8B4513'];\r\n    else if (value === 1000) colors = ['#8B4513', 'black', 'red'];\r\n    else colors = ['gray', 'gray', 'gray'];\r\n\r\n    return (\r\n        <group rotation={[0, 0, Math.PI / 2]}>\r\n            {/* Body */}\r\n            <mesh>\r\n                <cylinderGeometry args={[0.1, 0.1, 0.6, 16]} />\r\n                <meshStandardMaterial color=\"#D2B48C\" /> {/* Beige */}\r\n            </mesh>\r\n            {/* Bands */}\r\n            {colors.map((c, i) => (\r\n                <mesh key={i} position={[0, 0.15 - (i * 0.15), 0]}>\r\n                    <cylinderGeometry args={[0.105, 0.105, 0.05, 16]} />\r\n                    <meshStandardMaterial color={c} />\r\n                </mesh>\r\n            ))}\r\n            {/* Leads */}\r\n            <mesh position={[0, 0.4, 0]}>\r\n                <cylinderGeometry args={[0.02, 0.02, 0.2]} />\r\n                <meshStandardMaterial color=\"silver\" />\r\n            </mesh>\r\n            <mesh position={[0, -0.4, 0]}>\r\n                <cylinderGeometry args={[0.02, 0.02, 0.2]} />\r\n                <meshStandardMaterial color=\"silver\" />\r\n            </mesh>\r\n        </group>\r\n    );\r\n}\r\n\r\nfunction CircuitSegment({ p1, p2, vertical, active }) {\r\n    const mid = [(p1[0] + p2[0]) / 2, (p1[1] + p2[1]) / 2, (p1[2] + p2[2]) / 2];\r\n    const len = Math.sqrt(Math.pow(p2[0] - p1[0], 2) + Math.pow(p2[1] - p1[1], 2));\r\n    const rot = vertical ? [0, 0, 0] : [0, 0, Math.PI / 2];\r\n\r\n    // Electrons\r\n    const electrons = useMemo(() => Array.from({ length: Math.ceil(len * 5) }), [len]);\r\n\r\n    return (\r\n        <group position={mid} rotation={rot}>\r\n            {/* Wire */}\r\n            <mesh>\r\n                <cylinderGeometry args={[0.03, 0.03, len]} />\r\n                <meshStandardMaterial color={active ? '#F59E0B' : '#4B5563'} />\r\n            </mesh>\r\n\r\n            {/* Electron Flow */}\r\n            {active && electrons.map((_, i) => (\r\n                <MovingElectron key={i} offset={i / electrons.length} len={len} speed={2} />\r\n            ))}\r\n        </group>\r\n    );\r\n}\r\n\r\nfunction MovingElectron({ offset, len, speed }) {\r\n    const ref = useRef();\r\n    useFrame((state) => {\r\n        if (ref.current) {\r\n            // Move along Y axis (cylinder's length)\r\n            const t = (state.clock.elapsedTime * speed + offset) % 1;\r\n            ref.current.position.y = (t - 0.5) * len;\r\n        }\r\n    });\r\n    return (\r\n        <mesh ref={ref}>\r\n            <sphereGeometry args={[0.04]} />\r\n            <meshBasicMaterial color=\"#FEF3C7\" />\r\n        </mesh>\r\n    );\r\n}\r\n\r\nfunction Switch3D({ position, closed }) {\r\n    return (\r\n        <group position={position}>\r\n            <Box args={[0.6, 0.1, 0.4]} material-color=\"#1F2937\" />\r\n            <group position={[-0.25, 0.1, 0]} rotation={[0, 0, closed ? 0 : 0.6]}>\r\n                <Box args={[0.5, 0.05, 0.2]} position={[0.25, 0, 0]} material-color={closed ? \"#10B981\" : \"#EF4444\"} />\r\n            </group>\r\n        </group>\r\n    );\r\n}\r\n\r\nfunction Lamp3D({ active, intensity }) {\r\n    return (\r\n        <group position={[0, 1, 0]}>\r\n            {/* Bulb Glass */}\r\n            <mesh>\r\n                <sphereGeometry args={[0.4, 32, 32]} />\r\n                <meshPhysicalMaterial\r\n                    color={active ? \"#FEF9C3\" : \"#E5E7EB\"}\r\n                    transparent\r\n                    opacity={0.4}\r\n                    transmission={0.9}\r\n                    roughness={0.1}\r\n                    thickness={0.1}\r\n                />\r\n            </mesh>\r\n            {/* Filament */}\r\n            <mesh>\r\n                <sphereGeometry args={[0.15]} />\r\n                <meshBasicMaterial color={active ? \"#FBBF24\" : \"#4B5563\"} />\r\n            </mesh>\r\n            {/* Base */}\r\n            <Cylinder args={[0.2, 0.2, 0.5]} position={[0, -0.4, 0]} material-color=\"silver\" />\r\n\r\n            {/* Glow */}\r\n            {active && (\r\n                <>\r\n                    <pointLight distance={3} intensity={intensity} color=\"orange\" />\r\n                    <mesh scale={1.2}>\r\n                        <sphereGeometry args={[0.4]} />\r\n                        <meshBasicMaterial color=\"#FBBF24\" transparent opacity={0.2} />\r\n                    </mesh>\r\n                </>\r\n            )}\r\n        </group>\r\n    );\r\n}\r\n\r\nfunction Motor3D({ active, speed }) {\r\n    const ref = useRef();\r\n    useFrame(() => {\r\n        if (active && ref.current) ref.current.rotation.z += speed * 0.1;\r\n    });\r\n    return (\r\n        <group position={[0, 1, 0]}>\r\n            <Cylinder args={[0.4, 0.4, 0.8]} rotation={[Math.PI / 2, 0, 0]} material-color=\"gray\" />\r\n            <group ref={ref} position={[0, 0, 0.5]}>\r\n                <Box args={[1, 0.1, 0.1]} material-color=\"blue\" />\r\n                <Box args={[0.1, 1, 0.1]} material-color=\"blue\" />\r\n            </group>\r\n        </group>\r\n    );\r\n}\r\n\r\nfunction Buzzer3D({ active }) {\r\n    const [scale, setScale] = useState(1);\r\n    useFrame(({ clock }) => {\r\n        if (active) {\r\n            setScale(1 + Math.sin(clock.elapsedTime * 50) * 0.1);\r\n        } else {\r\n            setScale(1);\r\n        }\r\n    });\r\n    return (\r\n        <group position={[0, 1, 0]} scale={scale}>\r\n            <Cylinder args={[0.4, 0.5, 0.3]} material-color=\"black\" />\r\n            {active && (\r\n                <Text position={[0, 0.5, 0]} fontSize={0.3} color=\"red\">ÔÖ¬ÔÖ½ÔÖ¬</Text>\r\n            )}\r\n        </group>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\PC4eChapter6to8.js","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":213,"column":109,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[12428,12454],"text":"Taille de l&apos;ombre calcul├®e"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[12428,12454],"text":"Taille de l&lsquo;ombre calcul├®e"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[12428,12454],"text":"Taille de l&#39;ombre calcul├®e"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[12428,12454],"text":"Taille de l&rsquo;ombre calcul├®e"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":227,"column":91,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[13618,13638],"text":"THAL├êS : h&apos;/h = D'/D"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[13618,13638],"text":"THAL├êS : h&lsquo;/h = D'/D"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[13618,13638],"text":"THAL├êS : h&#39;/h = D'/D"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[13618,13638],"text":"THAL├êS : h&rsquo;/h = D'/D"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":227,"column":98,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[13618,13638],"text":"THAL├êS : h'/h = D&apos;/D"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[13618,13638],"text":"THAL├êS : h'/h = D&lsquo;/D"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[13618,13638],"text":"THAL├êS : h'/h = D&#39;/D"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[13618,13638],"text":"THAL├êS : h'/h = D&rsquo;/D"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":260,"column":115,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[15399,15418],"text":"├ëCRAN D&apos;OBSERVATION"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[15399,15418],"text":"├ëCRAN D&lsquo;OBSERVATION"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[15399,15418],"text":"├ëCRAN D&#39;OBSERVATION"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[15399,15418],"text":"├ëCRAN D&rsquo;OBSERVATION"},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport { useState, useRef, useEffect, useMemo } from 'react';\r\nimport * as THREE from 'three';\r\nimport { useFrame } from '@react-three/fiber';\r\nimport { Text, Html, Box, Sphere, Cylinder, Float, Line } from '@react-three/drei';\r\nimport DraggableHtmlPanel from './DraggableHtmlPanel';\r\nimport { PhaseSelector, MissionObjective, GradeBadge, XPBar, SuccessOverlay, ConfettiExplosion } from './GamificationUtils';\r\n\r\n\r\nexport function Chap6SourcesLumiere() {\r\n    const [lightsOn, setLightsOn] = useState(false);\r\n    const [mode, setMode] = useState('explore');\r\n    const [quizIndex, setQuizIndex] = useState(0);\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n\r\n    const quizQuestions = [\r\n        { q: \"Quelle source produit sa propre lumi├¿re ?\", options: [\"Miroir\", \"Lampe\", \"Livre\"], correct: \"Lampe\", icon: \"­ƒÆí\" },\r\n        { q: \"Quel objet diffuse la lumi├¿re re├ºue ?\", options: [\"Soleil\", \"Lampe\", \"Miroir\"], correct: \"Miroir\", icon: \"­ƒ¬×\" },\r\n        { q: \"La Lune est-elle une source primaire ?\", options: [\"Oui\", \"Non\", \"Parfois\"], correct: \"Non\", icon: \"­ƒîÖ\" }\r\n    ];\r\n\r\n    const checkAnswer = (ans) => {\r\n        if (ans === quizQuestions[quizIndex].correct) {\r\n            setScore(s => s + 50);\r\n            setShowSuccess(true);\r\n        } else {\r\n            alert(\"Rat├® ! Observe bien les rayons et les sources.\");\r\n        }\r\n    };\r\n\r\n    const nextQuestion = () => {\r\n        setShowSuccess(false);\r\n        setQuizIndex(i => (i + 1) % quizQuestions.length);\r\n    };\r\n\r\n    const isVisible = (type) => type === 'primaire' || lightsOn;\r\n\r\n    return (\r\n        <group>\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒÆí Expert Optique\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[380px] border-yellow-500/30 text-white\">\r\n                    <div className=\"mb-4\">\r\n                        <PhaseSelector currentPhase={mode} onSelect={(m) => setMode(m)} />\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-between items-center mb-4 border-b border-white/10 pb-2\">\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-[10px] text-yellow-400 font-bold uppercase tracking-widest\">Ma├«tre de la Lumi├¿re</span>\r\n                            <span className=\"text-lg font-black\">{mode === 'explore' ? 'Laboratoire d\\'Optique' : 'D├®fi des Sources ­ƒºá'}</span>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {mode === 'explore' ? (\r\n                        <div className=\"space-y-4\">\r\n                            <button onClick={() => setLightsOn(!lightsOn)}\r\n                                className={`w-full py-6 rounded-2xl font-black text-lg transition-all flex flex-col items-center justify-center gap-2 ${lightsOn ? 'bg-yellow-400 text-black shadow-[0_0_30px_rgba(250,204,21,0.4)]' : 'bg-gray-800 text-gray-500 border border-white/5'}`}>\r\n                                <span className=\"text-2xl\">{lightsOn ? 'ÔÿÇ´©Å' : '­ƒîæ'}</span>\r\n                                {lightsOn ? 'INTERRUPTEUR : ALLUM├ë' : 'INTERRUPTEUR : ├ëTEINT'}\r\n                            </button>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-3\">\r\n                                <div className=\"p-3 bg-yellow-900/20 rounded-xl border border-yellow-500/20\">\r\n                                    <div className=\"text-yellow-400 font-black text-[10px] uppercase mb-1\">Source Primaire</div>\r\n                                    <p className=\"text-[10px] text-gray-400 leading-tight\">Cr├®e sa propre lumi├¿re. Reste visible dans le noir absolu.</p>\r\n                                </div>\r\n                                <div className=\"p-3 bg-blue-900/20 rounded-xl border border-blue-500/20\">\r\n                                    <div className=\"text-blue-400 font-black text-[10px] uppercase mb-1\">Source Secondaire</div>\r\n                                    <p className=\"text-[10px] text-gray-400 leading-tight\">Diffuse la lumi├¿re re├ºue. Devient invisible sans source.</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"space-y-4\">\r\n                            <MissionObjective objective={quizQuestions[quizIndex].q} icon={quizQuestions[quizIndex].icon} />\r\n                            <div className=\"grid grid-cols-1 gap-2\">\r\n                                {quizQuestions[quizIndex].options.map(opt => (\r\n                                    <button key={opt} onClick={() => checkAnswer(opt)}\r\n                                        className=\"w-full p-4 bg-white/5 hover:bg-yellow-500 hover:text-black border border-white/10 rounded-xl text-sm font-bold transition-all text-left flex justify-between items-center group\">\r\n                                        {opt}\r\n                                        <span className=\"opacity-0 group-hover:opacity-100 transition-opacity\">Ô×£</span>\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <XPBar current={score % 100} nextLevel={100} />\r\n            <SuccessOverlay show={showSuccess} message=\"Analyse Correcte ! Tu distingues parfaitement l'origine de la lumi├¿re.\" points={50} onNext={nextQuestion} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            <ambientLight intensity={lightsOn ? 0.3 : 0} />\r\n\r\n            <group position={[-2, 0, 0]}>\r\n                <mesh>\r\n                    <cylinderGeometry args={[0.2, 0.4, 0.5]} />\r\n                    <meshStandardMaterial color={lightsOn ? '#FCD34D' : '#4B5563'} emissive={lightsOn ? '#FCD34D' : 'black'} emissiveIntensity={2} />\r\n                </mesh>\r\n                <Text position={[0, -0.6, 0]} fontSize={0.2} color=\"#FCD34D\" font=\"/fonts/Inter-Bold.ttf\">Lampe (Primaire)</Text>\r\n                {lightsOn && <pointLight distance={10} intensity={4} color=\"#FCD34D\" />}\r\n            </group>\r\n\r\n            <group position={[2, 0, 0]} visible={isVisible('secondaire')}>\r\n                <mesh rotation={[0, -0.5, 0]}>\r\n                    <boxGeometry args={[0.1, 2, 1.5]} />\r\n                    <meshStandardMaterial color=\"#93C5FD\" metalness={1} roughness={0} />\r\n                </mesh>\r\n                <Text position={[0, -1.2, 0]} fontSize={0.2} color=\"#93C5FD\" font=\"/fonts/Inter-Bold.ttf\">Miroir (Secondaire)</Text>\r\n                {lightsOn && (\r\n                    <mesh position={[-0.1, 0, 0]} rotation={[0, -0.5, 0]}>\r\n                        <planeGeometry args={[0.1, 2, 1.4]} />\r\n                        <meshBasicMaterial color=\"#FCD34D\" opacity={0.2} transparent />\r\n                    </mesh>\r\n                )}\r\n            </group>\r\n\r\n            <group position={[0, -1.5, 1]} visible={isVisible('secondaire')}>\r\n                <Box args={[1, 0.2, 1.4]} material-color=\"#EF4444\" />\r\n                <Text position={[0, 0.2, 0]} rotation={[-Math.PI / 2, 0, 0]} fontSize={0.12} color=\"white\" font=\"/fonts/Inter-Bold.ttf\">LABORATOIRE PC</Text>\r\n                <Text position={[0, -0.3, 0]} fontSize={0.15} color=\"white\" font=\"/fonts/Inter-Bold.ttf\">Livre (Secondaire)</Text>\r\n            </group>\r\n\r\n            {lightsOn && (\r\n                <group>\r\n                    <Line points={[[-2, 0, 0], [2, 0, 0]]} color=\"#FCD34D\" lineWidth={3} transparent opacity={0.6} />\r\n                    <Line points={[[2, 0, 0], [0, 0, 4]]} color=\"#FCD34D\" lineWidth={1} transparent opacity={0.3} />\r\n                    <Line points={[[-2, 0, 0], [0, -1.5, 1]]} color=\"#FCD34D\" lineWidth={3} transparent opacity={0.6} />\r\n                </group>\r\n            )}\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// CHAPITRE 7: PROPAGATION DE LA LUMI├êRE (ENRICHI)\r\n// ============================================================\r\nexport function Chap7PropagationLumiere() {\r\n    const [screenDistance, setScreenDistance] = useState(3);\r\n    const [objectSize, setObjectSize] = useState(0.5);\r\n    const [showRays, setShowRays] = useState(true);\r\n    const [mode, setMode] = useState('explore');\r\n    const [targetShadow, setTargetShadow] = useState(null);\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n\r\n    const D_source_obj = 3;\r\n    const D_source_screen = 3 + screenDistance;\r\n    const shadowScale = D_source_screen / D_source_obj;\r\n    const shadowSize = objectSize * shadowScale;\r\n\r\n    const startChallenge = () => {\r\n        setTargetShadow((Math.random() * 1.5 + 0.5).toFixed(1));\r\n        setMode('challenge');\r\n        setShowSuccess(false);\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (mode === 'challenge' && targetShadow && !showSuccess) {\r\n            if (Math.abs(shadowSize - parseFloat(targetShadow)) < 0.05) {\r\n                setScore(s => s + 50);\r\n                setShowSuccess(true);\r\n            }\r\n        }\r\n    }, [shadowSize, targetShadow, mode, showSuccess]);\r\n\r\n    return (\r\n        <group>\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒîæ Expert en Ombres\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[380px] border-white/30 text-white\">\r\n                    <div className=\"mb-4\">\r\n                        <PhaseSelector currentPhase={mode} onSelect={(m) => m === 'challenge' ? startChallenge() : setMode('explore')} />\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-between items-center mb-4 border-b border-white/10 pb-2\">\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-[10px] text-gray-400 font-bold uppercase tracking-widest\">Projectionniste</span>\r\n                            <span className=\"text-lg font-black\">{mode === 'explore' ? 'Manipulation G├®om├®trique' : 'D├®fi de Projection ­ƒÄ»'}</span>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {mode === 'challenge' && targetShadow && (\r\n                        <div className=\"mb-4\">\r\n                            <MissionObjective objective={`R├¿gle les param├¿tres pour obtenir une ombre de exactement ${targetShadow} m.`} icon=\"­ƒÄ»\" />\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"space-y-6\">\r\n                        <div className=\"bg-white/5 p-4 rounded-xl border border-white/10 space-y-4\">\r\n                            <div>\r\n                                <div className=\"flex justify-between text-[10px] font-black uppercase text-gray-500 mb-2\">\r\n                                    <span>Distance ├ëcran</span>\r\n                                    <span className=\"text-white\">{screenDistance.toFixed(1)} M</span>\r\n                                </div>\r\n                                <input type=\"range\" min=\"1\" max=\"5\" step=\"0.1\" value={screenDistance} onChange={(e) => setScreenDistance(Number(e.target.value))}\r\n                                    className=\"w-full h-2 bg-gray-800 rounded-lg appearance-none cursor-pointer accent-white\" />\r\n                            </div>\r\n\r\n                            <div>\r\n                                <div className=\"flex justify-between text-[10px] font-black uppercase text-gray-500 mb-2\">\r\n                                    <span>Diam├¿tre Objet</span>\r\n                                    <span className=\"text-white\">{(objectSize * 2).toFixed(1)} M</span>\r\n                                </div>\r\n                                <input type=\"range\" min=\"0.2\" max=\"1\" step=\"0.1\" value={objectSize} onChange={(e) => setObjectSize(Number(e.target.value))}\r\n                                    className=\"w-full h-2 bg-gray-800 rounded-lg appearance-none cursor-pointer accent-red-500\" />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"p-4 bg-black/60 rounded-xl border border-white/20 flex flex-col items-center\">\r\n                            <div className=\"text-[10px] text-gray-400 font-black uppercase mb-1\">Taille de l'ombre calcul├®e</div>\r\n                            <div className={`text-4xl font-mono font-black transition-all ${showSuccess ? 'text-green-400' : 'text-white'}`}>\r\n                                {shadowSize.toFixed(2)} <span className=\"text-xl\">M</span>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <label className=\"flex items-center gap-2 cursor-pointer group\">\r\n                                <div className={`w-5 h-5 rounded border-2 flex items-center justify-center transition-all ${showRays ? 'border-yellow-400 bg-yellow-400' : 'border-white/20 bg-transparent'}`}\r\n                                    onClick={() => setShowRays(!showRays)}>\r\n                                    {showRays && <span className=\"text-black text-[10px]\">Ô£ö</span>}\r\n                                </div>\r\n                                <span className=\"text-[10px] font-black uppercase tracking-tighter\">Afficher les Rayons Limites</span>\r\n                            </label>\r\n                            <div className=\"text-[8px] text-gray-500 font-mono\">THAL├êS : h'/h = D'/D</div>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <XPBar current={score % 100} nextLevel={100} />\r\n            <SuccessOverlay show={showSuccess} message=\"Alignement Parfait ! L'ombre correspond exactement ├á la consigne.\" points={50} onNext={startChallenge} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            <group position={[-3, 0, 0]}>\r\n                <Sphere args={[0.1]}>\r\n                    <meshStandardMaterial color=\"yellow\" emissive=\"yellow\" emissiveIntensity={5} />\r\n                </Sphere>\r\n                <pointLight intensity={3} distance={20} />\r\n                <Text position={[0, -0.5, 0]} fontSize={0.2} color=\"yellow\" font=\"/fonts/Inter-Bold.ttf\">SOURCE</Text>\r\n            </group>\r\n\r\n            <group position={[0, 0, 0]}>\r\n                <Sphere args={[objectSize]}>\r\n                    <meshStandardMaterial color=\"#EF4444\" roughness={0.3} metalness={0.2} />\r\n                </Sphere>\r\n                <Text position={[0, -1.2, 0]} fontSize={0.2} color=\"#EF4444\" font=\"/fonts/Inter-Bold.ttf\">OBJET OPAQUE</Text>\r\n            </group>\r\n\r\n            <group position={[screenDistance, 0, 0]} rotation={[0, -Math.PI / 2, 0]}>\r\n                <Box args={[10, 10, 0.1]}>\r\n                    <meshStandardMaterial color=\"#F3F4F6\" />\r\n                </Box>\r\n                <mesh position={[0, 0, 0.06]} rotation={[Math.PI / 2, 0, 0]}>\r\n                    <circleGeometry args={[shadowSize, 64]} />\r\n                    <meshBasicMaterial color=\"#000\" opacity={0.85} transparent />\r\n                </mesh>\r\n                <Text position={[0, 4.5, 0.1]} fontSize={0.3} color=\"#374151\" font=\"/fonts/Inter-Bold.ttf\">├ëCRAN D'OBSERVATION</Text>\r\n            </group>\r\n\r\n            {/* C├┤ne d'ombre volum├®trique */}\r\n            <mesh position={[screenDistance / 2, 0, 0]} rotation={[0, 0, -Math.PI / 2]}>\r\n                <cylinderGeometry args={[shadowSize, 0, screenDistance, 64, 1, true]} />\r\n                <meshBasicMaterial color=\"black\" opacity={0.15} transparent side={THREE.DoubleSide} />\r\n            </mesh>\r\n\r\n            {showRays && (\r\n                <group>\r\n                    <Line points={[[-3, 0, 0], [screenDistance, shadowSize, 0]]} color=\"#FBBF24\" lineWidth={1} transparent opacity={0.4} />\r\n                    <Line points={[[-3, 0, 0], [screenDistance, -shadowSize, 0]]} color=\"#FBBF24\" lineWidth={1} transparent opacity={0.4} />\r\n                    <Line points={[[-3, 0, 0], [screenDistance, 0, shadowSize]]} color=\"#FBBF24\" lineWidth={1} transparent opacity={0.2} />\r\n                    <Line points={[[-3, 0, 0], [screenDistance, 0, -shadowSize]]} color=\"#FBBF24\" lineWidth={1} transparent opacity={0.2} />\r\n                </group>\r\n            )}\r\n        </group>\r\n    );\r\n}\r\n\r\n\r\n// ============================================================\r\n// CHAPITRE 8: R├ëFRACTION DE LA LUMI├êRE (ENRICHI)\r\n// ============================================================\r\nexport function Chap8Refraction() {\r\n    const [angleIncidence, setAngleIncidence] = useState(45);\r\n    const [n1, setN1] = useState(1.0);\r\n    const [n2, setN2] = useState(1.33);\r\n    const [mode, setMode] = useState('explore');\r\n    const [targetPos, setTargetPos] = useState(null);\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n\r\n    const i1 = angleIncidence * Math.PI / 180;\r\n    let i2 = 0;\r\n    let reflection = false;\r\n    const sin_i2 = (n1 / n2) * Math.sin(i1);\r\n\r\n    if (Math.abs(sin_i2) <= 1) {\r\n        i2 = Math.asin(sin_i2);\r\n    } else {\r\n        reflection = true;\r\n        i2 = i1;\r\n    }\r\n\r\n    const angleRefractionDeg = (i2 * 180 / Math.PI).toFixed(1);\r\n    const beamLength = 4;\r\n    const endX = Math.sin(i2) * beamLength;\r\n    const endY = -Math.cos(i2) * beamLength;\r\n\r\n    const startChallenge = () => {\r\n        const randAngle = (Math.random() * 50 + 15) * Math.PI / 180;\r\n        const tX = Math.sin(randAngle) * beamLength;\r\n        const tY = -Math.cos(randAngle) * beamLength;\r\n        setTargetPos({ x: tX, y: tY });\r\n        setMode('challenge');\r\n        setAngleIncidence(0);\r\n        setShowSuccess(false);\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (mode === 'challenge' && targetPos && !reflection && !showSuccess) {\r\n            const dist = Math.sqrt(Math.pow(endX - targetPos.x, 2) + Math.pow(endY - targetPos.y, 2));\r\n            if (dist < 0.25) {\r\n                setScore(s => s + 50);\r\n                setShowSuccess(true);\r\n            }\r\n        }\r\n    }, [endX, endY, targetPos, mode, showSuccess, reflection]);\r\n\r\n    const materials = {\r\n        1.0: { name: 'Air', icon: '­ƒÆ¿' },\r\n        1.33: { name: 'Eau', icon: '­ƒÆº' },\r\n        1.5: { name: 'Verre', icon: '­ƒöì' },\r\n        2.42: { name: 'Diamant', icon: '­ƒÆÄ' }\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒîê Ma├«tre des Rayons\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[400px] border-cyan-500/30 text-white\">\r\n                    <div className=\"mb-4\">\r\n                        <PhaseSelector currentPhase={mode} onSelect={(m) => m === 'challenge' ? startChallenge() : setMode('explore')} />\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-between items-center mb-4 border-b border-white/10 pb-2\">\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-[10px] text-cyan-400 font-bold uppercase tracking-widest\">Ing├®nieur Optique</span>\r\n                            <span className=\"text-lg font-black\">{mode === 'explore' ? 'Loi de Snell-Descartes' : 'Target Laser ­ƒÄ»'}</span>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {mode === 'challenge' && targetPos && (\r\n                        <div className=\"mb-4\">\r\n                            <MissionObjective objective=\"Ajuste l'angle d'incidence pour que le rayon r├®fract├® touche la cible dor├®e.\" icon=\"­ƒöª\" />\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"grid grid-cols-2 gap-4\">\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-[10px] font-black text-gray-500 uppercase\">Milieu Incident (nÔéü)</label>\r\n                                <div className=\"grid grid-cols-2 gap-1\">\r\n                                    {Object.entries(materials).map(([n, data]) => (\r\n                                        <button key={n} onClick={() => setN1(Number(n))}\r\n                                            className={`p-2 rounded-lg text-[10px] font-bold border transition-all ${n1 === Number(n) ? 'bg-cyan-500 border-cyan-400 text-white' : 'bg-gray-800 border-white/5 text-gray-400'}`}>\r\n                                            {data.name}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-[10px] font-black text-gray-500 uppercase\">Milieu R├®fract├® (nÔéé)</label>\r\n                                <div className=\"grid grid-cols-2 gap-1\">\r\n                                    {Object.entries(materials).map(([n, data]) => (\r\n                                        <button key={n} onClick={() => setN2(Number(n))}\r\n                                            className={`p-2 rounded-lg text-[10px] font-bold border transition-all ${n2 === Number(n) ? 'bg-indigo-500 border-indigo-400 text-white' : 'bg-gray-800 border-white/5 text-gray-400'}`}>\r\n                                            {data.name}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"bg-black/40 p-4 rounded-xl border border-white/5\">\r\n                            <div className=\"flex justify-between text-[10px] font-black text-gray-500 mb-2\">\r\n                                <span>ANGLE INCIDENT (iÔéü)</span>\r\n                                <span className=\"text-white\">{angleIncidence}┬░</span>\r\n                            </div>\r\n                            <input type=\"range\" min=\"0\" max=\"85\" value={angleIncidence} onChange={(e) => setAngleIncidence(Number(e.target.value))}\r\n                                className=\"w-full h-2 bg-gray-800 rounded-lg appearance-none cursor-pointer accent-cyan-500\" />\r\n                        </div>\r\n\r\n                        <div className=\"p-4 bg-cyan-950/30 rounded-xl border border-cyan-500/30\">\r\n                            <div className=\"flex justify-between items-center\">\r\n                                <span className=\"text-xs font-mono text-cyan-400\">{n1} ┬À sin({angleIncidence}┬░) = {n2} ┬À sin(iÔéé)</span>\r\n                                {reflection ? (\r\n                                    <span className=\"text-red-400 font-black animate-pulse\">R├ëFLEXION TOTALE</span>\r\n                                ) : (\r\n                                    <span className=\"text-xl font-black text-white\">iÔéé = {angleRefractionDeg}┬░</span>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <XPBar current={score % 100} nextLevel={100} />\r\n            <SuccessOverlay show={showSuccess} message=\"Calcul Pr├®cis ! La trajectoire est parfaite.\" points={50} onNext={startChallenge} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            {/* Target */}\r\n            {mode === 'challenge' && targetPos && (\r\n                <group position={[targetPos.x, targetPos.y, 0]}>\r\n                    <Sphere args={[0.2]}>\r\n                        <meshStandardMaterial color=\"#FBBF24\" emissive=\"#FBBF24\" emissiveIntensity={5} />\r\n                    </Sphere>\r\n                    <pointLight color=\"#FBBF24\" intensity={2} distance={2} />\r\n                </group>\r\n            )}\r\n\r\n            {/* Milieux */}\r\n            <mesh position={[0, -2, 0]}>\r\n                <planeGeometry args={[10, 4]} />\r\n                <meshStandardMaterial color=\"#3B82F6\" transparent opacity={0.25} />\r\n                <Text position={[4, -1, 0.1]} color=\"white\" fontSize={0.2} font=\"/fonts/Inter-Bold.ttf\">{materials[n2].name} (n={n2})</Text>\r\n            </mesh>\r\n            <mesh position={[0, 2, 0]}>\r\n                <planeGeometry args={[10, 4]} />\r\n                <meshStandardMaterial color=\"white\" transparent opacity={0.05} />\r\n                <Text position={[4, 1, 0.1]} color=\"white\" fontSize={0.2} font=\"/fonts/Inter-Bold.ttf\">{materials[n1].name} (n={n1})</Text>\r\n            </mesh>\r\n\r\n            <Line points={[[-5, 0, 0], [5, 0, 0]]} color=\"white\" lineWidth={2} transparent opacity={0.5} />\r\n            <Line points={[[0, -4, 0], [0, 4, 0]]} color=\"white\" lineWidth={1} dashed transparent opacity={0.3} />\r\n\r\n            <RayVisuals i1={i1} i2={i2} length={beamLength} reflection={reflection} />\r\n        </group>\r\n    );\r\n}\r\n\r\nfunction RayVisuals({ i1, i2, length, reflection }) {\r\n    // Incident : Vient du haut gauche.\r\n    // vecteur direct : x = sin(i1), y = -cos(i1)  (car 0 = verticale bas)\r\n    // Start point calcul├® pour arriver en (0,0)\r\n\r\n    const startX = -Math.sin(i1) * length;\r\n    const startY = Math.cos(i1) * length;\r\n\r\n    const endRefractX = Math.sin(i2) * length;\r\n    const endRefractY = -Math.cos(i2) * length;\r\n\r\n    const endReflectX = Math.sin(i1) * length;\r\n    const endReflectY = Math.cos(i1) * length;\r\n\r\n    return (\r\n        <group>\r\n            {/* Incident */}\r\n            <Line points={[[startX, startY, 0], [0, 0, 0]]} color=\"red\" lineWidth={3} />\r\n            <Text position={[startX / 2, startY / 2 + 0.2, 0]} fontSize={0.2} color=\"red\">i1</Text>\r\n\r\n            {/* Arcs d'angle */}\r\n            {/* ... */}\r\n\r\n            {reflection ? (\r\n                <Line points={[[0, 0, 0], [endReflectX, endReflectY, 0]]} color=\"red\" lineWidth={3} dashed />\r\n            ) : (\r\n                <group>\r\n                    <Line points={[[0, 0, 0], [endRefractX, endRefractY, 0]]} color=\"green\" lineWidth={3} />\r\n                    <Text position={[endRefractX / 2, endRefractY / 2 - 0.2, 0]} fontSize={0.2} color=\"green\">i2</Text>\r\n                </group>\r\n            )}\r\n        </group>\r\n    )\r\n}\r\n\r\nfunction LaserRay({ angle, length, color, isReflected, isRefracted }) {\r\n    // Composant helper simple si besoin, mais RayVisuals fait le job math├®matique\r\n    return null;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\PC4eSimulations.js","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":199,"column":138,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[11110,11152],"text":"Ions Na+ Cl- dissous (invisibles ├á l&apos;oeil)"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[11110,11152],"text":"Ions Na+ Cl- dissous (invisibles ├á l&lsquo;oeil)"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[11110,11152],"text":"Ions Na+ Cl- dissous (invisibles ├á l&#39;oeil)"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[11110,11152],"text":"Ions Na+ Cl- dissous (invisibles ├á l&rsquo;oeil)"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'collection', 'element.symbol', 'showSuccess', and 'timeLeft'. Either include them or remove the dependency array.","line":345,"column":8,"nodeType":"ArrayExpression","endLine":345,"endColumn":54,"suggestions":[{"desc":"Update the dependencies array to be: [protons, neutrons, electrons, mission, phase, showSuccess, timeLeft, collection, element.symbol]","fix":{"range":[18540,18586],"text":"[protons, neutrons, electrons, mission, phase, showSuccess, timeLeft, collection, element.symbol]"}}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":465,"column":89,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[26401,26421],"text":"STRUCTURE DE L&apos;ATOME"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[26401,26421],"text":"STRUCTURE DE L&lsquo;ATOME"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[26401,26421],"text":"STRUCTURE DE L&#39;ATOME"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[26401,26421],"text":"STRUCTURE DE L&rsquo;ATOME"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":1309,"column":51,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[70808,70905],"text":"\r\n                                        AQUARIUM D&apos;EAU ­ƒÆº\r\n                                    "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[70808,70905],"text":"\r\n                                        AQUARIUM D&lsquo;EAU ­ƒÆº\r\n                                    "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[70808,70905],"text":"\r\n                                        AQUARIUM D&#39;EAU ­ƒÆº\r\n                                    "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[70808,70905],"text":"\r\n                                        AQUARIUM D&rsquo;EAU ­ƒÆº\r\n                                    "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":1323,"column":53,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[72005,72118],"text":"\r\n                                            L├éCHER L&apos;OBJET MYST├êRE ­ƒæç\r\n                                        "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[72005,72118],"text":"\r\n                                            L├éCHER L&lsquo;OBJET MYST├êRE ­ƒæç\r\n                                        "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[72005,72118],"text":"\r\n                                            L├éCHER L&#39;OBJET MYST├êRE ­ƒæç\r\n                                        "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[72005,72118],"text":"\r\n                                            L├éCHER L&rsquo;OBJET MYST├êRE ­ƒæç\r\n                                        "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":1361,"column":40,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[74896,74976],"text":"\r\n                                VIDER L&apos;AQUARIUM\r\n                            "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[74896,74976],"text":"\r\n                                VIDER L&lsquo;AQUARIUM\r\n                            "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[74896,74976],"text":"\r\n                                VIDER L&#39;AQUARIUM\r\n                            "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[74896,74976],"text":"\r\n                                VIDER L&rsquo;AQUARIUM\r\n                            "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":1512,"column":137,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[81594,81610],"text":"Choix de l&apos;Outil"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[81594,81610],"text":"Choix de l&lsquo;Outil"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[81594,81610],"text":"Choix de l&#39;Outil"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[81594,81610],"text":"Choix de l&rsquo;Outil"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":1703,"column":134,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[92620,92641],"text":"Angle d&apos;Incidence (i)"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[92620,92641],"text":"Angle d&lsquo;Incidence (i)"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[92620,92641],"text":"Angle d&#39;Incidence (i)"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[92620,92641],"text":"Angle d&rsquo;Incidence (i)"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'isLit'. Either include it or remove the dependency array.","line":1844,"column":8,"nodeType":"ArrayExpression","endLine":1844,"endColumn":43,"suggestions":[{"desc":"Update the dependencies array to be: [bulbs, mode, phase, missionTarget, isLit]","fix":{"range":[99722,99757],"text":"[bulbs, mode, phase, missionTarget, isLit]"}}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":1856,"column":34,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[100483,100561],"text":"\r\n                            LAB D&apos;├ëLECTROTECHNIQUE\r\n                        "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[100483,100561],"text":"\r\n                            LAB D&lsquo;├ëLECTROTECHNIQUE\r\n                        "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[100483,100561],"text":"\r\n                            LAB D&#39;├ëLECTROTECHNIQUE\r\n                        "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[100483,100561],"text":"\r\n                            LAB D&rsquo;├ëLECTROTECHNIQUE\r\n                        "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'shadowRadius', 'showSuccess', and 'umbraRadius'. Either include them or remove the dependency array.","line":2191,"column":8,"nodeType":"ArrayExpression","endLine":2191,"endColumn":47,"suggestions":[{"desc":"Update the dependencies array to be: [objZ, sourceType, phase, targetRadius, shadowRadius, umbraRadius, showSuccess]","fix":{"range":[118418,118457],"text":"[objZ, sourceType, phase, targetRadius, shadowRadius, umbraRadius, showSuccess]"}}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":2203,"column":38,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[119192,119271],"text":"\r\n                            STATION D&apos;OPTIQUE GEOM.\r\n                        "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[119192,119271],"text":"\r\n                            STATION D&lsquo;OPTIQUE GEOM.\r\n                        "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[119192,119271],"text":"\r\n                            STATION D&#39;OPTIQUE GEOM.\r\n                        "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[119192,119271],"text":"\r\n                            STATION D&rsquo;OPTIQUE GEOM.\r\n                        "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":2338,"column":143,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[127965,128088],"text":" Cliquez sur les objets en 3D pour d├®couvrir s&apos;ils sont des sources primaires ou secondaires.\r\n                            "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[127965,128088],"text":" Cliquez sur les objets en 3D pour d├®couvrir s&lsquo;ils sont des sources primaires ou secondaires.\r\n                            "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[127965,128088],"text":" Cliquez sur les objets en 3D pour d├®couvrir s&#39;ils sont des sources primaires ou secondaires.\r\n                            "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[127965,128088],"text":" Cliquez sur les objets en 3D pour d├®couvrir s&rsquo;ils sont des sources primaires ou secondaires.\r\n                            "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"´╗┐'use client';\r\nimport { useRef, useMemo, useState, useEffect } from 'react';\r\nimport * as THREE from 'three';\r\nimport { useFrame } from '@react-three/fiber';\r\nimport { Text, Html, Float, Sphere, OrbitControls, Box, Cylinder, Torus } from '@react-three/drei';\r\nimport DraggableHtmlPanel from './DraggableHtmlPanel';\r\nimport { SuccessOverlay, ConfettiExplosion, GradeBadge, XPBar, PhaseSelector, MissionObjective, ChallengeTimer } from './GamificationUtils';\r\n\r\n// ============================================================\r\n// CHAPITRE 9: S├ëPARATION DES M├ëLANGES (IMMERSIVE & CHALLENGE)\r\n// ============================================================\r\nexport function MixtureSeparationPC4() {\r\n    const [phase, setPhase] = useState('explore');\r\n    const [mixture, setMixture] = useState('mud');\r\n    const [method, setMethod] = useState(null);\r\n    const [progress, setProgress] = useState(0);\r\n    const [particles, setParticles] = useState(null);\r\n    const [targetReached, setTargetReached] = useState(false);\r\n\r\n    // Gamification & Features\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [microscope, setMicroscope] = useState(false);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n    const [mission, setMission] = useState(null);\r\n\r\n    // Initialisation des particules\r\n    useEffect(() => {\r\n        const pts = new Float32Array(600).map(() => (Math.random() - 0.5) * 1.5);\r\n        setParticles(pts);\r\n    }, []);\r\n\r\n    const mixtures = {\r\n        mud: { name: 'Eau boueuse', components: ['Eau', 'Terre'], color: '#78350F', difficulty: 1 },\r\n        salt_water: { name: 'Eau sal├®e', components: ['Eau', 'Sel'], color: '#93C5FD', difficulty: 2 },\r\n        oil_water: { name: 'Eau + Huile', components: ['Eau', 'Huile'], color: '#FEF3C7', difficulty: 1 }\r\n    };\r\n\r\n    const mix = mixtures[mission?.target || mixture];\r\n\r\n    const methods = {\r\n        decantation: { name: 'D├®cantation', icon: 'ÔÅ│', effective: ['mud', 'oil_water'], desc: 'Laisser reposer (densit├®)' },\r\n        filtration: { name: 'Filtration', icon: 'Ôÿò', effective: ['mud'], desc: 'Passer ├á travers un filtre (taille)' },\r\n        evaporation: { name: 'Vaporisation', icon: '­ƒöÑ', effective: ['salt_water'], desc: 'Chauffer pour r├®cup├®rer le solide' }\r\n    };\r\n\r\n    const startSeparation = (m) => {\r\n        setMethod(m);\r\n        setProgress(0);\r\n        setShowSuccess(false);\r\n    };\r\n\r\n    const isSuccess = method && methods[method].effective.includes(mission?.target || mixture);\r\n\r\n    useFrame((state, delta) => {\r\n        if (method && progress < 1) {\r\n            setProgress(prev => {\r\n                const newP = Math.min(prev + delta * 0.3, 1);\r\n                if (newP === 1 && prev < 1) {\r\n                    if (isSuccess) {\r\n                        setTargetReached(true);\r\n                        handleMissionSuccess();\r\n                    }\r\n                }\r\n                return newP;\r\n            });\r\n        }\r\n    });\r\n\r\n    const handleMissionSuccess = () => {\r\n        const points = 50 + (phase === 'mission' ? Math.floor(timeLeft * 2) : 0);\r\n        setScore(s => s + points);\r\n        setShowSuccess(true);\r\n    };\r\n\r\n    const startMission = () => {\r\n        const keys = Object.keys(mixtures);\r\n        const randomKey = keys[Math.floor(Math.random() * keys.length)];\r\n        setMission({\r\n            target: randomKey,\r\n            objective: `Isolez les composants de : ${mixtures[randomKey].name}`\r\n        });\r\n        setMixture(randomKey);\r\n        setPhase('mission');\r\n        setMethod(null);\r\n        setProgress(0);\r\n        setShowSuccess(false);\r\n        setTimeLeft(45);\r\n        setTargetReached(false);\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [timeLeft, phase, showSuccess]);\r\n\r\n    return (\r\n        <>\r\n            <SuccessOverlay show={showSuccess} message={`Mission Accomplie ! Tu as s├®par├® : ${mixtures[mission?.target || mixture].name}`} points={50 + (phase === 'mission' ? Math.floor(timeLeft * 2) : 0)} onNext={phase === 'mission' ? startMission : () => setShowSuccess(false)} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"ÔÜù´©Å Laboratoire de S├®paration\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[400px] border-orange-500/30 text-white\">\r\n                    <div className=\"flex justify-between items-center mb-4\">\r\n                        <GradeBadge score={score} />\r\n                        {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={45} />}\r\n                    </div>\r\n\r\n                    <XPBar current={score} nextLevel={1000} />\r\n\r\n                    <div className=\"h-[1px] bg-gradient-to-r from-transparent via-orange-500/50 to-transparent my-4\" />\r\n\r\n                    <PhaseSelector currentPhase={phase} onSelect={(p) => { setPhase(p); if (p === 'mission') startMission(); }} />\r\n\r\n                    {phase === 'mission' && mission && (\r\n                        <MissionObjective objective={mission.objective} icon=\"ÔÜù´©Å\" />\r\n                    )}\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                        <div className=\"space-y-4\">\r\n                            {phase === 'explore' && (\r\n                                <div>\r\n                                    <label className=\"text-[10px] text-gray-400 block mb-1 uppercase\">Solution ├á traiter</label>\r\n                                    <div className=\"grid grid-cols-1 gap-1\">\r\n                                        {Object.entries(mixtures).map(([k, m]) => (\r\n                                            <button key={k} onClick={() => { setMixture(k); setMethod(null); setProgress(0); }}\r\n                                                className={`py-1 px-2 rounded-lg text-xs font-bold transition-all border ${mixture === k ? 'bg-orange-600 border-orange-400' : 'bg-gray-800 border-gray-700'}`}>\r\n                                                {m.name}\r\n                                            </button>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n\r\n                            <div>\r\n                                <label className=\"text-[10px] text-gray-400 block mb-1 uppercase\">Technique de S├®paration</label>\r\n                                <div className=\"grid grid-cols-1 gap-1\">\r\n                                    {Object.entries(methods).map(([k, m]) => (\r\n                                        <button key={k} onClick={() => startSeparation(k)}\r\n                                            className={`flex items-center gap-2 p-1 px-2 rounded-lg border transition-all ${method === k ? 'bg-orange-100 text-black border-orange-500' : 'bg-gray-800 border-gray-700'}`}>\r\n                                            <span className=\"text-lg\">{m.icon}</span>\r\n                                            <div className=\"text-left\">\r\n                                                <div className=\"font-bold text-[10px]\">{m.name}</div>\r\n                                                <div className=\"text-[8px] opacity-70 leading-tight\">{m.desc}</div>\r\n                                            </div>\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"bg-black/60 rounded-xl p-3 border border-white/5 flex flex-col justify-between\">\r\n                            <div className=\"space-y-2 text-center\">\r\n                                <div className=\"text-[9px] text-gray-500 font-mono\">LAB_ANALYSIS</div>\r\n                                <button onClick={() => setMicroscope(!microscope)} className={`w-full py-1 text-[10px] border px-2 rounded transition-colors ${microscope ? 'bg-blue-600 border-blue-400 text-white' : 'bg-gray-800 border-gray-600 text-gray-400'}`}>\r\n                                    {microscope ? 'Microscope: ON ­ƒö¼' : 'Microscope: OFF ­ƒö¼'}\r\n                                </button>\r\n\r\n                                {method && (\r\n                                    <div className=\"mt-2\">\r\n                                        <div className=\"flex justify-between text-[9px] font-mono mb-1\">\r\n                                            <span>PROGRESS</span>\r\n                                            <span>{Math.round(progress * 100)}%</span>\r\n                                        </div>\r\n                                        <div className=\"h-1 bg-gray-800 rounded-full overflow-hidden\">\r\n                                            <div className=\"h-full bg-orange-500 transition-all\" style={{ width: `${progress * 100}%` }} />\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n\r\n                                {progress === 1 && !isSuccess && (\r\n                                    <div className=\"text-red-400 text-[9px] font-bold animate-pulse mt-1\">├ëchec: Technique Inadapt├®e</div>\r\n                                )}\r\n                            </div>\r\n\r\n                            <button onClick={() => { setMethod(null); setProgress(0); }} className=\"w-full py-1 bg-white/5 hover:bg-white/10 rounded text-[10px] transition-all mt-2\">\r\n                                RE-INITIALISER\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            {/* Microscope Overlay - Must be outside Portal */}\r\n            {microscope && (\r\n                <Html position={[2, 0, 0]} center>\r\n                    <div className=\"bg-black rounded-full border-4 border-gray-500 w-48 h-48 overflow-hidden relative shadow-2xl\">\r\n                        <div className=\"absolute inset-0 bg-white/10 pointer-events-none\"></div>\r\n                        {/* Simulation de vue microscopique */}\r\n                        {(mission?.target || mixture) === 'mud' && (\r\n                            <div className=\"w-full h-full bg-[#5D4037]/20 flex flex-wrap content-center justify-center p-4 gap-1\">\r\n                                {Array.from({ length: 20 }).map((_, i) => <div key={i} className=\"w-2 h-2 bg-[#5D4037] rounded-full animate-bounce\" style={{ animationDelay: `${i * 0.1}s` }}></div>)}\r\n                            </div>\r\n                        )}\r\n                        {(mission?.target || mixture) === 'salt_water' && (\r\n                            <div className=\"w-full h-full bg-[#93C5FD]/20 flex flex-wrap content-center justify-center p-4\">\r\n                                <div className=\"text-xs text-center text-white font-bold opacity-50\">Ions Na+ Cl- dissous (invisibles ├á l'oeil)</div>\r\n                            </div>\r\n                        )}\r\n                        {(mission?.target || mixture) === 'oil_water' && (\r\n                            <div className=\"w-full h-full bg-[#FEF3C7]/20 flex items-center justify-center\">\r\n                                <div className=\"w-16 h-16 bg-yellow-400/50 rounded-full blur-md animate-pulse\"></div>\r\n                                <div className=\"w-8 h-8 bg-yellow-400/50 rounded-full blur-sm absolute top-10 left-10\"></div>\r\n                            </div>\r\n                        )}\r\n                        <div className=\"absolute bottom-2 left-0 right-0 text-center text-[10px] text-gray-400 font-mono\">x100 Zoom</div>\r\n                    </div>\r\n                    <div className=\"w-1 h-12 bg-gray-500 mx-auto\"></div>\r\n                </Html>\r\n            )}\r\n\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            <group>\r\n                <group position={[0, -1, 0]}>\r\n                    <mesh position={[0, 0, 0]}>\r\n                        <cylinderGeometry args={[1, 1, 2.5, 32, 1, true]} />\r\n                        <meshPhysicalMaterial color=\"#A5F3FC\" transmission={0.9} opacity={0.3} transparent side={THREE.DoubleSide} />\r\n                    </mesh>\r\n\r\n                    {(!method || method === 'decantation' || method === 'evaporation') && (\r\n                        <group position={[0, -0.5, 0]}>\r\n                            <mesh scale={[0.95, isSuccess && method === 'evaporation' ? 1 - progress : 1, 0.95]}>\r\n                                <cylinderGeometry args={[1, 1, 1.4, 32]} />\r\n                                <meshStandardMaterial color={mix ? mix.color : '#FFF'} transparent opacity={0.8} />\r\n                            </mesh>\r\n\r\n                            {(mission?.target === 'mud' || mixture === 'mud') && particles && (\r\n                                <group position={[0, isSuccess && method === 'decantation' ? -0.6 : 0, 0]}>\r\n                                    <points>\r\n                                        <bufferGeometry>\r\n                                            <bufferAttribute attach=\"attributes-position\" count={200} array={particles} itemSize={3} />\r\n                                        </bufferGeometry>\r\n                                        <pointsMaterial size={0.05} color=\"#5D4037\" />\r\n                                    </points>\r\n                                </group>\r\n                            )}\r\n\r\n                            {(mission?.target === 'oil_water' || mixture === 'oil_water') && isSuccess && method === 'decantation' && (\r\n                                <mesh position={[0, 0.5, 0]}>\r\n                                    <cylinderGeometry args={[0.95, 0.95, 0.5, 32]} />\r\n                                    <meshStandardMaterial color=\"#FBBF24\" transparent opacity={0.8} />\r\n                                </mesh>\r\n                            )}\r\n\r\n                            {(mission?.target === 'salt_water' || mixture === 'salt_water') && isSuccess && method === 'evaporation' && progress > 0.8 && (\r\n                                <mesh position={[0, -0.7, 0]}>\r\n                                    <cylinderGeometry args={[0.9, 0.9, 0.1, 32]} />\r\n                                    <meshStandardMaterial color=\"white\" roughness={0.8} />\r\n                                </mesh>\r\n                            )}\r\n                        </group>\r\n                    )}\r\n\r\n                    {method === 'filtration' && (\r\n                        <group position={[0, 1.5, 0]}>\r\n                            <mesh rotation={[Math.PI, 0, 0]}>\r\n                                <coneGeometry args={[1.2, 1.5, 32, 1, true]} />\r\n                                <meshStandardMaterial color=\"white\" transparent opacity={0.8} side={THREE.DoubleSide} />\r\n                            </mesh>\r\n                            {progress < 1 && (\r\n                                <mesh position={[0, -1.5 - (progress * 2), 0]}>\r\n                                    <sphereGeometry args={[0.1]} />\r\n                                    <meshStandardMaterial color=\"#93C5FD\" />\r\n                                </mesh>\r\n                            )}\r\n                        </group>\r\n                    )}\r\n\r\n                    {method === 'evaporation' && (\r\n                        <group position={[0, -2, 0]}>\r\n                            <pointLight color=\"orange\" intensity={2} distance={3} />\r\n                            {particles && (\r\n                                <mesh scale={[1, 1, 1]}>\r\n                                    <coneGeometry args={[0.5, 1, 32]} />\r\n                                    <meshStandardMaterial color=\"orange\" emissive=\"red\" emissiveIntensity={2} />\r\n                                </mesh>\r\n                            )}\r\n                        </group>\r\n                    )}\r\n                </group>\r\n            </group>\r\n        </>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// CHAPITRE 10: LES ATOMES (IMMERSIVE & MISSION)\r\n// ============================================================\r\nexport function AtomBuilderSim() {\r\n    const [phase, setPhase] = useState('explore');\r\n    const [protons, setProtons] = useState(1);\r\n    const [neutrons, setNeutrons] = useState(0);\r\n    const [electrons, setElectrons] = useState(1);\r\n    const [mission, setMission] = useState(null);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n\r\n    // Gamification\r\n    const [score, setScore] = useState(0);\r\n    const [collection, setCollection] = useState([]);\r\n    const [timeLeft, setTimeLeft] = useState(60);\r\n    const [showShells, setShowShells] = useState(true);\r\n\r\n    const elements = {\r\n        1: { name: 'Hydrog├¿ne', symbol: 'H' },\r\n        2: { name: 'H├®lium', symbol: 'He' },\r\n        3: { name: 'Lithium', symbol: 'Li' },\r\n        4: { name: 'B├®ryllium', symbol: 'Be' },\r\n        5: { name: 'Bore', symbol: 'B' },\r\n        6: { name: 'Carbone', symbol: 'C' }\r\n    };\r\n\r\n    const element = elements[protons] || { name: 'Inconnu', symbol: '?' };\r\n    const massNumber = protons + neutrons;\r\n    const charge = protons - electrons;\r\n    const isStable = Math.abs(neutrons - protons) <= 1 || (protons === 1 && neutrons === 0);\r\n\r\n    const startMission = () => {\r\n        const targets = [\r\n            { id: 1, p: 1, n: 0, e: 1, name: \"Hydrog├¿ne-1\", points: 50 },\r\n            { id: 2, p: 2, n: 2, e: 2, name: \"H├®lium-4\", points: 100 },\r\n            { id: 3, p: 6, n: 6, e: 6, name: \"Carbone-12\", points: 200 }\r\n        ];\r\n        const t = targets[Math.floor(Math.random() * targets.length)];\r\n        setMission(t);\r\n        setPhase('mission');\r\n        setProtons(1); setNeutrons(0); setElectrons(1);\r\n        setShowSuccess(false);\r\n        setTimeLeft(60);\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && mission && !showSuccess) {\r\n            if (protons === mission.p && neutrons === mission.n && electrons === mission.e) {\r\n                const bonus = Math.floor(timeLeft / 2);\r\n                setScore(s => s + mission.points + bonus);\r\n                setShowSuccess(true);\r\n                if (!collection.includes(element.symbol)) {\r\n                    setCollection(prev => [...prev, element.symbol]);\r\n                }\r\n            }\r\n        }\r\n    }, [protons, neutrons, electrons, mission, phase]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [timeLeft, phase, showSuccess]);\r\n\r\n    return (\r\n        <>\r\n            <SuccessOverlay\r\n                show={showSuccess}\r\n                message={`Fantastique ! Atome de ${mission?.name} stabilis├®.`}\r\n                points={mission?.points + Math.floor(timeLeft / 2)}\r\n                onNext={startMission}\r\n            />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"ÔÜø´©Å Architecte de l'Atome\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[400px] border-pink-500/30 text-white\">\r\n                    <div className=\"flex justify-between items-center mb-4\">\r\n                        <GradeBadge score={score} />\r\n                        {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={60} />}\r\n                    </div>\r\n\r\n                    <XPBar current={score} nextLevel={2000} />\r\n\r\n                    <div className=\"h-[1px] bg-gradient-to-r from-transparent via-pink-500/50 to-transparent my-4\" />\r\n\r\n                    <div className=\"h-[1px] bg-gradient-to-r from-transparent via-pink-500/50 to-transparent my-4\" />\r\n\r\n                    <div className=\"flex justify-between items-center mb-2\">\r\n                        <PhaseSelector currentPhase={phase} onSelect={(p) => { setPhase(p); if (p === 'mission') startMission(); }} />\r\n                        <button onClick={() => setShowShells(!showShells)} className={`text-[10px] px-2 py-1 rounded border ${showShells ? 'bg-blue-600/50 border-blue-400' : 'bg-gray-800 border-gray-600'}`}>\r\n                            {showShells ? '­ƒæü´©Å Orbites' : '­ƒÖê Orbites'}\r\n                        </button>\r\n                    </div>\r\n\r\n                    {phase === 'mission' && mission && (\r\n                        <MissionObjective objective={`Construis cet isotope : ${mission.name}`} icon=\"ÔÜø´©Å\" />\r\n                    )}\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"bg-gray-800/50 p-2 rounded-xl border border-white/5\">\r\n                                <div className=\"flex items-center justify-between mb-4\">\r\n                                    <div className=\"text-center bg-gray-900 rounded-lg p-2 min-w-[50px]\">\r\n                                        <div className=\"text-[10px] text-gray-500\">Z</div>\r\n                                        <div className=\"font-bold text-pink-400\">{protons}</div>\r\n                                    </div>\r\n                                    <div className=\"w-12 h-12 flex items-center justify-center bg-white text-black rounded font-black text-xl shadow-[0_0_20px_rgba(255,255,255,0.3)]\">\r\n                                        {element.symbol}\r\n                                    </div>\r\n                                    <div className=\"text-center bg-gray-900 rounded-lg p-2 min-w-[50px]\">\r\n                                        <div className=\"text-[10px] text-gray-500\">A</div>\r\n                                        <div className=\"font-bold text-pink-400\">{massNumber}</div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-3\">\r\n                                <div className=\"space-y-1\">\r\n                                    <label className=\"flex justify-between text-[10px] text-red-400 font-bold\">\r\n                                        <span>PROTONS (+)</span>\r\n                                        <span>{protons}</span>\r\n                                    </label>\r\n                                    <input type=\"range\" min=\"1\" max=\"6\" value={protons} onChange={e => setProtons(Number(e.target.value))} className=\"w-full h-1 bg-gray-700 accent-red-500 rounded-lg appearance-none cursor-pointer\" />\r\n                                </div>\r\n                                <div className=\"space-y-1\">\r\n                                    <label className=\"flex justify-between text-[10px] text-gray-400 font-bold\">\r\n                                        <span>NEUTRONS (0)</span>\r\n                                        <span>{neutrons}</span>\r\n                                    </label>\r\n                                    <input type=\"range\" min=\"0\" max=\"8\" value={neutrons} onChange={e => setNeutrons(Number(e.target.value))} className=\"w-full h-1 bg-gray-700 accent-gray-500 rounded-lg appearance-none cursor-pointer\" />\r\n                                </div>\r\n                                <div className=\"space-y-1\">\r\n                                    <label className=\"flex justify-between text-[10px] text-blue-400 font-bold\">\r\n                                        <span>├ëLECTRONS (-)</span>\r\n                                        <span>{electrons}</span>\r\n                                    </label>\r\n                                    <input type=\"range\" min=\"0\" max=\"6\" value={electrons} onChange={e => setElectrons(Number(e.target.value))} className=\"w-full h-1 bg-gray-700 accent-blue-500 rounded-lg appearance-none cursor-pointer\" />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"bg-black/60 rounded-xl p-3 border border-pink-500/20 flex flex-col justify-between\">\r\n                            <div className=\"space-y-3\">\r\n                                <div className=\"text-[10px] text-gray-500 font-mono tracking-widest text-center uppercase\">Telemetry</div>\r\n\r\n                                <div className=\"space-y-1\">\r\n                                    <div className=\"flex justify-between text-[10px]\">\r\n                                        <span>CHARGE</span>\r\n                                        <span className={charge === 0 ? 'text-green-400' : 'text-red-400'}>{charge === 0 ? 'NEUTRE' : `${charge > 0 ? '+' : ''}${charge}`}</span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between text-[10px]\">\r\n                                        <span>STABILIT├ë</span>\r\n                                        <span className={isStable ? 'text-green-400' : 'text-red-500 animate-pulse'}>{isStable ? 'STABLE' : 'INSTABLE'}</span>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"border-t border-white/5 pt-2\">\r\n                                    <div className=\"text-[9px] text-gray-500 mb-1\">COLLECTION</div>\r\n                                    <div className=\"flex flex-wrap gap-1\">\r\n                                        {['H', 'He', 'Li', 'Be', 'B', 'C'].map(s => (\r\n                                            <div key={s} className={`w-6 h-6 flex items-center justify-center rounded text-[9px] font-bold ${collection.includes(s) ? 'bg-pink-600 text-white' : 'bg-gray-800 text-gray-600'}`}>\r\n                                                {s}\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <ConfettiExplosion active={success} />\r\n\r\n            <group>\r\n                <Text position={[0, 4, 0]} fontSize={0.5} color=\"#EC4899\">STRUCTURE DE L'ATOME</Text>\r\n\r\n                {/* Noyau */}\r\n                <group position={[0, 0, 0]}>\r\n                    <group>\r\n                        {/* Visualisation : si instable, le noyau tremble */}\r\n                        {/* Protons rouges */}\r\n                        {Array.from({ length: protons }).map((_, i) => (\r\n                            <Sphere key={`p-${i}`} args={[0.3]} position={[\r\n                                Math.sin(i * 2 + (isStable ? 0 : Date.now() * 0.01)) * 0.35,\r\n                                Math.cos(i * 3) * 0.35,\r\n                                Math.sin(i * 4) * 0.35\r\n                            ]}>\r\n                                <meshStandardMaterial\r\n                                    color=\"#EF4444\"\r\n                                    roughness={0.3}\r\n                                    emissive={isStable ? \"#EF4444\" : \"#7F1D1D\"}\r\n                                    emissiveIntensity={isStable ? 0.2 : 0}\r\n                                />\r\n                            </Sphere>\r\n                        ))}\r\n                        {/* Neutrons gris */}\r\n                        {Array.from({ length: neutrons }).map((_, i) => (\r\n                            <Sphere key={`n-${i}`} args={[0.3]} position={[\r\n                                Math.cos(i * 2) * 0.35,\r\n                                Math.sin(i * 3 + (isStable ? 0 : Date.now() * 0.01)) * 0.35,\r\n                                Math.cos(i * 5) * 0.35\r\n                            ]}>\r\n                                <meshStandardMaterial color=\"#9CA3AF\" roughness={0.3} />\r\n                            </Sphere>\r\n                        ))}\r\n                    </group>\r\n\r\n                    {!isStable && (\r\n                        <pointLight color=\"red\" intensity={2} distance={2} animate={{ intensity: [1, 3] }} />\r\n                    )}\r\n                </group>\r\n\r\n                {/* ├ëlectrons sur orbites */}\r\n                <group rotation={[Math.PI / 4, Math.PI / 4, 0]}>\r\n                    {Array.from({ length: electrons }).map((_, i) => {\r\n                        const shell = i < 2 ? 1 : 2;\r\n                        const radius = shell * 2;\r\n                        const speed = 1.5 / shell;\r\n                        return (\r\n                            <Electron key={`e-${i}`} radius={radius} speed={speed} offset={i} />\r\n                        );\r\n                    })}\r\n                </group>\r\n\r\n                {/* Orbites visuelles */}\r\n                {showShells && (\r\n                    <group rotation={[Math.PI / 4, Math.PI / 4, 0]}>\r\n                        <Torus args={[2, 0.02, 32, 100]} rotation={[Math.PI / 2, 0, 0]}><meshBasicMaterial color=\"#3B82F6\" opacity={0.3} transparent /></Torus>\r\n                        {electrons > 2 && <Torus args={[4, 0.02, 32, 100]} rotation={[Math.PI / 2, 0, 0]}><meshBasicMaterial color=\"#3B82F6\" opacity={0.3} transparent /></Torus>}\r\n                    </group>\r\n                )}\r\n            </group>\r\n        </>\r\n    );\r\n}\r\n\r\nfunction ControlRow({ label, color, value, onChange, min, max }) {\r\n    return (\r\n        <div className=\"flex items-center justify-between\">\r\n            <span className={`text-sm font-bold ${color}`}>{label}</span>\r\n            <div className=\"flex items-center gap-3\">\r\n                <button onClick={() => onChange(Math.max(min, value - 1))} className=\"w-8 h-8 rounded bg-gray-700 hover:bg-gray-600 border border-gray-600\">-</button>\r\n                <span className=\"w-4 text-center font-mono font-bold\">{value}</span>\r\n                <button onClick={() => onChange(Math.min(max, value + 1))} className=\"w-8 h-8 rounded bg-gray-700 hover:bg-gray-600 border border-gray-600\">+</button>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction Electron({ radius, speed, offset }) {\r\n    const ref = useRef();\r\n    useFrame(({ clock }) => {\r\n        if (ref.current) {\r\n            const t = clock.elapsedTime * speed + offset;\r\n            ref.current.position.x = Math.cos(t) * radius;\r\n            ref.current.position.z = Math.sin(t) * radius;\r\n        }\r\n    });\r\n    return (\r\n        <mesh ref={ref}>\r\n            <sphereGeometry args={[0.1]} />\r\n            <meshStandardMaterial color=\"#3B82F6\" emissive=\"#3B82F6\" emissiveIntensity={2} />\r\n            <pointLight distance={1} intensity={1} color=\"#3B82F6\" />\r\n        </mesh>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// GAMIFICATION HELPERS (ADDED)\r\n// ============================================================\r\n\r\n// Local gamification helpers removed to use GamificationUtils.js central ones\r\n\r\nexport function MoleConceptPC4() {\r\n    const [phase, setPhase] = useState('explore');\r\n    const [element, setElement] = useState('C');\r\n    const [moles, setMoles] = useState(1);\r\n    const [targetMass, setTargetMass] = useState(null);\r\n    const [showAnalogy, setShowAnalogy] = useState(false);\r\n\r\n    // Gamification\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n\r\n    const elements = {\r\n        C: { name: 'Carbone', M: 12.0, color: '#1F2937' },\r\n        S: { name: 'Soufre', M: 32.1, color: '#FCD34D' },\r\n        Cu: { name: 'Cuivre', M: 63.5, color: '#B45309' },\r\n        H2O: { name: 'Eau', M: 18.0, color: '#3B82F6' },\r\n        Fe: { name: 'Fer', M: 55.8, color: '#9CA3AF' }\r\n    };\r\n\r\n    const el = elements[element];\r\n    const mass = moles * el.M;\r\n    const atoms = (moles * 6.02).toFixed(2);\r\n\r\n    const startChallenge = () => {\r\n        const keys = Object.keys(elements);\r\n        const randEl = keys[Math.floor(Math.random() * keys.length)];\r\n        setElement(randEl);\r\n        const randMoles = (Math.floor(Math.random() * 40) + 1) / 10;\r\n        setTargetMass((randMoles * elements[randEl].M).toFixed(1));\r\n        setMoles(0);\r\n        setPhase('mission');\r\n        setShowSuccess(false);\r\n        setTimeLeft(45);\r\n    };\r\n\r\n    const checkChallenge = () => {\r\n        if (targetMass && Math.abs(mass - parseFloat(targetMass)) < 0.1) {\r\n            if (!showSuccess) {\r\n                const points = 50 + Math.floor(timeLeft / 2);\r\n                setScore(s => s + points);\r\n                setShowSuccess(true);\r\n            }\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [timeLeft, phase, showSuccess]);\r\n\r\n    return (\r\n        <>\r\n            <SuccessOverlay show={showSuccess} message={`Pes├®e parfaite ! ${mass.toFixed(1)}g de ${el.name}`} points={50 + Math.floor(timeLeft / 2)} onNext={startChallenge} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"ÔÜû´©Å Laboratoire de la Mole\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[400px] border-green-500/30 text-white\">\r\n                    <div className=\"flex justify-between items-center mb-4\">\r\n                        <GradeBadge score={score} />\r\n                        {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={45} />}\r\n                    </div>\r\n\r\n                    <XPBar current={score} nextLevel={1500} />\r\n\r\n                    <div className=\"h-[1px] bg-gradient-to-r from-transparent via-green-500/50 to-transparent my-4\" />\r\n\r\n                    <PhaseSelector currentPhase={phase} onSelect={(p) => { setPhase(p); if (p === 'mission') startChallenge(); }} />\r\n\r\n                    {phase === 'mission' && targetMass && (\r\n                        <MissionObjective objective={`P├¿se exactement ${targetMass}g de ${el.name}`} icon=\"ÔÜû´©Å\" />\r\n                    )}\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                        <div className=\"space-y-4\">\r\n                            {phase === 'explore' && (\r\n                                <div>\r\n                                    <label className=\"text-[10px] text-gray-400 block mb-1 uppercase tracking-wider\">├ëchantillon</label>\r\n                                    <div className=\"grid grid-cols-2 gap-1\">\r\n                                        {Object.entries(elements).map(([k, e]) => (\r\n                                            <button key={k} onClick={() => setElement(k)}\r\n                                                className={`p-1 text-[10px] font-bold rounded border transition-all ${element === k ? 'bg-green-600 border-green-400' : 'bg-gray-800 border-gray-700'}`}>\r\n                                                {k}\r\n                                            </button>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n\r\n                            <div>\r\n                                <label className=\"text-[10px] text-gray-400 block mb-1 uppercase tracking-wider\">Quantit├® (n)</label>\r\n                                <div className=\"bg-gray-900/50 p-3 rounded-xl border border-white/5\">\r\n                                    <div className=\"text-2xl font-bold text-green-400 font-mono mb-2\">{moles} <span className=\"text-xs text-gray-500\">mol</span></div>\r\n                                    <input type=\"range\" min=\"0\" max=\"5\" step=\"0.1\" value={moles} onChange={(e) => setMoles(Number(e.target.value))}\r\n                                        className=\"w-full h-1 bg-gray-700 accent-green-500 rounded-lg appearance-none cursor-pointer\" />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"bg-black/60 rounded-xl p-3 border border-green-500/20 flex flex-col justify-between\">\r\n                            <div className=\"space-y-3\">\r\n                                <div className=\"text-[10px] text-center font-mono text-gray-500 tracking-widest uppercase\">Balance Digitale</div>\r\n\r\n                                <div className=\"bg-gray-900/80 p-3 rounded-lg border border-white/5 text-center\">\r\n                                    <div className=\"text-2xl font-black text-white font-mono\">{mass.toFixed(1)}<span className=\"text-xs ml-1 text-gray-500\">g</span></div>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-1\">\r\n                                    <div className=\"flex justify-between text-[9px]\">\r\n                                        <span className=\"text-gray-500\">MASSE MOLAIRE</span>\r\n                                        <span className=\"font-bold text-gray-300\">{el.M} g/mol</span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between text-[9px]\">\r\n                                        <span className=\"text-gray-500\">PARTICULES</span>\r\n                                        <span className=\"font-bold text-gray-300\">{atoms}e23</span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <button onClick={phase === 'mission' ? checkChallenge : () => setShowAnalogy(!showAnalogy)}\r\n                                className={`w-full py-2 rounded font-bold text-[10px] transition-all ${phase === 'mission' ? 'bg-green-600 hover:bg-green-500 shadow-lg shadow-green-500/20' : 'bg-gray-800 hover:bg-white hover:text-black'}`}>\r\n                                {phase === 'mission' ? 'VALIDER LA PES├ëE' : (showAnalogy ? 'CACHER ANALOGIE' : 'VOIR ANALOGIE ­ƒºá')}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            <group>\r\n                {showAnalogy && mode === 'explore' && (\r\n                    <group position={[3, 1, 0]}>\r\n                        <Text fontSize={0.3} color=\"white\" maxWidth={3} textAlign=\"center\" anchorX=\"left\">\r\n                            {`1 mole d'eau ($H_2O$)\\n= 18 mL d'eau\\n= 602 000 milliards de milliards de mol├®cules !\\n\\nC'est autant de mol├®cules qu'il y a de grains de sable\\n dans tout le Sahara... x 1000 !`}\r\n                        </Text>\r\n                        <Box args={[3.2, 2, 0.1]} position={[1.5, -0.2, -0.1]}>\r\n                            <meshBasicMaterial color=\"black\" transparent opacity={0.6} />\r\n                        </Box>\r\n                    </group>\r\n                )}\r\n\r\n                <Text position={[0, 3.5, 0]} fontSize={0.5} color=\"#4ADE80\">n = m / M</Text>\r\n\r\n                {/* Balance */}\r\n                <group position={[0, -2, 0]}>\r\n                    <Box args={[4, 0.5, 3]} material-color=\"#333\" />\r\n                    <Box args={[3, 0.2, 2.5]} position={[0, 0.4, 0]} material-color=\"#111\" />\r\n\r\n                    {/* Affichage digital sur la balance */}\r\n                    <group position={[0, 0.51, 1.2]} rotation={[-Math.PI / 2, 0, 0]}>\r\n                        <mesh position={[0, 0, -0.01]}>\r\n                            <planeGeometry args={[1.5, 0.6]} />\r\n                            <meshBasicMaterial color=\"#000\" />\r\n                        </mesh>\r\n                        <Text position={[0, 0, 0]} fontSize={0.4} color={showSuccess ? \"#4ADE80\" : \"red\"}>\r\n                            {mass.toFixed(1)} g\r\n                        </Text>\r\n                    </group>\r\n\r\n                    {/* Tas de mati├¿re */}\r\n                    <group position={[0, 0.5, 0]}>\r\n                        {moles > 0 && (\r\n                            <mesh scale={Math.pow(moles, 1 / 3) * (Math.max(1, el.M / 20))}>\r\n                                {element === 'H2O' ? (\r\n                                    <cylinderGeometry args={[0.5, 0.5, 0.5, 32]} />\r\n                                ) : (\r\n                                    <coneGeometry args={[0.6, 0.8, 32]} />\r\n                                )}\r\n                                <meshStandardMaterial color={el.color} roughness={0.9} transparent opacity={element === 'H2O' ? 0.6 : 1} />\r\n                            </mesh>\r\n                        )}\r\n                        {element === 'H2O' && (\r\n                            <mesh position={[0, 0.25 * Math.pow(moles, 1 / 3), 0]} scale={Math.pow(moles, 1 / 3)}>\r\n                                <cylinderGeometry args={[0.6, 0.6, 0.6, 32, 1, true]} />\r\n                                <meshPhysicalMaterial color=\"#A5F3FC\" transmission={0.9} opacity={0.3} transparent side={THREE.DoubleSide} />\r\n                            </mesh>\r\n                        )}\r\n                    </group>\r\n                </group>\r\n            </group>\r\n        </>\r\n    );\r\n}\r\n\r\n\r\n// ============================================================\r\n// CHAPITRE 4: CONSERVATION DE LA MASSE (IMMERSIVE)\r\n// ============================================================\r\nexport function MassConservation() {\r\n    const [phase, setPhase] = useState('explore');\r\n    const [step, setStep] = useState(0); // 0: Setup, 1: Reaction\r\n    const [system, setSystem] = useState('open'); // open, closed\r\n    const [gasParticles, setGasParticles] = useState(null);\r\n    const [balanceValue, setBalanceValue] = useState(200);\r\n\r\n    // Gamification\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [prediction, setPrediction] = useState(null);\r\n    const [experimentDone, setExperimentDone] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const pts = new Float32Array(150 * 3);\r\n        for (let i = 0; i < 150 * 3; i++) pts[i] = (Math.random() - 0.5) * 1.0;\r\n        setGasParticles(pts);\r\n    }, []);\r\n\r\n    const startReaction = () => {\r\n        if (!prediction) return;\r\n        setExperimentDone(false);\r\n        setStep(1);\r\n        let target = system === 'open' ? 190 : 200;\r\n        const duration = 3000;\r\n        const start = 200;\r\n        const startTime = Date.now();\r\n\r\n        const animate = () => {\r\n            const elapsed = Date.now() - startTime;\r\n            const progress = Math.min(elapsed / duration, 1);\r\n            const newVal = start - (start - target) * progress;\r\n            setBalanceValue(newVal);\r\n            if (progress < 1) {\r\n                requestAnimationFrame(animate);\r\n            } else {\r\n                setExperimentDone(true);\r\n                const correct = (system === 'open' && prediction === 'less') || (system === 'closed' && prediction === 'same');\r\n                if (correct) {\r\n                    setShowSuccess(true);\r\n                    setScore(s => s + 50);\r\n                }\r\n            }\r\n        };\r\n        animate();\r\n    };\r\n\r\n    const reset = () => {\r\n        setStep(0);\r\n        setBalanceValue(200);\r\n        setPrediction(null);\r\n        setExperimentDone(false);\r\n        setShowSuccess(false);\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <SuccessOverlay show={showSuccess} message={system === 'closed' ? \"Masse conserv├®e ! Bravo !\" : \"Masse perdue (gaz) ! Bien vu !\"} points={50} onNext={reset} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"ÔÜû´©Å Conservation de la Masse\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[400px] border-red-500/30 text-white\">\r\n                    <div className=\"flex justify-between items-center mb-4\">\r\n                        <GradeBadge score={score} />\r\n                        <div className=\"bg-gray-900 rounded-lg px-3 py-1 border border-white/10 text-[10px] text-gray-400\">\r\n                            STEP: {step === 0 ? 'PREDICTION' : 'ANALYSIS'}\r\n                        </div>\r\n                    </div>\r\n\r\n                    <XPBar current={score} nextLevel={1000} />\r\n\r\n                    <div className=\"h-[1px] bg-gradient-to-r from-transparent via-red-500/50 to-transparent my-4\" />\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"bg-gray-800/50 p-3 rounded-xl border border-white/5\">\r\n                                <label className=\"text-[10px] text-gray-500 block mb-2 uppercase tracking-widest\">Type de Syst├¿me</label>\r\n                                <div className=\"grid grid-cols-1 gap-2\">\r\n                                    <button onClick={() => !step && setSystem('open')} disabled={step === 1}\r\n                                        className={`flex-1 py-1.5 rounded text-[10px] font-bold transition-all ${system === 'open' ? 'bg-red-600 border-red-400 border' : 'bg-gray-800 border-gray-700 border opacity-50'}`}>\r\n                                        SYST├êME OUVERT ­ƒöô\r\n                                    </button>\r\n                                    <button onClick={() => !step && setSystem('closed')} disabled={step === 1}\r\n                                        className={`flex-1 py-1.5 rounded text-[10px] font-bold transition-all ${system === 'closed' ? 'bg-green-600 border-green-400 border' : 'bg-gray-800 border-gray-700 border opacity-50'}`}>\r\n                                        SYST├êME CLOS ­ƒöÆ\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {step === 0 && (\r\n                                <div className=\"bg-gray-800/50 p-3 rounded-xl border border-white/5\">\r\n                                    <label className=\"text-[10px] text-gray-500 block mb-2 uppercase tracking-widest\">Pr├®diction</label>\r\n                                    <div className=\"grid grid-cols-1 gap-1\">\r\n                                        <button onClick={() => setPrediction('less')} className={`p-1.5 rounded text-[10px] border transition-all ${prediction === 'less' ? 'bg-orange-600 border-orange-400' : 'bg-gray-900 border-gray-700'}`}>\r\n                                            LA MASSE VA BAISSER\r\n                                        </button>\r\n                                        <button onClick={() => setPrediction('same')} className={`p-1.5 rounded text-[10px] border transition-all ${prediction === 'same' ? 'bg-orange-600 border-orange-400' : 'bg-gray-900 border-gray-700'}`}>\r\n                                            LA MASSE SERA stable\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        <div className=\"bg-black/60 rounded-xl p-3 border border-red-500/20 flex flex-col justify-between\">\r\n                            <div className=\"space-y-3\">\r\n                                <div className=\"text-[10px] text-center font-mono text-gray-500 tracking-widest uppercase\">Balance Digitale</div>\r\n\r\n                                <div className=\"bg-gray-900/80 p-3 rounded-lg border border-white/5 text-center\">\r\n                                    <div className={`text-2xl font-black font-mono transition-colors ${step === 1 && system === 'open' ? 'text-red-400 animate-pulse' : 'text-green-400'}`}>\r\n                                        {balanceValue.toFixed(1)}<span className=\"text-[10px] ml-1 opacity-50\">g</span>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"text-[9px] text-gray-400 leading-tight\">\r\n                                    {step === 0 ? \"Configurez et faites une pr├®diction.\" : (experimentDone ? (system === 'open' ? \"Le gaz s'est ├®chapp├® !\" : \"Le gaz est rest├® pi├®g├®.\") : \"R├®action en cours...\")}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <button onClick={step === 0 ? startReaction : reset} disabled={step === 0 && !prediction}\r\n                                className={`w-full py-2 rounded font-black text-[10px] tracking-widest shadow-lg transition-transform hover:scale-105 active:scale-95 ${step === 0 ? (prediction ? 'bg-white text-black' : 'bg-gray-800 text-gray-600 cursor-not-allowed') : 'bg-gray-200 text-black'}`}>\r\n                                {step === 0 ? \"LANCER R├ëACTION\" : \"REINIT.\"}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            <group>\r\n                {/* Scene */}\r\n                <group position={[0, -1, 0]}>\r\n                    {/* Balance */}\r\n                    <group position={[0, -1, 0]}>\r\n                        <boxGeometry args={[3, 0.2, 2]} />\r\n                        <meshStandardMaterial color=\"#333\" />\r\n                        {/* Screen */}\r\n                        <mesh position={[0, 0.11, 0.8]} rotation={[-Math.PI / 2, 0, 0]}>\r\n                            <planeGeometry args={[1, 0.4]} />\r\n                            <meshBasicMaterial color=\"black\" />\r\n                        </mesh>\r\n                        <Text position={[0, 0.12, 0.8]} rotation={[-Math.PI / 2, 0, 0]} fontSize={0.2} color=\"red\">\r\n                            {balanceValue.toFixed(1)} g\r\n                        </Text>\r\n                    </group>\r\n\r\n                    {/* Flask */}\r\n                    <group position={[0, 0.5, 0]}>\r\n                        <mesh position={[0, -0.5, 0]}>\r\n                            <cylinderGeometry args={[0.8, 1, 1.5, 32, 1, true]} />\r\n                            <meshPhysicalMaterial color=\"white\" transmission={0.9} opacity={0.3} transparent side={THREE.DoubleSide} />\r\n                        </mesh>\r\n                        {/* Liquid Reactants */}\r\n                        <mesh position={[0, -1, 0]} scale={[1, step === 1 ? 0.8 : 1, 1]}>\r\n                            <cylinderGeometry args={[0.9, 0.9, 0.5, 32]} />\r\n                            <meshStandardMaterial color=\"#E91E63\" transparent opacity={0.8} />\r\n                        </mesh>\r\n\r\n                        {/* Gas Particles */}\r\n                        {step === 1 && gasParticles && (\r\n                            <GasParticles particles={gasParticles} escape={system === 'open'} />\r\n                        )}\r\n\r\n                        {/* Stopper */}\r\n                        {system === 'closed' && (\r\n                            <mesh position={[0, 0.3, 0]}>\r\n                                <cylinderGeometry args={[0.85, 0.8, 0.2]} />\r\n                                <meshStandardMaterial color=\"#5D4037\" />\r\n                            </mesh>\r\n                        )}\r\n                    </group>\r\n                </group>\r\n            </group>\r\n        </>\r\n    );\r\n}\r\n\r\nfunction GasParticles({ particles, escape }) {\r\n    const ref = useRef();\r\n    useFrame((state, delta) => {\r\n        if (!ref.current) return;\r\n        const positions = ref.current.geometry.attributes.position.array;\r\n        for (let i = 0; i < positions.length; i += 3) {\r\n            // Move up\r\n            positions[i + 1] += delta * (0.5 + Math.random());\r\n            // Wiggle\r\n            positions[i] += (Math.random() - 0.5) * 0.05;\r\n            positions[i + 2] += (Math.random() - 0.5) * 0.05;\r\n\r\n            // Reset if too high (loop for visual) or remove if escape\r\n            if (escape) {\r\n                if (positions[i + 1] > 5) positions[i + 1] = -0.5;\r\n            } else {\r\n                // Bounce in flask (approx)\r\n                if (positions[i + 1] > 0.2) positions[i + 1] = -0.5;\r\n            }\r\n        }\r\n        ref.current.geometry.attributes.position.needsUpdate = true;\r\n    });\r\n\r\n    return (\r\n        <points ref={ref} position={[0, -0.5, 0]}>\r\n            <bufferGeometry>\r\n                <bufferAttribute attach=\"attributes-position\" count={particles.length / 3} array={particles} itemSize={3} />\r\n            </bufferGeometry>\r\n            <pointsMaterial size={0.1} color=\"#FFF\" transparent opacity={0.6} />\r\n        </points>\r\n    );\r\n}\r\n\r\n\r\n// ============================================================\r\n// CHAPITRE 1: D├ëMARCHE SCIENTIFIQUE (IMMERSIVE)\r\n// ============================================================\r\nexport function ScientificMethod() {\r\n    const [phase, setPhase] = useState('explore');\r\n    const [scenario, setScenario] = useState('plant');\r\n    const [step, setStep] = useState(0);\r\n    const [variable, setVariable] = useState(null);\r\n    const [result, setResult] = useState(null);\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n\r\n    const scenarios = {\r\n        plant: {\r\n            title: \"­ƒî▒ Myst├¿re de la Plante\",\r\n            obs: \"Cette plante est toute fan├®e... Pourquoi ?\",\r\n            hypotheses: [\r\n                { id: 'water', text: \"Elle manque d'eau\", correct: true },\r\n                { id: 'music', text: \"Elle n'aime pas ma musique\", correct: false },\r\n                { id: 'light', text: \"Elle manque de lumi├¿re\", correct: false }\r\n            ],\r\n            exp: \"Testons ton hypoth├¿se sur 3 jours...\",\r\n            conc: { true: \"Bravo ! L'eau est vitale.\", false: \"Rien ne change... Essayons autre chose.\" }\r\n        },\r\n        pendulum: {\r\n            title: \"ÔÅ▒´©Å Le Pendule Simple\",\r\n            obs: \"Qu'est-ce qui change la vitesse de balancement ?\",\r\n            hypotheses: [\r\n                { id: 'mass', text: \"La masse de l'objet\", correct: false },\r\n                { id: 'length', text: \"La longueur de la ficelle\", correct: true },\r\n                { id: 'force', text: \"La force de pouss├®e\", correct: false }\r\n            ],\r\n            exp: \"Lan├ºons le pendule avec ce param├¿tre...\",\r\n            conc: { true: \"Exact ! Plus c'est court, plus c'est rapide.\", false: \"La p├®riode reste la m├¬me.\" }\r\n        },\r\n        mission: {\r\n            title: \"­ƒòÁ´©Å Mission : La Lampe\",\r\n            obs: \"La lampe de bureau ne s'allume plus ! ├Ç toi de trouver pourquoi.\",\r\n            hypotheses: [\r\n                { id: 'bulb', text: \"L'ampoule est grill├®e\", correct: true },\r\n                { id: 'plug', text: \"La prise est d├®branch├®e\", correct: false },\r\n                { id: 'switch', text: \"L'interrupteur est cass├®\", correct: false }\r\n            ],\r\n            exp: \"Rempla├ºons l'├®l├®ment pour v├®rifier...\",\r\n            conc: { true: \"Gagn├® ! C'├®tait bien l'ampoule.\", false: \"M├¬me avec cet ├®l├®ment neuf, ├ºa ne s'allume pas.\" }\r\n        }\r\n    };\r\n\r\n    const sc = phase === 'mission' ? scenarios.mission : scenarios[scenario];\r\n\r\n    const runExperiment = (hId) => {\r\n        setVariable(hId);\r\n        setStep(2);\r\n        setTimeout(() => {\r\n            const isCorrect = sc.hypotheses.find(h => h.id === hId).correct;\r\n            setResult(isCorrect);\r\n            setStep(3);\r\n            if (isCorrect) {\r\n                setScore(s => s + 50);\r\n                setShowSuccess(true);\r\n            }\r\n        }, 3000);\r\n    };\r\n\r\n    const reset = () => {\r\n        setStep(0);\r\n        setVariable(null);\r\n        setResult(null);\r\n        setShowSuccess(false);\r\n    };\r\n\r\n    const handlePhaseChange = (p) => {\r\n        setPhase(p);\r\n        if (p === 'mission') setScenario('mission');\r\n        else if (scenario === 'mission') setScenario('plant');\r\n        reset();\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            <SuccessOverlay show={showSuccess} message={sc.conc[true]} points={50} onNext={() => { if (phase === 'mission') handlePhaseChange('explore'); else reset(); }} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒö¼ D├®marche Scientifique\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[400px] border-blue-500/30 text-white\">\r\n                    <div className=\"flex justify-between items-center mb-4\">\r\n                        <GradeBadge score={score} />\r\n                        <div className=\"bg-gray-900 rounded-lg px-3 py-1 border border-white/10 text-[10px] text-gray-400 capitalize\">\r\n                            Phase: {phase} | ├ëtape {step + 1}\r\n                        </div>\r\n                    </div>\r\n\r\n                    <XPBar current={score} nextLevel={1000} />\r\n\r\n                    <div className=\"h-[1px] bg-gradient-to-r from-transparent via-blue-500/50 to-transparent my-4\" />\r\n\r\n                    <PhaseSelector currentPhase={phase} onSelect={handlePhaseChange} />\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                        <div className=\"space-y-4\">\r\n                            {step === 0 && (\r\n                                <div className=\"space-y-2\">\r\n                                    <label className=\"text-[10px] text-gray-400 block uppercase tracking-widest\">Enqu├¬te en cours</label>\r\n                                    {phase === 'explore' ? (\r\n                                        <>\r\n                                            <button onClick={() => setScenario('plant')} className={`w-full p-2 rounded text-[10px] font-bold border transition-all ${scenario === 'plant' ? 'bg-green-600 border-green-400' : 'bg-gray-800 border-gray-700 opacity-50'}`}>\r\n                                                LA PLANTE ­ƒî▒\r\n                                            </button>\r\n                                            <button onClick={() => setScenario('pendulum')} className={`w-full p-2 rounded text-[10px] font-bold border transition-all ${scenario === 'pendulum' ? 'bg-purple-600 border-purple-400' : 'bg-gray-800 border-gray-700 opacity-50'}`}>\r\n                                                LE PENDULE ÔÅ▒´©Å\r\n                                            </button>\r\n                                        </>\r\n                                    ) : (\r\n                                        <div className=\"p-4 bg-blue-900/20 border border-blue-500/30 rounded-xl text-center\">\r\n                                            <span className=\"text-2xl\">­ƒòÁ´©Å</span>\r\n                                            <div className=\"text-[10px] font-bold mt-2 text-blue-300\">MISSION SP├ëCIALE</div>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n\r\n                            {step === 1 && (\r\n                                <div className=\"space-y-2\">\r\n                                    <label className=\"text-[10px] text-gray-400 block uppercase tracking-widest\">Tes Hypoth├¿ses</label>\r\n                                    {sc.hypotheses.map(h => (\r\n                                        <button key={h.id} onClick={() => runExperiment(h.id)}\r\n                                            className=\"w-full p-2 text-left text-[9px] bg-gray-800 hover:bg-gray-700 rounded border border-gray-600 hover:border-blue-400 transition-all\">\r\n                                            ­ƒñö {h.text}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        <div className=\"bg-black/60 rounded-xl p-3 border border-blue-500/20 flex flex-col justify-between\">\r\n                            <div className=\"space-y-3\">\r\n                                <div className=\"text-[10px] text-center font-mono text-gray-500 tracking-widest uppercase\">Carnet de Labo</div>\r\n\r\n                                <div className=\"bg-gray-900/80 p-3 rounded-lg border border-white/5\">\r\n                                    <div className=\"text-[10px] leading-relaxed text-blue-100 italic\">\r\n                                        {step === 0 ? sc.obs : (step === 1 ? \"Choisis une hypoth├¿se ├á tester par l'exp├®rience.\" : (step === 2 ? sc.exp : \"Interpr├¿te les r├®sultats obtenus.\"))}\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {step === 3 && (\r\n                                    <div className={`p-2 rounded text-[10px] font-bold text-center ${result ? 'bg-green-900/40 text-green-400' : 'bg-red-900/40 text-red-400'}`}>\r\n                                        {result ? 'VALID├ëE Ô£à' : 'REJET├ëE ÔØî'}\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            <button onClick={step === 0 ? () => setStep(1) : (step === 3 ? reset : null)}\r\n                                disabled={step === 1 || step === 2}\r\n                                className={`w-full py-2 rounded font-black text-[10px] tracking-widest transition-transform hover:scale-105 active:scale-95 ${step === 0 ? 'bg-blue-600 text-white shadow-lg shadow-blue-500/20' : (step === 3 ? 'bg-white text-black' : 'bg-gray-800 text-gray-500')}`}>\r\n                                {step === 0 ? 'SUIVANT' : (step === 3 ? 'RECOMMENCER' : 'EXP├ëRIENCE...')}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <group position={[0, -1, 0]}>\r\n                {scenario === 'plant' && <PlantSim state={step === 0 ? 'dead' : (step === 2 ? 'growing' : (result ? 'alive' : 'dead_dry'))} />}\r\n                {scenario === 'pendulum' && <PendulumSim moving={step === 2} length={variable === 'length' ? 1 : 2} mass={variable === 'mass' ? 2 : 1} />}\r\n                {scenario === 'mission' && (\r\n                    <group>\r\n                        <mesh position={[0, 1, 0]}>\r\n                            <cylinderGeometry args={[0.5, 0.5, 1]} />\r\n                            <meshStandardMaterial color={step === 3 && result ? \"#FFEB3B\" : \"#333\"} emissive={step === 3 && result ? \"#FFEB3B\" : \"black\"} emissiveIntensity={1} />\r\n                        </mesh>\r\n                        <mesh position={[0, 0, 0]}>\r\n                            <boxGeometry args={[1, 0.2, 1]} />\r\n                            <meshStandardMaterial color=\"gray\" />\r\n                        </mesh>\r\n                        {step === 2 && <Text position={[0, 2, 0]} fontSize={0.2} color=\"white\">­ƒöº En cours de r├®paration...</Text>}\r\n                    </group>\r\n                )}\r\n            </group>\r\n        </group>\r\n    );\r\n}\r\n\r\nfunction PlantSim({ state }) {\r\n    // state: dead, growing, alive, dead_dry\r\n    return (\r\n        <group>\r\n            <mesh position={[0, -1, 0]}>\r\n                <cylinderGeometry args={[0.5, 0.3, 1]} />\r\n                <meshStandardMaterial color=\"#8D6E63\" />\r\n            </mesh>\r\n            <group position={[0, -0.5, 0]}>\r\n                {/* Tige */}\r\n                <mesh position={[0, 1, 0]} rotation={[0, 0, state.startsWith('dead') ? 0.2 : 0]}>\r\n                    <cylinderGeometry args={[0.05, 0.05, 2]} />\r\n                    <meshStandardMaterial color={state === 'alive' ? \"#4CAF50\" : \"#8D6E63\"} />\r\n                </mesh>\r\n                {/* Feuilles */}\r\n                <mesh position={[0, 1.8, 0]} scale={state === 'alive' ? 1 : 0.5} rotation={[0, 0, state.startsWith('dead') ? 0.5 : 0]}>\r\n                    <dodecahedronGeometry args={[0.8]} />\r\n                    <meshStandardMaterial color={state === 'alive' ? \"#66BB6A\" : (state === 'dead_dry' ? \"#D7CCC8\" : \"#A1887F\")} />\r\n                </mesh>\r\n                {/* Eau qui tombe (si growing) */}\r\n                {state === 'growing' && (\r\n                    <group position={[0, 3, 0]}>\r\n                        <mesh position={[0, 0, 0]}>\r\n                            <coneGeometry args={[0.5, 1, 32]} rotation={[Math.PI, 0, 0]} />\r\n                            <meshStandardMaterial color=\"blue\" transparent opacity={0.5} />\r\n                        </mesh>\r\n                        {Array.from({ length: 5 }).map((_, i) => (\r\n                            <mesh key={i} position={[(Math.random() - 0.5) * 0.5, -1 - Math.random(), (Math.random() - 0.5) * 0.5]}>\r\n                                <sphereGeometry args={[0.05]} />\r\n                                <meshStandardMaterial color=\"cyan\" />\r\n                            </mesh>\r\n                        ))}\r\n                    </group>\r\n                )}\r\n            </group>\r\n        </group>\r\n    );\r\n}\r\n\r\nfunction PendulumSim({ moving, length, mass }) {\r\n    const groupRef = useRef();\r\n    useFrame(({ clock }) => {\r\n        if (moving && groupRef.current) {\r\n            // P├®riode T = 2*PI*sqrt(L/g)\r\n            // Si L est petit (1), T est petit -> w est grand\r\n            // Simplification visuelle : w = 1 / sqrt(L)\r\n            const speed = 3 / Math.sqrt(length);\r\n            const angle = Math.sin(clock.elapsedTime * speed) * 0.5;\r\n            groupRef.current.rotation.z = angle;\r\n        } else if (groupRef.current) {\r\n            groupRef.current.rotation.z = 0;\r\n        }\r\n    });\r\n\r\n    return (\r\n        <group position={[0, 2, 0]}>\r\n            <mesh position={[0, 0, 0]}>\r\n                <boxGeometry args={[0.2, 0.2, 0.2]} />\r\n                <meshStandardMaterial color=\"gray\" />\r\n            </mesh>\r\n            <group ref={groupRef}>\r\n                <mesh position={[0, -length / 2, 0]}>\r\n                    <cylinderGeometry args={[0.02, 0.02, length]} />\r\n                    <meshStandardMaterial color=\"white\" />\r\n                </mesh>\r\n                <mesh position={[0, -length, 0]}>\r\n                    <sphereGeometry args={[mass * 0.2]} />\r\n                    <meshStandardMaterial color={mass > 1 ? \"red\" : \"yellow\"} />\r\n                </mesh>\r\n            </group>\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// DENSIT├ë (IMMERSIVE)\r\n// ============================================================\r\n// ============================================================\r\n// DENSIT├ë (IMMERSIVE & CHALLENGE)\r\n// ============================================================\r\nexport function DensityExplorer() {\r\n    const [phase, setPhase] = useState('explore'); // explore, challenge\r\n    const [subMode, setSubMode] = useState('sinkfloat'); // sinkfloat, tower\r\n    const [objectsInWater, setObjectsInWater] = useState([]);\r\n    const [mysteryObj, setMysteryObj] = useState(null);\r\n    const [success, setSuccess] = useState(null);\r\n\r\n    // Gamification\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccessOverlay, setShowSuccessOverlay] = useState(false);\r\n\r\n    const items = [\r\n        { id: 'wood', name: 'Bois', dens: 0.6, color: '#A1887F' },\r\n        { id: 'brick', name: 'Brique', dens: 2.0, color: '#EF5350' },\r\n        { id: 'ice', name: 'Gla├ºon', dens: 0.92, color: '#E0F7FA' },\r\n        { id: 'gold', name: 'Or', dens: 19.3, color: '#FFD700' }\r\n    ];\r\n\r\n    const liquids = [\r\n        { id: 'oil', name: 'Huile', dens: 0.9, color: '#FFF176', y: 1 },\r\n        { id: 'water', name: 'Eau', dens: 1.0, color: '#4FC3F7', y: 0 },\r\n        { id: 'honey', name: 'Miel', dens: 1.4, color: '#FFB74D', y: -1 }\r\n    ];\r\n\r\n    const dropObject = (obj) => {\r\n        setObjectsInWater(prev => [...prev.filter(o => o.id !== obj.id), { ...obj, key: Math.random() }]);\r\n    };\r\n\r\n    const startChallenge = () => {\r\n        const secret = items[Math.floor(Math.random() * items.length)];\r\n        setMysteryObj({ ...secret, originalId: secret.id, id: 'mystery', name: 'Myst├¿reÔØô', color: '#607D8B' });\r\n        setPhase('mission');\r\n        setObjectsInWater([]);\r\n        setSuccess(null);\r\n        setShowSuccessOverlay(false);\r\n    };\r\n\r\n    const verifyGuess = (guessId) => {\r\n        if (!mysteryObj) return;\r\n        if (guessId === mysteryObj.originalId) {\r\n            setSuccess(true);\r\n            const points = 50;\r\n            setScore(s => s + points);\r\n            setShowSuccessOverlay(true);\r\n        } else {\r\n            setSuccess(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <SuccessOverlay show={showSuccessOverlay} message={`Excellent ! C'├®tait bien du ${mysteryObj?.originalId ? items.find(i => i.id === mysteryObj.originalId).name : '...'} !`} points={50} onNext={startChallenge} />\r\n            <ConfettiExplosion active={showSuccessOverlay} />\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒîè Labo de Densit├®\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[400px] border-cyan-500/30 text-white\">\r\n                    <div className=\"flex justify-between items-center mb-4\">\r\n                        <GradeBadge score={score} />\r\n                        <div className=\"bg-gray-900 rounded-lg px-3 py-1 border border-white/10 text-[10px] text-gray-400 uppercase\">\r\n                            {phase === 'mission' ? 'MISSION EN COURS' : 'MODE LIBRE'}\r\n                        </div>\r\n                    </div>\r\n\r\n                    <XPBar current={score} nextLevel={1000} />\r\n\r\n                    <div className=\"h-[1px] bg-gradient-to-r from-transparent via-cyan-500/50 to-transparent my-4\" />\r\n\r\n                    <PhaseSelector currentPhase={phase} onSelect={(p) => { setPhase(p); if (p === 'mission') startChallenge(); }} />\r\n\r\n                    {phase === 'mission' && mysteryObj && (\r\n                        <MissionObjective objective=\"Analyse le comportement de l'objet myst├¿re et identifie son mat├®riau.\" icon=\"­ƒöì\" />\r\n                    )}\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"bg-gray-800/50 p-2 rounded-xl border border-white/5\">\r\n                                <label className=\"text-[10px] text-gray-500 block mb-2 uppercase tracking-widest text-center\">Environnement</label>\r\n                                <div className=\"grid grid-cols-1 gap-1\">\r\n                                    <button onClick={() => { setSubMode('sinkfloat'); setObjectsInWater([]); }}\r\n                                        className={`py-1.5 rounded text-[10px] font-bold border transition-all ${subMode === 'sinkfloat' ? 'bg-cyan-600 border-cyan-400' : 'bg-gray-900 border-gray-700 opacity-50'}`}>\r\n                                        AQUARIUM D'EAU ­ƒÆº\r\n                                    </button>\r\n                                    <button onClick={() => { setSubMode('tower'); setObjectsInWater([]); }}\r\n                                        className={`py-1.5 rounded text-[10px] font-bold border transition-all ${subMode === 'tower' ? 'bg-orange-600 border-orange-400' : 'bg-gray-900 border-gray-700 opacity-50'}`}>\r\n                                        TOUR DE LIQUIDES ­ƒÑ¬\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-1\">\r\n                                <label className=\"text-[10px] text-gray-500 block mb-1 uppercase tracking-widest text-center\">Objets</label>\r\n                                <div className=\"grid grid-cols-2 gap-1\">\r\n                                    {phase === 'mission' ? (\r\n                                        <button onClick={() => dropObject(mysteryObj)} className=\"col-span-2 py-3 bg-white text-black rounded-lg font-black text-[12px] shadow-lg shadow-white/10 hover:scale-105 active:scale-95 transition-all\">\r\n                                            L├éCHER L'OBJET MYST├êRE ­ƒæç\r\n                                        </button>\r\n                                    ) : (\r\n                                        items.map(item => (\r\n                                            <button key={item.id} onClick={() => dropObject(item)}\r\n                                                className=\"p-1 px-2 bg-gray-800 hover:bg-gray-700 rounded border border-gray-600 text-[9px] font-bold text-left flex items-center gap-2\">\r\n                                                <div className=\"w-2 h-2 rounded-full\" style={{ backgroundColor: item.color }} />\r\n                                                {item.name}\r\n                                            </button>\r\n                                        ))\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"bg-black/60 rounded-xl p-3 border border-cyan-500/20 flex flex-col justify-between\">\r\n                            <div className=\"space-y-3\">\r\n                                <div className=\"text-[10px] text-center font-mono text-gray-500 tracking-widest uppercase\">Analyse Materiaux</div>\r\n\r\n                                {phase === 'mission' ? (\r\n                                    <div className=\"grid grid-cols-2 gap-1\">\r\n                                        {items.map(item => (\r\n                                            <button key={item.id} onClick={() => verifyGuess(item.id)}\r\n                                                className={`p-1.5 rounded text-[9px] font-bold border transition-all ${success === false ? 'animate-shake' : ''} bg-gray-900 border-gray-700 hover:border-cyan-400`}>\r\n                                                {item.name}\r\n                                            </button>\r\n                                        ))}\r\n                                    </div>\r\n                                ) : (\r\n                                    <div className=\"bg-gray-900/80 p-3 rounded-lg border border-white/5 text-[9px] text-gray-400 leading-tight\">\r\n                                        {subMode === 'sinkfloat' ? \"Dans l'eau (d=1), les objets plus denses coulent, les moins denses flottent.\" : \"D├®couvre comment les objets se stabilisent entre diff├®rentes couches de liquides.\"}\r\n                                    </div>\r\n                                )}\r\n\r\n                                {success === false && <div className=\"text-[9px] text-red-400 font-bold text-center animate-pulse\">ESSAYE ENCORE !</div>}\r\n                            </div>\r\n\r\n                            <button onClick={() => setObjectsInWater([])} className=\"w-full py-2 rounded bg-gray-800 text-[10px] font-bold hover:bg-white hover:text-black transition-all\">\r\n                                VIDER L'AQUARIUM\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <ConfettiExplosion active={showSuccessOverlay} />\r\n\r\n            <group>\r\n\r\n                {/* Aquarium */}\r\n                <group position={[0, -1.5, 0]}>\r\n                    <mesh position={[0, 1.5, 0]}>\r\n                        <boxGeometry args={[3.2, 3.2, 2.2]} />\r\n                        <meshPhysicalMaterial color=\"#E0F7FA\" transmission={0.9} opacity={0.3} transparent side={THREE.DoubleSide} thickness={0.5} roughness={0} />\r\n                    </mesh>\r\n\r\n                    {subMode === 'sinkfloat' || phase === 'mission' ? (\r\n                        <group>\r\n                            <mesh position={[0, 1, 0]}>\r\n                                <boxGeometry args={[3, 2, 2]} />\r\n                                <meshStandardMaterial color=\"#4FC3F7\" transparent opacity={0.6} />\r\n                            </mesh>\r\n                            {/* Simulation des liquides multiples pour le mode challenge aussi si besoin, mais simplifions a l'eau unique pour sinkfloat/challenge simple */}\r\n                        </group>\r\n                    ) : (\r\n                        // Tour de liquides\r\n                        <group>\r\n                            {liquids.map((l, i) => (\r\n                                <mesh key={l.id} position={[0, l.y, 0]}>\r\n                                    <boxGeometry args={[3, 1, 2]} />\r\n                                    <meshStandardMaterial color={l.color} transparent opacity={0.8} />\r\n                                </mesh>\r\n                            ))}\r\n                        </group>\r\n                    )}\r\n\r\n                    {/* Objets Simul├®s */}\r\n                    {objectsInWater.map(obj => (\r\n                        <FloatingObject key={obj.key} obj={obj} mode={phase === 'mission' ? 'sinkfloat' : subMode} liquids={liquids} />\r\n                    ))}\r\n                </group>\r\n            </group>\r\n        </>\r\n    );\r\n}\r\n\r\n\r\nfunction FloatingObject({ obj, mode, liquids }) {\r\n    const ref = useRef();\r\n    const [yPos, setYPos] = useState(3); // Start high\r\n\r\n    // Physics simplified\r\n    useFrame((state, delta) => {\r\n        let targetY = -0.5; // Bottom by default\r\n\r\n        if (mode === 'sinkfloat') {\r\n            // Water density = 1\r\n            if (obj.dens < 1) targetY = 1.8; // Float surface\r\n            else targetY = 0.1; // Sink bottom\r\n        } else {\r\n            // Find layer based on density\r\n            // Ascending order of Y: Honey (-1), Water (0), Oil (1)\r\n            if (obj.dens > 1.4) targetY = -0.5; // Bottom of Honey\r\n            else if (obj.dens > 1.0) targetY = -0.5; // In Honey (sink) / At interface Honey/Water approx\r\n            else if (obj.dens > 0.9) targetY = 0.5; // In Water\r\n            else targetY = 1.5; // In Oil / Float\r\n        }\r\n\r\n        // Smooth Lerp\r\n        const newY = THREE.MathUtils.lerp(ref.current.position.y, targetY, delta * 2);\r\n        ref.current.position.y = newY;\r\n    });\r\n\r\n    return (\r\n        <mesh ref={ref} position={[0, 3, 0]}>\r\n            <boxGeometry args={[0.5, 0.5, 0.5]} />\r\n            <meshStandardMaterial color={obj.color} />\r\n        </mesh>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// OUTILS DE MESURE (IMMERSIVE)\r\n// ============================================================\r\nexport function MeasurementTools() {\r\n    const [phase, setPhase] = useState('explore');\r\n    const [toolType, setToolType] = useState('ruler'); // ruler, balance\r\n    const [target, setTarget] = useState(5.0);\r\n    const [userValue, setUserValue] = useState(0);\r\n    const [feedback, setFeedback] = useState(null);\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n\r\n    const checkMeasurement = () => {\r\n        const diff = Math.abs(userValue - target);\r\n        const tolerance = toolType === 'ruler' ? 0.2 : 0.5;\r\n        const result = diff < (tolerance / 2) ? 'perfect' : (diff < tolerance ? 'good' : 'bad');\r\n        setFeedback(result);\r\n\r\n        if (result === 'perfect' || result === 'good') {\r\n            const pts = result === 'perfect' ? 50 : 20;\r\n            if (!showSuccess) {\r\n                setScore(s => s + pts);\r\n                setShowSuccess(true);\r\n            }\r\n        }\r\n    };\r\n\r\n    const startNext = () => {\r\n        if (phase === 'mission') {\r\n            const nextTool = Math.random() > 0.5 ? 'ruler' : 'balance';\r\n            setToolType(nextTool);\r\n            setTarget(nextTool === 'ruler' ? (Math.random() * 4 + 3).toFixed(1) : (Math.random() * 150 + 50).toFixed(0));\r\n        } else {\r\n            setTarget(toolType === 'ruler' ? (Math.random() * 4 + 3).toFixed(1) : (Math.random() * 150 + 50).toFixed(0));\r\n        }\r\n        setUserValue(toolType === 'ruler' ? 3 : 0);\r\n        setFeedback(null);\r\n        setShowSuccess(false);\r\n    };\r\n\r\n    const handlePhaseChange = (p) => {\r\n        setPhase(p);\r\n        startNext();\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            <SuccessOverlay show={showSuccess} message={feedback === 'perfect' ? \"Pr├®cision Chirurgicale ! ­ƒÄ»\" : \"Mesure valid├®e ! ­ƒæì\"} points={feedback === 'perfect' ? 50 : 20} onNext={startNext} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒôÅ Atelier de M├®trologie\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[450px] border-yellow-500/30 text-white\">\r\n                    <div className=\"flex justify-between items-center mb-4\">\r\n                        <GradeBadge score={score} />\r\n                        <div className=\"bg-gray-900 rounded-lg px-3 py-1 border border-white/10 text-[10px] text-gray-400 font-mono tracking-tighter\">\r\n                            LAB_STATION_PC4_02\r\n                        </div>\r\n                    </div>\r\n\r\n                    <XPBar current={score} nextLevel={2000} />\r\n\r\n                    <div className=\"h-[1px] bg-gradient-to-r from-transparent via-yellow-500/50 to-transparent my-4\" />\r\n\r\n                    <PhaseSelector currentPhase={phase} onSelect={handlePhaseChange} />\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"bg-gray-800/50 p-2 rounded-xl border border-white/5\">\r\n                                <label className=\"text-[10px] text-gray-500 block mb-2 uppercase tracking-widest text-center\">Choix de l'Outil</label>\r\n                                <div className=\"grid grid-cols-2 gap-1\">\r\n                                    <button onClick={() => { setToolType('ruler'); startNext(); }} disabled={phase === 'mission'}\r\n                                        className={`py-1.5 rounded text-[10px] font-bold border transition-all ${toolType === 'ruler' ? 'bg-yellow-600 border-yellow-400' : 'bg-gray-900 border-gray-700 opacity-50'}`}>\r\n                                        R├êGLE ­ƒôÅ\r\n                                    </button>\r\n                                    <button onClick={() => { setToolType('balance'); startNext(); }} disabled={phase === 'mission'}\r\n                                        className={`py-1.5 rounded text-[10px] font-bold border transition-all ${toolType === 'balance' ? 'bg-yellow-600 border-yellow-400' : 'bg-gray-900 border-gray-700 opacity-50'}`}>\r\n                                        BALANCE ÔÜû´©Å\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"bg-gray-900/50 p-3 rounded-xl border border-white/5\">\r\n                                <label className=\"text-[10px] text-gray-500 block mb-2 uppercase tracking-widest text-center\">Valeur Mesur├®e</label>\r\n                                <div className=\"text-3xl font-black text-yellow-400 font-mono text-center mb-2\">\r\n                                    {toolType === 'ruler' ? parseFloat(userValue).toFixed(1) : userValue}\r\n                                    <span className=\"text-xs ml-1 text-gray-500\">{toolType === 'ruler' ? 'cm' : 'g'}</span>\r\n                                </div>\r\n                                <input type=\"range\"\r\n                                    min={toolType === 'ruler' ? 3 : 0}\r\n                                    max={toolType === 'ruler' ? 7 : 200}\r\n                                    step={toolType === 'ruler' ? 0.1 : 1}\r\n                                    value={userValue}\r\n                                    onChange={(e) => { setUserValue(parseFloat(e.target.value)); setFeedback(null); setShowSuccess(false); }}\r\n                                    className=\"w-full h-1 bg-gray-700 accent-yellow-500 rounded-lg appearance-none cursor-pointer\" />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"bg-black/60 rounded-xl p-3 border border-yellow-500/20 flex flex-col justify-between\">\r\n                            <div className=\"space-y-3\">\r\n                                <div className=\"text-[10px] text-center font-mono text-gray-400 tracking-widest uppercase\">Objectif</div>\r\n\r\n                                {phase === 'mission' ? (\r\n                                    <div className=\"p-3 bg-yellow-900/20 border border-yellow-500/30 rounded-lg text-center animate-pulse\">\r\n                                        <div className=\"text-[10px] text-yellow-200 font-bold\">CIBLE ├Ç ATTEINDRE</div>\r\n                                        <div className=\"text-2xl font-black text-white\">{target} {toolType === 'ruler' ? 'cm' : 'g'}</div>\r\n                                    </div>\r\n                                ) : (\r\n                                    <div className=\"bg-gray-900/80 p-3 rounded-lg border border-white/5 text-[9px] text-gray-400 leading-tight italic\">\r\n                                        Entra├«ne-toi ├á utiliser les diff├®rents instruments de mesure avec pr├®cision.\r\n                                    </div>\r\n                                )}\r\n\r\n                                {feedback === 'bad' && (\r\n                                    <div className=\"p-2 bg-red-900/40 text-red-400 text-[9px] font-bold text-center animate-shake rounded\">\r\n                                        INCORRECT ({toolType === 'ruler' ? '┬▒0.2cm' : '┬▒0.5g'})\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            <button onClick={checkMeasurement} disabled={showSuccess}\r\n                                className={`w-full py-3 rounded-xl font-black text-[10px] tracking-widest transition-all ${showSuccess ? 'bg-gray-800 text-gray-500' : 'bg-yellow-600 text-black shadow-lg shadow-yellow-500/30'}`}>\r\n                                VALIDER LA MESURE\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <group position={[0, -1, 0]}>\r\n                {toolType === 'ruler' ? (\r\n                    <group>\r\n                        <mesh position={[0, 0, -0.1]}>\r\n                            <boxGeometry args={[10, 1, 0.1]} />\r\n                            <meshStandardMaterial color=\"#FFCA28\" />\r\n                        </mesh>\r\n                        {Array.from({ length: 11 }).map((_, i) => (\r\n                            <mesh key={i} position={[i - 5, 0.2, 0]}>\r\n                                <boxGeometry args={[0.05, 0.5, 0.15]} />\r\n                                <meshStandardMaterial color=\"black\" />\r\n                            </mesh>\r\n                        ))}\r\n                        <mesh position={[(target / 2) - 5, -0.2, 0.1]}>\r\n                            <boxGeometry args={[target, 0.5, 0.1]} />\r\n                            <meshStandardMaterial color=\"#66BB6A\" />\r\n                        </mesh>\r\n                        <mesh position={[userValue - 5, 0.5, 0.2]}>\r\n                            <coneGeometry args={[0.2, 0.5, 16]} rotation={[Math.PI, 0, 0]} />\r\n                            <meshStandardMaterial color=\"red\" />\r\n                        </mesh>\r\n                    </group>\r\n                ) : (\r\n                    <group scale={[1.5, 1.5, 1.5]}>\r\n                        <Box args={[2, 0.2, 1.5]} material-color=\"#333\" />\r\n                        <Box args={[1.8, 0.1, 1.3]} position={[0, 0.1, 0]} material-color=\"#111\" />\r\n                        <mesh position={[0, 0.2 + (userValue / 200), 0]} scale={[1, 1, 1]}>\r\n                            <sphereGeometry args={[0.4 + (target / 300)]} />\r\n                            <meshStandardMaterial color=\"#64B5F6\" />\r\n                        </mesh>\r\n                        <Text position={[0, -0.5, 0.8]} fontSize={0.2} color=\"red\">{userValue} g</Text>\r\n                    </group>\r\n                )}\r\n            </group>\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// R├ëFRACTION (IMMERSIVE)\r\n// ============================================================\r\n// ============================================================\r\n// R├ëFRACTION (IMMERSIVE & CHALLENGE)\r\n// ============================================================\r\nexport function RefractionSimulator() {\r\n    const [phase, setPhase] = useState('explore');\r\n    const [angle, setAngle] = useState(45);\r\n    const [material, setMaterial] = useState('water');\r\n    const [targetX, setTargetX] = useState(1.5);\r\n    const [hit, setHit] = useState(false);\r\n\r\n    // Gamification\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n\r\n    const materials = {\r\n        water: { n: 1.33, name: 'Eau', color: '#4FC3F7' },\r\n        glass: { n: 1.5, name: 'Verre', color: '#EEEEEE' },\r\n        diamond: { n: 2.42, name: 'Diamant', color: '#E1F5FE' }\r\n    };\r\n\r\n    const n1 = 1.0; // Air\r\n    const n2 = materials[material].n;\r\n\r\n    const rad = (deg) => deg * Math.PI / 180;\r\n    const angleRad = rad(angle);\r\n    const rRad = Math.asin((n1 / n2) * Math.sin(angleRad));\r\n    const rDeg = rRad * 180 / Math.PI;\r\n\r\n    const hitX = Math.tan(rRad) * 2;\r\n\r\n    const startChallenge = () => {\r\n        setPhase('mission');\r\n        setTargetX((Math.random() * 2 + 0.5) * (Math.random() > 0.5 ? 1 : -1));\r\n        setHit(false);\r\n        setShowSuccess(false);\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission') {\r\n            if (Math.abs(hitX - targetX) < 0.2) {\r\n                if (!hit) {\r\n                    setHit(true);\r\n                    setScore(s => s + 50);\r\n                    setShowSuccess(true);\r\n                }\r\n            } else {\r\n                setHit(false);\r\n            }\r\n        }\r\n    }, [hitX, targetX, phase, hit]);\r\n\r\n    return (\r\n        <>\r\n            <SuccessOverlay show={showSuccess} message=\"Cible touch├®e ! Magnifique pr├®cision !\" points={50} onNext={startChallenge} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒöª Optique de R├®fraction\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[400px] border-red-500/30 text-white\">\r\n                    <div className=\"flex justify-between items-center mb-4\">\r\n                        <GradeBadge score={score} />\r\n                        <div className=\"bg-gray-900 rounded-lg px-3 py-1 border border-white/10 text-[10px] text-gray-400\">\r\n                            OPTIQUE LAB\r\n                        </div>\r\n                    </div>\r\n\r\n                    <XPBar current={score} nextLevel={1000} />\r\n\r\n                    <div className=\"h-[1px] bg-gradient-to-r from-transparent via-red-500/50 to-transparent my-4\" />\r\n\r\n                    <PhaseSelector currentPhase={phase} onSelect={(p) => { setPhase(p); if (p === 'mission') startChallenge(); }} />\r\n\r\n                    {phase === 'mission' && !hit && (\r\n                        <MissionObjective objective=\"Ajuste l'angle d'incidence pour toucher la cible au fond de la cuve.\" icon=\"­ƒÄ»\" />\r\n                    )}\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"bg-gray-900/50 p-2 rounded-xl border border-white/5\">\r\n                                <label className=\"text-[10px] text-gray-400 block mb-2 uppercase tracking-widest text-center\">Milieu de R├®fraction</label>\r\n                                <div className=\"grid grid-cols-1 gap-1\">\r\n                                    {Object.entries(materials).map(([k, m]) => (\r\n                                        <button key={k} onClick={() => setMaterial(k)}\r\n                                            className={`py-1.5 rounded text-[10px] font-bold border transition-all ${material === k ? 'bg-red-600 border-red-400' : 'bg-gray-800 border-gray-700 opacity-50'}`}>\r\n                                            {m.name.toUpperCase()} (n={m.n})\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"bg-gray-900/50 p-3 rounded-xl border border-white/5\">\r\n                                <label className=\"text-[10px] text-gray-500 block mb-2 uppercase tracking-widest text-center\">Angle d'Incidence (i)</label>\r\n                                <div className=\"text-2xl font-black text-red-400 font-mono text-center mb-2\">{Math.abs(angle)}┬░</div>\r\n                                <input type=\"range\" min=\"-80\" max=\"80\" step=\"1\" value={angle} onChange={(e) => setAngle(parseFloat(e.target.value))}\r\n                                    className=\"w-full h-1 bg-gray-700 accent-red-500 rounded-lg appearance-none cursor-pointer\" />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"bg-black/60 rounded-xl p-3 border border-red-500/20 flex flex-col justify-between\">\r\n                            <div className=\"space-y-3\">\r\n                                <div className=\"text-[10px] text-center font-mono text-gray-500 tracking-widest uppercase\">Donn├®es Physiques</div>\r\n\r\n                                <div className=\"bg-gray-900/80 p-3 rounded-lg border border-white/5 space-y-2\">\r\n                                    <div className=\"flex justify-between items-center text-[10px]\">\r\n                                        <span className=\"text-gray-500\">INDICE n1</span>\r\n                                        <span className=\"text-white font-bold\">1.00 (Air)</span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between items-center text-[10px]\">\r\n                                        <span className=\"text-gray-500\">INDICE n2</span>\r\n                                        <span className=\"text-white font-bold\">{n2.toFixed(2)}</span>\r\n                                    </div>\r\n                                    <div className=\"h-[1px] bg-white/5\" />\r\n                                    <div className=\"flex justify-between items-center\">\r\n                                        <span className=\"text-[10px] text-red-400 font-bold\">ANGLE R</span>\r\n                                        <span className=\"text-lg font-black text-white font-mono\">{rDeg.toFixed(1)}┬░</span>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"text-[9px] text-gray-400 italic text-center p-1\">\r\n                                    Loi de Snell-Descartes:<br />\r\n                                    nÔéü ├ù sin(i) = nÔéé ├ù sin(r)\r\n                                </div>\r\n                            </div>\r\n\r\n                            <button onClick={() => setAngle(0)} className=\"w-full py-2 rounded bg-gray-800 text-[10px] font-bold hover:bg-white hover:text-black transition-all\">\r\n                                R├ëALIGNER OPTIQUE\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <group>\r\n\r\n                {/* Laser Source (Updated rotation logic for +/- angles) */}\r\n                <group position={[0, 2, 0]} rotation={[0, 0, -angleRad - Math.PI / 2]}>\r\n                    <mesh position={[0, 0.5, 0]}>\r\n                        <cylinderGeometry args={[0.1, 0.1, 1]} />\r\n                        <meshStandardMaterial color=\"gray\" />\r\n                    </mesh>\r\n                    {/* Rayon Incident */}\r\n                    <mesh position={[0, -2, 0]}>\r\n                        <cylinderGeometry args={[0.02, 0.02, 4]} />\r\n                        <meshBasicMaterial color=\"red\" />\r\n                    </mesh>\r\n                </group>\r\n\r\n                {/* Surface / Milieu 2 */}\r\n                <mesh position={[0, -2, 0]}>\r\n                    <boxGeometry args={[6, 4, 2]} />\r\n                    <meshPhysicalMaterial color={materials[material].color} transmission={0.9} opacity={0.5} transparent roughness={0.1} />\r\n                </mesh>\r\n\r\n                {/* Normale */}\r\n                <mesh position={[0, 0, 0]}>\r\n                    <cylinderGeometry args={[0.01, 0.01, 6]} />\r\n                    <meshBasicMaterial color=\"white\" opacity={0.3} transparent />\r\n                </mesh>\r\n\r\n                {/* Rayon R├®fract├® */}\r\n                <group position={[0, 0, 0]} rotation={[0, 0, -rRad + Math.PI]}>\r\n                    <mesh position={[0, 2, 0]}>\r\n                        <cylinderGeometry args={[0.02, 0.02, 4.5]} /> {/* Lengthened to hit bottom */}\r\n                        <meshBasicMaterial color=\"red\" opacity={0.7} transparent />\r\n                    </mesh>\r\n                </group>\r\n\r\n                {/* Target in Challenge Mode */}\r\n                {phase === 'mission' && (\r\n                    <mesh position={[targetX, -4, 0]}>\r\n                        <cylinderGeometry args={[0.3, 0.3, 0.1]} />\r\n                        <meshStandardMaterial color={hit ? \"#4CAF50\" : \"#F44336\"} emissive={hit ? \"#4CAF50\" : \"black\"} />\r\n                        <mesh position={[0, 0.1, 0]}>\r\n                            <ringGeometry args={[0.1, 0.2, 32]} />\r\n                            <meshBasicMaterial color=\"white\" side={THREE.DoubleSide} rotation={[-Math.PI / 2, 0, 0]} />\r\n                        </mesh>\r\n                    </mesh>\r\n                )}\r\n\r\n                <Text position={[-2, 0.5, 0]} fontSize={0.3} color=\"white\">Air (n=1.0)</Text>\r\n                <Text position={[-2, -1, 0]} fontSize={0.3} color=\"white\">{materials[material].name}</Text>\r\n            </group>\r\n        </>\r\n    );\r\n}\r\n\r\n\r\n// ============================================================\r\n// CIRCUITS S├ëRIE / PARALL├êLE (IMMERSIVE)\r\n// ============================================================\r\nexport function CircuitSeriesParallel() {\r\n    const [phase, setPhase] = useState('explore');\r\n    const [mode, setMode] = useState('series');\r\n    const [bulbs, setBulbs] = useState([true, true]);\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [missionTarget, setMissionTarget] = useState(null);\r\n\r\n    const toggleBulb = (index) => {\r\n        const newBulbs = [...bulbs];\r\n        newBulbs[index] = !newBulbs[index];\r\n        setBulbs(newBulbs);\r\n    };\r\n\r\n    const isLit = (index) => {\r\n        if (!bulbs[index]) return false;\r\n        if (mode === 'series') return bulbs.every(b => b);\r\n        return true;\r\n    };\r\n\r\n    const startMission = () => {\r\n        setPhase('mission');\r\n        const randMode = Math.random() > 0.5 ? 'series' : 'parallel';\r\n        setMode(randMode);\r\n        setBulbs([Math.random() > 0.5, Math.random() > 0.5]);\r\n        setMissionTarget(Math.random() > 0.5 ? 'all_on' : 'all_off');\r\n        setShowSuccess(false);\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission') {\r\n            const allLit = bulbs.every((_, i) => isLit(i));\r\n            const allOff = bulbs.every((_, i) => !isLit(i));\r\n\r\n            if (missionTarget === 'all_on' && allLit) {\r\n                setScore(s => s + 50);\r\n                setShowSuccess(true);\r\n            } else if (missionTarget === 'all_off' && allOff) {\r\n                setScore(s => s + 50);\r\n                setShowSuccess(true);\r\n            }\r\n        }\r\n    }, [bulbs, mode, phase, missionTarget]);\r\n\r\n    return (\r\n        <group>\r\n            <SuccessOverlay show={showSuccess} message=\"Circuit configur├® avec succ├¿s ! Tu es un expert en ├®lectricit├®.\" points={50} onNext={startMission} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"ÔÜí Circuits ├ëlectriques\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[420px] border-yellow-500/30 text-white\">\r\n                    <div className=\"flex justify-between items-center mb-4\">\r\n                        <GradeBadge score={score} />\r\n                        <div className=\"bg-gray-900 rounded-lg px-3 py-1 border border-white/10 text-[10px] text-gray-400\">\r\n                            LAB D'├ëLECTROTECHNIQUE\r\n                        </div>\r\n                    </div>\r\n\r\n                    <XPBar current={score} nextLevel={2000} />\r\n\r\n                    <div className=\"h-[1px] bg-gradient-to-r from-transparent via-yellow-500/50 to-transparent my-4\" />\r\n\r\n                    <PhaseSelector currentPhase={phase} onSelect={(p) => { setPhase(p); if (p === 'mission') startMission(); }} />\r\n\r\n                    {phase === 'mission' && missionTarget && (\r\n                        <MissionObjective\r\n                            objective={missionTarget === 'all_on' ? \"Trouve la configuration pour allumer TOUTES les lampes.\" : \"Configure le circuit pour ├®teindre TOUTES les lampes.\"}\r\n                            icon=\"­ƒÆí\"\r\n                        />\r\n                    )}\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"bg-gray-800/10 p-2 rounded-xl border border-white/5\">\r\n                                <label className=\"text-[10px] text-gray-500 block mb-2 uppercase tracking-widest text-center\">Type de Circuit</label>\r\n                                <div className=\"grid grid-cols-1 gap-1\">\r\n                                    <button onClick={() => setMode('series')}\r\n                                        className={`py-2 rounded text-[10px] font-bold border transition-all ${mode === 'series' ? 'bg-yellow-600 border-yellow-400 text-black' : 'bg-gray-800 border-gray-700 opacity-50'}`}>\r\n                                        S├ëRIE ­ƒöù\r\n                                    </button>\r\n                                    <button onClick={() => setMode('parallel')}\r\n                                        className={`py-2 rounded text-[10px] font-bold border transition-all ${mode === 'parallel' ? 'bg-yellow-600 border-yellow-400 text-black' : 'bg-gray-800 border-gray-700 opacity-50'}`}>\r\n                                        PARALL├êLE ­ƒ¬£\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"bg-black/60 rounded-xl p-3 border border-yellow-500/20 flex flex-col justify-between\">\r\n                            <div className=\"space-y-3\">\r\n                                <div className=\"text-[10px] text-center font-mono text-gray-500 tracking-widest uppercase\">├ëtat du R├®seau</div>\r\n                                <div className=\"space-y-2\">\r\n                                    {[0, 1].map(i => (\r\n                                        <div key={i} className=\"flex items-center justify-between bg-gray-900/50 p-2 rounded border border-white/5\">\r\n                                            <span className=\"text-[9px] text-gray-400\">LAMPE {i + 1}</span>\r\n                                            <div className=\"flex gap-2 items-center\">\r\n                                                <div className={`w-2 h-2 rounded-full ${bulbs[i] ? 'bg-green-500' : 'bg-red-500'}`} />\r\n                                                <div className={`w-3 h-3 rounded-full ${isLit(i) ? 'bg-yellow-400 shadow-[0_0_10px_#facc15]' : 'bg-gray-800'}`} />\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                            <button onClick={() => setBulbs([true, true])} className=\"w-full py-2 bg-gray-800 text-[9px] font-bold hover:bg-white hover:text-black transition-all rounded-lg uppercase\">\r\n                                R├ëTABLIR TOUT\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <group>\r\n                <mesh position={[-3, 0, 0]}>\r\n                    <boxGeometry args={[1, 1.5, 1]} />\r\n                    <meshStandardMaterial color=\"#333\" />\r\n                    <Text position={[0, 0, 0.6]} fontSize={0.5} color=\"white\">ÔÜí</Text>\r\n                </mesh>\r\n\r\n                {mode === 'series' ? (\r\n                    <group>\r\n                        <mesh position={[0, 1.5, 0]} rotation={[0, 0, Math.PI / 2]}><cylinderGeometry args={[0.05, 0.05, 6]} /><meshStandardMaterial color=\"orange\" /></mesh>\r\n                        <mesh position={[0, -1.5, 0]} rotation={[0, 0, Math.PI / 2]}><cylinderGeometry args={[0.05, 0.05, 6]} /><meshStandardMaterial color=\"orange\" /></mesh>\r\n                        <mesh position={[3, 0, 0]}><cylinderGeometry args={[0.05, 0.05, 3]} /><meshStandardMaterial color=\"orange\" /></mesh>\r\n                        <InteractiveBulb position={[-1, 1.5, 0]} lit={isLit(0)} working={bulbs[0]} onClick={() => toggleBulb(0)} />\r\n                        <InteractiveBulb position={[1, 1.5, 0]} lit={isLit(1)} working={bulbs[1]} onClick={() => toggleBulb(1)} />\r\n                    </group>\r\n                ) : (\r\n                    <group>\r\n                        <mesh position={[-1, 2, 0]} rotation={[0, 0, Math.PI / 2]}><cylinderGeometry args={[0.05, 0.05, 4]} /><meshStandardMaterial color=\"orange\" /></mesh>\r\n                        <mesh position={[-1, -2, 0]} rotation={[0, 0, Math.PI / 2]}><cylinderGeometry args={[0.05, 0.05, 4]} /><meshStandardMaterial color=\"orange\" /></mesh>\r\n                        <group position={[1, 0, 0]}>\r\n                            <mesh position={[0, 0, 0]}><cylinderGeometry args={[0.05, 0.05, 4]} /><meshStandardMaterial color=\"orange\" /></mesh>\r\n                            <InteractiveBulb position={[0, 0, 0]} lit={isLit(0)} working={bulbs[0]} onClick={() => toggleBulb(0)} />\r\n                        </group>\r\n                        <group position={[3, 0, 0]}>\r\n                            <mesh position={[0, 0, 0]}><cylinderGeometry args={[0.05, 0.05, 4]} /><meshStandardMaterial color=\"orange\" /></mesh>\r\n                            <InteractiveBulb position={[0, 0, 0]} lit={isLit(1)} working={bulbs[1]} onClick={() => toggleBulb(1)} />\r\n                        </group>\r\n                    </group>\r\n                )}\r\n            </group>\r\n        </group>\r\n    );\r\n}\r\n\r\nfunction InteractiveBulb({ position, lit, working, onClick }) {\r\n    const [hovered, setHover] = useState(false);\r\n    return (\r\n        <group position={position} onClick={onClick} onPointerOver={() => setHover(true)} onPointerOut={() => setHover(false)}>\r\n            <mesh position={[0, 0.5, 0]}>\r\n                <sphereGeometry args={[0.4, 32, 32]} />\r\n                <meshStandardMaterial\r\n                    color={lit ? \"#FFEB3B\" : (working ? \"#FFFFFF\" : \"#424242\")}\r\n                    emissive={lit ? \"#FFEB3B\" : \"#000000\"}\r\n                    emissiveIntensity={lit ? 2 : 0}\r\n                    transparent opacity={working ? 0.9 : 0.4}\r\n                />\r\n            </mesh>\r\n            <mesh position={[0, 0, 0]}>\r\n                <cylinderGeometry args={[0.2, 0.2, 0.5]} />\r\n                <meshStandardMaterial color=\"#9E9E9E\" />\r\n            </mesh>\r\n            {/* Socket */}\r\n            <mesh position={[0, -0.3, 0]}>\r\n                <cylinderGeometry args={[0.15, 0.15, 0.3]} />\r\n                <meshStandardMaterial color=\"#BDBDBD\" />\r\n            </mesh>\r\n            {hovered && <Text position={[0, 1.2, 0]} fontSize={0.2} color=\"white\">{working ? \"D├®visser\" : \"Revisser\"}</Text>}\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// PROPAGATION LUMI├êRE (IMMERSIVE - ALIGNEMENT)\r\n// ============================================================\r\nexport function LightPropagationPC4() {\r\n    const [phase, setPhase] = useState('explore');\r\n    const [screens, setScreens] = useState([0, 0, 0.5]);\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n\r\n    const moveScreen = (i, dir) => {\r\n        setScreens(prev => {\r\n            const next = [...prev];\r\n            next[i] = Math.max(-1, Math.min(1, next[i] + dir * 0.1));\r\n            return next;\r\n        });\r\n    };\r\n\r\n    const aligned = screens.every(y => Math.abs(y) < 0.1);\r\n\r\n    useEffect(() => {\r\n        if (aligned && !showSuccess && phase === 'mission') {\r\n            setScore(s => s + 50);\r\n            setShowSuccess(true);\r\n        }\r\n    }, [aligned, showSuccess, phase]);\r\n\r\n    const startMission = () => {\r\n        setPhase('mission');\r\n        setScreens([\r\n            (Math.random() - 0.5) * 1.5,\r\n            (Math.random() - 0.5) * 1.5,\r\n            (Math.random() - 0.5) * 1.5\r\n        ]);\r\n        setShowSuccess(false);\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <SuccessOverlay show={showSuccess} message=\"Faisceau align├® ! La lumi├¿re voyage bien en ligne droite.\" points={50} onNext={startMission} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒöª Propagation Rectiligne\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[400px] border-white/30 text-white\">\r\n                    <div className=\"flex justify-between items-center mb-4\">\r\n                        <GradeBadge score={score} />\r\n                        <div className=\"bg-gray-900 rounded-lg px-3 py-1 border border-white/10 text-[10px] text-gray-400\">\r\n                            OPTIQUE G├ëOM├ëTRIQUE\r\n                        </div>\r\n                    </div>\r\n\r\n                    <XPBar current={score} nextLevel={1000} />\r\n\r\n                    <div className=\"h-[1px] bg-gradient-to-r from-transparent via-white/50 to-transparent my-4\" />\r\n\r\n                    <PhaseSelector currentPhase={phase} onSelect={(p) => { setPhase(p); if (p === 'mission') startMission(); }} />\r\n\r\n                    {phase === 'mission' && !aligned && (\r\n                        <MissionObjective objective=\"Aligne tous les ├®crans pour que le laser traverse les ouvertures.\" icon=\"­ƒöª\" />\r\n                    )}\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"bg-gray-800/50 p-3 rounded-xl border border-white/5\">\r\n                                <label className=\"text-[10px] text-gray-500 block mb-3 uppercase tracking-widest text-center\">Contr├┤le des ├ëcrans</label>\r\n                                <div className=\"grid grid-cols-3 gap-2\">\r\n                                    {[0, 1, 2].map(i => (\r\n                                        <div key={i} className=\"flex flex-col items-center gap-1\">\r\n                                            <button onClick={() => moveScreen(i, 1)} className=\"w-full py-1 bg-gray-700 hover:bg-gray-600 rounded text-[10px]\">Ôû▓</button>\r\n                                            <div className=\"text-[9px] font-bold text-gray-400\">E{i + 1}</div>\r\n                                            <button onClick={() => moveScreen(i, -1)} className=\"w-full py-1 bg-gray-700 hover:bg-gray-600 rounded text-[10px]\">Ôû╝</button>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"bg-black/60 rounded-xl p-3 border border-white/20 flex flex-col justify-between\">\r\n                            <div className=\"space-y-3\">\r\n                                <div className=\"text-[10px] text-center font-mono text-gray-500 tracking-widest uppercase\">Statut Optique</div>\r\n\r\n                                <div className=\"space-y-1.5\">\r\n                                    {[0, 1, 2].map(i => (\r\n                                        <div key={i} className=\"flex items-center justify-between bg-gray-900/50 p-1.5 rounded border border-white/5\">\r\n                                            <span className=\"text-[9px] text-gray-500 uppercase\">├ëcran {i + 1}</span>\r\n                                            <div className={`w-2 h-2 rounded-full ${Math.abs(screens[i]) < 0.1 ? 'bg-green-500 shadow-[0_0_5px_rgba(34,197,94,0.5)]' : 'bg-red-500'}`} />\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n\r\n                                <div className=\"text-[9px] text-center text-gray-500 leading-tight\">\r\n                                    {aligned ? \"ALIGNEMENT PARFAIT Ô£à\" : \"D├ëCALAGE D├ëTECT├ë ÔØî\"}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <button onClick={startMission} className=\"w-full py-2 rounded bg-gray-800 text-[10px] font-bold hover:bg-white hover:text-black transition-all\">\r\n                                R├ëINITIALISER\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <group>\r\n\r\n                {/* Laser */}\r\n                <mesh position={[-4, 0, 0]} rotation={[0, 0, -Math.PI / 2]}>\r\n                    <cylinderGeometry args={[0.2, 0.2, 1]} />\r\n                    <meshStandardMaterial color=\"#333\" />\r\n                </mesh>\r\n\r\n                {/* Beam Segment 1 (Always on) */}\r\n                <mesh position={[-2, 0, 0]} rotation={[0, 0, -Math.PI / 2]}>\r\n                    <cylinderGeometry args={[0.05, 0.05, 3]} />\r\n                    <meshBasicMaterial color=\"red\" />\r\n                </mesh>\r\n\r\n                {/* Beam Segment 2 (If Screen 1 Aligned) */}\r\n                {Math.abs(screens[0]) < 0.1 && (\r\n                    <mesh position={[0, 0, 0]} rotation={[0, 0, -Math.PI / 2]}>\r\n                        <cylinderGeometry args={[0.05, 0.05, 1]} />\r\n                        <meshBasicMaterial color=\"red\" />\r\n                    </mesh>\r\n                )}\r\n                {/* Beam Segment 3 (If Screen 1&2 Aligned) */}\r\n                {Math.abs(screens[0]) < 0.1 && Math.abs(screens[1]) < 0.1 && (\r\n                    <mesh position={[1.5, 0, 0]} rotation={[0, 0, -Math.PI / 2]}>\r\n                        <cylinderGeometry args={[0.05, 0.05, 2]} />\r\n                        <meshBasicMaterial color=\"red\" />\r\n                    </mesh>\r\n                )}\r\n                {/* Beam Segment 4 (If All Aligned - Hit Target) */}\r\n                {aligned && (\r\n                    <mesh position={[3.5, 0, 0]} rotation={[0, 0, -Math.PI / 2]}>\r\n                        <cylinderGeometry args={[0.05, 0.05, 2]} />\r\n                        <meshBasicMaterial color=\"red\" />\r\n                    </mesh>\r\n                )}\r\n\r\n                {/* Screens */}\r\n                {[0, 1, 2].map(i => (\r\n                    <group key={i} position={[-0.5 + i * 1.5, screens[i], 0]}>\r\n                        {/* Board with hole */}\r\n                        <mesh position={[0, 0.75, 0]}>\r\n                            <boxGeometry args={[0.1, 1.4, 1.4]} />\r\n                            <meshStandardMaterial color=\"#546E7A\" />\r\n                        </mesh>\r\n                        <mesh position={[0, -0.75, 0]}>\r\n                            <boxGeometry args={[0.1, 1.4, 1.4]} />\r\n                            <meshStandardMaterial color=\"#546E7A\" />\r\n                        </mesh>\r\n                    </group>\r\n                ))}\r\n\r\n                {/* Target */}\r\n                <mesh position={[4.5, 0, 0]} rotation={[0, -Math.PI / 2, 0]}>\r\n                    <circleGeometry args={[1, 32]} />\r\n                    <meshStandardMaterial color={aligned ? \"#4CAF50\" : \"#263238\"} emissive={aligned ? \"#4CAF50\" : \"black\"} />\r\n                    <mesh position={[0, 0, 0.1]}>\r\n                        <ringGeometry args={[0.2, 0.3, 32]} />\r\n                        <meshBasicMaterial color=\"white\" />\r\n                    </mesh>\r\n                    <mesh position={[0, 0, 0.1]}>\r\n                        <ringGeometry args={[0.5, 0.6, 32]} />\r\n                        <meshBasicMaterial color=\"white\" />\r\n                    </mesh>\r\n                </mesh>\r\n            </group>\r\n        </>\r\n    );\r\n}\r\n\r\n\r\n\r\n// ============================================================\r\n// OMBRES ET P├ëNOMBRE (IMMERSIVE)\r\n// ============================================================\r\nexport function ShadowsSimulator() {\r\n    const [phase, setPhase] = useState('explore');\r\n    const [sourceType, setSourceType] = useState('point');\r\n    const [objZ, setObjZ] = useState(-2);\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [targetRadius, setTargetRadius] = useState(1.5);\r\n\r\n    // Geometry Constants\r\n    const sourceZ = -4;\r\n    const screenZ = 2;\r\n    const objRadius = 0.5;\r\n\r\n    // Thales calculations\r\n    const d1 = Math.abs(objZ - sourceZ);\r\n    const dTotal = Math.abs(screenZ - sourceZ);\r\n    const d2 = Math.abs(screenZ - objZ);\r\n\r\n    const k = dTotal / d1;\r\n    const shadowRadius = objRadius * k;\r\n\r\n    const sourceRadius = sourceType === 'point' ? 0.05 : 0.8;\r\n    const penumbraRadius = shadowRadius + (sourceType === 'extended' ? (d2 * 0.5) : 0);\r\n    const umbraRadius = sourceType === 'extended' ? Math.max(0, shadowRadius - (d2 * 0.3)) : shadowRadius;\r\n\r\n    const startMission = () => {\r\n        setPhase('mission');\r\n        setTargetRadius(parseFloat((Math.random() * 2 + 1).toFixed(1)));\r\n        setShowSuccess(false);\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission') {\r\n            const currentSize = sourceType === 'point' ? shadowRadius : umbraRadius;\r\n            if (Math.abs(currentSize - targetRadius) < 0.1) {\r\n                if (!showSuccess) {\r\n                    setScore(s => s + 50);\r\n                    setShowSuccess(true);\r\n                }\r\n            }\r\n        }\r\n    }, [objZ, sourceType, phase, targetRadius]);\r\n\r\n    return (\r\n        <group>\r\n            <SuccessOverlay show={showSuccess} message={`Taille cible atteinte ! L'ombre mesure exactement ${targetRadius} unit├®s.`} points={50} onNext={startMission} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒîæ Ombres et P├®nombre\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[400px] border-gray-500/30 text-white\">\r\n                    <div className=\"flex justify-between items-center mb-4\">\r\n                        <GradeBadge score={score} />\r\n                        <div className=\"bg-gray-900 rounded-lg px-3 py-1 border border-white/10 text-[10px] text-gray-400\">\r\n                            STATION D'OPTIQUE GEOM.\r\n                        </div>\r\n                    </div>\r\n\r\n                    <XPBar current={score} nextLevel={1000} />\r\n\r\n                    <div className=\"h-[1px] bg-gradient-to-r from-transparent via-gray-500/50 to-transparent my-4\" />\r\n\r\n                    <PhaseSelector currentPhase={phase} onSelect={(p) => { setPhase(p); if (p === 'mission') startMission(); }} />\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                        <div className=\"space-y-4\">\r\n                            {phase === 'mission' && (\r\n                                <MissionObjective objective={`Ajuste la position pour que l'ombre port├®e (zone d'ombre) mesure ${targetRadius} unit├®s.`} icon=\"­ƒÄ»\" />\r\n                            )}\r\n\r\n                            <div className=\"bg-gray-800/10 p-2 rounded-xl border border-white/5\">\r\n                                <label className=\"text-[10px] text-gray-400 block mb-2 uppercase tracking-widest text-center\">Type de Source</label>\r\n                                <div className=\"grid grid-cols-1 gap-1\">\r\n                                    <button onClick={() => setSourceType('point')}\r\n                                        className={`py-1.5 rounded text-[10px] font-bold border transition-all ${sourceType === 'point' ? 'bg-yellow-600 border-yellow-400 text-black' : 'bg-gray-800 border-gray-700 opacity-50'}`}>\r\n                                        PONCTUELLE ÔÜ¬\r\n                                    </button>\r\n                                    <button onClick={() => setSourceType('extended')}\r\n                                        className={`py-1.5 rounded text-[10px] font-bold border transition-all ${sourceType === 'extended' ? 'bg-orange-600 border-orange-400 text-black' : 'bg-gray-800 border-gray-700 opacity-50'}`}>\r\n                                        ├ëTENDUE ÔÿÇ´©Å\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"bg-gray-900/50 p-3 rounded-xl border border-white/5\">\r\n                                <label className=\"text-[10px] text-gray-500 block mb-2 uppercase tracking-widest text-center\">Distance Objet-Source</label>\r\n                                <input type=\"range\" min=\"-3\" max=\"0\" step=\"0.1\" value={objZ} onChange={(e) => setObjZ(parseFloat(e.target.value))}\r\n                                    className=\"w-full h-1 bg-gray-700 accent-white rounded-lg appearance-none cursor-pointer\" />\r\n                                <div className=\"flex justify-between text-[8px] text-gray-500 mt-1 uppercase tracking-tighter\">\r\n                                    <span>Pr├¿s Source</span>\r\n                                    <span>Pr├¿s ├ëcran</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"bg-black/60 rounded-xl p-3 border border-gray-500/20 flex flex-col justify-between\">\r\n                            <div className=\"space-y-3\">\r\n                                <div className=\"text-[10px] text-center font-mono text-gray-500 tracking-widest uppercase\">Mesures ├ëcran</div>\r\n                                <div className=\"bg-gray-900/80 p-3 rounded-lg border border-white/5 space-y-2 text-center\">\r\n                                    <div className=\"text-[9px] text-gray-500 uppercase\">Ombre Port├®e (R)</div>\r\n                                    <div className=\"text-2xl font-black text-white font-mono\">{umbraRadius.toFixed(2)}</div>\r\n                                    {sourceType === 'extended' && (\r\n                                        <div className=\"mt-2\">\r\n                                            <div className=\"text-[8px] text-gray-600 uppercase\">P├®nombre (R)</div>\r\n                                            <div className=\"text-sm font-bold text-gray-400\">{penumbraRadius.toFixed(2)}</div>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                            <button onClick={() => { setObjZ(-2); setSourceType('point'); setPhase('explore'); }} className=\"w-full py-2 bg-gray-800 text-[10px] font-bold hover:bg-white hover:text-black transition-all rounded-lg uppercase\">\r\n                                R├®initialiser\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <group position={[0, 0, (screenZ + sourceZ) / 2]}>\r\n                <mesh>\r\n                    <cylinderGeometry args={[0.01, umbraRadius, screenZ - sourceZ]} />\r\n                    <meshBasicMaterial color=\"yellow\" transparent opacity={0.05} />\r\n                </mesh>\r\n            </group>\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// SOURCES DE LUMI├êRE (IMMERSIVE)\r\n// ============================================================\r\nexport function LightSources() {\r\n    const [sunOn, setSunOn] = useState(true);\r\n    const [lampOn, setLampOn] = useState(false);\r\n    const [info, setInfo] = useState(null);\r\n    const [score, setScore] = useState(0);\r\n    const [discovered, setDiscovered] = useState(new Set());\r\n\r\n    const objects = [\r\n        { id: 'sun', type: 'primary', name: 'Soleil', pos: [-3, 2, -2], color: '#FDB813', scale: 1 },\r\n        { id: 'lamp', type: 'primary', name: 'Lampe', pos: [3, 0, 0], color: '#FFFFFF', scale: 0.5 },\r\n        { id: 'moon', type: 'secondary', name: 'Lune', pos: [-2, 2, 2], color: '#CFD8DC', scale: 0.8 },\r\n        { id: 'mirror', type: 'secondary', name: 'Miroir', pos: [0, -1, 1], color: '#B0BEC5', scale: 1 }\r\n    ];\r\n\r\n    const handleObjectClick = (obj) => {\r\n        if (obj.id === 'sun') setSunOn(!sunOn);\r\n        if (obj.id === 'lamp') setLampOn(!lampOn);\r\n        setInfo(obj);\r\n\r\n        if (!discovered.has(obj.id)) {\r\n            const newDiscovered = new Set(discovered);\r\n            newDiscovered.add(obj.id);\r\n            setDiscovered(newDiscovered);\r\n            setScore(s => s + 25);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"ÔÿÇ´©Å Sources de Lumi├¿re\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[400px] border-yellow-500/30 text-white\">\r\n                    <div className=\"flex justify-between items-center mb-4\">\r\n                        <GradeBadge score={score} />\r\n                        <div className=\"bg-gray-900 rounded-lg px-3 py-1 border border-white/10 text-[10px] text-gray-400\">\r\n                            TYPES DE SOURCES\r\n                        </div>\r\n                    </div>\r\n\r\n                    <XPBar current={score} nextLevel={100} />\r\n\r\n                    <div className=\"h-[1px] bg-gradient-to-r from-transparent via-yellow-500/50 to-transparent my-4\" />\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"bg-gray-800/50 p-3 rounded-xl border border-white/5 space-y-3\">\r\n                                <label className=\"text-[10px] text-gray-500 block uppercase tracking-widest text-center\">├ëtat des Sources</label>\r\n                                <div className=\"grid grid-cols-2 gap-2\">\r\n                                    <div className={`p-2 rounded border transition-all text-center ${sunOn ? 'bg-yellow-600/20 border-yellow-500' : 'bg-gray-900/50 border-white/5 opacity-50'}`}>\r\n                                        <div className=\"text-[10px] font-bold text-yellow-400\">SOLEIL</div>\r\n                                        <div className=\"text-[8px] text-gray-500 uppercase\">{sunOn ? 'Actif' : '├ëteint'}</div>\r\n                                    </div>\r\n                                    <div className={`p-2 rounded border transition-all text-center ${lampOn ? 'bg-white/10 border-white' : 'bg-gray-900/50 border-white/5 opacity-50'}`}>\r\n                                        <div className=\"text-[10px] font-bold text-white\">LAMPE</div>\r\n                                        <div className=\"text-[8px] text-gray-500 uppercase\">{lampOn ? 'Actif' : '├ëteint'}</div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"bg-gray-900/80 p-3 rounded-lg border border-white/5 text-[10px] text-gray-400 leading-tight\">\r\n                                <span className=\"text-yellow-500 font-bold italic\">Info :</span> Cliquez sur les objets en 3D pour d├®couvrir s'ils sont des sources primaires ou secondaires.\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"bg-black/60 rounded-xl p-3 border border-yellow-500/20 flex flex-col justify-between min-h-[160px]\">\r\n                            {info ? (\r\n                                <div className=\"space-y-3 animate-in fade-in zoom-in duration-300\">\r\n                                    <div className=\"text-[10px] text-center font-mono text-gray-500 tracking-widest uppercase\">├ël├®ment D├®couvert</div>\r\n                                    <div className=\"bg-gray-900/80 p-3 rounded-lg border border-yellow-500/30\">\r\n                                        <div className=\"text-[12px] font-black text-white mb-1 uppercase tracking-wider\">{info.name}</div>\r\n                                        <div className={`text-[9px] font-bold px-2 py-0.5 rounded inline-block mb-2 ${info.type === 'primary' ? 'bg-yellow-600/20 text-yellow-500' : 'bg-blue-600/20 text-blue-400'}`}>\r\n                                            {info.type === 'primary' ? 'SOURCE PRIMAIRE ­ƒîƒ' : 'SOURCE SECONDAIRE ­ƒîÖ'}\r\n                                        </div>\r\n                                        <p className=\"text-[9px] text-gray-400 leading-tight\">\r\n                                            {info.type === 'primary'\r\n                                                ? \"Cet objet produit sa propre lumi├¿re !\"\r\n                                                : \"Cet objet ne produit pas de lumi├¿re, il ne fait que diffuser la lumi├¿re qu'il re├ºoit.\"}\r\n                                        </p>\r\n                                    </div>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"flex flex-col items-center justify-center h-full text-center space-y-2 opacity-40\">\r\n                                    <div className=\"text-2xl\">­ƒöì</div>\r\n                                    <div className=\"text-[9px] text-gray-500 uppercase tracking-widest\">En attente de d├®couverte</div>\r\n                                </div>\r\n                            )}\r\n\r\n                            <div className=\"mt-4 flex justify-between items-center text-[9px] text-gray-500 border-t border-white/5 pt-2\">\r\n                                <span>OBJETS : {discovered.size} / 4</span>\r\n                                <div className=\"flex gap-1\">\r\n                                    {[0, 1, 2, 3].map(i => (\r\n                                        <div key={i} className={`w-1.5 h-1.5 rounded-full ${i < discovered.size ? 'bg-yellow-500' : 'bg-gray-800'}`} />\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            {/* Ambient Light (low) */}\r\n            <ambientLight intensity={0.1} />\r\n\r\n            {/* Sun Light source */}\r\n            {sunOn && <pointLight position={[-3, 2, -2]} intensity={2} color=\"#FDB813\" distance={10} />}\r\n\r\n            {/* Lamp Light source */}\r\n            {lampOn && <pointLight position={[3, 0.5, 0]} intensity={1.5} color=\"#FFFFFF\" distance={5} />}\r\n\r\n            {/* Objects */}\r\n            {objects.map(obj => {\r\n                let isLit = false;\r\n                if (obj.type === 'primary') {\r\n                    if (obj.id === 'sun') isLit = sunOn;\r\n                    if (obj.id === 'lamp') isLit = lampOn;\r\n                } else {\r\n                    // Secondary objects need a primary source ON\r\n                    isLit = sunOn || lampOn; // Simplified logic\r\n                }\r\n\r\n                return (\r\n                    <group key={obj.id} position={obj.pos} onClick={() => handleObjectClick(obj)}\r\n                        onPointerOver={(e) => document.body.style.cursor = 'pointer'}\r\n                        onPointerOut={(e) => document.body.style.cursor = 'auto'}>\r\n\r\n                        {/* Sun Visual */}\r\n                        {obj.id === 'sun' && (\r\n                            <mesh scale={obj.scale}>\r\n                                <sphereGeometry args={[1, 32, 32]} />\r\n                                <meshStandardMaterial color={obj.color} emissive={obj.color} emissiveIntensity={sunOn ? 2 : 0.1} />\r\n                            </mesh>\r\n                        )}\r\n\r\n                        {/* Moon Visual */}\r\n                        {obj.id === 'moon' && (\r\n                            <mesh scale={obj.scale}>\r\n                                <sphereGeometry args={[1, 32, 32]} />\r\n                                <meshStandardMaterial color={obj.color} roughness={0.8} />\r\n                            </mesh>\r\n                        )}\r\n\r\n                        {/* Lamp Visual */}\r\n                        {obj.id === 'lamp' && (\r\n                            <group scale={obj.scale}>\r\n                                <mesh position={[0, 0, 0]}>\r\n                                    <cylinderGeometry args={[0.5, 0.8, 1]} />\r\n                                    <meshStandardMaterial color=\"white\" emissive=\"white\" emissiveIntensity={lampOn ? 1 : 0} transparent opacity={0.8} />\r\n                                </mesh>\r\n                                <mesh position={[0, -0.6, 0]}>\r\n                                    <cylinderGeometry args={[0.1, 0.5, 0.2]} />\r\n                                    <meshStandardMaterial color=\"black\" />\r\n                                </mesh>\r\n                            </group>\r\n                        )}\r\n\r\n                        {/* Mirror Visual */}\r\n                        {obj.id === 'mirror' && (\r\n                            <mesh scale={obj.scale} rotation={[-Math.PI / 4, 0, 0]}>\r\n                                <boxGeometry args={[2, 2, 0.1]} />\r\n                                <meshStandardMaterial color=\"#E0E0E0\" metalness={1} roughness={0} />\r\n                            </mesh>\r\n                        )}\r\n                    </group>\r\n                );\r\n            })}\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// INTRODUCTION ├ëLECTRICIT├ë (IMMERSIVE)\r\n// ============================================================\r\n\r\n// ============================================================\r\n// INTRODUCTION ├ëLECTRICIT├ë (IMMERSIVE & S├ëCURIT├ë)\r\n// ============================================================\r\nexport function IntroElectricity() {\r\n    const [phase, setPhase] = useState('explore');\r\n    const [switchClosed, setSwitchClosed] = useState(false);\r\n    const [shortCircuit, setShortCircuit] = useState(false);\r\n    const [fuseBlown, setFuseBlown] = useState(false);\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [missionFault, setMissionFault] = useState(null); // 'fuse', 'short'\r\n    const [repaired, setRepaired] = useState(false);\r\n\r\n    // Electrons animation reference\r\n    const electronsRef = useRef([]);\r\n\r\n    useFrame((state) => {\r\n        if (switchClosed && !fuseBlown && !shortCircuit) {\r\n            // Normal flow\r\n        }\r\n    });\r\n\r\n    const startMission = () => {\r\n        setPhase('mission');\r\n        const faults = ['fuse', 'short'];\r\n        const fault = faults[Math.floor(Math.random() * faults.length)];\r\n        setMissionFault(fault);\r\n\r\n        if (fault === 'fuse') {\r\n            setFuseBlown(true);\r\n            setShortCircuit(false);\r\n        } else {\r\n            setShortCircuit(true);\r\n            setFuseBlown(false);\r\n        }\r\n\r\n        setSwitchClosed(false);\r\n        setRepaired(false);\r\n        setShowSuccess(false);\r\n    };\r\n\r\n    const toggleShortCircuit = () => {\r\n        if (fuseBlown) return;\r\n        if (!shortCircuit) {\r\n            setShortCircuit(true);\r\n            setSwitchClosed(true);\r\n            setTimeout(() => {\r\n                setFuseBlown(true);\r\n                setSwitchClosed(false);\r\n            }, 1500);\r\n        } else {\r\n            setShortCircuit(false);\r\n        }\r\n    };\r\n\r\n    const handleRepair = (type) => {\r\n        if (phase === 'mission') {\r\n            if (type === missionFault) {\r\n                if (type === 'fuse') setFuseBlown(false);\r\n                if (type === 'short') setShortCircuit(false);\r\n                setRepaired(true);\r\n                setScore(s => s + 50);\r\n                setShowSuccess(true);\r\n            }\r\n        } else {\r\n            if (type === 'fuse') replaceFuse();\r\n        }\r\n    };\r\n\r\n    const replaceFuse = () => {\r\n        setFuseBlown(false);\r\n        setShortCircuit(false);\r\n        setSwitchClosed(false);\r\n        setScore(s => s + 10);\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            <SuccessOverlay show={showSuccess} message=\"Circuit r├®par├® ! Tu as identifi├® et corrig├® la panne.\" points={50} onNext={startMission} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒöî Circuit et S├®curit├®\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[400px] border-blue-500/30 text-white\">\r\n                    <div className=\"flex justify-between items-center mb-4\">\r\n                        <GradeBadge score={score} />\r\n                        <div className=\"bg-gray-900 rounded-lg px-3 py-1 border border-white/10 text-[10px] text-gray-400\">\r\n                            D├ëPANNAGE ├ëLECTRIQUE\r\n                        </div>\r\n                    </div>\r\n\r\n                    <XPBar current={score} nextLevel={1000} />\r\n\r\n                    <div className=\"h-[1px] bg-gradient-to-r from-transparent via-blue-500/50 to-transparent my-4\" />\r\n\r\n                    <PhaseSelector currentPhase={phase} onSelect={(p) => { setPhase(p); if (p === 'mission') startMission(); else { setFuseBlown(false); setShortCircuit(false); } }} />\r\n\r\n                    {phase === 'mission' && !repaired && (\r\n                        <MissionObjective objective=\"Le circuit ne fonctionne plus. Trouve la panne et r├®pare-la !\" icon=\"­ƒøá´©Å\" />\r\n                    )}\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"bg-gray-800/50 p-3 rounded-xl border border-white/5 space-y-3\">\r\n                                <label className=\"text-[10px] text-gray-400 block uppercase tracking-widest text-center\">Contr├┤le</label>\r\n                                <button onClick={() => !fuseBlown && setSwitchClosed(!switchClosed)} disabled={fuseBlown || shortCircuit}\r\n                                    className={`w-full py-4 rounded-xl font-black text-[12px] transition-all shadow-lg ${fuseBlown ? 'bg-gray-800 text-gray-600' : (switchClosed ? 'bg-green-600 text-white shadow-green-500/20' : 'bg-blue-600 text-white shadow-blue-500/20')}`}>\r\n                                    {switchClosed ? \"COUPER LE COURANT\" : \"METTRE SOUS TENSION\"}\r\n                                </button>\r\n                            </div>\r\n\r\n                            <div className=\"flex flex-col gap-2\">\r\n                                {phase === 'explore' ? (\r\n                                    <button onClick={toggleShortCircuit} disabled={fuseBlown || shortCircuit}\r\n                                        className=\"w-full py-2 bg-red-900/40 hover:bg-red-900/60 border border-red-500/30 rounded text-[9px] font-bold text-red-200 uppercase\">\r\n                                        Simuler Court-Circuit ÔÜá´©Å\r\n                                    </button>\r\n                                ) : (\r\n                                    <div className=\"grid grid-cols-2 gap-2\">\r\n                                        <button onClick={() => handleRepair('fuse')} className=\"p-2 bg-gray-800 hover:bg-gray-700 border border-white/10 rounded text-[8px] font-bold\">­ƒøá´©Å CHANGER FUSIBLE</button>\r\n                                        <button onClick={() => handleRepair('short')} className=\"p-2 bg-gray-800 hover:bg-gray-700 border border-white/10 rounded text-[8px] font-bold\">Ô£é´©Å ISOLER C├éBLES</button>\r\n                                    </div>\r\n                                )}\r\n\r\n                                {fuseBlown && phase === 'explore' && (\r\n                                    <button onClick={replaceFuse}\r\n                                        className=\"w-full py-2 bg-green-600 hover:bg-green-500 border border-green-400/50 rounded text-[9px] font-bold text-white uppercase animate-pulse\">\r\n                                        Remplacer Fusible ­ƒøá´©Å\r\n                                    </button>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"bg-black/60 rounded-xl p-3 border border-blue-500/20 flex flex-col justify-between\">\r\n                            <div className=\"space-y-3\">\r\n                                <div className=\"text-[10px] text-center font-mono text-gray-500 tracking-widest uppercase\">Indicateurs</div>\r\n\r\n                                <div className=\"bg-gray-900/80 p-3 rounded-lg border border-white/5 space-y-2\">\r\n                                    <div className=\"flex justify-between items-center text-[10px]\">\r\n                                        <span className=\"text-gray-500 uppercase\">COURANT</span>\r\n                                        <span className={`font-bold ${switchClosed && !fuseBlown && !shortCircuit ? 'text-green-400' : 'text-red-400'}`}>\r\n                                            {switchClosed && !fuseBlown && !shortCircuit ? 'FLUX OK' : 'STOP'}\r\n                                        </span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between items-center text-[10px]\">\r\n                                        <span className=\"text-gray-500 uppercase\">S├ëCURIT├ë</span>\r\n                                        <span className={`font-bold ${fuseBlown ? 'text-red-400' : 'text-blue-400'}`}>\r\n                                            {fuseBlown ? 'D├ëFAUT' : 'OK'}\r\n                                        </span>\r\n                                    </div>\r\n                                    <div className=\"h-[1px] bg-white/5\" />\r\n                                    <p className=\"text-[9px] text-gray-500 leading-tight italic\">\r\n                                        {fuseBlown\r\n                                            ? \"Fusible grill├® ! L'installation est prot├®g├®e.\"\r\n                                            : (shortCircuit ? \"DANGER ! Court-circuit d├®tect├® !\" : \"Tout est normal. Observe le trajet de l'├®lectricit├®.\")}\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <button onClick={() => { setSwitchClosed(false); setShortCircuit(false); setFuseBlown(false); setPhase('explore'); }} className=\"w-full py-2 rounded bg-gray-800 text-[10px] font-bold hover:bg-white hover:text-black transition-all\">\r\n                                RESET\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <group position={[0, -1, 0]}>\r\n                {/* Battery */}\r\n                <group position={[-2, 0, 0]}>\r\n                    <Box args={[1, 1.5, 1]} material-color={shortCircuit && !fuseBlown ? \"#ff3333\" : \"#212121\"} />\r\n                    <Text position={[0, 0, 0.6]} fontSize={0.8} color=\"white\">+</Text>\r\n                    {/* Fire effect if short circuit */}\r\n                    {shortCircuit && !fuseBlown && (\r\n                        <mesh position={[0, 1, 0]}>\r\n                            <sphereGeometry args={[0.5]} />\r\n                            <meshBasicMaterial color=\"orange\" transparent opacity={0.6} />\r\n                        </mesh>\r\n                    )}\r\n                </group>\r\n\r\n                {/* Fuse */}\r\n                <group position={[0, 1.5, 0]} onClick={() => handleRepair('fuse')}\r\n                    onPointerOver={() => document.body.style.cursor = 'pointer'}\r\n                    onPointerOut={() => document.body.style.cursor = 'auto'}>\r\n                    <mesh rotation={[0, 0, Math.PI / 2]}>\r\n                        <cylinderGeometry args={[0.1, 0.1, 1]} />\r\n                        <meshStandardMaterial color=\"white\" transparent opacity={0.5} />\r\n                    </mesh>\r\n                    <mesh rotation={[0, 0, Math.PI / 2]}>\r\n                        <cylinderGeometry args={[0.02, 0.02, fuseBlown ? 0.2 : 1]} />\r\n                        <meshBasicMaterial color={fuseBlown ? \"black\" : \"red\"} />\r\n                    </mesh>\r\n                    <Text position={[0, 0.3, 0]} fontSize={0.2} color=\"white\">FUSIBLE</Text>\r\n                </group>\r\n\r\n                {/* Bulb */}\r\n                <group position={[2, 0, 0]}>\r\n                    <mesh position={[0, 0.8, 0]}>\r\n                        <sphereGeometry args={[0.6]} />\r\n                        <meshStandardMaterial\r\n                            color={switchClosed && !shortCircuit && !fuseBlown ? \"#FFEB3B\" : \"white\"}\r\n                            emissive={switchClosed && !shortCircuit && !fuseBlown ? \"#FFEB3B\" : \"black\"}\r\n                            emissiveIntensity={switchClosed && !shortCircuit && !fuseBlown ? 2 : 0}\r\n                            transparent opacity={0.6}\r\n                        />\r\n                    </mesh>\r\n                    <mesh position={[0, 0, 0]}>\r\n                        <cylinderGeometry args={[0.3, 0.3, 0.8]} />\r\n                        <meshStandardMaterial color=\"#B0BEC5\" />\r\n                    </mesh>\r\n                </group>\r\n\r\n                {/* Switch Visual */}\r\n                <group position={[0, -1.5, 0]}>\r\n                    <mesh position={[-0.5, 0, 0]}><boxGeometry args={[0.2, 0.2, 0.2]} /><meshStandardMaterial color=\"gray\" /></mesh>\r\n                    <mesh position={[0.5, 0, 0]}><boxGeometry args={[0.2, 0.2, 0.2]} /><meshStandardMaterial color=\"gray\" /></mesh>\r\n                    <mesh position={[-0.5, 0.2, 0]} rotation={[0, 0, switchClosed ? 0 : 0.5]}>\r\n                        <boxGeometry args={[1.2, 0.1, 0.1]} />\r\n                        <meshStandardMaterial color=\"red\" />\r\n                    </mesh>\r\n                </group>\r\n\r\n                {/* Wires */}\r\n                <WirePath points={[[-2, 0.75, 0], [-2, 1.5, 0], [-0.5, 1.5, 0]]} color=\"red\" />\r\n                <WirePath points={[[0.5, 1.5, 0], [2, 1.5, 0], [2, 0.8, 0]]} color=\"red\" />\r\n                <WirePath points={[[-2, -0.75, 0], [-2, -1.5, 0], [-0.5, -1.5, 0]]} color=\"black\" />\r\n                <WirePath points={[[0.5, -1.5, 0], [2, -1.5, 0], [2, -0.4, 0]]} color=\"black\" />\r\n\r\n                {/* SHORT CIRCUIT WIRE */}\r\n                {shortCircuit && (\r\n                    <group onClick={() => handleRepair('short')}>\r\n                        <WirePath points={[[1, 1.5, 0], [1, -1.5, 0]]} color=\"#FF5722\" />\r\n                        <Text position={[1.2, 0, 0]} fontSize={0.2} color=\"orange\">PANNE ÔÜá´©Å</Text>\r\n                    </group>\r\n                )}\r\n\r\n                {/* Electron Flow Visualization */}\r\n                {switchClosed && !fuseBlown && !shortCircuit && (\r\n                    <group>\r\n                        <ElectronStream start={[-2, 1.5, 0]} end={[0, 1.5, 0]} speed={1} />\r\n                        <ElectronStream start={[0.1, 1.5, 0]} end={[2, 1.5, 0]} speed={1} />\r\n                        <ElectronStream start={[2, -1.5, 0]} end={[-2, -1.5, 0]} speed={1} />\r\n                    </group>\r\n                )}\r\n            </group>\r\n        </group >\r\n    );\r\n}\r\n\r\nfunction WirePath({ points, color }) {\r\n    // Simple segmented wire\r\n    const segments = [];\r\n    for (let i = 0; i < points.length - 1; i++) {\r\n        const p1 = new THREE.Vector3(...points[i]);\r\n        const p2 = new THREE.Vector3(...points[i + 1]);\r\n        const dist = p1.distanceTo(p2);\r\n        const center = p1.clone().add(p2).multiplyScalar(0.5);\r\n        const lookAtRot = new THREE.Euler().setFromQuaternion(new THREE.Quaternion().setFromUnitVectors(new THREE.Vector3(0, 1, 0), p2.clone().sub(p1).normalize()));\r\n\r\n        segments.push(\r\n            <mesh key={i} position={center} rotation={lookAtRot}>\r\n                <cylinderGeometry args={[0.05, 0.05, dist]} />\r\n                <meshStandardMaterial color={color} />\r\n            </mesh>\r\n        );\r\n    }\r\n    return <group>{segments}</group>;\r\n}\r\n\r\nfunction ElectronStream({ start, end, speed = 1 }) {\r\n    const count = 5;\r\n    return (\r\n        <group>\r\n            {Array.from({ length: count }).map((_, i) => (\r\n                <MovingElectron key={i} start={start} end={end} offset={i / count} speed={speed} />\r\n            ))}\r\n        </group>\r\n    );\r\n}\r\n\r\n\r\n// ============================================================\r\n// CHAPITRE 4: POIDS ET MASSE (ENRICHI & CHALLENGE)\r\n// ============================================================\r\nexport function WeightMassPC4() {\r\n    const [phase, setPhase] = useState('explore');\r\n    const [planet, setPlanet] = useState('earth');\r\n    const [mass, setMass] = useState(10);\r\n    const [targetWeight, setTargetWeight] = useState(null);\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n\r\n    const planets = {\r\n        earth: { name: 'Terre', g: 9.8, color: '#3B82F6', emissive: '#1D4ED8' },\r\n        moon: { name: 'Lune', g: 1.6, color: '#9CA3AF', emissive: '#4B5563' },\r\n        mars: { name: 'Mars', g: 3.7, color: '#EF4444', emissive: '#991B1B' },\r\n        jupiter: { name: 'Jupiter', g: 24.8, color: '#F59E0B', emissive: '#B45309' }\r\n    };\r\n\r\n    const currentPlanet = planets[planet];\r\n    const weight = (mass * currentPlanet.g).toFixed(1);\r\n\r\n    const startMission = () => {\r\n        const keys = Object.keys(planets);\r\n        const randPlanet = keys[Math.floor(Math.random() * keys.length)];\r\n        setPlanet(randPlanet);\r\n        const randMass = Math.floor(Math.random() * 40 + 10);\r\n        setTargetWeight((randMass * planets[randPlanet].g).toFixed(1));\r\n        setMass(0);\r\n        setPhase('mission');\r\n        setShowSuccess(false);\r\n        setTimeLeft(45);\r\n    };\r\n\r\n    const checkMission = () => {\r\n        if (targetWeight && Math.abs(parseFloat(weight) - parseFloat(targetWeight)) < 0.5) {\r\n            if (!showSuccess) {\r\n                const points = 50 + Math.floor(timeLeft / 2);\r\n                setScore(s => s + points);\r\n                setShowSuccess(true);\r\n            }\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [timeLeft, phase, showSuccess]);\r\n\r\n    return (\r\n        <group>\r\n            <SuccessOverlay show={showSuccess} message={`Cargaison ├®quilibr├®e ! ${weight} N sur ${currentPlanet.name}`} points={50 + Math.floor(timeLeft / 2)} onNext={startMission} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒÜÇ Mission : Poids Spatial\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[400px] border-blue-500/30 text-white\">\r\n                    <div className=\"flex justify-between items-center mb-4\">\r\n                        <GradeBadge score={score} />\r\n                        {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={45} />}\r\n                    </div>\r\n\r\n                    <XPBar current={score} nextLevel={2000} />\r\n\r\n                    <div className=\"h-[1px] bg-gradient-to-r from-transparent via-blue-500/50 to-transparent my-4\" />\r\n\r\n                    <PhaseSelector currentPhase={phase} onSelect={(p) => { setPhase(p); if (p === 'mission') startMission(); }} />\r\n\r\n                    {phase === 'mission' && targetWeight && (\r\n                        <MissionObjective objective={`Ajustez la masse pour atteindre un poids de ${targetWeight} N sur ${currentPlanet.name}`} icon=\"ÔÜû´©Å\" />\r\n                    )}\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                        <div className=\"space-y-4\">\r\n                            <div>\r\n                                <label className=\"text-[10px] text-gray-400 block mb-1 uppercase tracking-wider\">Destination</label>\r\n                                <div className=\"grid grid-cols-2 gap-1\">\r\n                                    {Object.entries(planets).map(([k, p]) => (\r\n                                        <button key={k} onClick={() => setPlanet(k)} disabled={phase === 'mission'}\r\n                                            className={`p-1 text-[9px] font-bold rounded border transition-all ${planet === k ? 'bg-blue-600 border-blue-400' : 'bg-gray-800 border-gray-700 opacity-50'}`}>\r\n                                            {p.name.toUpperCase()}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"text-[10px] text-gray-400 block mb-1 uppercase tracking-wider\">Cargaison (Masse)</label>\r\n                                <div className=\"bg-gray-900/50 p-3 rounded-xl border border-white/5\">\r\n                                    <div className=\"text-2xl font-bold text-blue-400 font-mono mb-2\">{mass} <span className=\"text-xs text-gray-500\">kg</span></div>\r\n                                    <input type=\"range\" min=\"0\" max=\"100\" step=\"1\" value={mass} onChange={(e) => setMass(Number(e.target.value))}\r\n                                        className=\"w-full h-1 bg-gray-700 accent-blue-500 rounded-lg appearance-none cursor-pointer\" />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"bg-black/60 rounded-xl p-3 border border-blue-500/20 flex flex-col justify-between\">\r\n                            <div className=\"space-y-3 text-center\">\r\n                                <div className=\"text-[10px] font-mono text-gray-500 tracking-widest uppercase\">Indicateur de Poids</div>\r\n                                <div className=\"bg-gray-900/80 p-3 rounded-lg border border-blue-500/30\">\r\n                                    <div className=\"text-2xl font-black text-white font-mono\">{weight}<span className=\"text-xs ml-1 text-gray-500\">N</span></div>\r\n                                    <div className=\"text-[8px] text-blue-400 mt-1 uppercase\">Force Gravitationnelle</div>\r\n                                </div>\r\n                                <div className=\"text-[10px] text-gray-500\">g = {currentPlanet.g} N/kg</div>\r\n                            </div>\r\n\r\n                            <button onClick={phase === 'mission' ? checkMission : null}\r\n                                className={`w-full py-2 rounded font-black text-[10px] tracking-widest transition-all ${phase === 'mission' ? 'bg-blue-600 hover:bg-blue-500 shadow-lg shadow-blue-500/20' : 'bg-gray-800 text-gray-500 cursor-default'}`}>\r\n                                {phase === 'mission' ? 'V├ëRIFIER LE POIDS' : 'EXPLORATION LIBRE'}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <group position={[0, -2, 0]}>\r\n                {/* Planet Surface */}\r\n                <mesh rotation={[-Math.PI / 2, 0, 0]} position={[0, -0.05, 0]}>\r\n                    <planeGeometry args={[10, 10]} />\r\n                    <meshStandardMaterial color={currentPlanet.color} roughness={0.8} />\r\n                </mesh>\r\n                <gridHelper args={[10, 10, currentPlanet.color, '#1F2937']} />\r\n\r\n                {/* Astronaut / Cargo Object */}\r\n                <Float speed={2} rotationIntensity={0.2} floatIntensity={currentPlanet.g < 5 ? 0.5 : 0.1}>\r\n                    <mesh position={[0, 1, 0]} scale={[1 + mass / 100, 1 + mass / 100, 1 + mass / 100]}>\r\n                        <boxGeometry args={[1, 1, 1]} />\r\n                        <meshStandardMaterial color=\"#FCD34D\" metalness={0.5} roughness={0.2} />\r\n                    </mesh>\r\n\r\n                    {/* Weight Vector */}\r\n                    <arrowHelper\r\n                        args={[\r\n                            new THREE.Vector3(0, -1, 0),\r\n                            new THREE.Vector3(0, 0.5, 0),\r\n                            1 + parseFloat(weight) / 100,\r\n                            0xEF4444,\r\n                            0.3,\r\n                            0.2\r\n                        ]}\r\n                    />\r\n                </Float>\r\n\r\n                {/* Background Planet */}\r\n                <group position={[5, 5, -10]}>\r\n                    <mesh>\r\n                        <sphereGeometry args={[2, 32, 32]} />\r\n                        <meshStandardMaterial color={currentPlanet.color} emissive={currentPlanet.emissive} emissiveIntensity={0.5} />\r\n                    </mesh>\r\n                    <pointLight intensity={2} color={currentPlanet.color} />\r\n                </group>\r\n            </group>\r\n        </group>\r\n    );\r\n}\r\n\r\nfunction MovingElectron({ start, end, offset, speed }) {\r\n    const ref = useRef();\r\n    const p1 = new THREE.Vector3(...start);\r\n    const p2 = new THREE.Vector3(...end);\r\n\r\n    useFrame((state) => {\r\n        if (ref.current) {\r\n            const t = (state.clock.elapsedTime * 0.5 * speed + offset) % 1;\r\n            ref.current.position.lerpVectors(p1, p2, t);\r\n        }\r\n    });\r\n\r\n    return (\r\n        <mesh ref={ref}>\r\n            <sphereGeometry args={[0.08]} />\r\n            <meshBasicMaterial color=\"#FFFF00\" />\r\n        </mesh>\r\n    );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\ParticleBackground.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\Physique1ereSimulations.js","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":1021,"column":71,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[57458,57460],"text":"F&apos;"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[57458,57460],"text":"F&lsquo;"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[57458,57460],"text":"F&#39;"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[57458,57460],"text":"F&rsquo;"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":1038,"column":102,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[58773,58775],"text":"A&apos;"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[58773,58775],"text":"A&lsquo;"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[58773,58775],"text":"A&#39;"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[58773,58775],"text":"A&rsquo;"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":1039,"column":128,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[58910,58912],"text":"B&apos;"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[58910,58912],"text":"B&lsquo;"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[58910,58912],"text":"B&#39;"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[58910,58912],"text":"B&rsquo;"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":1074,"column":104,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[61714,61728],"text":"Focale |f&apos;| = "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[61714,61728],"text":"Focale |f&lsquo;| = "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[61714,61728],"text":"Focale |f&#39;| = "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[61714,61728],"text":"Focale |f&rsquo;| = "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":1083,"column":81,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[62501,62519],"text":"Position Image OA&apos;"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[62501,62519],"text":"Position Image OA&lsquo;"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[62501,62519],"text":"Position Image OA&#39;"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[62501,62519],"text":"Position Image OA&rsquo;"},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useRef, useMemo, useEffect } from 'react';\r\nimport { useFrame } from '@react-three/fiber';\r\nimport { Html, OrbitControls, Text, Sphere, Box, Cylinder, Line, Plane } from '@react-three/drei';\r\nimport * as THREE from 'three';\r\nimport DraggableHtmlPanel from './DraggableHtmlPanel';\r\nimport confetti from 'canvas-confetti';\r\n\r\n// ==========================================\r\n// SHARED UTILS\r\n// ==========================================\r\nimport { SuccessOverlay, ConfettiExplosion, ChallengeTimer, GradeBadge, XPBar, PhaseSelector, MissionObjective } from './GamificationUtils';\r\n\r\n// ==========================================\r\n// SHARED UTILS REMOVED (Now using GamificationUtils)\r\n// ==========================================\r\n\r\n// SuccessOverlay removed (imported from GamificationUtils)\r\n\r\nfunction Grid() {\r\n    return <gridHelper args={[30, 30, '#333', '#111']} position={[0, -2, 0]} />;\r\n}\r\n\r\n// ==========================================\r\n// P1: TRAVAIL ET PUISSANCE\r\n// ==========================================\r\nexport function TravailPuissanceSim() {\r\n    const [force, setForce] = useState(50);\r\n    const [angle, setAngle] = useState(30);\r\n    const [distance, setDistance] = useState(5);\r\n    const [incline, setIncline] = useState(0); // Inclinaison plan\r\n    const [mode, setMode] = useState('explore');\r\n    const [challenge, setChallenge] = useState(null);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [score, setScore] = useState(0);\r\n    const chariotRef = useRef();\r\n    const [animPos, setAnimPos] = useState(-3);\r\n    const [isAnimating, setIsAnimating] = useState(false);\r\n\r\n    const travailF = force * distance * Math.cos(angle * Math.PI / 180);\r\n    const travailP = -10 * 9.81 * distance * Math.sin(incline * Math.PI / 180); // m=10kg\r\n    const puissance = travailF / 5; // Suppose t=5s pour simplifier\r\n    const [phase, setPhase] = useState('explore');\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n    const [mission, setMission] = useState(null);\r\n\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Travail Moteur', objective: 'Obtenez un travail positif > 500J.', targetMin: 500, type: 'moteur' },\r\n        { id: 2, title: 'Force Nulle', objective: 'Annulez le travail (W=0) avec un angle de 90┬░.', targetW: 0, angle: 90 },\r\n        { id: 3, title: 'Puissance Max', objective: 'Atteignez une puissance de 100W.', targetP: 100 }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            setMission(missions[Math.floor(Math.random() * missions.length)]);\r\n            setTimeLeft(45);\r\n        }\r\n    }, [phase, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [timeLeft, phase, showSuccess]);\r\n\r\n    const checkMission = () => {\r\n        if (!mission) return;\r\n        let success = false;\r\n        if (mission.id === 1 && travailF > mission.targetMin) success = true;\r\n        if (mission.id === 2 && Math.abs(travailF) < 1 && angle === 90) success = true;\r\n        if (mission.id === 3 && puissance >= mission.targetP) success = true;\r\n\r\n        if (success) {\r\n            setScore(s => s + 500);\r\n            setShowSuccess(true);\r\n        }\r\n    };\r\n\r\n    useFrame((state, delta) => {\r\n        if (isAnimating && chariotRef.current) {\r\n            setAnimPos(p => {\r\n                if (p < distance - 3) return p + delta * 2;\r\n                setIsAnimating(false);\r\n                return p;\r\n            });\r\n        }\r\n    });\r\n\r\n    const startAnimation = () => {\r\n        setAnimPos(-3);\r\n        setIsAnimating(true);\r\n    };\r\n\r\n    const inclineRad = incline * Math.PI / 180;\r\n    const forceAngleRad = angle * Math.PI / 180;\r\n\r\n    return (\r\n        <group>\r\n            <OrbitControls />\r\n            <Grid />\r\n\r\n            {/* Plan Inclinable */}\r\n            <group rotation={[0, 0, inclineRad]}>\r\n                <mesh position={[0, -0.15, 0]}>\r\n                    <boxGeometry args={[15, 0.3, 4]} />\r\n                    <meshStandardMaterial color=\"#444\" />\r\n                </mesh>\r\n\r\n                {/* Rep├¿res distance */}\r\n                {/* Ligne d├®part */}\r\n                <Line points={[[-3, 0.02, 1.5], [-3, 0.02, -1.5]]} color=\"white\" lineWidth={2} />\r\n                <Text position={[-3, 0.2, 2]} fontSize={0.3} color=\"white\">0m</Text>\r\n\r\n                {/* Ligne arriv├®e */}\r\n                <Line points={[[-3 + distance, 0.02, 1.5], [-3 + distance, 0.02, -1.5]]} color=\"#00F5D4\" lineWidth={2} dashed />\r\n                <Text position={[-3 + distance, 0.2, 2]} fontSize={0.3} color=\"#00F5D4\">{distance}m</Text>\r\n\r\n                {/* Chariot */}\r\n                <group ref={chariotRef} position={[animPos, 0.6, 0]}>\r\n                    <Box args={[1.2, 0.6, 1]}><meshStandardMaterial color=\"#FF6B35\" /></Box>\r\n                    <Cylinder args={[0.18, 0.18, 0.12]} position={[-0.35, -0.4, 0.5]} rotation={[Math.PI / 2, 0, 0]}><meshStandardMaterial color=\"#222\" /></Cylinder>\r\n                    <Cylinder args={[0.18, 0.18, 0.12]} position={[0.35, -0.4, 0.5]} rotation={[Math.PI / 2, 0, 0]}><meshStandardMaterial color=\"#222\" /></Cylinder>\r\n                    <Cylinder args={[0.18, 0.18, 0.12]} position={[-0.35, -0.4, -0.5]} rotation={[Math.PI / 2, 0, 0]}><meshStandardMaterial color=\"#222\" /></Cylinder>\r\n                    <Cylinder args={[0.18, 0.18, 0.12]} position={[0.35, -0.4, -0.5]} rotation={[Math.PI / 2, 0, 0]}><meshStandardMaterial color=\"#222\" /></Cylinder>\r\n\r\n                    {/* Vecteur Poids (Vertical toujours) - Rotation inverse pour rester vertical */}\r\n                    <group rotation={[0, 0, -inclineRad]}>\r\n                        <arrowHelper args={[new THREE.Vector3(0, -1, 0), new THREE.Vector3(0, 0, 0), 1.5, 0x00AACC, 0.4, 0.2]} />\r\n                        <Text position={[0.5, -1, 0]} fontSize={0.3} color=\"#00AACC\">P</Text>\r\n                    </group>\r\n\r\n                    {/* Vecteur Force */}\r\n                    <arrowHelper args={[new THREE.Vector3(Math.cos(forceAngleRad), Math.sin(forceAngleRad), 0), new THREE.Vector3(0, 0.3, 0), 2, 0xFFFF00, 0.4, 0.2]} />\r\n                </group>\r\n\r\n                {/* Corde Force */}\r\n                <Line\r\n                    points={[\r\n                        [animPos, 0.9, 0],\r\n                        [animPos + Math.cos(forceAngleRad) * 2, 0.9 + Math.sin(forceAngleRad) * 2, 0]\r\n                    ]}\r\n                    color=\"yellow\"\r\n                    lineWidth={2}\r\n                />\r\n            </group>\r\n\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒöº Travail & Puissance\" className=\"w-[400px] border-blue-500/30\">\r\n                    <div className=\"text-white\">\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <GradeBadge score={score} />\r\n                            {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={45} />}\r\n                        </div>\r\n                        <XPBar current={score} nextLevel={1000} />\r\n                        <div className=\"h-[1px] bg-gradient-to-r from-transparent via-blue-500/50 to-transparent my-4\" />\r\n                        <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n                        {phase === 'mission' && mission && <MissionObjective objective={mission.objective} icon=\"­ƒÄ»\" />}\r\n\r\n                        <div className=\"space-y-3 mt-4\">\r\n                            <div><label className=\"text-xs font-bold text-yellow-400\">Force F: {force} N</label><input type=\"range\" min=\"10\" max=\"150\" value={force} onChange={e => setForce(Number(e.target.value))} className=\"w-full accent-yellow-500\" /></div>\r\n                            <div><label className=\"text-xs font-bold text-cyan-400\">Angle ╬▒: {angle}┬░</label><input type=\"range\" min=\"0\" max=\"90\" value={angle} onChange={e => setAngle(Number(e.target.value))} className=\"w-full accent-cyan-500\" /></div>\r\n                            <div><label className=\"text-xs font-bold text-green-400\">Distance d: {distance} m</label><input type=\"range\" min=\"1\" max=\"10\" value={distance} onChange={e => setDistance(Number(e.target.value))} className=\"w-full accent-green-500\" /></div>\r\n                            <div><label className=\"text-xs font-bold text-gray-400\">Inclinaison: {incline}┬░</label><input type=\"range\" min=\"-30\" max=\"30\" value={incline} onChange={e => setIncline(Number(e.target.value))} className=\"w-full accent-gray-500\" /></div>\r\n                        </div>\r\n                        <div className=\"mt-4 p-3 bg-black/40 rounded-xl border border-white/10\">\r\n                            <div className=\"flex justify-between items-center mb-1\">\r\n                                <span className=\"text-xs text-yellow-500\">W(F) = F┬Àd┬Àcos(╬▒)</span>\r\n                                <span className=\"text-xl font-bold text-[#00F5D4]\">{travailF.toFixed(0)} J</span>\r\n                            </div>\r\n                            <div className=\"flex justify-between items-center mb-1\">\r\n                                <span className=\"text-xs text-blue-400\">W(P) = -mg┬Àd┬Àsin(i)</span>\r\n                                <span className=\"text-md font-bold text-blue-300\">{travailP.toFixed(0)} J</span>\r\n                            </div>\r\n                            <div className=\"flex justify-between items-center mt-2 border-t border-white/10 pt-1\">\r\n                                <span className=\"text-xs text-gray-400\">Puissance P</span>\r\n                                <span className=\"text-sm font-bold text-white\">{puissance.toFixed(0)} W</span>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"flex gap-2 mt-4\">\r\n                            <button onClick={startAnimation} className=\"flex-1 py-3 bg-green-600 rounded-xl font-bold hover:bg-green-500 transition-all text-xs\">ÔûÂ´©Å LANCER</button>\r\n                            {phase === 'mission' && <button onClick={checkMission} className=\"flex-1 py-3 bg-orange-600 rounded-xl font-bold hover:bg-orange-500 transition-all text-xs\">V├ëRIFIER</button>}\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n            <SuccessOverlay show={showSuccess} message=\"Mission R├®ussie !\" points={500} onNext={() => { setShowSuccess(false); setMission(null); setPhase('explore'); }} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group >\r\n    );\r\n}\r\n\r\n// ==========================================\r\n// P2: ├ëNERGIE CIN├ëTIQUE\r\n// ==========================================\r\nexport function EnergieCinetiqueSim() {\r\n    const [mass, setMass] = useState(1000);\r\n    const [velocity, setVelocity] = useState(20);\r\n    const [brakeForce, setBrakeForce] = useState(5000);\r\n    const [carPos, setCarPos] = useState(-10);\r\n    const [isMoving, setIsMoving] = useState(false);\r\n    const [crashed, setCrashed] = useState(false);\r\n    const cameraRef = useRef();\r\n\r\n    const ec = 0.5 * mass * velocity * velocity;\r\n    const distanceFreinage = ec / brakeForce;\r\n    const WALL_POS = 15;\r\n    const START_POS = -10;\r\n\r\n    // Si la distance d'arr├¬t d├®passe la distance au mur (25m), CRASH !\r\n    const willCrash = (START_POS + distanceFreinage) > WALL_POS;\r\n    const finalPos = willCrash ? WALL_POS : START_POS + distanceFreinage;\r\n\r\n    useFrame((state, delta) => {\r\n        if (isMoving) {\r\n            setCarPos(p => {\r\n                const step = velocity * delta * 0.8; // Vitesse animation proportionnelle\r\n                if (p < finalPos) {\r\n                    const next = p + step;\r\n                    if (next >= finalPos) {\r\n                        setIsMoving(false);\r\n                        if (willCrash) {\r\n                            setCrashed(true);\r\n                            triggerSuccess(); // Boom confetti\r\n                        }\r\n                        return finalPos;\r\n                    }\r\n                    return next;\r\n                }\r\n                return p;\r\n            });\r\n        }\r\n    });\r\n\r\n    const reset = () => {\r\n        setCarPos(START_POS);\r\n        setCrashed(false);\r\n        setIsMoving(false);\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            <OrbitControls />\r\n            <Grid />\r\n            <Plane args={[40, 5]} rotation={[-Math.PI / 2, 0, 0]} position={[0, -1.95, 0]}><meshStandardMaterial color=\"#333\" /></Plane>\r\n\r\n            {/* Ligne d├®part */}\r\n            <Line points={[[START_POS, -1.9, 2.5], [START_POS, -1.9, -2.5]]} color=\"white\" lineWidth={2} />\r\n            <Text position={[START_POS, -1.5, 3]} fontSize={0.5} color=\"white\">D├®part</Text>\r\n\r\n            {/* Mur */}\r\n            <Box args={[1, 4, 6]} position={[WALL_POS + 0.5, 0, 0]}><meshStandardMaterial color=\"#555\" map={null} /></Box>\r\n            <Text position={[WALL_POS, 2.5, 0]} fontSize={0.8} color=\"red\" rotation={[0, -Math.PI / 2, 0]}>MUR</Text>\r\n\r\n            {/* Distance th├®orique */}\r\n            <Line points={[[START_POS, -1.8, 2.2], [START_POS + distanceFreinage, -1.8, 2.2]]} color={willCrash ? \"red\" : \"green\"} lineWidth={4} />\r\n            <Text position={[START_POS + distanceFreinage / 2, -1.4, 2.2]} fontSize={0.4} color={willCrash ? \"red\" : \"green\"}>d = {distanceFreinage.toFixed(1)} m</Text>\r\n\r\n            <group position={[carPos, -1.2, 0]} rotation={[0, 0, crashed ? 0.2 : 0]}>\r\n                <Box args={[2.2, 0.6, 1.2]}><meshStandardMaterial color=\"#E63946\" /></Box>\r\n                <Box args={[1, 0.5, 1.1]} position={[0.4, 0.5, 0]}><meshStandardMaterial color=\"#1D3557\" /></Box>\r\n                <Cylinder args={[0.28, 0.28, 0.18]} position={[-0.7, -0.35, 0.6]} rotation={[Math.PI / 2, 0, 0]}><meshStandardMaterial color=\"#111\" /></Cylinder>\r\n                <Cylinder args={[0.28, 0.28, 0.18]} position={[0.7, -0.35, 0.6]} rotation={[Math.PI / 2, 0, 0]}><meshStandardMaterial color=\"#111\" /></Cylinder>\r\n                <Cylinder args={[0.28, 0.28, 0.18]} position={[-0.7, -0.35, -0.6]} rotation={[Math.PI / 2, 0, 0]}><meshStandardMaterial color=\"#111\" /></Cylinder>\r\n                <Cylinder args={[0.28, 0.28, 0.18]} position={[0.7, -0.35, -0.6]} rotation={[Math.PI / 2, 0, 0]}><meshStandardMaterial color=\"#111\" /></Cylinder>\r\n                {crashed && <Text position={[0, 1.5, 0]} fontSize={1} color=\"yellow\">BOOM!</Text>}\r\n            </group>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒÜù ├ënergie Cin├®tique\" className=\"w-[400px] border-red-500/30\">\r\n                    <div className=\"text-white\">\r\n                        <div className=\"bg-black/40 p-2 rounded-lg mb-3\">\r\n                            <div className=\"flex justify-between text-xs\"><span>Vitesse</span><span className=\"font-bold text-green-400\">{(velocity * 3.6).toFixed(0)} km/h</span></div>\r\n                            <div className=\"flex justify-between text-xs mt-1\"><span>Distance Freinage</span><span className={`font-bold ${willCrash ? 'text-red-500' : 'text-blue-400'}`}>{distanceFreinage.toFixed(1)} m</span></div>\r\n                        </div>\r\n                        <div className=\"space-y-3\">\r\n                            <div><label className=\"text-[10px] font-bold text-blue-400 uppercase\">Masse (kg)</label><input type=\"range\" min=\"500\" max=\"2500\" step=\"100\" value={mass} onChange={e => { setMass(Number(e.target.value)); reset(); }} className=\"w-full accent-blue-500 h-1 bg-gray-700\" /></div>\r\n                            <div><label className=\"text-[10px] font-bold text-green-400 uppercase\">Vitesse (m/s)</label><input type=\"range\" min=\"5\" max=\"45\" value={velocity} onChange={e => { setVelocity(Number(e.target.value)); reset(); }} className=\"w-full accent-green-500 h-1 bg-gray-700\" /></div>\r\n                            <div><label className=\"text-[10px] font-bold text-red-400 uppercase\">Freinage (N)</label><input type=\"range\" min=\"1000\" max=\"15000\" step=\"500\" value={brakeForce} onChange={e => { setBrakeForce(Number(e.target.value)); reset(); }} className=\"w-full accent-red-500 h-1 bg-gray-700\" /></div>\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-2 gap-2 mt-4\">\r\n                            <div className=\"p-2 bg-gray-800 rounded border border-gray-600 text-center\">\r\n                                <div className=\"text-[9px] text-gray-400\">├ëNERGIE CIN├ëTIQUE</div>\r\n                                <div className=\"text-lg font-bold text-white\">{(ec / 1000).toFixed(0)} kJ</div>\r\n                            </div>\r\n                            <div className=\"p-2 bg-gray-800 rounded border border-gray-600 text-center\">\r\n                                <div className=\"text-[9px] text-gray-400\">MUR ├Ç</div>\r\n                                <div className=\"text-lg font-bold text-white\">{(WALL_POS - START_POS).toFixed(0)} m</div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <button onClick={() => { reset(); setTimeout(() => setIsMoving(true), 100); }}\r\n                            className={`w-full mt-4 py-3 ${willCrash ? 'bg-red-600 hover:bg-red-500 shadow-red-600/20' : 'bg-green-600 hover:bg-green-500 shadow-green-600/20'} rounded-xl font-bold shadow-lg transition-all text-xs uppercase tracking-wider`}>\r\n                            {willCrash ? 'ÔÜá´©Å Impact Imminent' : 'Ô£à Test S├®curis├®'}\r\n                        </button>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n            <SuccessOverlay show={crashed} message=\"CRASH ! L'├®nergie cin├®tique ├®tait trop grande.\" points={0} onNext={reset} />\r\n            <ConfettiExplosion active={crashed} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// ==========================================\r\n// P3: ├ëNERGIE M├ëCANIQUE (Pendule)\r\n// ==========================================\r\nexport function EnergieMecaniqueSim() {\r\n    const [isPlaying, setIsPlaying] = useState(false);\r\n    const [angleInit, setAngleInit] = useState(45);\r\n    const penduleRef = useRef();\r\n    const timeRef = useRef(0);\r\n    const L = 3;\r\n    const g = 9.81;\r\n    const omega = Math.sqrt(g / L);\r\n    const [ec, setEc] = useState(0);\r\n    const [ep, setEp] = useState(0);\r\n\r\n    useFrame((state, delta) => {\r\n        if (isPlaying && penduleRef.current) {\r\n            timeRef.current += delta;\r\n            const theta = (angleInit * Math.PI / 180) * Math.cos(omega * timeRef.current);\r\n            penduleRef.current.rotation.z = theta;\r\n            const h = L * (1 - Math.cos(theta));\r\n            const v = L * omega * Math.abs(Math.sin(omega * timeRef.current)) * (angleInit * Math.PI / 180);\r\n            setEp(10 * g * h);\r\n            setEc(0.5 * 10 * v * v);\r\n        }\r\n    });\r\n\r\n    const reset = () => { setIsPlaying(false); timeRef.current = 0; if (penduleRef.current) penduleRef.current.rotation.z = angleInit * Math.PI / 180; };\r\n\r\n    return (\r\n        <group>\r\n            <OrbitControls />\r\n            <Box args={[5, 0.25, 0.6]} position={[0, 4.5, 0]}><meshStandardMaterial color=\"#444\" /></Box>\r\n            <group ref={penduleRef} position={[0, 4.5, 0]}>\r\n                <Cylinder args={[0.05, 0.05, L]} position={[0, -L / 2, 0]}><meshStandardMaterial color=\"#777\" /></Cylinder>\r\n                <Sphere args={[0.35]} position={[0, -L, 0]}><meshStandardMaterial color=\"#FF0055\" emissive={isPlaying ? \"#FF0055\" : \"#000\"} emissiveIntensity={0.3} /></Sphere>\r\n            </group>\r\n            <Line points={[[-4, 4.5 - L, 0], [4, 4.5 - L, 0]]} color=\"cyan\" lineWidth={2} />\r\n            <Text position={[4.5, 4.5 - L, 0]} fontSize={0.25} color=\"cyan\">Ep = 0</Text>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒÄó ├ënergie M├®canique\" className=\"w-[380px] border-yellow-500/30\">\r\n                    <div className=\"text-white\">\r\n                        <div className=\"grid grid-cols-3 gap-2 text-center mb-4\">\r\n                            <div className=\"bg-green-500/10 p-2 rounded-xl border border-green-500/20\"><div className=\"text-green-400 text-[9px] font-bold uppercase\">Cin├®tique</div><div className=\"text-sm font-bold\">{ec.toFixed(0)} J</div></div>\r\n                            <div className=\"bg-blue-500/10 p-2 rounded-xl border border-blue-500/20\"><div className=\"text-blue-400 text-[9px] font-bold uppercase\">Potentielle</div><div className=\"text-sm font-bold\">{ep.toFixed(0)} J</div></div>\r\n                            <div className=\"bg-yellow-500/10 p-2 rounded-xl border border-yellow-500/20\"><div className=\"text-yellow-400 text-[9px] font-bold uppercase\">M├®canique</div><div className=\"text-sm font-bold\">{(ec + ep).toFixed(0)} J</div></div>\r\n                        </div>\r\n\r\n                        <div className=\"mb-4\">\r\n                            <label className=\"text-[10px] text-gray-400 uppercase font-bold\">Angle Initial</label>\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <input type=\"range\" min=\"15\" max=\"80\" value={angleInit} onChange={e => { setAngleInit(Number(e.target.value)); reset(); }} className=\"w-full h-1 bg-gray-700 accent-yellow-500\" disabled={isPlaying} />\r\n                                <span className=\"text-xs font-mono w-8\">{angleInit}┬░</span>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"flex gap-2\">\r\n                            <button onClick={() => setIsPlaying(!isPlaying)} className={`flex-1 py-3 rounded-xl font-bold text-xs uppercase transition-all ${isPlaying ? 'bg-red-500 shadow-lg shadow-red-500/30' : 'bg-green-500 shadow-lg shadow-green-500/30 hover:scale-105'}`}>{isPlaying ? 'ÔÅ© PAUSE' : 'ÔûÂ´©Å L├éCHER'}</button>\r\n                            <button onClick={reset} className=\"px-4 bg-gray-700 rounded-xl font-bold text-xs uppercase hover:bg-gray-600\">Ôå║ Reset</button>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n        </group>\r\n    );\r\n}\r\n\r\n// ==========================================\r\n// P4: ├ëNERGIE POTENTIELLE DE PESANTEUR\r\n// ==========================================\r\nexport function EnergiePotentielleSim() {\r\n    const [mass, setMass] = useState(10);\r\n    const [height, setHeight] = useState(2); // Hauteur\r\n    const [gravity, setGravity] = useState(9.81); // Terre par d├®faut\r\n    const [phase, setPhase] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n\r\n    const epp = mass * gravity * height;\r\n\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Ascension Everest', objective: 'Atteignez une Epp > 3000 J.', targetMin: 3000 },\r\n        { id: 2, title: 'Gravit├® Lunaire', objective: 'Simulez sur la Lune avec une Epp entre 100 et 200 J.', targetMin: 100, targetMax: 200, grav: 1.62 },\r\n        { id: 3, title: 'Poids Lourds', objective: 'Utilisez la masse maximale pour d├®passer 4000 J.', targetMin: 4000, minMass: 45 }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            setMission(missions[Math.floor(Math.random() * missions.length)]);\r\n            setTimeLeft(45);\r\n        }\r\n    }, [phase, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [timeLeft, phase, showSuccess]);\r\n\r\n    const checkMission = () => {\r\n        if (!mission) return;\r\n        let success = false;\r\n        if (mission.id === 1 && epp > mission.targetMin) success = true;\r\n        if (mission.id === 2 && epp >= mission.targetMin && epp <= mission.targetMax && gravity === 1.62) success = true;\r\n        if (mission.id === 3 && epp > mission.targetMin && mass >= mission.minMass) success = true;\r\n\r\n        if (success) {\r\n            setScore(s => s + 300);\r\n            setShowSuccess(true);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            <OrbitControls />\r\n            <Grid />\r\n            {/* Sol */}\r\n            <Plane args={[10, 10]} rotation={[-Math.PI / 2, 0, 0]} position={[0, -0.01, 0]}><meshStandardMaterial color=\"#222\" /></Plane>\r\n\r\n            {/* Objet suspendu/pos├® */}\r\n            <group position={[0, height + 0.5, 0]}>\r\n                <Box args={[1, 1, 1]}><meshStandardMaterial color=\"#FFD700\" /></Box>\r\n                <Text position={[0, 0.6, 0.6]} fontSize={0.3} color=\"white\">{mass} kg</Text>\r\n            </group>\r\n\r\n            {/* Ligne de r├®f├®rence */}\r\n            <Line points={[[-5, 0, 0], [5, 0, 0]]} color=\"blue\" lineWidth={2} transparent opacity={0.5} />\r\n            <Text position={[5.2, 0, 0]} fontSize={0.3} color=\"blue\">z=0</Text>\r\n\r\n            {/* Ligne hauteur actuelle */}\r\n            <Line points={[[0, 0, 0], [0, height, 0]]} color=\"white\" lineWidth={1} dashed />\r\n            <Text position={[0.6, height / 2, 0]} fontSize={0.3} color=\"white\">h={height}m</Text>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒÅù´©Å ├ënergie Potentielle\" className=\"w-[380px] border-yellow-500/30\">\r\n                    <div className=\"text-white\">\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <GradeBadge score={score} />\r\n                            {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={45} />}\r\n                        </div>\r\n                        <XPBar current={score} nextLevel={1000} />\r\n                        <div className=\"h-[1px] bg-gradient-to-r from-transparent via-yellow-500/50 to-transparent my-4\" />\r\n                        <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n                        {phase === 'mission' && mission && <MissionObjective objective={mission.objective} icon=\"­ƒÅù´©Å\" />}\r\n\r\n                        <div className=\"space-y-3 mt-4\">\r\n                            <div><label className=\"text-xs font-bold text-yellow-400\">Masse m: {mass} kg</label><input type=\"range\" min=\"1\" max=\"50\" value={mass} onChange={e => setMass(Number(e.target.value))} className=\"w-full accent-yellow-500\" /></div>\r\n                            <div><label className=\"text-xs font-bold text-blue-400\">Hauteur h: {height} m</label><input type=\"range\" min=\"0\" max=\"10\" step=\"0.5\" value={height} onChange={e => setHeight(Number(e.target.value))} className=\"w-full accent-blue-500\" /></div>\r\n                            <div>\r\n                                <label className=\"text-xs font-bold text-gray-400\">Astre (g):</label>\r\n                                <select value={gravity} onChange={e => setGravity(Number(e.target.value))} className=\"w-full bg-gray-800 rounded p-1 text-sm border border-gray-600\">\r\n                                    <option value=\"9.81\">Terre (9.81 N/kg)</option>\r\n                                    <option value=\"1.62\">Lune (1.62 N/kg)</option>\r\n                                    <option value=\"3.71\">Mars (3.71 N/kg)</option>\r\n                                    <option value=\"24.79\">Jupiter (24.79 N/kg)</option>\r\n                                </select>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"mt-4 p-3 bg-gradient-to-br from-yellow-900/30 to-black/50 rounded-lg border border-yellow-500/30\">\r\n                            <p className=\"text-xs text-gray-400\">Epp = m ├ù g ├ù z</p>\r\n                            <p className=\"text-2xl font-bold text-yellow-400\">Epp = {epp.toFixed(1)} J</p>\r\n                        </div>\r\n                        {phase === 'mission' && <button onClick={checkMission} className=\"w-full mt-4 py-3 bg-orange-600 rounded-xl font-bold hover:bg-orange-500 transition-all text-xs uppercase\">V├ëRIFIER MISSION</button>}\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n            <SuccessOverlay show={showSuccess} message=\"Objectif Atteint !\" points={300} onNext={() => { setShowSuccess(false); setMission(null); setPhase('explore'); }} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n\r\nexport function ElectrostatiqueSim() {\r\n    const [charges, setCharges] = useState([{ x: 2, y: 0, q: 5 }, { x: -2, y: 0, q: -5 }]);\r\n    const [showFieldLines, setShowFieldLines] = useState(true);\r\n    const [phase, setPhase] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Dip├┤le Parfait', objective: 'Placez 2 charges oppos├®es sym├®triques.', type: 'dipole' },\r\n        { id: 2, title: 'Monop├┤le', objective: 'Ne gardez qu\\'une seule charge positive.', count: 1, sign: 1 },\r\n        { id: 3, title: 'Condensateur', objective: 'Placez au moins 4 charges (2+, 2-).', minCount: 4 }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            setMission(missions[Math.floor(Math.random() * missions.length)]);\r\n            setTimeLeft(45);\r\n        }\r\n    }, [phase, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [timeLeft, phase, showSuccess]);\r\n\r\n    const checkMission = () => {\r\n        if (!mission) return;\r\n        let success = false;\r\n        if (mission.id === 1 && charges.length === 2 && charges[0].q === -charges[1].q) success = true;\r\n        if (mission.id === 2 && charges.length === 1 && charges[0].q > 0) success = true;\r\n        if (mission.id === 3 && charges.length >= 4 && charges.some(c => c.q > 0) && charges.some(c => c.q < 0)) success = true;\r\n\r\n        if (success) {\r\n            setScore(s => s + 300);\r\n            setShowSuccess(true);\r\n        }\r\n    };\r\n\r\n    const addCharge = (q) => setCharges([...charges, { x: (Math.random() - 0.5) * 4, y: (Math.random() - 0.5) * 4, q }]);\r\n\r\n    const fieldLines = useMemo(() => {\r\n        const lines = [];\r\n        charges.forEach(c => {\r\n            if (c.q > 0) {\r\n                for (let a = 0; a < Math.PI * 2; a += Math.PI / 4) {\r\n                    const pts = [];\r\n                    let x = c.x + 0.3 * Math.cos(a), y = c.y + 0.3 * Math.sin(a);\r\n                    for (let step = 0; step < 20; step++) {\r\n                        pts.push(new THREE.Vector3(x, y, 0));\r\n                        let ex = 0, ey = 0;\r\n                        charges.forEach(oc => { const dx = x - oc.x, dy = y - oc.y, r2 = dx * dx + dy * dy + 0.01, e = oc.q / r2; ex += e * dx / Math.sqrt(r2); ey += e * dy / Math.sqrt(r2); });\r\n                        const len = Math.sqrt(ex * ex + ey * ey);\r\n                        if (len > 0) { x += 0.3 * ex / len; y += 0.3 * ey / len; }\r\n                    }\r\n                    lines.push(pts);\r\n                }\r\n            }\r\n        });\r\n        return lines;\r\n    }, [charges]);\r\n\r\n    return (\r\n        <group>\r\n            <OrbitControls enableRotate={false} />\r\n            <Grid />\r\n            {charges.map((c, i) => (<group key={i} position={[c.x, c.y, 0]}><Sphere args={[0.35]}><meshStandardMaterial color={c.q > 0 ? \"#FF4444\" : \"#4444FF\"} /></Sphere><Text fontSize={0.3} color=\"white\">{c.q > 0 ? '+' : '-'}</Text></group>))}\r\n            {showFieldLines && fieldLines.map((pts, i) => (<Line key={i} points={pts} color=\"#00F5D4\" lineWidth={1.5} transparent opacity={0.7} />))}\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"ÔÜí Champ ├ëlectrique\" className=\"w-[380px] border-blue-500/30\">\r\n                    <div className=\"text-white\">\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <GradeBadge score={score} />\r\n                            {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={45} />}\r\n                        </div>\r\n                        <XPBar current={score} nextLevel={1000} />\r\n                        <div className=\"h-[1px] bg-gradient-to-r from-transparent via-blue-500/50 to-transparent my-4\" />\r\n                        <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n                        {phase === 'mission' && mission && <MissionObjective objective={mission.objective} icon=\"ÔÜí\" />}\r\n\r\n                        <div className=\"flex gap-2 mb-4 mt-4\">\r\n                            <button onClick={() => addCharge(5)} className=\"flex-1 bg-red-600 py-2 rounded-lg font-bold hover:bg-red-500 text-xs uppercase shadow-lg shadow-red-600/20\">+ Positive</button>\r\n                            <button onClick={() => addCharge(-5)} className=\"flex-1 bg-blue-600 py-2 rounded-lg font-bold hover:bg-blue-500 text-xs uppercase shadow-lg shadow-blue-600/20\">- N├®gative</button>\r\n                        </div>\r\n                        <button onClick={() => setCharges([])} className=\"w-full mb-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-xs uppercase font-bold\">­ƒùæ´©Å Effacer tout</button>\r\n                        <label className=\"flex items-center gap-2 text-sm cursor-pointer p-2 bg-gray-800 rounded hover:bg-gray-700 transition\">\r\n                            <input type=\"checkbox\" checked={showFieldLines} onChange={e => setShowFieldLines(e.target.checked)} className=\"w-4 h-4 accent-cyan-500\" />\r\n                            <span className=\"font-bold text-cyan-400\">Voir Lignes de champ</span>\r\n                        </label>\r\n                        <div className=\"mt-4 p-3 bg-black/50 rounded-lg text-xs text-gray-400 border border-white/10\">\r\n                            <p className=\"mb-1\"><span className=\"text-yellow-400\">Loi de Coulomb:</span> F = k┬ÀqÔéü┬ÀqÔéé/r┬▓</p>\r\n                            <p><span className=\"text-cyan-400\">Champ:</span> E = F/q (V/m)</p>\r\n                        </div>\r\n                        {phase === 'mission' && <button onClick={checkMission} className=\"w-full mt-4 py-3 bg-orange-600 rounded-xl font-bold hover:bg-orange-500 transition-all text-xs uppercase\">V├ëRIFIER CONFIGURATION</button>}\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n            <SuccessOverlay show={showSuccess} message=\"Champ Ma├«tris├® !\" points={300} onNext={() => { setShowSuccess(false); setMission(null); setPhase('explore'); }} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// ==========================================\r\n// P7-P9: ├ëLECTRONIQUE (Circuit RC)\r\n// ==========================================\r\nexport function ElectroniqueSim() {\r\n    const [mode, setMode] = useState('charge');\r\n    const [R, setR] = useState(1000);\r\n    const [C, setC] = useState(0.001);\r\n    const [time, setTime] = useState(0);\r\n    const [running, setRunning] = useState(false);\r\n    const electronsRef = useRef([]);\r\n    const [phase, setPhase] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n\r\n    const tau = R * C;\r\n    const E = 5;\r\n\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Charge Rapide', objective: 'Obtenez une constante de temps ¤ä < 0.5s.', tauMax: 0.5 },\r\n        { id: 2, title: 'Grande Capacit├®', objective: 'Utilisez C > 4mF et R > 2000╬®.', minC: 0.004, minR: 2000 },\r\n        { id: 3, title: 'D├®charge Totale', objective: 'Passez en mode court-circuit avec une tension nulle.', mode: 'discharge' }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            setMission(missions[Math.floor(Math.random() * missions.length)]);\r\n            setTimeLeft(45);\r\n        }\r\n    }, [phase, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [timeLeft, phase, showSuccess]);\r\n\r\n    const checkMission = () => {\r\n        if (!mission) return;\r\n        let success = false;\r\n        if (mission.id === 1 && tau < mission.tauMax) success = true;\r\n        if (mission.id === 2 && C > mission.minC && R > mission.minR) success = true;\r\n        if (mission.id === 3 && mode === 'discharge' && time > 5 * tau) success = true;\r\n\r\n        if (success) {\r\n            setScore(s => s + 400);\r\n            setShowSuccess(true);\r\n        }\r\n    };\r\n\r\n    // Calculs temps r├®el\r\n    const uC = mode === 'charge' ? E * (1 - Math.exp(-time / tau)) : E * Math.exp(-time / tau);\r\n    const i = mode === 'charge' ? (E / R) * Math.exp(-time / tau) : -(E / R) * Math.exp(-time / tau);\r\n    const q = C * uC; // Charge condensateur\r\n\r\n    useFrame((state, delta) => {\r\n        if (running) {\r\n            setTime(t => t + delta);\r\n        }\r\n\r\n        // Animation ├®lectrons (vitesse proportionnelle au courant i)\r\n        // Courant max = E/R = 5/1000 = 0.005 A. On multiplie pour l'effet visuel.\r\n        const speed = Math.abs(i) * 500;\r\n        const direction = i > 0 ? 1 : -1;\r\n\r\n        electronsRef.current.forEach((el, idx) => {\r\n            if (el) {\r\n                // Circuit rectangulaire simple autour de [0, 2, -2] (Generateur) et [0, -1.5, 2] (Composants)\r\n                // C'est un peu complexe ├á animer parfaitement sur un path.\r\n                // On fait tourner simple : angle += speed\r\n                el.rotation.z += speed * direction * 0.1;\r\n            }\r\n        });\r\n    });\r\n\r\n    const reset = () => { setTime(0); setRunning(true); };\r\n\r\n    return (\r\n        <group>\r\n            <OrbitControls />\r\n            <Grid />\r\n\r\n            {/* Circuit Visuel - Fil Rectangulaire */}\r\n            <group rotation={[Math.PI / 2, 0, 0]}>\r\n                <mesh>\r\n                    <torusGeometry args={[4, 0.1, 16, 100]} />\r\n                    <meshStandardMaterial color=\"gold\" />\r\n                </mesh>\r\n\r\n                {/* Electrons sur l'anneau */}\r\n                <group ref={g => { electronsRef.current[0] = g }}>\r\n                    {Array.from({ length: 12 }).map((_, k) => (\r\n                        <mesh key={k} position={[4 * Math.cos(k * Math.PI / 6), 4 * Math.sin(k * Math.PI / 6), 0]}>\r\n                            <sphereGeometry args={[0.15]} />\r\n                            <meshStandardMaterial color=\"yellow\" emissive=\"yellow\" emissiveIntensity={0.5} />\r\n                        </mesh>\r\n                    ))}\r\n                </group>\r\n            </group>\r\n\r\n            {/* G├®n├®rateur (Haut) */}\r\n            <group position={[0, 4, 0]}>\r\n                <Box args={[2, 1, 1]}><meshStandardMaterial color=\"#333\" /></Box>\r\n                <Text position={[0, 0, 0.6]} fontSize={0.5} color=\"red\">{mode === 'charge' ? 'G├ëN├ëRATEUR' : 'COURT-CIRCUIT'}</Text>\r\n                {mode === 'charge' && <Text position={[0, 0.8, 0]} fontSize={0.4} color=\"yellow\">E = 5V</Text>}\r\n            </group>\r\n\r\n            {/* Condensateur (Bas-Droite) */}\r\n            <group position={[3, -2, 0]}>\r\n                <Cylinder args={[0.5, 0.5, 1]} rotation={[0, 0, Math.PI / 2]}><meshStandardMaterial color=\"#1a1a1a\" /></Cylinder>\r\n                <Text position={[0, -0.8, 0]} fontSize={0.4} color=\"cyan\">C</Text>\r\n                {/* Charge accumul├®e Visualisation */}\r\n                <Text position={[-0.8, 0.8, 0]} fontSize={0.3} color=\"red\" visible={q > 0}>+{q.toFixed(4)}C</Text>\r\n                <Text position={[0.8, 0.8, 0]} fontSize={0.3} color=\"blue\" visible={q > 0}>-{q.toFixed(4)}C</Text>\r\n            </group>\r\n\r\n            {/* R├®sistance (Bas-Gauche) */}\r\n            <group position={[-3, -2, 0]}>\r\n                <Box args={[1.5, 0.6, 0.6]}><meshStandardMaterial color=\"#b5651d\" /></Box>\r\n                <Text position={[0, -0.8, 0]} fontSize={0.4} color=\"orange\">R</Text>\r\n            </group>\r\n\r\n            <Line points={[[-4, 0, 0], [-4, 4, 0], [4, 4, 0], [4, 0, 0]]} color=\"gold\" lineWidth={2} /> {/* Haut */}\r\n            <Line points={[[-4, 0, 0], [-4, -2, 0], [4, -2, 0], [4, 0, 0]]} color=\"gold\" lineWidth={2} /> {/* Bas */}\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒô║ Circuit RC\" className=\"w-[380px] border-cyan-500/30\">\r\n                    <div className=\"text-white\">\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <GradeBadge score={score} />\r\n                            {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={45} />}\r\n                        </div>\r\n                        <XPBar current={score} nextLevel={1000} />\r\n                        <div className=\"h-[1px] bg-gradient-to-r from-transparent via-cyan-500/50 to-transparent my-4\" />\r\n                        <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n                        {phase === 'mission' && mission && <MissionObjective objective={mission.objective} icon=\"­ƒô║\" />}\r\n\r\n                        <div className=\"flex gap-2 mb-4 mt-4\">\r\n                            <button onClick={() => { setMode('charge'); reset(); }} className={`flex-1 py-3 rounded-lg font-bold text-xs uppercase transition-all ${mode === 'charge' ? 'bg-green-500 shadow-lg shadow-green-500/20' : 'bg-gray-700'}`}>Ô¼å´©Å Charger</button>\r\n                            <button onClick={() => { setMode('discharge'); reset(); }} className={`flex-1 py-3 rounded-lg font-bold text-xs uppercase transition-all ${mode === 'discharge' ? 'bg-red-500 shadow-lg shadow-red-500/20' : 'bg-gray-700'}`}>Ô¼ç´©Å D├®charger</button>\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-2 gap-4 mb-4 text-center\">\r\n                            <div className=\"bg-cyan-900/40 p-2 rounded-xl border border-cyan-500/30\">\r\n                                <div className=\"text-[9px] text-cyan-400 uppercase font-bold\">Tension uC</div>\r\n                                <div className=\"text-xl font-bold\">{uC.toFixed(2)} V</div>\r\n                                <div className=\"w-full bg-gray-700 h-1 mt-1 rounded\"><div className=\"bg-cyan-400 h-1 rounded transition-all\" style={{ width: `${(uC / 5) * 100}%` }}></div></div>\r\n                            </div>\r\n                            <div className=\"bg-yellow-900/40 p-2 rounded-xl border border-yellow-500/30\">\r\n                                <div className=\"text-[9px] text-yellow-400 uppercase font-bold\">Courant i</div>\r\n                                <div className=\"text-xl font-bold\">{(i * 1000).toFixed(2)} mA</div>\r\n                                <div className=\"text-[8px] text-gray-400\">Flux ├®lectrons</div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-3 bg-black/30 p-3 rounded-lg border border-white/5\">\r\n                            <div><label className=\"text-xs font-bold text-orange-400\">R = {R} ╬®</label><input type=\"range\" min=\"100\" max=\"5000\" step=\"100\" value={R} onChange={e => { setR(Number(e.target.value)); reset(); }} className=\"w-full accent-orange-500\" /></div>\r\n                            <div><label className=\"text-xs font-bold text-cyan-400\">C = {(C * 1000).toFixed(1)} mF</label><input type=\"range\" min=\"0.1\" max=\"5\" step=\"0.1\" value={C * 1000} onChange={e => { setC(Number(e.target.value) / 1000); reset(); }} className=\"w-full accent-cyan-500\" /></div>\r\n                        </div>\r\n\r\n                        <div className=\"mt-3 text-center\">\r\n                            <span className=\"text-gray-400 text-xs uppercase font-bold\">Constante ¤ä = RC = </span><span className=\"text-xl font-bold text-[#00F5D4]\">{tau.toFixed(2)} s</span>\r\n                        </div>\r\n                        {phase === 'mission' && <button onClick={checkMission} className=\"w-full mt-4 py-3 bg-orange-600 rounded-xl font-bold hover:bg-orange-500 transition-all text-xs uppercase\">V├ëRIFIER MISSION</button>}\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n            <SuccessOverlay show={showSuccess} message=\"Circuit Ma├«tris├® !\" points={400} onNext={() => { setShowSuccess(false); setMission(null); setPhase('explore'); }} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group >\r\n    );\r\n}\r\n\r\n// ==========================================\r\n// P10: ONDES M├ëCANIQUES\r\n// ==========================================\r\nexport function OndesSim() {\r\n    const materialRef = useRef();\r\n    const [freq, setFreq] = useState(3.0);\r\n    const [separation, setSeparation] = useState(0.4);\r\n    const [phase, setPhase] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Basse Fr├®quence', objective: 'R├®glez f < 2Hz pour de longues ondes.', maxF: 2 },\r\n        { id: 2, title: 'Interf├®rence Max', objective: 'Rapprochez les sources (separation < 0.2).', maxSep: 0.2 },\r\n        { id: 3, title: 'Haute Fr├®quence', objective: 'Poussez la fr├®quence au max (> 7Hz).', minF: 7 }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            setMission(missions[Math.floor(Math.random() * missions.length)]);\r\n            setTimeLeft(45);\r\n        }\r\n    }, [phase, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [timeLeft, phase, showSuccess]);\r\n\r\n    const checkMission = () => {\r\n        if (!mission) return;\r\n        let success = false;\r\n        if (mission.id === 1 && freq < mission.maxF) success = true;\r\n        if (mission.id === 2 && separation < mission.maxSep) success = true;\r\n        if (mission.id === 3 && freq > mission.minF) success = true;\r\n\r\n        if (success) {\r\n            setScore(s => s + 300);\r\n            setShowSuccess(true);\r\n        }\r\n    };\r\n\r\n    // Shader am├®lior├® pour interf├®rences\r\n    const WaveShader = useMemo(() => ({\r\n        uniforms: { uTime: { value: 0 }, uFreq: { value: 3.0 }, uSep: { value: 0.4 } },\r\n        vertexShader: `\r\n            varying vec2 vUv; \r\n            uniform float uTime;\r\n            uniform float uFreq;\r\n            uniform float uSep;\r\n            void main() { \r\n                vUv = uv; \r\n                vec3 pos = position;\r\n                \r\n                // Effet de vague sur le mesh (vertex displacement)\r\n                vec2 p = vUv * 2.0 - 1.0;\r\n                float d1 = distance(p, vec2(-uSep, 0.0));\r\n                float d2 = distance(p, vec2(uSep, 0.0));\r\n                float w = sin(d1 * 20.0 - uTime * uFreq * 5.0) + sin(d2 * 20.0 - uTime * uFreq * 5.0);\r\n                pos.z += w * 0.2; // Hauteur vague\r\n\r\n                gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0); \r\n            }\r\n        `,\r\n        fragmentShader: `\r\n            uniform float uTime; \r\n            uniform float uFreq; \r\n            uniform float uSep;\r\n            varying vec2 vUv; \r\n            \r\n            void main() { \r\n                vec2 p = vUv * 2.0 - 1.0; \r\n                float d1 = distance(p, vec2(-uSep, 0.0)); \r\n                float d2 = distance(p, vec2(uSep, 0.0)); \r\n                \r\n                // Onde\r\n                float w = sin(d1 * 20.0 - uTime * uFreq * 5.0) + sin(d2 * 20.0 - uTime * uFreq * 5.0);\r\n                \r\n                // Couleurs bas├®es sur l'amplitude\r\n                float intensity = 0.5 + 0.25 * w;\r\n                vec3 color = mix(vec3(0.0, 0.2, 0.5), vec3(0.0, 0.8, 1.0), intensity);\r\n                \r\n                // Lignes de cr├¬te brillantes\r\n                if (w > 1.8) color = vec3(1.0); \r\n\r\n                gl_FragColor = vec4(color, 0.9); \r\n            }\r\n        `\r\n    }), []);\r\n\r\n    useFrame(({ clock }) => {\r\n        if (materialRef.current) {\r\n            materialRef.current.uniforms.uTime.value = clock.getElapsedTime();\r\n            materialRef.current.uniforms.uFreq.value = freq;\r\n            materialRef.current.uniforms.uSep.value = separation;\r\n        }\r\n    });\r\n\r\n    return (\r\n        <group>\r\n            <OrbitControls />\r\n            <Grid infiniteGrid fadeDistance={50} />\r\n\r\n            {/* Sources ponctuelles */}\r\n            <Sphere position={[-separation * 6, 0.5, 0]} args={[0.2]}><meshStandardMaterial color=\"white\" emissive=\"white\" /></Sphere>\r\n            <Sphere position={[separation * 6, 0.5, 0]} args={[0.2]}><meshStandardMaterial color=\"white\" emissive=\"white\" /></Sphere>\r\n\r\n            {/* Surface de l'eau */}\r\n            <mesh rotation={[-Math.PI / 2, 0, 0]} position={[0, -0.5, 0]}>\r\n                <planeGeometry args={[12, 12, 128, 128]} /> {/* Haute r├®solution pour le displacement */}\r\n                <shaderMaterial ref={materialRef} args={[WaveShader]} transparent side={THREE.DoubleSide} />\r\n            </mesh>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒîè Ondes : Interf├®rences\" className=\"w-[380px] border-blue-500/30\">\r\n                    <div className=\"text-white\">\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <GradeBadge score={score} />\r\n                            {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={45} />}\r\n                        </div>\r\n                        <XPBar current={score} nextLevel={1000} />\r\n                        <div className=\"h-[1px] bg-gradient-to-r from-transparent via-blue-500/50 to-transparent my-4\" />\r\n                        <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n                        {phase === 'mission' && mission && <MissionObjective objective={mission.objective} icon=\"­ƒîè\" />}\r\n\r\n                        <div className=\"space-y-4 mt-4\">\r\n                            <div>\r\n                                <label className=\"flex justify-between text-xs font-bold mb-1\">\r\n                                    <span>Fr├®quence f</span>\r\n                                    <span className=\"text-cyan-400\">{freq} Hz</span>\r\n                                </label>\r\n                                <input type=\"range\" min=\"1\" max=\"8\" step=\"0.1\" value={freq} onChange={e => setFreq(Number(e.target.value))} className=\"w-full accent-cyan-500\" />\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"flex justify-between text-xs font-bold mb-1\">\r\n                                    <span>├ëcartement S1-S2</span>\r\n                                    <span className=\"text-yellow-400\">{(separation * 2).toFixed(1)}</span>\r\n                                </label>\r\n                                <input type=\"range\" min=\"0\" max=\"0.8\" step=\"0.05\" value={separation} onChange={e => setSeparation(Number(e.target.value))} className=\"w-full accent-yellow-500\" />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"mt-4 p-3 bg-black/50 rounded-lg text-xs border border-white/10\">\r\n                            <p className=\"text-gray-300 font-semibold mb-2 uppercase text-[10px]\">L├ëGENDE</p>\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <div className=\"w-2 h-2 bg-white rounded-full\"></div>\r\n                                <span className=\"text-gray-400\">Constructive (Max)</span>\r\n                            </div>\r\n                            <div className=\"flex items-center gap-2 mt-1\">\r\n                                <div className=\"w-2 h-2 bg-blue-900 rounded-full border border-blue-500\"></div>\r\n                                <span className=\"text-gray-400\">Destructive (Min)</span>\r\n                            </div>\r\n                        </div>\r\n                        {phase === 'mission' && <button onClick={checkMission} className=\"w-full mt-4 py-3 bg-orange-600 rounded-xl font-bold hover:bg-orange-500 transition-all text-xs uppercase\">V├ëRIFIER ONDES</button>}\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n            <SuccessOverlay show={showSuccess} message=\"Ondes Ma├«tris├®es !\" points={300} onNext={() => { setShowSuccess(false); setMission(null); setPhase('explore'); }} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group >\r\n    );\r\n}\r\n\r\n// ==========================================\r\n// P11: OPTIQUE (Lentilles)\r\n// ==========================================\r\nexport function OptiqueLentilleSim() {\r\n    const [focalAbs, setFocalAbs] = useState(3);\r\n    const [objPos, setObjPos] = useState(-6);\r\n    const [lensType, setLensType] = useState('converging'); // converging, diverging\r\n    const [phase, setPhase] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Image R├®elle', objective: 'Cr├®ez une image r├®elle (OA\\' > 0) avec une lentille convergente.', type: 'converging', real: true },\r\n        { id: 2, title: 'Loupe (Virtuelle)', objective: 'Placez l\\'objet entre F et O pour une image virtuelle.', type: 'converging', real: false },\r\n        { id: 3, title: 'Divergence', objective: 'Utilisez une lentille divergente.', type: 'diverging' }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            setMission(missions[Math.floor(Math.random() * missions.length)]);\r\n            setTimeLeft(45);\r\n        }\r\n    }, [phase, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [timeLeft, phase, showSuccess]);\r\n\r\n    const checkMission = () => {\r\n        if (!mission) return;\r\n        const f = lensType === 'converging' ? focalAbs : -focalAbs;\r\n        const oaP = (objPos * f) / (objPos + f);\r\n        const virtual = oaP < 0;\r\n\r\n        let success = false;\r\n        if (mission.id === 1 && !virtual && lensType === 'converging') success = true;\r\n        if (mission.id === 2 && virtual && lensType === 'converging') success = true;\r\n        if (mission.id === 3 && lensType === 'diverging') success = true;\r\n\r\n        if (success) {\r\n            setScore(s => s + 300);\r\n            setShowSuccess(true);\r\n        }\r\n    };\r\n\r\n    const f = lensType === 'converging' ? focalAbs : -focalAbs;\r\n    const oa = objPos;\r\n\r\n    // Formule conjugaison : 1/oa' = 1/f + 1/oa\r\n    // oa' = (oa * f) / (oa + f)\r\n    const oaP = (oa * f) / (oa + f);\r\n    const gamma = oaP / oa;\r\n\r\n    const isVirtual = oaP < 0; // Image virtuelle si oa' < 0 (├á gauche) pour objet r├®el\r\n\r\n    const hObj = 2; // Hauteur objet\r\n    const hImg = hObj * gamma;\r\n\r\n    return (\r\n        <group>\r\n            <OrbitControls enableRotate={false} />\r\n            <Grid infiniteGrid fadeDistance={50} />\r\n\r\n            {/* Axe optique */}\r\n            <Line points={[[-15, 0, 0], [15, 0, 0]]} color=\"white\" transparent opacity={0.3} lineWidth={1} />\r\n\r\n            {/* Lentille */}\r\n            <group rotation={[0, 0, Math.PI / 2]}>\r\n                {lensType === 'converging' ? (\r\n                    // Biconvexe\r\n                    <mesh><cylinderGeometry args={[3, 3, 0.2, 32]} /><meshPhysicalMaterial transmission={0.9} roughness={0} color=\"#88CCFF\" /></mesh>\r\n                ) : (\r\n                    // Biconcave (simul├® par cylindre + torus inverse ou juste symbole)\r\n                    <group>\r\n                        <mesh><cylinderGeometry args={[3, 3, 0.1, 32]} /><meshPhysicalMaterial transmission={0.9} roughness={0} color=\"#FFCC88\" /></mesh>\r\n                        <Text position={[0, 3.2, 0]} fontSize={0.5} rotation={[0, 0, -Math.PI / 2]}>)(</Text>\r\n                    </group>\r\n                )}\r\n                {/* Symboles extr├®mit├® */}\r\n                <Text position={[0, 3.5, 0]} fontSize={1} color=\"white\" rotation={[0, 0, -Math.PI / 2]}>{lensType === 'converging' ? 'Ôåæ' : 'Y'}</Text>\r\n                <Text position={[0, -3.5, 0]} fontSize={1} color=\"white\" rotation={[0, 0, -Math.PI / 2]}>{lensType === 'converging' ? 'Ôåô' : 'A'}</Text>\r\n            </group>\r\n\r\n            {/* Foyers */}\r\n            <Sphere args={[0.15]} position={[f, 0, 0]}><meshStandardMaterial color=\"red\" /></Sphere>\r\n            <Text position={[f, -0.5, 0]} fontSize={0.4} color=\"red\">F'</Text>\r\n\r\n            <Sphere args={[0.15]} position={[-f, 0, 0]}><meshStandardMaterial color=\"red\" /></Sphere>\r\n            <Text position={[-f, -0.5, 0]} fontSize={0.4} color=\"red\">F</Text>\r\n\r\n            {/* Objet (Bougie) */}\r\n            <group position={[oa, 0, 0]}>\r\n                <Cylinder args={[0.05, 0.05, hObj]} position={[0, hObj / 2, 0]}><meshStandardMaterial color=\"white\" /></Cylinder>\r\n                <Sphere args={[0.2]} position={[0, hObj, 0]}><meshStandardMaterial color=\"orange\" emissive=\"orange\" emissiveIntensity={1} /></Sphere>\r\n                <Text position={[0, -0.5, 0]} fontSize={0.4} color=\"white\">A</Text>\r\n                <Text position={[0, hObj + 0.3, 0]} fontSize={0.4} color=\"white\">B</Text>\r\n            </group>\r\n\r\n            {/* Image */}\r\n            <group position={[oaP, 0, 0]}>\r\n                <Cylinder args={[0.05, 0.05, Math.abs(hImg)]} position={[0, hImg / 2, 0]}><meshStandardMaterial color={isVirtual ? \"#888\" : \"#00F5D4\"} transparent opacity={isVirtual ? 0.5 : 1} /></Cylinder>\r\n                <Sphere args={[0.2]} position={[0, hImg, 0]}><meshStandardMaterial color={isVirtual ? \"#888\" : \"#00F5D4\"} transparent opacity={isVirtual ? 0.5 : 1} /></Sphere>\r\n                <Text position={[0, -0.5, 0]} fontSize={0.4} color={isVirtual ? \"#888\" : \"#00F5D4\"}>A'</Text>\r\n                <Text position={[0, hImg + (hImg > 0 ? 0.3 : -0.3), 0]} fontSize={0.4} color={isVirtual ? \"#888\" : \"#00F5D4\"}>B'</Text>\r\n            </group>\r\n\r\n            {/* Rayons de construction */}\r\n            {/* 1. Parall├¿le -> F' */}\r\n            <group>\r\n                <Line points={[[oa, hObj, 0], [0, hObj, 0]]} color=\"yellow\" lineWidth={2} /> {/* Incident */}\r\n                <Line points={[[0, hObj, 0], [oaP, hImg, 0]]} color=\"yellow\" lineWidth={2} /> {/* Emergent */}\r\n                {isVirtual && <Line points={[[0, hObj, 0], [oaP, hImg, 0]]} color=\"yellow\" lineWidth={1} dashed dashSize={0.2} gapSize={0.1} />}\r\n                {/* Prolongement si divergent */}\r\n                {lensType === 'diverging' && <Line points={[[f, 0, 0], [0, hObj, 0]]} color=\"yellow\" lineWidth={1} dashed />}\r\n            </group>\r\n\r\n            {/* 2. Centre optique */}\r\n            <Line points={[[oa, hObj, 0], [oaP, hImg, 0]]} color=\"cyan\" lineWidth={2} />\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒö¡ Lentilles Minces\" className=\"w-[380px] border-purple-500/30\">\r\n                    <div className=\"text-white\">\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <GradeBadge score={score} />\r\n                            {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={45} />}\r\n                        </div>\r\n                        <XPBar current={score} nextLevel={1000} />\r\n                        <div className=\"h-[1px] bg-gradient-to-r from-transparent via-purple-500/50 to-transparent my-4\" />\r\n                        <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n                        {phase === 'mission' && mission && <MissionObjective objective={mission.objective} icon=\"­ƒö¡\" />}\r\n\r\n                        <div className=\"flex gap-2 mb-4 mt-4\">\r\n                            <button onClick={() => setLensType('converging')} className={`flex-1 py-1 rounded text-xs uppercase font-bold transition-all ${lensType === 'converging' ? 'bg-blue-600 shadow-lg shadow-blue-600/20' : 'bg-gray-700'}`}>Convergente</button>\r\n                            <button onClick={() => setLensType('diverging')} className={`flex-1 py-1 rounded text-xs uppercase font-bold transition-all ${lensType === 'diverging' ? 'bg-orange-600 shadow-lg shadow-orange-600/20' : 'bg-gray-700'}`}>Divergente</button>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-3\">\r\n                            <div><label className=\"text-xs font-bold text-gray-400 uppercase\">Position Objet OA = {objPos.toFixed(1)} cm</label><input type=\"range\" min=\"-10\" max=\"-2\" step=\"0.1\" value={objPos} onChange={e => setObjPos(Number(e.target.value))} className=\"w-full accent-purple-500\" /></div>\r\n                            <div><label className=\"text-xs font-bold text-gray-400 uppercase\">Focale |f'| = {focalAbs} cm</label><input type=\"range\" min=\"1\" max=\"5\" step=\"0.5\" value={focalAbs} onChange={e => setFocalAbs(Number(e.target.value))} className=\"w-full accent-pink-500\" /></div>\r\n                        </div>\r\n\r\n                        <div className=\"mt-4 grid grid-cols-2 gap-2 text-center text-xs\">\r\n                            <div className=\"bg-gray-800 p-2 rounded border border-gray-700\">\r\n                                <div className=\"text-gray-400\">Grandissement ╬│</div>\r\n                                <div className=\"text-lg font-bold\">{gamma.toFixed(2)}</div>\r\n                            </div>\r\n                            <div className=\"bg-gray-800 p-2 rounded border border-gray-700\">\r\n                                <div className=\"text-gray-400\">Position Image OA'</div>\r\n                                <div className={`text-lg font-bold ${oaP > 0 ? 'text-green-400' : 'text-red-400'}`}>{Math.abs(oaP) > 50 ? 'Ôê×' : oaP.toFixed(1) + ' cm'}</div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className={`mt-2 text-[10px] text-center uppercase font-bold py-1 rounded ${isVirtual ? 'bg-gray-700 text-gray-300' : 'bg-green-900/50 text-green-400'}`}>\r\n                            {isVirtual ? \"Image VIRTUELLE (ne peut ├¬tre projet├®e)\" : \"Image R├ëELLE (peut ├¬tre projet├®e)\"}\r\n                        </div>\r\n                        {phase === 'mission' && <button onClick={checkMission} className=\"w-full mt-4 py-3 bg-orange-600 rounded-xl font-bold hover:bg-orange-500 transition-all text-xs uppercase\">V├ëRIFIER MISSION</button>}\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n            <SuccessOverlay show={showSuccess} message=\"Optique Ma├«tris├®e !\" points={300} onNext={() => { setShowSuccess(false); setMission(null); setPhase('explore'); }} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group >\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\Physique2ndeSimulations.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'success'. Either include it or remove the dependency array.","line":130,"column":8,"nodeType":"ArrayExpression","endLine":130,"endColumn":36,"suggestions":[{"desc":"Update the dependencies array to be: [chargeRod, mode, challenge, success]","fix":{"range":[5251,5279],"text":"[chargeRod, mode, challenge, success]"}}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":222,"column":87,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[11584,11606],"text":"Distance d&apos;interaction"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[11584,11606],"text":"Distance d&lsquo;interaction"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[11584,11606],"text":"Distance d&#39;interaction"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[11584,11606],"text":"Distance d&rsquo;interaction"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":263,"column":134,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[14811,14876],"text":"Choisis les bons mat├®riaux et frotte jusqu&apos;├á atteindre la cible !"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[14811,14876],"text":"Choisis les bons mat├®riaux et frotte jusqu&lsquo;├á atteindre la cible !"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[14811,14876],"text":"Choisis les bons mat├®riaux et frotte jusqu&#39;├á atteindre la cible !"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[14811,14876],"text":"Choisis les bons mat├®riaux et frotte jusqu&rsquo;├á atteindre la cible !"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/jsx-no-comment-textnodes","severity":2,"message":"Comments inside children section of tag should be placed inside braces","line":317,"column":60,"nodeType":"JSXText","messageId":"putCommentInBraces","endLine":318,"endColumn":25},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":716,"column":94,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[39955,39964],"text":"LOI D&apos;OHM"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[39955,39964],"text":"LOI D&lsquo;OHM"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[39955,39964],"text":"LOI D&#39;OHM"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[39955,39964],"text":"LOI D&rsquo;OHM"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":780,"column":113,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[44675,44870],"text":"\r\n                                        Une r├®sistance inconnue est connect├®e. Fais varier la tension, observe l&apos;intensit├®, et d├®duis sa valeur (R = U/I) !\r\n                                    "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[44675,44870],"text":"\r\n                                        Une r├®sistance inconnue est connect├®e. Fais varier la tension, observe l&lsquo;intensit├®, et d├®duis sa valeur (R = U/I) !\r\n                                    "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[44675,44870],"text":"\r\n                                        Une r├®sistance inconnue est connect├®e. Fais varier la tension, observe l&#39;intensit├®, et d├®duis sa valeur (R = U/I) !\r\n                                    "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[44675,44870],"text":"\r\n                                        Une r├®sistance inconnue est connect├®e. Fais varier la tension, observe l&rsquo;intensit├®, et d├®duis sa valeur (R = U/I) !\r\n                                    "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":807,"column":52,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[47098,47197],"text":"\r\n                                        Commencer l&apos;Enqu├¬te\r\n                                    "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[47098,47197],"text":"\r\n                                        Commencer l&lsquo;Enqu├¬te\r\n                                    "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[47098,47197],"text":"\r\n                                        Commencer l&#39;Enqu├¬te\r\n                                    "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[47098,47197],"text":"\r\n                                        Commencer l&rsquo;Enqu├¬te\r\n                                    "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":1268,"column":110,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[71863,71882],"text":"Tension d&apos;Entr├®e Ve"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[71863,71882],"text":"Tension d&lsquo;Entr├®e Ve"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[71863,71882],"text":"Tension d&#39;Entr├®e Ve"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[71863,71882],"text":"Tension d&rsquo;Entr├®e Ve"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"import/no-anonymous-default-export","severity":1,"message":"Assign object to a variable before exporting as module default","line":1367,"column":1,"nodeType":"ExportDefaultDeclaration","endLine":1373,"endColumn":3}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Physique 2nde Simulations - Part 1: ├ëlectricit├® (Chapitres 1-7)\r\n * High-quality 3D simulations for Seconde curriculum\r\n */\r\nimport React, { useState, useRef, useEffect, useMemo } from 'react';\r\nimport { useFrame } from '@react-three/fiber';\r\nimport { Html, Sphere, Box, Cylinder, Line, Text, Float, OrbitControls, useGLTF } from '@react-three/drei';\r\nimport * as THREE from 'three';\r\nimport DraggableHtmlPanel from './DraggableHtmlPanel';\r\nimport { PhaseSelector, GradeBadge, MissionObjective, XPBar, SuccessOverlay, ConfettiExplosion } from './GamificationUtils';\r\n\r\n// Helper for electron visualization\r\nfunction ElectronsStream({ path, count = 20, speed = 1, active = false }) {\r\n    const electrons = useMemo(() => Array.from({ length: count }, () => Math.random()), [count]);\r\n    const refs = useRef([]);\r\n\r\n    useFrame((state) => {\r\n        if (!active) return;\r\n        const time = state.clock.elapsedTime * speed;\r\n        refs.current.forEach((el, i) => {\r\n            if (!el) return;\r\n            // Simple linear interpolation along path for now, or circular\r\n            // Assuming path is just a loop or line. \r\n            // We'll implement specific movements in components.\r\n        });\r\n    });\r\n\r\n    return null; // Implemented inside components for specific paths\r\n}\r\n\r\n// ============================================================\r\n// P1. ├ëLECTRISATION - Ph├®nom├¿nes d'├®lectrisation (ENRICHI)\r\n// ============================================================\r\nexport function ElectrisationSimulation() {\r\n    const [scenario, setScenario] = useState('frottement'); // frottement, contact, influence\r\n    const [material1, setMaterial1] = useState('plastique'); // plastique (PVC), verre\r\n    const [material2, setMaterial2] = useState('laine'); // laine, soie\r\n\r\n    // ├ëtat physique\r\n    const [chargeRod, setChargeRod] = useState(0); // -100 to 100\r\n    const [chargeObject, setChargeObject] = useState(0); // Electroscope or other object\r\n    const [isRubbing, setIsRubbing] = useState(false);\r\n    const [distance, setDistance] = useState(2); // Distance rod-object\r\n\r\n    // Gamification\r\n    const [mode, setMode] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [challenge, setChallenge] = useState(null);\r\n\r\n    const rodRef = useRef();\r\n\r\n    // Propri├®t├®s mat├®riaux (Tribo├®lectrique relative)\r\n    const materials = {\r\n        verre: { name: 'Verre', tendency: 5, color: '#A5F3FC' },\r\n        laine: { name: 'Laine', tendency: 2, color: '#FEF3C7' },\r\n        soie: { name: 'Soie', tendency: -1, color: '#FBCFE8' },\r\n        plastique: { name: 'Plastique (PVC)', tendency: -5, color: '#4ADE80' },\r\n        ebonite: { name: '├ëbonite', tendency: -6, color: '#1F2937' }\r\n    };\r\n\r\n    useFrame((state) => {\r\n        // Frottement Logic\r\n        if (isRubbing && scenario === 'frottement') {\r\n            const t1 = materials[material1].tendency;\r\n            const t2 = materials[material2].tendency;\r\n            const delta = t1 - t2;\r\n\r\n            // On charge progressivement\r\n            if (Math.abs(chargeRod) < 100) {\r\n                setChargeRod(prev => {\r\n                    const sign = delta > 0 ? 1 : -1;\r\n                    return THREE.MathUtils.clamp(prev + sign * 1, -100, 100);\r\n                });\r\n            }\r\n\r\n            // Animation vibration\r\n            if (rodRef.current) {\r\n                rodRef.current.rotation.z = Math.sin(state.clock.elapsedTime * 30) * 0.1;\r\n                rodRef.current.position.y = 2 + Math.cos(state.clock.elapsedTime * 20) * 0.05;\r\n            }\r\n        } else if (rodRef.current) {\r\n            // Retour position repos\r\n            rodRef.current.rotation.z *= 0.9;\r\n            rodRef.current.position.y += (2 - rodRef.current.position.y) * 0.1;\r\n        }\r\n\r\n        // Contact Logic\r\n        if (scenario === 'contact' && distance < 0.8) {\r\n            const total = chargeRod + chargeObject;\r\n            const share = total / 2;\r\n            setChargeRod(prev => prev + (share - prev) * 0.1);\r\n            setChargeObject(prev => prev + (share - prev) * 0.1);\r\n        }\r\n    });\r\n\r\n    const reset = () => {\r\n        setChargeRod(0);\r\n        setChargeObject(0);\r\n        setDistance(2);\r\n        setIsRubbing(false);\r\n    };\r\n\r\n    const startChallenge = () => {\r\n        setMode('challenge');\r\n        setScore(0);\r\n        generateChallenge();\r\n    };\r\n\r\n    const generateChallenge = () => {\r\n        const types = ['negatif', 'positif'];\r\n        const targetType = types[Math.floor(Math.random() * types.length)];\r\n        setChallenge({\r\n            type: targetType,\r\n            desc: `Charge la r├¿gle ${targetType === 'positif' ? 'positivement (+)' : 'n├®gativement (-)'} !`,\r\n            target: targetType === 'positif' ? 50 : -50\r\n        });\r\n        reset();\r\n        setShowSuccess(false);\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (mode === 'challenge' && challenge) {\r\n            if (challenge.type === 'positif' && chargeRod > challenge.target) {\r\n                success();\r\n            } else if (challenge.type === 'negatif' && chargeRod < challenge.target) {\r\n                success();\r\n            }\r\n        }\r\n    }, [chargeRod, mode, challenge]);\r\n\r\n    const success = () => {\r\n        if (!showSuccess) {\r\n            setShowSuccess(true);\r\n            setScore(s => s + 50);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            <SuccessOverlay show={showSuccess} message=\"D├®fi R├®ussi !\" points={50} onNext={generateChallenge} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"ÔÜí Labo ├ëlectrostatique\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[360px] border-blue-500/30 text-white\">\r\n                    {/* MODE SELECTOR */}\r\n                    <div className=\"mb-4\">\r\n                        <PhaseSelector currentPhase={mode} onSelect={setMode} />\r\n                    </div>\r\n\r\n                    {/* HEADER INFO */}\r\n                    <div className=\"flex justify-between items-end mb-4 pb-2 border-b border-white/10\">\r\n                        <div>\r\n                            <div className=\"text-xs text-blue-300 font-bold uppercase tracking-wider mb-1\">Module Physique</div>\r\n                            <div className=\"text-xl font-black text-white leading-none\">├ëLECTRISATION</div>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {mode === 'explore' ? (\r\n                        <>\r\n                            <div className=\"mb-4\">\r\n                                <MissionObjective objective=\"Exp├®rimentez avec les charges ├®lectriques !\" icon=\"­ƒº¬\" />\r\n                            </div>\r\n\r\n                            {/* Sc├®narios */}\r\n                            <div className=\"flex gap-2 mb-4 overflow-x-auto pb-1 no-scrollbar\">\r\n                                {['frottement', 'contact', 'influence'].map(s => (\r\n                                    <button key={s} onClick={() => { setScenario(s); reset(); }}\r\n                                        className={`px-3 py-1 rounded-full text-xs font-bold whitespace-nowrap transition-all ${scenario === s ? 'bg-blue-600 text-white shadow-lg shadow-blue-900/40' : 'bg-gray-800 text-gray-400 hover:bg-gray-700'}`}>\r\n                                        {s.charAt(0).toUpperCase() + s.slice(1)}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n\r\n                            {scenario === 'frottement' && (\r\n                                <div className=\"space-y-3 p-3 bg-gray-900/50 rounded-xl border border-white/5\">\r\n                                    <div className=\"grid grid-cols-2 gap-2\">\r\n                                        <div>\r\n                                            <label className=\"text-xs text-blue-300 font-bold block mb-1\">Objet Mobile</label>\r\n                                            <select value={material1} onChange={e => setMaterial1(e.target.value)}\r\n                                                className=\"w-full bg-gray-800 rounded p-2 text-sm border border-gray-600 focus:border-blue-500 outline-none\">\r\n                                                {Object.keys(materials).map(k => <option key={k} value={k}>{materials[k].name}</option>)}\r\n                                            </select>\r\n                                        </div>\r\n                                        <div>\r\n                                            <label className=\"text-xs text-blue-300 font-bold block mb-1\">Frotteur</label>\r\n                                            <select value={material2} onChange={e => setMaterial2(e.target.value)}\r\n                                                className=\"w-full bg-gray-800 rounded p-2 text-sm border border-gray-600 focus:border-blue-500 outline-none\">\r\n                                                {Object.keys(materials).map(k => <option key={k} value={k}>{materials[k].name}</option>)}\r\n                                            </select>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <button\r\n                                        onMouseDown={() => setIsRubbing(true)}\r\n                                        onMouseUp={() => setIsRubbing(false)}\r\n                                        onMouseLeave={() => setIsRubbing(false)}\r\n                                        className={`w-full py-4 rounded-xl font-black text-lg transition-all transform active:scale-95 relative overflow-hidden group\r\n                                            ${isRubbing ? 'bg-gradient-to-r from-red-600 to-orange-600 shadow-inner' : 'bg-gradient-to-r from-blue-600 to-indigo-600 hover:scale-[1.02] shadow-lg'}`}\r\n                                    >\r\n                                        <span className=\"relative z-10 flex justify-center items-center gap-2\">\r\n                                            {isRubbing ? 'ÔÜí FROTTEMENT...' : 'Ô£ï MAINTENIR POUR FROTTER'}\r\n                                        </span>\r\n                                    </button>\r\n                                </div>\r\n                            )}\r\n\r\n                            {(scenario === 'contact' || scenario === 'influence') && (\r\n                                <div className=\"space-y-3 p-3 bg-gray-900/50 rounded-xl border border-white/5\">\r\n                                    <div className=\"space-y-2\">\r\n                                        <div className=\"flex justify-between text-xs\">\r\n                                            <span className=\"text-gray-400\">Charge initiale</span>\r\n                                            <span className=\"font-mono text-blue-300\">{chargeRod}</span>\r\n                                        </div>\r\n                                        <input type=\"range\" min=\"-100\" max=\"100\" value={chargeRod} onChange={e => setChargeRod(Number(e.target.value))}\r\n                                            className=\"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-500\" />\r\n                                    </div>\r\n\r\n                                    <div className=\"space-y-2\">\r\n                                        <div className=\"flex justify-between text-xs\">\r\n                                            <span className=\"text-gray-400\">Distance d'interaction</span>\r\n                                            <span className=\"font-mono text-green-300\">{distance.toFixed(1)} m</span>\r\n                                        </div>\r\n                                        <input type=\"range\" min=\"0.5\" max=\"4\" step=\"0.1\" value={distance} onChange={e => setDistance(Number(e.target.value))}\r\n                                            className=\"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-green-500\" />\r\n                                    </div>\r\n\r\n                                    <div className=\"text-xs text-center p-2 bg-blue-900/20 rounded text-blue-200\">\r\n                                        {scenario === 'contact' ? \"Approche pour toucher et transf├®rer la charge.\" : \"Approche pour voir la polarisation (sans toucher).\"}\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n\r\n                            {/* JAUGE DE CHARGE */}\r\n                            <div className=\"mt-4 p-3 bg-black/40 rounded-lg border border-white/10\">\r\n                                <div className=\"flex justify-between items-center mb-2\">\r\n                                    <div className=\"text-xs font-bold text-gray-300\">├ëTAT DE CHARGE</div>\r\n                                    <div className={`text-xs font-bold ${chargeRod !== 0 ? (chargeRod > 0 ? 'text-red-400' : 'text-blue-400') : 'text-gray-500'}`}>\r\n                                        {chargeRod > 0 ? 'POSITIF (+)' : chargeRod < 0 ? 'N├ëGATIF (-)' : 'NEUTRE'}\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"h-3 bg-gray-800 rounded-full overflow-hidden relative\">\r\n                                    <div className=\"absolute top-0 bottom-0 left-1/2 w-0.5 bg-white/30 z-10\"></div>\r\n                                    <div className={`absolute top-0 bottom-0 transition-all duration-300 ${chargeRod > 0 ? 'bg-red-500 left-1/2' : 'bg-blue-500 right-1/2'}`}\r\n                                        style={{ width: `${Math.abs(chargeRod) / 2}%` }} />\r\n                                </div>\r\n                            </div>\r\n                        </>\r\n                    ) : (\r\n                        <div className=\"bg-gray-900/50 p-4 rounded-xl border border-purple-500/30\">\r\n                            <div className=\"flex justify-between items-center mb-6\">\r\n                                <h3 className=\"text-purple-300 font-bold flex items-center gap-2\">\r\n                                    <span>­ƒºá</span> D├®fi ├ëlectrique\r\n                                </h3>\r\n                                <XPBar current={score} nextLevel={100} />\r\n                            </div>\r\n\r\n                            {challenge ? (\r\n                                <div className=\"space-y-4 animate-in slide-in-from-right duration-300\">\r\n                                    <div className=\"text-sm font-medium bg-black/20 p-4 rounded-lg border-l-2 border-purple-500\">\r\n                                        {challenge.desc}\r\n                                        <div className=\"text-xs text-gray-400 mt-2 italic\">Choisis les bons mat├®riaux et frotte jusqu'├á atteindre la cible !</div>\r\n                                    </div>\r\n\r\n                                    <div className=\"grid grid-cols-2 gap-2\">\r\n                                        <div className=\"p-2 bg-gray-800 rounded text-center\">\r\n                                            <div className=\"text-xs text-gray-500\">Actuel</div>\r\n                                            <div className={`font-bold ${chargeRod > 0 ? 'text-red-400' : 'text-blue-400'}`}>{Math.round(chargeRod)}</div>\r\n                                        </div>\r\n                                        <div className=\"p-2 bg-gray-800 rounded text-center\">\r\n                                            <div className=\"text-xs text-gray-500\">Cible</div>\r\n                                            <div className=\"font-bold text-white\">{challenge.target}</div>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"text-center py-8\">\r\n                                    <button onClick={startChallenge} className=\"px-6 py-3 bg-purple-600 hover:bg-purple-500 text-white rounded-full font-bold shadow-lg shadow-purple-900/20 transition-all transform hover:scale-105\">\r\n                                        Lancer le D├®fi\r\n                                    </button>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            {/* SC├êNE 3D -inchang├®e sauf refs- */}\r\n            <group>\r\n                <group ref={rodRef} position={[-1, 2, 0]} rotation={[0, 0, -Math.PI / 6]}>\r\n                    <Box args={[4, 0.3, 0.3]}>\r\n                        <meshStandardMaterial color={materials[material1]?.color || 'white'} />\r\n                    </Box>\r\n                    {Math.abs(chargeRod) > 10 && (\r\n                        <group>\r\n                            {Array.from({ length: Math.floor(Math.abs(chargeRod) / 10) }).map((_, i) => (\r\n                                <Text key={i} position={[-1.5 + i * 0.3, 0.3, 0]} fontSize={0.2} color={chargeRod > 0 ? '#EF4444' : '#3B82F6'}>\r\n                                    {chargeRod > 0 ? '+' : '-'}\r\n                                </Text>\r\n                            ))}\r\n                            <pointLight color={chargeRod > 0 ? '#EF4444' : '#3B82F6'} intensity={Math.abs(chargeRod) / 50} distance={2} />\r\n                        </group>\r\n                    )}\r\n                </group>\r\n\r\n                {scenario === 'frottement' && (\r\n                    <group position={[1, 1.5, 0]}>\r\n                        <Box args={[2, 2, 0.5]}>\r\n                            <meshStandardMaterial color={materials[material2]?.color || 'gray'} roughness={1} />\r\n                        </Box>\r\n                        {isRubbing && <Text position={[0, 1.2, 0]} fontSize={0.3} color=\"yellow\">FROTTEMENT !</Text>}\r\n                    </group>\r\n                )}\r\n\r\n                {(scenario === 'contact' || scenario === 'influence') && (\r\n                    <group position={[distance - 1, 2, 0]}> /* Position relative */\r\n                        <Sphere args={[0.5]} position={[0, 0, 0]}>\r\n                            <meshStandardMaterial color=\"#9CA3AF\" metalness={0.9} roughness={0.1} />\r\n                        </Sphere>\r\n                        <Cylinder args={[0.1, 0.1, 2]} position={[0, -1.2, 0]}>\r\n                            <meshStandardMaterial color=\"#6B7280\" />\r\n                        </Cylinder>\r\n                        <group position={[0, -2.2, 0]}>\r\n                            <Box args={[0.05, 1, 0.4]} position={[-0.2, -0.4, 0]} rotation={[0, 0, Math.min(1.5, Math.abs(chargeObject) / 50 + (scenario === 'influence' && distance < 2 ? Math.abs(chargeRod) / (distance * 20) : 0))]}>\r\n                                <meshStandardMaterial color=\"gold\" />\r\n                            </Box>\r\n                            <Box args={[0.05, 1, 0.4]} position={[0.2, -0.4, 0]} rotation={[0, 0, -Math.min(1.5, Math.abs(chargeObject) / 50 + (scenario === 'influence' && distance < 2 ? Math.abs(chargeRod) / (distance * 20) : 0))]}>\r\n                                <meshStandardMaterial color=\"gold\" />\r\n                            </Box>\r\n                        </group>\r\n                        {Math.abs(chargeObject) > 5 && (\r\n                            <Text position={[0, 0.7, 0]} fontSize={0.3} color={chargeObject > 0 ? '#EF4444' : '#3B82F6'}>\r\n                                {chargeObject > 0 ? '+++' : '---'}\r\n                            </Text>\r\n                        )}\r\n                        {scenario === 'influence' && distance < 2 && Math.abs(chargeRod) > 20 && (\r\n                            <group>\r\n                                <Text position={[-0.6, 0.3, 0]} fontSize={0.2} color={chargeRod > 0 ? '#3B82F6' : '#EF4444'}>\r\n                                    {chargeRod > 0 ? '-' : '+'}\r\n                                </Text>\r\n                                <Text position={[0.6, 0.3, 0]} fontSize={0.2} color={chargeRod > 0 ? '#EF4444' : '#3B82F6'}>\r\n                                    {chargeRod > 0 ? '+' : '-'}\r\n                                </Text>\r\n                            </group>\r\n                        )}\r\n                    </group>\r\n                )}\r\n            </group>\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// P2-P4. CIRCUIT ├ëLECTRIQUE - Tension et Intensit├®\r\n// ============================================================\r\n// ============================================================\r\n// P2-P4. CIRCUIT ├ëLECTRIQUE - Tension et Intensit├® (ENRICHI)\r\n// ============================================================\r\nexport function CircuitElectriqueSeconde() {\r\n    const [voltage, setVoltage] = useState(6);\r\n    const [resistance, setResistance] = useState(100);\r\n    const [circuitClosed, setCircuitClosed] = useState(true);\r\n    const [components, setComponents] = useState(['R', 'L']); // R: Resistance, L: Lampe\r\n\r\n    // Gamification\r\n    const [mode, setMode] = useState('explore');\r\n    const [targetCurrent, setTargetCurrent] = useState(null);\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n\r\n    // Physics Calc\r\n    const R_lamp = 50; // Ohms (approximatif)\r\n    const R_total = (components.includes('R') ? resistance : 0) + (components.includes('L') ? R_lamp : 0);\r\n    const current = circuitClosed && R_total > 0 ? (voltage / R_total) * 1000 : 0; // mA\r\n\r\n    const electronRefs = useRef([]);\r\n\r\n    useFrame((state) => {\r\n        if (circuitClosed && electronRefs.current.length > 0) {\r\n            const speed = current / 500;\r\n            electronRefs.current.forEach((electron) => {\r\n                if (electron) {\r\n                    electron.position.x += speed * 0.1;\r\n                    if (electron.position.x > 3) electron.position.x = -3;\r\n                }\r\n            });\r\n        }\r\n    });\r\n\r\n    const startChallenge = () => {\r\n        setMode('challenge');\r\n        setTargetCurrent(Math.floor(Math.random() * 50 + 10)); // 10-60mA\r\n        setScore(0);\r\n        setShowSuccess(false);\r\n    };\r\n\r\n    const checkChallenge = () => {\r\n        if (!targetCurrent) return;\r\n        if (Math.abs(current - targetCurrent) < 2) { // Tolerance 2mA\r\n            setShowSuccess(true);\r\n            setScore(s => s + 50);\r\n        }\r\n    };\r\n\r\n    // Electrons visualization\r\n    const electrons = useMemo(() => {\r\n        return Array.from({ length: 20 }, (_, i) => ({\r\n            x: -3 + (i * 0.3),\r\n            y: 0,\r\n            z: 0\r\n        }));\r\n    }, []);\r\n\r\n    return (\r\n        <group>\r\n            <SuccessOverlay show={showSuccess} message={`Bravo ! I = ${current.toFixed(1)} mA`} points={50} onNext={startChallenge} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            {/* Components 3D */}\r\n            <group position={[-3, 0, 0]}>\r\n                <Cylinder args={[0.3, 0.3, 1, 16]} rotation={[0, 0, Math.PI / 2]}>\r\n                    <meshStandardMaterial color=\"#333\" />\r\n                </Cylinder>\r\n                <Text position={[0, 0.8, 0]} fontSize={0.25} color=\"white\">{voltage}V</Text>\r\n            </group>\r\n\r\n            {/* Circuit Loop Visualization */}\r\n            <group>\r\n                <Line points={[[-2.5, 0, 0], [2.5, 0, 0]]} color={circuitClosed ? \"#FFFF00\" : \"#555\"} lineWidth={3} position={[0, 1, 0]} />\r\n                <Line points={[[-2.5, 0, 0], [2.5, 0, 0]]} color={circuitClosed ? \"#FFFF00\" : \"#555\"} lineWidth={3} position={[0, -1, 0]} />\r\n                <Line points={[[-2.5, 1, 0], [-2.5, -1, 0]]} color={circuitClosed ? \"#FFFF00\" : \"#555\"} lineWidth={3} />\r\n                <Line points={[[2.5, 1, 0], [2.5, -1, 0]]} color={circuitClosed ? \"#FFFF00\" : \"#555\"} lineWidth={3} />\r\n            </group>\r\n\r\n            {/* Composants ins├®r├®s */}\r\n            {components.includes('R') && (\r\n                <group position={[0, 1, 0]}>\r\n                    <Box args={[1, 0.4, 0.4]} material-color=\"#8D6E63\" />\r\n                    <Text position={[0, 0.5, 0]} fontSize={0.2} color=\"white\">{resistance} ╬®</Text>\r\n                </group>\r\n            )}\r\n\r\n            {components.includes('L') && (\r\n                <group position={[0, -1, 0]}>\r\n                    <Sphere args={[0.4]} material-color={circuitClosed ? \"#FFFF00\" : \"#444\"}\r\n                        material-emissive={circuitClosed ? \"#FFFF00\" : \"black\"}\r\n                        material-emissiveIntensity={current / 50} />\r\n                    <Text position={[0, -0.6, 0]} fontSize={0.2} color=\"white\">Lampe</Text>\r\n                </group>\r\n            )}\r\n\r\n            {/* Electrons Flow */}\r\n            {circuitClosed && electrons.map((e, i) => (\r\n                <Sphere\r\n                    key={i}\r\n                    ref={el => electronRefs.current[i] = el}\r\n                    args={[0.08]}\r\n                    position={[e.x, 1, 0]}\r\n                >\r\n                    <meshStandardMaterial color=\"#00FFFF\" emissive=\"#00FFFF\" />\r\n                </Sphere>\r\n            ))}\r\n\r\n            {/* Interrupteur */}\r\n            <group position={[2.5, 0, 0]} onClick={() => setCircuitClosed(!circuitClosed)} onPointerOver={() => document.body.style.cursor = 'pointer'} onPointerOut={() => document.body.style.cursor = 'auto'}>\r\n                <Box args={[0.5, 0.5, 0.5]} material-color={circuitClosed ? \"green\" : \"red\"} />\r\n                <Text position={[0.5, 0, 0]} fontSize={0.2}>I/O</Text>\r\n            </group>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒöî Circuits ├ëlectriques\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[380px] border-yellow-500/30 text-white\">\r\n                    {/* MODE SELECTOR */}\r\n                    <div className=\"mb-4\">\r\n                        <PhaseSelector currentPhase={mode} onSelect={setMode} />\r\n                    </div>\r\n\r\n                    {/* HEADER INFO */}\r\n                    <div className=\"flex justify-between items-end mb-4 pb-2 border-b border-white/10\">\r\n                        <div>\r\n                            <div className=\"text-xs text-yellow-500 font-bold uppercase tracking-wider mb-1\">Module Physique</div>\r\n                            <div className=\"text-xl font-black text-white leading-none\">CIRCUITS</div>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {mode === 'explore' ? (\r\n                        <>\r\n                            <div className=\"mb-4\">\r\n                                <MissionObjective objective=\"Ma├«trisez la tension et l'intensit├® !\" icon=\"­ƒÆí\" />\r\n                            </div>\r\n\r\n                            <div className=\"space-y-4 p-3 bg-gray-900/50 rounded-xl border border-white/5\">\r\n                                <div className=\"bg-gray-800 p-3 rounded-lg\">\r\n                                    <label className=\"text-xs text-yellow-400 font-bold block mb-1\">G├®n├®rateur (Tension)</label>\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <input type=\"range\" min=\"1\" max=\"12\" step=\"0.5\" value={voltage} onChange={e => setVoltage(Number(e.target.value))}\r\n                                            className=\"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-yellow-500\" />\r\n                                        <div className=\"w-16 text-right font-mono text-yellow-400 font-bold\">{voltage} V</div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {components.includes('R') && (\r\n                                    <div className=\"bg-gray-800 p-3 rounded-lg\">\r\n                                        <label className=\"text-xs text-orange-400 font-bold block mb-1\">R├®sistance</label>\r\n                                        <div className=\"flex items-center gap-3\">\r\n                                            <input type=\"range\" min=\"10\" max=\"500\" step=\"10\" value={resistance} onChange={e => setResistance(Number(e.target.value))}\r\n                                                className=\"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-orange-500\" />\r\n                                            <div className=\"w-16 text-right font-mono text-orange-400 font-bold\">{resistance} ╬®</div>\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n\r\n                                <div className=\"flex gap-2\">\r\n                                    <button onClick={() => setCircuitClosed(!circuitClosed)}\r\n                                        className={`flex-1 py-3 rounded-lg font-black text-sm transition-all transform active:scale-95 shadow-lg ${circuitClosed ? 'bg-green-600 hover:bg-green-500 text-white shadow-green-900/30' : 'bg-red-600 hover:bg-red-500 text-white shadow-red-900/30'}`}>\r\n                                        {circuitClosed ? 'CIRCUIT FERM├ë (ON)' : 'CIRCUIT OUVERT (OFF)'}\r\n                                    </button>\r\n                                </div>\r\n\r\n                                <div className=\"bg-black/40 p-3 rounded-lg font-mono text-sm border-l-4 border-blue-500 flex justify-between items-center\">\r\n                                    <div className=\"text-gray-400\">Intensit├® (I)</div>\r\n                                    <div className=\"text-2xl font-bold text-blue-400\">{current.toFixed(1)} <span className=\"text-sm\">mA</span></div>\r\n                                </div>\r\n                            </div>\r\n                        </>\r\n                    ) : (\r\n                        <div className=\"bg-gray-900/50 p-4 rounded-xl border border-orange-500/30\">\r\n                            <div className=\"flex justify-between items-center mb-6\">\r\n                                <h3 className=\"text-orange-300 font-bold flex items-center gap-2\">\r\n                                    <span>­ƒºá</span> Mission Ing├®nieur\r\n                                </h3>\r\n                                <XPBar current={score} nextLevel={100} />\r\n                            </div>\r\n\r\n                            {targetCurrent ? (\r\n                                <div className=\"space-y-4 animate-in slide-in-from-right duration-300\">\r\n                                    <div className=\"bg-black/30 p-4 rounded-lg border border-orange-500/30 text-center\">\r\n                                        <div className=\"text-gray-400 text-xs uppercase tracking-widest mb-2\">CIBLE ├Ç ATTEINDRE</div>\r\n                                        <div className=\"text-4xl font-black text-orange-500 mb-1\">{targetCurrent} mA</div>\r\n                                        <div className=\"text-xs text-gray-500\">Ajuste la tension et la r├®sistance pour obtenir cette intensit├® !</div>\r\n                                    </div>\r\n\r\n                                    <div className=\"space-y-4\">\r\n                                        <div className=\"bg-gray-800 p-2 rounded-lg\">\r\n                                            <label className=\"text-xs text-yellow-400 block mb-1\">G├®n├®rateur</label>\r\n                                            <input type=\"range\" min=\"1\" max=\"12\" step=\"0.5\" value={voltage} onChange={e => setVoltage(Number(e.target.value))} className=\"w-full accent-yellow-500\" />\r\n                                        </div>\r\n\r\n                                        <div className=\"bg-gray-800 p-2 rounded-lg\">\r\n                                            <label className=\"text-xs text-orange-400 block mb-1\">R├®sistance</label>\r\n                                            <input type=\"range\" min=\"10\" max=\"500\" step=\"10\" value={resistance} onChange={e => setResistance(Number(e.target.value))} className=\"w-full accent-orange-500\" />\r\n                                        </div>\r\n\r\n                                        <div className=\"flex justify-between items-center bg-black/40 p-2 rounded\">\r\n                                            <span className=\"text-gray-400 text-xs\">Actuel :</span>\r\n                                            <span className={`font-mono font-bold ${Math.abs(current - targetCurrent) < 2 ? 'text-green-500' : 'text-white'}`}>{current.toFixed(1)} mA</span>\r\n                                        </div>\r\n\r\n                                        <button onClick={checkChallenge}\r\n                                            className=\"w-full py-3 bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-500 hover:to-red-500 rounded-lg font-bold text-white shadow-lg shadow-orange-900/20 transform transition-all hover:scale-[1.02]\">\r\n                                            V├®rifier le Circuit\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"text-center py-8\">\r\n                                    <button onClick={startChallenge} className=\"px-8 py-3 bg-orange-600 hover:bg-orange-500 text-white rounded-full font-bold shadow-lg shadow-orange-900/20 transition-all transform hover:scale-105\">\r\n                                        Recevoir ma Mission\r\n                                    </button>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// P5. LOI D'OHM - Caract├®ristique Tension-Intensit├®\r\n// ============================================================\r\n// ============================================================\r\n// P5. LOI D'OHM - Caract├®ristique Tension-Intensit├® (ENRICHI)\r\n// ============================================================\r\nexport function LoiOhmSeconde() {\r\n    const [voltage, setVoltage] = useState(0);\r\n    const [resistance, setResistance] = useState(100);\r\n    const [dataPoints, setDataPoints] = useState([]);\r\n    const [showGraph, setShowGraph] = useState(true);\r\n\r\n    // Gamification\r\n    const [mode, setMode] = useState('explore'); // explore, challenge\r\n    const [mysteryR, setMysteryR] = useState(null);\r\n    const [guessR, setGuessR] = useState('');\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n\r\n    // Physics\r\n    const activeR = mode === 'challenge' && mysteryR ? mysteryR : resistance;\r\n    const current = activeR > 0 ? voltage / activeR : 0; // Amps\r\n    const currentmA = current * 1000;\r\n\r\n    const addDataPoint = () => {\r\n        if (voltage > 0) {\r\n            setDataPoints(prev => [...prev, { U: voltage, I: currentmA }]);\r\n        }\r\n    };\r\n\r\n    const clearData = () => {\r\n        setDataPoints([]);\r\n    };\r\n\r\n    const startChallenge = () => {\r\n        const secret = Math.floor(Math.random() * 40 + 10) * 10; // 100 to 500\r\n        setMysteryR(secret);\r\n        setMode('challenge');\r\n        setVoltage(0);\r\n        setDataPoints([]);\r\n        setShowSuccess(false);\r\n        setGuessR('');\r\n    };\r\n\r\n    const checkAnswer = () => {\r\n        if (!mysteryR) return;\r\n        // 5% tolerance\r\n        if (Math.abs(Number(guessR) - mysteryR) / mysteryR < 0.1) {\r\n            setShowSuccess(true);\r\n            setScore(s => s + 100);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            <SuccessOverlay show={showSuccess} message={`Bravo ! R ├®tait bien ${mysteryR} ╬®`} points={100} onNext={startChallenge} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            {/* Resistor visualization */}\r\n            <group position={[0, 0, 0]}>\r\n                <Box args={[2, 0.5, 0.5]}>\r\n                    <meshStandardMaterial color={mode === 'challenge' ? \"#333\" : \"#795548\"} />\r\n                </Box>\r\n                {/* Resistance color bands - Hidden in challenge */}\r\n                {mode === 'explore' && [0, 1, 2, 3].map((i) => (\r\n                    <Box key={i} args={[0.12, 0.55, 0.55]} position={[-0.7 + i * 0.35, 0, 0]}>\r\n                        <meshStandardMaterial color={['#9c27b0', '#000', '#795548', '#ffc107'][i]} />\r\n                    </Box>\r\n                ))}\r\n                {mode === 'challenge' && (\r\n                    <Text position={[0, 0, 0.3]} fontSize={0.2} color=\"white\">?</Text>\r\n                )}\r\n            </group>\r\n\r\n            {/* Circuit wiring */}\r\n            <group>\r\n                <Line points={[[-3, 0, 0], [-1, 0, 0]]} color=\"#f44336\" lineWidth={4} />\r\n                <Line points={[[1, 0, 0], [3, 0, 0]]} color=\"#2196f3\" lineWidth={4} />\r\n            </group>\r\n\r\n            {/* Measurements Arrows */}\r\n            <group position={[0, 1, 0]}>\r\n                <Line points={[[-1, 0, 0], [1, 0, 0]]} color=\"#ff9800\" lineWidth={2} />\r\n                <Text position={[0, 0.3, 0]} fontSize={0.25} color=\"#ff9800\">\r\n                    U = {voltage.toFixed(1)} V\r\n                </Text>\r\n            </group>\r\n\r\n            <group position={[0, -1, 0]}>\r\n                <Text position={[0, 0, 0]} fontSize={0.25} color=\"#4fc3f7\">\r\n                    I = {currentmA.toFixed(1)} mA\r\n                </Text>\r\n                <mesh position={[0, 0.4, 0]} rotation={[0, 0, Math.PI / 2]}>\r\n                    <coneGeometry args={[0.1, 0.2, 32]} />\r\n                    <meshBasicMaterial color=\"#4fc3f7\" />\r\n                </mesh>\r\n            </group>\r\n\r\n            {/* Live 3D Graph */}\r\n            {showGraph && (\r\n                <group position={[0, 2.5, -3]} scale={1.5}>\r\n                    <Text position={[0, 1.8, 0]} fontSize={0.2} color=\"white\">Caract├®ristique U = f(I)</Text>\r\n                    {/* Axes */}\r\n                    <Line points={[[-1.5, -1, 0], [1.5, -1, 0]]} color=\"#fff\" lineWidth={2} />\r\n                    <Line points={[[-1.5, -1, 0], [-1.5, 1.5, 0]]} color=\"#fff\" lineWidth={2} />\r\n                    <Text position={[1.6, -1.1, 0]} fontSize={0.15} color=\"#fff\">I (mA)</Text>\r\n                    <Text position={[-1.6, 1.5, 0]} fontSize={0.15} color=\"#fff\">U (V)</Text>\r\n\r\n                    {/* Plot Points */}\r\n                    {dataPoints.map((point, i) => {\r\n                        const x = -1.5 + (point.I / 200) * 3;\r\n                        const y = -1 + (point.U / 12) * 2.5;\r\n                        return (\r\n                            <Sphere key={i} args={[0.05]} position={[Math.min(x, 1.5), Math.min(y, 1.5), 0]}>\r\n                                <meshStandardMaterial color=\"#4caf50\" emissive=\"#4caf50\" />\r\n                            </Sphere>\r\n                        );\r\n                    })}\r\n\r\n                    {/* Current Live Point */}\r\n                    <Sphere args={[0.07]} position={[-1.5 + (currentmA / 200) * 3, -1 + (voltage / 12) * 2.5, 0]}>\r\n                        <meshStandardMaterial color=\"yellow\" emissive=\"yellow\" />\r\n                    </Sphere>\r\n                </group>\r\n            )}\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒôê Loi d'Ohm\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[380px] border-purple-500/30 text-white\">\r\n                    <div className=\"mb-4\">\r\n                        <PhaseSelector currentPhase={mode} onSelect={setMode} />\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-between items-end mb-4 pb-2 border-b border-white/10\">\r\n                        <div>\r\n                            <div className=\"text-xs text-purple-400 font-bold uppercase tracking-wider mb-1\">Module Physique</div>\r\n                            <div className=\"text-xl font-black text-white leading-none\">LOI D'OHM</div>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {mode === 'explore' ? (\r\n                        <>\r\n                            <MissionObjective objective=\"Tracez la caract├®ristique U=f(I) !\" icon=\"­ƒôê\" />\r\n\r\n                            <div className=\"space-y-4 p-3 bg-gray-900/50 rounded-xl border border-white/5\">\r\n                                <div className=\"bg-gray-800 p-3 rounded-lg\">\r\n                                    <label className=\"text-xs text-purple-400 font-bold block mb-1\">Source de Tension (U)</label>\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <input type=\"range\" min=\"0\" max=\"12\" step=\"0.1\" value={voltage} onChange={e => setVoltage(Number(e.target.value))}\r\n                                            className=\"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-500\" />\r\n                                        <div className=\"w-16 text-right font-mono text-purple-400 font-bold\">{voltage.toFixed(1)} V</div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"bg-gray-800 p-3 rounded-lg\">\r\n                                    <label className=\"text-xs text-orange-400 font-bold block mb-1\">R├®sistance (R)</label>\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <input type=\"range\" min=\"50\" max=\"500\" step=\"10\" value={resistance} onChange={e => setResistance(Number(e.target.value))}\r\n                                            className=\"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-orange-500\" />\r\n                                        <div className=\"w-16 text-right font-mono text-orange-400 font-bold\">{resistance} ╬®</div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"grid grid-cols-2 gap-2\">\r\n                                    <button onClick={addDataPoint} className=\"py-2 bg-blue-600 hover:bg-blue-500 rounded-lg font-bold text-xs shadow-lg shadow-blue-900/40\">\r\n                                        + Mesure (U, I)\r\n                                    </button>\r\n                                    <button onClick={clearData} className=\"py-2 bg-gray-700 hover:bg-gray-600 rounded-lg font-bold text-xs\">\r\n                                        Effacer Points\r\n                                    </button>\r\n                                </div>\r\n                                <button onClick={() => setShowGraph(!showGraph)} className={`w-full py-2 rounded-lg font-bold text-xs transition-all ${showGraph ? 'bg-green-600/20 text-green-400 border border-green-500/50' : 'bg-gray-800 text-gray-400'}`}>\r\n                                    {showGraph ? 'Graphe Visible' : 'Afficher Graphe'}\r\n                                </button>\r\n\r\n                                <div className=\"bg-black/40 p-2 rounded-lg font-mono text-xs border-l-4 border-yellow-500\">\r\n                                    <div className=\"flex justify-between\">\r\n                                        <span>Points mesur├®s : {dataPoints.length}</span>\r\n                                        {dataPoints.length > 1 && (\r\n                                            <span className=\"text-yellow-400\">\r\n                                                R Ôëê {(dataPoints[dataPoints.length - 1].U / (dataPoints[dataPoints.length - 1].I / 1000)).toFixed(0)} ╬®\r\n                                            </span>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </>\r\n                    ) : (\r\n                        <div className=\"bg-gray-900/50 p-4 rounded-xl border border-pink-500/30\">\r\n                            <div className=\"flex justify-between items-center mb-6\">\r\n                                <h3 className=\"text-pink-300 font-bold flex items-center gap-2\">\r\n                                    <span>­ƒòÁ´©Å</span> R├®sistance Myst├¿re\r\n                                </h3>\r\n                                <XPBar current={score} nextLevel={100} />\r\n                            </div>\r\n\r\n                            {mysteryR ? (\r\n                                <div className=\"space-y-4 animate-in slide-in-from-right duration-300\">\r\n                                    <div className=\"text-sm bg-black/30 p-3 rounded-lg border-l-2 border-pink-500 text-gray-300\">\r\n                                        Une r├®sistance inconnue est connect├®e. Fais varier la tension, observe l'intensit├®, et d├®duis sa valeur (R = U/I) !\r\n                                    </div>\r\n\r\n                                    <div className=\"bg-gray-800 p-3 rounded-lg\">\r\n                                        <label className=\"text-xs text-purple-400 font-bold block mb-1\">Voltage (U)</label>\r\n                                        <input type=\"range\" min=\"0\" max=\"12\" step=\"0.5\" value={voltage} onChange={e => setVoltage(Number(e.target.value))}\r\n                                            className=\"w-full accent-purple-500\" />\r\n                                        <div className=\"flex justify-between text-xs mt-2 font-mono\">\r\n                                            <span className=\"text-purple-400\">U = {voltage.toFixed(1)} V</span>\r\n                                            <span className=\"text-blue-400\">I = {currentmA.toFixed(1)} mA</span>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"space-y-2\">\r\n                                        <label className=\"text-xs text-pink-300 font-bold block\">Ta r├®ponse (en ╬®) :</label>\r\n                                        <div className=\"flex gap-2\">\r\n                                            <input type=\"number\" value={guessR} onChange={e => setGuessR(e.target.value)}\r\n                                                className=\"w-full bg-gray-900 border border-pink-500 rounded-lg px-3 py-2 text-white outline-none focus:ring-2 focus:ring-pink-500\" placeholder=\"ex: 200\" />\r\n                                            <button onClick={checkAnswer} className=\"px-4 bg-pink-600 hover:bg-pink-500 rounded-lg font-bold text-white shadow-lg shadow-pink-900/30\">\r\n                                                Valider\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"text-center py-8\">\r\n                                    <button onClick={startChallenge} className=\"px-8 py-3 bg-pink-600 hover:bg-pink-500 text-white rounded-full font-bold shadow-lg shadow-pink-900/20 transition-all transform hover:scale-105\">\r\n                                        Commencer l'Enqu├¬te\r\n                                    </button>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// P6. DIP├öLES ACTIFS - G├®n├®rateur avec f.├®.m et r├®sistance interne\r\n// ============================================================\r\n// ============================================================\r\n// P6. DIP├öLES ACTIFS - G├®n├®rateur avec f.├®.m et r├®sistance interne (ENRICHI)\r\n// ============================================================\r\nexport function GenerateurSeconde() {\r\n    const [fem, setFem] = useState(9); // Force ├®lectromotrice\r\n    const [rInterne, setRInterne] = useState(2); // R├®sistance interne\r\n    const [rExterne, setRExterne] = useState(50); // R├®sistance externe\r\n\r\n    // Gamification\r\n    const [mode, setMode] = useState('explore');\r\n    const [mysteryParams, setMysteryParams] = useState(null); // {E, r}\r\n    const [guessE, setGuessE] = useState('');\r\n    const [guessr, setGuessr] = useState('');\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n\r\n    // Physics\r\n    const activeE = mode === 'challenge' && mysteryParams ? mysteryParams.E : fem;\r\n    const active_r = mode === 'challenge' && mysteryParams ? mysteryParams.r : rInterne;\r\n\r\n    const iTot = activeE / (active_r + rExterne);\r\n    const uBornes = activeE - active_r * iTot;\r\n    const pUtile = uBornes * iTot;\r\n    const pPerdue = active_r * iTot * iTot;\r\n    const rendement = pUtile > 0 ? (pUtile / (pUtile + pPerdue)) * 100 : 0;\r\n\r\n    // Heat Color Interpolation\r\n    const heatLevel = Math.min(pPerdue / 20, 1); // 0 to 1\r\n    const batteryColor = new THREE.Color('#333333').lerp(new THREE.Color('#FF4500'), heatLevel);\r\n\r\n    const startChallenge = () => {\r\n        setMode('challenge');\r\n        setMysteryParams({\r\n            E: Math.floor(Math.random() * 8 + 4), // 4 to 12 V\r\n            r: Math.floor(Math.random() * 5 + 1) // 1 to 6 Ohm\r\n        });\r\n        setRExterne(50);\r\n        setGuessE('');\r\n        setGuessr('');\r\n        setShowSuccess(false);\r\n    };\r\n\r\n    const checkAnswer = () => {\r\n        if (!mysteryParams) return;\r\n        const correctE = Math.abs(Number(guessE) - mysteryParams.E) < 0.5;\r\n        const correctr = Math.abs(Number(guessr) - mysteryParams.r) < 0.5;\r\n\r\n        if (correctE && correctr) {\r\n            setShowSuccess(true);\r\n            setScore(s => s + 100);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            <SuccessOverlay show={showSuccess} message={`Expert Batterie ! E=${mysteryParams?.E}V, r=${mysteryParams?.r}╬®`} points={100} onNext={startChallenge} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            {/* Battery representation */}\r\n            <group position={[-2, 0, 0]}>\r\n                <Box args={[1.5, 2, 1]}>\r\n                    <meshStandardMaterial color={batteryColor} emissive={heatLevel > 0.5 ? \"#FF0000\" : \"black\"} emissiveIntensity={heatLevel} />\r\n                </Box>\r\n                {/* Positive terminal */}\r\n                <Cylinder args={[0.15, 0.15, 0.3, 16]} position={[0, 1.15, 0]}>\r\n                    <meshStandardMaterial color=\"#f44336\" />\r\n                </Cylinder>\r\n\r\n                {/* Internal visuals (schematic overlay) */}\r\n                <group position={[0, 0, 0.51]}>\r\n                    <Box args={[1.2, 1.8, 0.01]}>\r\n                        <meshBasicMaterial color=\"black\" opacity={0.5} transparent />\r\n                    </Box>\r\n                    <Text position={[0, 0.5, 0.05]} fontSize={0.2} color=\"#4caf50\">\r\n                        {mode === 'challenge' ? 'E = ?' : `E = ${fem}V`}\r\n                    </Text>\r\n                    <Box args={[0.6, 0.2, 0.05]} position={[0, 0, 0.05]} material-color=\"#ff9800\" />\r\n                    <Text position={[0, 0, 0.1]} fontSize={0.15} color=\"white\">\r\n                        {mode === 'challenge' ? 'r = ?' : `r = ${rInterne}╬®`}\r\n                    </Text>\r\n                </group>\r\n\r\n                {heatLevel > 0.3 && (\r\n                    <Text position={[0, 1.5, 0]} fontSize={0.25} color=\"red\">\r\n                        CHAUFFE ! {Math.round(pPerdue)}W\r\n                    </Text>\r\n                )}\r\n            </group>\r\n\r\n            {/* External circuit Wires */}\r\n            <Line\r\n                points={[[-1.2, 1, 0], [2, 1, 0], [2, -1, 0], [-1.2, -1, 0]]}\r\n                color={heatLevel > 0.8 ? \"#FF4500\" : \"#ffc107\"}\r\n                lineWidth={3 + iTot * 5}\r\n            />\r\n\r\n            {/* External Load */}\r\n            <group position={[2, 0, 0]}>\r\n                <Box args={[0.8, 1.5, 0.8]}>\r\n                    <meshStandardMaterial color=\"#795548\" />\r\n                </Box>\r\n                <Text position={[0, 0, 0.5]} fontSize={0.2} color=\"#fff\">\r\n                    R = {rExterne}╬®\r\n                </Text>\r\n                {/* Load Heating/Active Effect */}\r\n                <pointLight position={[0, 0, 1]} intensity={pUtile} color=\"yellow\" distance={2} />\r\n            </group>\r\n\r\n            {/* Voltage at terminals Meter */}\r\n            <group position={[0, 1.5, 0]}>\r\n                <Cylinder args={[0.4, 0.4, 0.1, 32]} rotation={[Math.PI / 2, 0, 0]}>\r\n                    <meshStandardMaterial color=\"#1976d2\" />\r\n                </Cylinder>\r\n                <Text position={[0, 0, 0.1]} fontSize={0.15} color=\"white\">VOLTM├êTRE</Text>\r\n                <Text position={[0, -0.5, 0]} fontSize={0.3} color=\"#2196f3\">\r\n                    U = {uBornes.toFixed(2)} V\r\n                </Text>\r\n            </group>\r\n\r\n            {/* Current Meter */}\r\n            <group position={[0, -1.5, 0]}>\r\n                <Cylinder args={[0.4, 0.4, 0.1, 32]} rotation={[Math.PI / 2, 0, 0]}>\r\n                    <meshStandardMaterial color=\"#388e3c\" />\r\n                </Cylinder>\r\n                <Text position={[0, 0, 0.1]} fontSize={0.15} color=\"white\">AMP├êREM├êTRE</Text>\r\n                <Text position={[0, 0.5, 0]} fontSize={0.3} color=\"#4caf50\">\r\n                    I = {(iTot).toFixed(2)} A\r\n                </Text>\r\n            </group>\r\n\r\n            {/* Operation Point Graph on the side (in 3D space) */}\r\n            <group position={[4, 0, -2]} scale={0.8}>\r\n                <Text position={[0, 2.5, 0]} fontSize={0.3} color=\"white\">U = E - r.I</Text>\r\n                {/* Axes */}\r\n                <Line points={[[0, 0, 0], [3, 0, 0]]} color=\"white\" lineWidth={2} />\r\n                <Line points={[[0, 0, 0], [0, 2.5, 0]]} color=\"white\" lineWidth={2} />\r\n                <Text position={[3.2, 0, 0]} fontSize={0.2} color=\"white\">I</Text>\r\n                <Text position={[0, 2.7, 0]} fontSize={0.2} color=\"white\">U</Text>\r\n\r\n                {/* The theoretical line */}\r\n                {mode === 'explore' && (\r\n                    <Line\r\n                        points={[[0, fem / 6, 0], [3, (fem - rInterne * (3 * 2)) / 6, 0]]}\r\n                        color=\"gray\"\r\n                        dashed\r\n                        lineWidth={1}\r\n                    />\r\n                )}\r\n\r\n                {/* Current Operating Point */}\r\n                <Sphere args={[0.1]} position={[iTot / 2, uBornes / 6, 0]}>\r\n                    <meshStandardMaterial color=\"cyan\" emissive=\"cyan\" />\r\n                </Sphere>\r\n                <Line points={[[iTot / 2, 0, 0], [iTot / 2, uBornes / 6, 0]]} color=\"gray\" dashed />\r\n                <Line points={[[0, uBornes / 6, 0], [iTot / 2, uBornes / 6, 0]]} color=\"gray\" dashed />\r\n            </group>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒöï G├®n├®rateur R├®el\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[380px] border-green-500/30 text-white\">\r\n                    <div className=\"mb-4\">\r\n                        <PhaseSelector currentPhase={mode} onSelect={setMode} />\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-between items-end mb-4 pb-2 border-b border-white/10\">\r\n                        <div>\r\n                            <div className=\"text-xs text-green-400 font-bold uppercase tracking-wider mb-1\">Module Physique</div>\r\n                            <div className=\"text-xl font-black text-white leading-none\">G├ëN├ëRATEUR</div>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {mode === 'explore' ? (\r\n                        <>\r\n                            <MissionObjective objective=\"Visualisez l'effet de la r├®sistance interne !\" icon=\"­ƒöï\" />\r\n                            <div className=\"space-y-4 p-3 bg-gray-900/50 rounded-xl border border-white/5\">\r\n                                <div className=\"bg-gray-800 p-3 rounded-lg border-l-4 border-green-500\">\r\n                                    <div className=\"font-bold text-sm mb-2 text-gray-300\">Caract├®ristiques (Source)</div>\r\n                                    <div className=\"grid grid-cols-2 gap-2\">\r\n                                        <div>\r\n                                            <label className=\"text-[10px] text-gray-400 font-bold\">Force ├ëlectromotrice E (V)</label>\r\n                                            <input type=\"number\" value={fem} onChange={(e) => setFem(Number(e.target.value))}\r\n                                                className=\"w-full bg-gray-900 border border-gray-600 rounded px-2 py-1 text-sm focus:border-green-500 outline-none\" />\r\n                                        </div>\r\n                                        <div>\r\n                                            <label className=\"text-[10px] text-gray-400 font-bold\">R├®sistance Interne r (╬®)</label>\r\n                                            <input type=\"number\" value={rInterne} onChange={(e) => setRInterne(Number(e.target.value))}\r\n                                                className=\"w-full bg-gray-900 border border-gray-600 rounded px-2 py-1 text-sm focus:border-green-500 outline-none\" />\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"bg-gray-800 p-3 rounded-lg border-l-4 border-orange-500\">\r\n                                    <label className=\"text-xs text-orange-400 block mb-1 font-bold\">Charge Externe R (╬®)</label>\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <input type=\"range\" min=\"0\" max=\"100\" step=\"1\" value={rExterne} onChange={e => setRExterne(Number(e.target.value))}\r\n                                            className=\"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-orange-500\" />\r\n                                        <div className=\"w-16 text-right font-mono text-orange-400 font-bold\">{rExterne} ╬®</div>\r\n                                    </div>\r\n                                    <div className=\"mt-1 text-xs text-center text-gray-500\">0╬® = Court-Circuit</div>\r\n                                </div>\r\n\r\n                                <div className=\"grid grid-cols-2 gap-2 text-xs\">\r\n                                    <div className=\"bg-blue-900/30 p-2 rounded text-center\">\r\n                                        <div className=\"text-blue-200 mb-1\">Puissance Utile</div>\r\n                                        <div className=\"text-lg font-bold text-blue-300\">{(pUtile).toFixed(2)} W</div>\r\n                                    </div>\r\n                                    <div className=\"bg-red-900/30 p-2 rounded text-center\">\r\n                                        <div className=\"text-red-200 mb-1\">Pertes (Joule)</div>\r\n                                        <div className=\"text-lg font-bold text-red-300\">{(pPerdue).toFixed(2)} W</div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {rendement > 0 && (\r\n                                    <div className=\"text-center text-xs\">\r\n                                        <span className=\"text-gray-400\">Rendement :</span>\r\n                                        <span className={`font-bold ml-1 ${rendement < 50 ? 'text-red-400' : 'text-green-400'}`}>{rendement.toFixed(1)}%</span>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </>\r\n                    ) : (\r\n                        <div className=\"bg-gray-900/50 p-4 rounded-xl border border-green-500/30\">\r\n                            <div className=\"flex justify-between items-center mb-6\">\r\n                                <h3 className=\"text-green-300 font-bold flex items-center gap-2\">\r\n                                    <span>ÔÜÖ´©Å</span> Diagnostic Expert\r\n                                </h3>\r\n                                <XPBar current={score} nextLevel={100} />\r\n                            </div>\r\n\r\n                            {mysteryParams ? (\r\n                                <div className=\"space-y-4 animate-in slide-in-from-right duration-300\">\r\n                                    <div className=\"text-sm bg-black/30 p-3 rounded-lg border-l-2 border-green-500 text-gray-300\">\r\n                                        Ce g├®n├®rateur est d├®fectueux (valeurs inconnues). <br />\r\n                                        Fais varier la charge R, rel├¿ve U et I. <br />\r\n                                        Rappel : U = E - r.I  (donc E = U ├á vide)\r\n                                    </div>\r\n\r\n                                    <div className=\"bg-gray-800 p-3 rounded-lg\">\r\n                                        <label className=\"text-xs text-orange-400 font-bold block mb-1\">Charge Externe R</label>\r\n                                        <input type=\"range\" min=\"0\" max=\"100\" step=\"1\" value={rExterne} onChange={e => setRExterne(Number(e.target.value))}\r\n                                            className=\"w-full accent-orange-500\" />\r\n                                        <div className=\"flex justify-between text-xs mt-2 font-mono\">\r\n                                            <span className=\"text-blue-400\">U = {uBornes.toFixed(2)} V</span>\r\n                                            <span className=\"text-green-400\">I = {iTot.toFixed(2)} A</span>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"grid grid-cols-2 gap-2\">\r\n                                        <div>\r\n                                            <label className=\"text-xs text-green-300 font-bold block\">E (Volts) ?</label>\r\n                                            <input type=\"number\" value={guessE} onChange={e => setGuessE(e.target.value)}\r\n                                                className=\"w-full bg-gray-900 border border-green-500 rounded px-2 py-1 text-white\" />\r\n                                        </div>\r\n                                        <div>\r\n                                            <label className=\"text-xs text-green-300 font-bold block\">r (Ohms) ?</label>\r\n                                            <input type=\"number\" value={guessr} onChange={e => setGuessr(e.target.value)}\r\n                                                className=\"w-full bg-gray-900 border border-green-500 rounded px-2 py-1 text-white\" />\r\n                                        </div>\r\n                                    </div>\r\n                                    <button onClick={checkAnswer} className=\"w-full py-2 bg-green-600 hover:bg-green-500 rounded-lg font-bold text-white shadow-lg shadow-green-900/30\">\r\n                                        Valider le Diagnostic\r\n                                    </button>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"text-center py-8\">\r\n                                    <button onClick={startChallenge} className=\"px-8 py-3 bg-green-600 hover:bg-green-500 text-white rounded-full font-bold shadow-lg shadow-green-900/20 transition-all transform hover:scale-105\">\r\n                                        Diagnostiquer\r\n                                    </button>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// P7. AMPLIFICATEUR OP├ëRATIONNEL (AOP) - ID├ëAL ET R├ëEL\r\n// ============================================================\r\n// ============================================================\r\n// P7. AMPLIFICATEUR OP├ëRATIONNEL (AOP) - ID├ëAL ET R├ëEL (ENRICHI)\r\n// ============================================================\r\nexport function AOPSimulation() {\r\n    const [aopMode, setAopMode] = useState('inverter');\r\n    const [ve, setVe] = useState(1); // Input voltage\r\n    const [r1, setR1] = useState(1000); // 1k\r\n    const [r2, setR2] = useState(2000); // 2k for Gain 2\r\n    const [vsat, setVsat] = useState(15);\r\n\r\n    // Gamification\r\n    const [mode, setMode] = useState('explore'); // explore, challenge\r\n    const [targetGain, setTargetGain] = useState(null);\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n\r\n    // Calculation\r\n    let vs = 0;\r\n    let gain = 0;\r\n\r\n    // Logic based on aopMode\r\n    if (aopMode === 'inverter') {\r\n        gain = -r2 / r1;\r\n        vs = gain * ve;\r\n    } else if (aopMode === 'non-inverter') {\r\n        gain = 1 + (r2 / r1);\r\n        vs = gain * ve;\r\n    } else if (aopMode === 'follower') {\r\n        gain = 1;\r\n        vs = ve;\r\n    } else if (aopMode === 'comparator') {\r\n        vs = ve > 0 ? vsat : -vsat;\r\n        gain = null;\r\n    }\r\n\r\n    // Saturation check\r\n    const isSaturated = Math.abs(vs) > vsat;\r\n    if (isSaturated) vs = Math.sign(vs) * vsat;\r\n\r\n    const startChallenge = () => {\r\n        setMode('challenge');\r\n        setAopMode('inverter');\r\n        const targets = [-2, -5, -10, 2, 5, 11];\r\n        setTargetGain(targets[Math.floor(Math.random() * targets.length)]);\r\n        setScore(0);\r\n        setShowSuccess(false);\r\n        setR1(1000);\r\n        setR2(1000);\r\n    };\r\n\r\n    const checkChallenge = () => {\r\n        if (!targetGain || gain === null) return;\r\n        if (Math.abs(gain - targetGain) < 0.1) {\r\n            setShowSuccess(true);\r\n            setScore(s => s + 100);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            <SuccessOverlay show={showSuccess} message={`Excellent ! Gain de ${targetGain} obtenu.`} points={100} onNext={startChallenge} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            {/* Chip Representation (DIP8) */}\r\n            <group position={[0, 0, 0]}>\r\n                <Box args={[1.5, 0.4, 1]} position={[0, 0, 0]}>\r\n                    <meshStandardMaterial color=\"#1f2937\" />\r\n                </Box>\r\n                <Text position={[0, 0.21, 0]} fontSize={0.15} color=\"white\" rotation={[-Math.PI / 2, 0, 0]}>LM741</Text>\r\n\r\n                {/* Legs */}\r\n                {[-0.6, -0.2, 0.2, 0.6].map(x => (\r\n                    <group key={x}>\r\n                        <Box args={[0.1, 0.4, 0.1]} position={[x, 0, 0.6]} material-color=\"#9ca3af\" />\r\n                        <Box args={[0.1, 0.4, 0.1]} position={[x, 0, -0.6]} material-color=\"#9ca3af\" />\r\n                    </group>\r\n                ))}\r\n            </group>\r\n\r\n            {/* Circuit Visualization based on aopMode */}\r\n            <group position={[0, 1.5, 0]}>\r\n                <Text position={[0, 0, 0]} fontSize={0.3} color=\"#4fc3f7\">\r\n                    {aopMode === 'inverter' && \"Montage Inverseur\"}\r\n                    {aopMode === 'non-inverter' && \"Montage Non-Inverseur\"}\r\n                    {aopMode === 'follower' && \"Suiveur de Tension\"}\r\n                    {aopMode === 'comparator' && \"Comparateur\"}\r\n                </Text>\r\n            </group>\r\n\r\n            {/* Oscilloscope View (Simplified) */}\r\n            <group position={[3.5, 0, 0]} scale={0.7}>\r\n                <Box args={[4, 3, 0.2]} material-color=\"#111\" />\r\n                <Text position={[-1.5, 1.2, 0.2]} fontSize={0.2} color=\"#aaa\">OSCILLOSCOPE</Text>\r\n\r\n                {/* Screen Grid */}\r\n                <Line points={[[-1.8, 0, 0.2], [1.8, 0, 0.2]]} color=\"#333\" />\r\n                <Line points={[[0, -1.3, 0.2], [0, 1.3, 0.2]]} color=\"#333\" />\r\n\r\n                {/* Input Signal Trace (Yellow) */}\r\n                <Line\r\n                    points={[[-1.8, ve / 10, 0.2], [1.8, ve / 10, 0.2]]} // DC simplified\r\n                    color=\"#ffeb3b\"\r\n                    lineWidth={2}\r\n                />\r\n                <Text position={[-1.7, Math.min(1.2, (ve / 10) + 0.2), 0.2]} fontSize={0.15} color=\"#ffeb3b\">Ve</Text>\r\n\r\n                {/* Output Signal Trace (Blue) */}\r\n                <Line\r\n                    points={[[-1.8, vs / 10, 0.2], [1.8, vs / 10, 0.2]]} // DC simplified\r\n                    color=\"#2196f3\"\r\n                    lineWidth={3}\r\n                />\r\n                <Text position={[1.7, Math.min(1.2, (vs / 10) + 0.2), 0.2]} fontSize={0.15} color=\"#2196f3\">Vs</Text>\r\n\r\n                {isSaturated && (\r\n                    <Text position={[0, -1.2, 0.2]} fontSize={0.2} color=\"red\">SATURATION !</Text>\r\n                )}\r\n            </group>\r\n\r\n            {/* Schematic Wires (Dynamic) */}\r\n            <group position={[-3, 0, 0]}>\r\n                {/* Input */}\r\n                <Text position={[-1, 0.5, 0]} fontSize={0.2} color=\"white\">Ve = {ve}V</Text>\r\n\r\n                {/* Resistors */}\r\n                {aopMode !== 'follower' && aopMode !== 'comparator' && (\r\n                    <>\r\n                        <Box args={[1, 0.3, 0.3]} position={[0, 1, 0]} material-color=\"#795548\" />\r\n                        <Text position={[0, 1.3, 0]} fontSize={0.15} color=\"white\">R2 = {r2}╬®</Text>\r\n\r\n                        <Box args={[1, 0.3, 0.3]} position={[0, -1, 0]} material-color=\"#795548\" />\r\n                        <Text position={[0, -0.7, 0]} fontSize={0.15} color=\"white\">R1 = {r1}╬®</Text>\r\n                    </>\r\n                )}\r\n            </group>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒÄø´©Å Amplificateur Op├®rationnel\" showCloseButton={false} defaultPosition=\"bottom-center\" className=\"w-[400px] border-blue-500/30 text-white\">\r\n                    <div className=\"mb-4\">\r\n                        <PhaseSelector currentPhase={mode} onSelect={setMode} />\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-between items-end mb-4 pb-2 border-b border-white/10\">\r\n                        <div>\r\n                            <div className=\"text-xs text-blue-400 font-bold uppercase tracking-wider mb-1\">Module ├ëlectronique</div>\r\n                            <div className=\"text-xl font-black text-white leading-none\">A.O.P.</div>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {mode === 'explore' ? (\r\n                        <>\r\n                            <MissionObjective objective=\"Explorez les diff├®rents montages de l'AOP !\" icon=\"­ƒÄø´©Å\" />\r\n\r\n                            <div className=\"flex gap-2 mb-4 overflow-x-auto pb-2 no-scrollbar\">\r\n                                {['inverter', 'non-inverter', 'follower', 'comparator'].map(m => (\r\n                                    <button key={m} onClick={() => setAopMode(m)}\r\n                                        className={`px-3 py-1 rounded-full text-[10px] font-bold whitespace-nowrap transition-all border ${aopMode === m ? 'bg-blue-600 text-white border-blue-400 shadow-lg' : 'bg-gray-800 text-gray-400 border-gray-700 hover:bg-gray-700'}`}>\r\n                                        {m === 'inverter' ? \"Inverseur\" : m === 'non-inverter' ? \"Non-Inverseur\" : m === 'follower' ? \"Suiveur\" : \"Comparateur\"}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n\r\n                            <div className=\"space-y-4 p-3 bg-gray-900/50 rounded-xl border border-white/5\">\r\n                                <div className=\"bg-gray-800 p-3 rounded-lg\">\r\n                                    <label className=\"text-xs text-yellow-400 font-bold block mb-1\">Tension d'Entr├®e Ve</label>\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <input type=\"range\" min=\"-5\" max=\"5\" step=\"0.1\" value={ve} onChange={e => setVe(Number(e.target.value))}\r\n                                            className=\"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-yellow-500\" />\r\n                                        <div className=\"w-16 text-right font-mono text-yellow-400 font-bold\">{ve} V</div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {(aopMode === 'inverter' || aopMode === 'non-inverter') && (\r\n                                    <div className=\"grid grid-cols-2 gap-3\">\r\n                                        <div className=\"bg-gray-800 p-2 rounded-lg\">\r\n                                            <label className=\"text-[10px] text-gray-400 block mb-1\">R1 (Entr├®e)</label>\r\n                                            <input type=\"number\" value={r1} onChange={e => setR1(Number(e.target.value))}\r\n                                                className=\"w-full bg-gray-900 border border-gray-600 rounded px-2 py-1 text-xs outline-none focus:border-blue-500\" />\r\n                                        </div>\r\n                                        <div className=\"bg-gray-800 p-2 rounded-lg\">\r\n                                            <label className=\"text-[10px] text-gray-400 block mb-1\">R2 (Contre-r├®action)</label>\r\n                                            <input type=\"number\" value={r2} onChange={e => setR2(Number(e.target.value))}\r\n                                                className=\"w-full bg-gray-900 border border-gray-600 rounded px-2 py-1 text-xs outline-none focus:border-blue-500\" />\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n\r\n                                <div className=\"bg-black/40 p-3 rounded-lg font-mono text-sm border-l-4 border-blue-500\">\r\n                                    <div className=\"flex justify-between items-center mb-1\">\r\n                                        <span className=\"text-gray-400\">Gain (G)</span>\r\n                                        <span className=\"font-bold text-white\">{gain !== null ? gain.toFixed(2) : 'N/A'}</span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between items-center\">\r\n                                        <span className=\"text-gray-400\">Sortie (Vs)</span>\r\n                                        <span className={`font-bold ${isSaturated ? 'text-red-500 animate-pulse' : 'text-blue-400'}`}>\r\n                                            {vs.toFixed(2)} V\r\n                                            {isSaturated && <span className=\"ml-2 text-[10px] uppercase bg-red-900/50 px-1 rounded\">Sat</span>}\r\n                                        </span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </>\r\n                    ) : (\r\n                        <div className=\"bg-gray-900/50 p-4 rounded-xl border border-blue-500/30\">\r\n                            <div className=\"flex justify-between items-center mb-6\">\r\n                                <h3 className=\"text-blue-300 font-bold flex items-center gap-2\">\r\n                                    <span>­ƒÄ»</span> Ma├«tre du Gain\r\n                                </h3>\r\n                                <XPBar current={score} nextLevel={100} />\r\n                            </div>\r\n\r\n                            {targetGain ? (\r\n                                <div className=\"space-y-4 animate-in slide-in-from-right duration-300\">\r\n                                    <div className=\"bg-black/30 p-4 rounded-lg border border-blue-500/30 text-center\">\r\n                                        <div className=\"text-gray-400 text-xs uppercase tracking-widest mb-2\">OBJECTIF</div>\r\n                                        <div className=\"text-4xl font-black text-blue-500 mb-1\">G = {targetGain}</div>\r\n                                        <div className=\"text-xs text-gray-500\">Ajuste R1 et R2 pour obtenir ce gain !</div>\r\n                                    </div>\r\n\r\n                                    <div className=\"flex gap-2 justify-center mb-2\">\r\n                                        <button onClick={() => setAopMode('inverter')} className={`px-3 py-1 text-xs rounded-full ${aopMode === 'inverter' ? 'bg-blue-600' : 'bg-gray-700'}`}>Inverseur</button>\r\n                                        <button onClick={() => setAopMode('non-inverter')} className={`px-3 py-1 text-xs rounded-full ${aopMode === 'non-inverter' ? 'bg-blue-600' : 'bg-gray-700'}`}>Non-Inverseur</button>\r\n                                    </div>\r\n\r\n                                    <div className=\"grid grid-cols-2 gap-3\">\r\n                                        <div className=\"bg-gray-800 p-2 rounded-lg\">\r\n                                            <label className=\"text-[10px] text-gray-400 block mb-1\">R1</label>\r\n                                            <input type=\"range\" min=\"100\" max=\"10000\" step=\"100\" value={r1} onChange={e => setR1(Number(e.target.value))} className=\"w-full accent-blue-500\" />\r\n                                            <div className=\"text-right text-[10px] font-mono\">{r1} ╬®</div>\r\n                                        </div>\r\n                                        <div className=\"bg-gray-800 p-2 rounded-lg\">\r\n                                            <label className=\"text-[10px] text-gray-400 block mb-1\">R2</label>\r\n                                            <input type=\"range\" min=\"100\" max=\"10000\" step=\"100\" value={r2} onChange={e => setR2(Number(e.target.value))} className=\"w-full accent-blue-500\" />\r\n                                            <div className=\"text-right text-[10px] font-mono\">{r2} ╬®</div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"bg-black/40 p-2 rounded text-center\">\r\n                                        <div className=\"text-xs text-gray-400\">Gain Actuel</div>\r\n                                        <div className={`text-xl font-bold ${Math.abs(gain - targetGain) < 0.1 ? 'text-green-500' : 'text-white'}`}>\r\n                                            {gain ? gain.toFixed(2) : '??'}\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <button onClick={checkChallenge} className=\"w-full py-2 bg-blue-600 hover:bg-blue-500 rounded-lg font-bold text-white shadow-lg shadow-blue-900/30\">\r\n                                        V├®rifier\r\n                                    </button>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"text-center py-8\">\r\n                                    <button onClick={startChallenge} className=\"px-8 py-3 bg-blue-600 hover:bg-blue-500 text-white rounded-full font-bold shadow-lg shadow-blue-900/20 transition-all transform hover:scale-105\">\r\n                                        D├®marrer le D├®fi\r\n                                    </button>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n        </group>\r\n    );\r\n}\r\n\r\nexport default {\r\n    ElectrisationSimulation,\r\n    CircuitElectriqueSeconde,\r\n    LoiOhmSeconde,\r\n    GenerateurSeconde,\r\n    AOPSimulation\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\Physique2ndeSimulationsPart2.js","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":705,"column":92,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[38984,39147],"text":"\r\n                                        Ajuste FÔéâ (Bleu) pour annuler FÔéü et FÔéé et r├®ussir l&apos;├®quilibre (point central Vert).\r\n                                    "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[38984,39147],"text":"\r\n                                        Ajuste FÔéâ (Bleu) pour annuler FÔéü et FÔéé et r├®ussir l&lsquo;├®quilibre (point central Vert).\r\n                                    "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[38984,39147],"text":"\r\n                                        Ajuste FÔéâ (Bleu) pour annuler FÔéü et FÔéé et r├®ussir l&#39;├®quilibre (point central Vert).\r\n                                    "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[38984,39147],"text":"\r\n                                        Ajuste FÔéâ (Bleu) pour annuler FÔéü et FÔéé et r├®ussir l&rsquo;├®quilibre (point central Vert).\r\n                                    "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":734,"column":51,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[41276,41376],"text":"\r\n                                        V├®rifier l&apos;├ëquilibre\r\n                                    "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[41276,41376],"text":"\r\n                                        V├®rifier l&lsquo;├ëquilibre\r\n                                    "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[41276,41376],"text":"\r\n                                        V├®rifier l&#39;├ëquilibre\r\n                                    "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[41276,41376],"text":"\r\n                                        V├®rifier l&rsquo;├ëquilibre\r\n                                    "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":961,"column":51,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[53909,54009],"text":"\r\n                                        V├®rifier l&apos;├ëquilibre\r\n                                    "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[53909,54009],"text":"\r\n                                        V├®rifier l&lsquo;├ëquilibre\r\n                                    "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[53909,54009],"text":"\r\n                                        V├®rifier l&#39;├ëquilibre\r\n                                    "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[53909,54009],"text":"\r\n                                        V├®rifier l&rsquo;├ëquilibre\r\n                                    "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"import/no-anonymous-default-export","severity":1,"message":"Assign object to a variable before exporting as module default","line":979,"column":1,"nodeType":"ExportDefaultDeclaration","endLine":984,"endColumn":3}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Physique 2nde Simulations - Part 2: M├®canique (Chapitres 8-12)\r\n * High-quality 3D simulations for Seconde curriculum\r\n */\r\nimport React, { useState, useRef, useEffect, useMemo } from 'react';\r\n\r\nimport { useFrame } from '@react-three/fiber';\r\nimport { Html, Sphere, Box, Cylinder, Line, Text, Cone } from '@react-three/drei';\r\nimport * as THREE from 'three';\r\nimport DraggableHtmlPanel from './DraggableHtmlPanel';\r\nimport { PhaseSelector, GradeBadge, MissionObjective, XPBar, SuccessOverlay, ConfettiExplosion } from './GamificationUtils';\r\n\r\n// ============================================================\r\n// P8. G├ëN├ëRALIT├ëS SUR LE MOUVEMENT - R├®f├®rentiel et Trajectoire\r\n// ============================================================\r\n// ============================================================\r\n// P8. G├ëN├ëRALIT├ëS SUR LE MOUVEMENT - R├®f├®rentiel et Trajectoire (ENRICHI)\r\n// ============================================================\r\nexport function MouvementSeconde() {\r\n    const [isPlaying, setIsPlaying] = useState(false);\r\n    const [time, setTime] = useState(0);\r\n    const [vitesse, setVitesse] = useState(2);\r\n    const [showTrajectory, setShowTrajectory] = useState(true);\r\n    const [referentiel, setReferentiel] = useState('sol'); // 'sol' or 'train'\r\n    const mobileRef = useRef();\r\n    const trainRef = useRef();\r\n\r\n    // Gamification\r\n    const [mode, setMode] = useState('explore'); // explore, challenge\r\n    const [targetDistance, setTargetDistance] = useState(null);\r\n    const [targetTime, setTargetTime] = useState(null);\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n\r\n    useFrame((state, delta) => {\r\n        if (isPlaying) {\r\n            const dt = delta;\r\n            setTime(prev => Math.min(prev + dt, 10)); // Max 10s\r\n\r\n            // Mobile movement logic\r\n            if (mobileRef.current) {\r\n                // x(t) = -4 + v * t\r\n                const position = -4 + (time * vitesse);\r\n                mobileRef.current.position.x = position;\r\n            }\r\n\r\n            // Train movement logic (Visual only if ref is sol)\r\n            if (trainRef.current) {\r\n                if (referentiel === 'sol') {\r\n                    // Train moves back and forth slightly to look like it's moving\r\n                    trainRef.current.position.x = (time * 1.5) % 10 - 5;\r\n                } else {\r\n                    trainRef.current.position.x = 0;\r\n                }\r\n            }\r\n\r\n            if (mode === 'challenge' && time >= targetTime) {\r\n                setIsPlaying(false);\r\n                checkChallenge();\r\n            }\r\n        }\r\n    });\r\n\r\n    const handleReset = () => {\r\n        setTime(0);\r\n        setIsPlaying(false);\r\n        if (mobileRef.current) mobileRef.current.position.x = -4;\r\n        if (trainRef.current) trainRef.current.position.x = (referentiel === 'sol' ? -5 : 0);\r\n    };\r\n\r\n    const startChallenge = () => {\r\n        setMode('challenge');\r\n        // Goal: Reach distance D in time T. Find V.\r\n        // D = V * T => V = D / T\r\n        const t = Math.floor(Math.random() * 3 + 2); // 2-5s\r\n        const vTarget = Math.floor(Math.random() * 4 + 1); // 1-5 m/s\r\n        const d = vTarget * t;\r\n\r\n        setTargetTime(t);\r\n        setTargetDistance(d);\r\n        setVitesse(1); // Reset slider\r\n        setScore(0);\r\n        setShowSuccess(false);\r\n        handleReset();\r\n    };\r\n\r\n    const checkChallenge = () => {\r\n        const dReal = vitesse * targetTime;\r\n        if (Math.abs(dReal - targetDistance) < 0.5) {\r\n            setShowSuccess(true);\r\n            setScore(s => s + 100);\r\n        }\r\n    };\r\n\r\n    // Correct trajectory points based on V\r\n    const trajectoryPoints = useMemo(() => {\r\n        const points = [];\r\n        for (let i = 0; i <= 20; i++) {\r\n            points.push(new THREE.Vector3(-4 + i * 0.5, 0.5, 0));\r\n        }\r\n        return points;\r\n    }, []);\r\n\r\n    return (\r\n        <group>\r\n            <SuccessOverlay show={showSuccess} message={`Bravo ! Vitesse parfaite.`} points={100} onNext={startChallenge} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            {/* Ground/Reference */}\r\n            <Box args={[20, 0.2, 4]} position={[0, -1.5, 0]} receiveShadow>\r\n                <meshStandardMaterial color={referentiel === 'sol' ? \"#2e7d32\" : \"#4a4a4a\"} />\r\n            </Box>\r\n\r\n            {/* Scenery to show motion when camera is fixed on train */}\r\n            {referentiel === 'train' && [-8, -4, 0, 4, 8].map(x => (\r\n                <group key={x} position={[x - (time * 1.5) % 20, -1, -2]}>\r\n                    <Cylinder args={[0.2, 0.2, 2]} material-color=\"#5d4037\" />\r\n                    <Cone args={[1, 2, 8]} position={[0, 1.5, 0]} material-color=\"#388e3c\" />\r\n                </group>\r\n            ))}\r\n\r\n            {/* Rails */}\r\n            <Box args={[20, 0.05, 0.2]} position={[0, -1.35, 0.5]}>\r\n                <meshStandardMaterial color=\"#666\" metalness={0.8} />\r\n            </Box>\r\n            <Box args={[20, 0.05, 0.2]} position={[0, -1.35, -0.5]}>\r\n                <meshStandardMaterial color=\"#666\" metalness={0.8} />\r\n            </Box>\r\n\r\n            {/* Train Visuals */}\r\n            <group ref={trainRef} position={[0, 0, 0]}>\r\n                <Box args={[8, 2, 2]} position={[0, 0, 0]} material-color=\"#1565c0\" transparent opacity={0.5} />\r\n                <Text position={[0, 1.2, 0]} fontSize={0.3} color=\"white\">WAGON</Text>\r\n                {/* Wheels */}\r\n                {[-3, 3].map(x => (\r\n                    <Cylinder key={x} args={[0.5, 0.5, 2.2, 16]} rotation={[Math.PI / 2, 0, 0]} position={[x, -1, 0]} material-color=\"#333\" />\r\n                ))}\r\n            </group>\r\n\r\n            {/* Mobile (ball) */}\r\n            <Sphere ref={mobileRef} args={[0.25, 16, 16]} position={[-4, 0.5, 0]} castShadow>\r\n                <meshStandardMaterial color=\"#f44336\" emissive=\"#ff5722\" emissiveIntensity={0.5} />\r\n            </Sphere>\r\n\r\n            {/* Trajectory visualization */}\r\n            {showTrajectory && referentiel === 'sol' && (\r\n                <Line\r\n                    points={trajectoryPoints}\r\n                    color=\"#ffeb3b\"\r\n                    lineWidth={2}\r\n                    dashed\r\n                />\r\n            )}\r\n\r\n            {/* Velocity vector */}\r\n            <group position={[mobileRef.current?.position.x || -4, 0.5, 0]}>\r\n                <Line\r\n                    points={[[0, 0, 0], [vitesse * 0.5, 0, 0]]} // Scaled for visibility\r\n                    color=\"#4caf50\"\r\n                    lineWidth={4}\r\n                />\r\n                <Cone args={[0.1, 0.2, 8]} position={[vitesse * 0.5 + 0.1, 0, 0]} rotation={[0, 0, -Math.PI / 2]}>\r\n                    <meshStandardMaterial color=\"#4caf50\" />\r\n                </Cone>\r\n                <Text position={[0, 0.4, 0]} fontSize={0.2} color=\"#4caf50\">\r\n                    v = {vitesse} m/s\r\n                </Text>\r\n            </group>\r\n\r\n            {/* Target Marker for Challenge */}\r\n            {mode === 'challenge' && (\r\n                <group position={[-4 + targetDistance, 0, 0]}>\r\n                    <Cylinder args={[0.8, 0.8, 0.05, 32]} rotation={[Math.PI / 2, 0, 0]} material-color=\"#e91e63\" />\r\n                    <Text position={[0, 0.5, 0]} fontSize={0.3} color=\"#e91e63\">CIBLE</Text>\r\n                    <Text position={[0, -0.5, 0]} fontSize={0.2} color=\"white\">{targetDistance} m</Text>\r\n                </group>\r\n            )}\r\n\r\n            {/* Control Panel */}\r\n            <Html position={[7, 2, 0]} transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒÜé Labo Mouvement\" className=\"w-[320px] border-cyan-500/30 text-white\">\r\n                    <div className=\"mb-4\">\r\n                        <PhaseSelector currentPhase={mode} onSelect={setMode} />\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-between items-end mb-4 pb-2 border-b border-white/10\">\r\n                        <div>\r\n                            <div className=\"text-xs text-cyan-400 font-bold uppercase tracking-wider mb-1\">Module M├®canique</div>\r\n                            <div className=\"text-xl font-black text-white leading-none\">MOUVEMENT</div>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {mode === 'explore' ? (\r\n                        <>\r\n                            <MissionObjective objective=\"Explorez le mouvement et les r├®f├®rentiels !\" icon=\"­ƒÜé\" />\r\n                            <div className=\"space-y-4\">\r\n                                <div className=\"bg-gray-800 p-3 rounded\">\r\n                                    <label className=\"text-xs text-secondary block mb-2\">R├®f├®rentiel</label>\r\n                                    <div className=\"flex gap-2\">\r\n                                        <button onClick={() => setReferentiel('sol')} className={`flex-1 py-1 rounded text-xs ${referentiel === 'sol' ? 'bg-purple-600' : 'bg-gray-700'}`}>­ƒîì Sol</button>\r\n                                        <button onClick={() => setReferentiel('train')} className={`flex-1 py-1 rounded text-xs ${referentiel === 'train' ? 'bg-purple-600' : 'bg-gray-700'}`}>­ƒÜå Train</button>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"mb-4\">\r\n                                    <label className=\"block text-sm mb-1 text-gray-300\">\r\n                                        Vitesse: <span className=\"text-cyan-400 font-bold\">{vitesse} m/s</span>\r\n                                    </label>\r\n                                    <input\r\n                                        type=\"range\"\r\n                                        min=\"0.5\"\r\n                                        max=\"10\"\r\n                                        step=\"0.5\"\r\n                                        value={vitesse}\r\n                                        onChange={(e) => setVitesse(parseFloat(e.target.value))}\r\n                                        className=\"w-full h-1 accent-cyan-500\"\r\n                                    />\r\n                                </div>\r\n                                <div className=\"flex gap-2\">\r\n                                    <button\r\n                                        onClick={() => setIsPlaying(!isPlaying)}\r\n                                        className={`flex-1 py-2 rounded font-bold ${isPlaying ? 'bg-red-500 hover:bg-red-600' : 'bg-green-500 hover:bg-green-600'}`}\r\n                                    >\r\n                                        {isPlaying ? 'ÔÅ©´©Å Stop' : 'ÔûÂ´©Å Go'}\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={handleReset}\r\n                                        className=\"flex-1 py-2 bg-gray-600 hover:bg-gray-500 rounded font-bold\"\r\n                                    >\r\n                                        ­ƒöä Reset\r\n                                    </button>\r\n                                </div>\r\n                                <div className=\"bg-green-900/20 p-3 rounded border border-green-500/20 font-mono text-xs\">\r\n                                    <div className=\"flex justify-between\"><span>Temps:</span> <strong>{time.toFixed(2)} s</strong></div>\r\n                                    <div className=\"flex justify-between\"><span>Dist:</span> <strong>{(vitesse * time).toFixed(2)} m</strong></div>\r\n                                </div>\r\n                            </div>\r\n                        </>\r\n                    ) : (\r\n                        <div className=\"bg-gray-900/50 p-4 rounded-xl border border-cyan-500/30\">\r\n                            <div className=\"flex justify-between items-center mb-6\">\r\n                                <h3 className=\"text-cyan-300 font-bold flex items-center gap-2\">\r\n                                    <span>ÔÅ▒´©Å</span> D├®fi Vitesse\r\n                                </h3>\r\n                                <XPBar current={score} nextLevel={100} />\r\n                            </div>\r\n\r\n                            {targetDistance ? (\r\n                                <div className=\"space-y-4 animate-in slide-in-from-right duration-300\">\r\n                                    <div className=\"bg-pink-900/30 p-3 rounded border border-pink-500/30 text-center\">\r\n                                        <div className=\"text-pink-200 text-xs uppercase mb-1\">Mission</div>\r\n                                        <div className=\"font-bold text-white text-sm\">\r\n                                            Avance de <span className=\"text-xl text-yellow-400\">{targetDistance}m</span> en <span className=\"text-xl text-yellow-400\">{targetTime}s</span>.\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"bg-gray-800 p-3 rounded-lg\">\r\n                                        <label className=\"text-xs text-cyan-400 block mb-1\">R├¿gle la Vitesse (v = d/t)</label>\r\n                                        <input\r\n                                            type=\"range\"\r\n                                            min=\"0.5\"\r\n                                            max=\"10\"\r\n                                            step=\"0.5\"\r\n                                            value={vitesse}\r\n                                            onChange={(e) => setVitesse(parseFloat(e.target.value))}\r\n                                            className=\"w-full accent-cyan-500\"\r\n                                        />\r\n                                        <div className=\"text-center font-bold text-lg mt-1\">{vitesse} m/s</div>\r\n                                    </div>\r\n\r\n                                    <button\r\n                                        onClick={() => setIsPlaying(true)}\r\n                                        disabled={isPlaying}\r\n                                        className=\"w-full py-2 bg-pink-600 hover:bg-pink-500 rounded-lg font-bold text-white shadow-lg shadow-pink-900/30\"\r\n                                    >\r\n                                        {isPlaying ? 'En cours...' : 'Lancer le Mobile ­ƒÜÇ'}\r\n                                    </button>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"text-center py-8\">\r\n                                    <button onClick={startChallenge} className=\"px-8 py-3 bg-cyan-600 hover:bg-cyan-500 text-white rounded-full font-bold shadow-lg shadow-cyan-900/20 transition-all transform hover:scale-105\">\r\n                                        Relever le D├®fi\r\n                                    </button>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// P9-P10. FORCES ET POIDS - Repr├®sentation vectorielle\r\n// ============================================================\r\n// ============================================================\r\n// P9-P10. FORCES ET POIDS - Repr├®sentation vectorielle (ENRICHI)\r\n// ============================================================\r\n// P9-P10. FORCES ET POIDS - Mission Cargaison Interstellaire\r\n// ============================================================\r\n// ============================================================\r\n// P9-P10. FORCES ET POIDS - Repr├®sentation vectorielle (ENRICHI)\r\n// ============================================================\r\n// P9-P10. FORCES ET POIDS - Mission Cargaison Interstellaire\r\n// ============================================================\r\nexport function ForcesPoidsSeconde() {\r\n    const [masse, setMasse] = useState(10);\r\n    const [planete, setPlanete] = useState('terre');\r\n    // Renaming 'mission' mode to 'challenge' for consistency, but keeping 'mission' functionality\r\n    const [mode, setMode] = useState('explore'); // 'explore', 'challenge'\r\n\r\n    // Mission State -> Challenge State\r\n    const [targetPoids, setTargetPoids] = useState(null);\r\n    const [missionStatus, setMissionStatus] = useState('idle'); // idle, checking, success, fail\r\n    const [craneHeight, setCraneHeight] = useState(3);\r\n    const [score, setScore] = useState(0);\r\n\r\n    const planetes = {\r\n        terre: { g: 9.8, color: '#2196f3', name: 'Terre', sky: '#87CEEB', ground: '#4CAF50' },\r\n        lune: { g: 1.6, color: '#bdbdbd', name: 'Lune', sky: '#000000', ground: '#E0E0E0' },\r\n        mars: { g: 3.7, color: '#ff5722', name: 'Mars', sky: '#FFCCBC', ground: '#D84315' },\r\n        jupiter: { g: 24.8, color: '#ff9800', name: 'Jupiter', sky: '#FFE0B2', ground: '#795548' }\r\n    };\r\n\r\n    const g = planetes[planete].g;\r\n    const poids = masse * g;\r\n\r\n    // Animation Grue\r\n    useFrame((state, delta) => {\r\n        if (missionStatus === 'checking') {\r\n            // La grue descend\r\n            if (craneHeight > 1.5) setCraneHeight(h => h - delta);\r\n        } else if (missionStatus === 'success') {\r\n            // La grue remonte avec la caisse\r\n            if (craneHeight < 5) setCraneHeight(h => h + delta * 2);\r\n        } else {\r\n            if (craneHeight < 3) setCraneHeight(h => h + delta);\r\n        }\r\n    });\r\n\r\n    const startChallenge = () => {\r\n        setMode('challenge');\r\n        const keys = Object.keys(planetes);\r\n        const p = keys[Math.floor(Math.random() * keys.length)];\r\n        const m = Math.floor(Math.random() * 20 + 5); // 5-25kg\r\n        const tP = m * planetes[p].g;\r\n\r\n        setPlanete(p);\r\n        setTargetPoids(tP);\r\n        setMasse(1);\r\n        setMissionStatus('idle');\r\n        setScore(0);\r\n    };\r\n\r\n    const checkChallenge = () => {\r\n        setMissionStatus('checking');\r\n        setTimeout(() => {\r\n            if (Math.abs(poids - targetPoids) < 1.0) {\r\n                setMissionStatus('success');\r\n                triggerSuccess();\r\n                setScore(s => s + 100);\r\n            } else {\r\n                setMissionStatus('fail');\r\n            }\r\n        }, 1500);\r\n    };\r\n\r\n    const triggerSuccess = () => {\r\n        // Just for consistency with other components that might rely on this.\r\n        // But here we use missionStatus to trigger UI effects.\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            {/* <OrbitControls /> Removed as it's usually outside or passed down, but assuming it's available in context or parent. Actually usually inserted inside Canvas. I'll leave it if it was there, but usually I shouldn't add it if not imported. It was in previous code? No, line 316 says <OrbitControls />. I need to make sure it's imported. Part2 imports don't show OrbitControls. I'll remove it to be safe, DraggableHtmlPanel handles UI interaction. */}\r\n            <SuccessOverlay show={missionStatus === 'success'} message=\"Cargaison charg├®e !\" points={100} onNext={startChallenge} />\r\n            <ConfettiExplosion active={missionStatus === 'success'} />\r\n\r\n            {/* Environnement Dynamique */}\r\n            <mesh position={[0, -2, 0]} rotation={[-Math.PI / 2, 0, 0]}>\r\n                <planeGeometry args={[50, 50]} />\r\n                <meshStandardMaterial color={planetes[planete].ground} />\r\n            </mesh>\r\n            <mesh position={[0, 10, -10]}>\r\n                <sphereGeometry args={[2]} />\r\n                <meshStandardMaterial color={planetes[planete].color} emissive={planetes[planete].color} emissiveIntensity={0.2} />\r\n            </mesh>\r\n            <ambientLight intensity={0.5} color={planetes[planete].sky} />\r\n\r\n            {/* Grue Spatiale */}\r\n            <group position={[2, 0, 0]}>\r\n                <Box args={[0.5, 6, 0.5]} position={[0, 3, 0]}><meshStandardMaterial color=\"#333\" /></Box>\r\n                <Box args={[4, 0.3, 0.5]} position={[-1.5, 6, 0]}><meshStandardMaterial color=\"#333\" /></Box>\r\n                {/* C├óble */}\r\n                <Line points={[[-3, 6, 0], [-3, craneHeight, 0]]} color=\"black\" lineWidth={2} />\r\n                {/* Crochet */}\r\n                <mesh position={[-3, craneHeight, 0]}>\r\n                    <cylinderGeometry args={[0.2, 0.2, 0.5]} />\r\n                    <meshStandardMaterial color=\"yellow\" />\r\n                </mesh>\r\n            </group>\r\n\r\n            {/* Caisse (Objet) */}\r\n            <group position={[-1, missionStatus === 'success' ? craneHeight - 0.5 : 0.5, 0]}>\r\n                <Box args={[1, 1, 1]}>\r\n                    <meshStandardMaterial color={missionStatus === 'fail' ? '#FF5252' : missionStatus === 'success' ? '#69F0AE' : '#607D8B'} />\r\n                </Box>\r\n                <Text position={[0, 0, 0.51]} fontSize={0.2} color=\"white\">\r\n                    {masse} kg\r\n                </Text>\r\n                {/* Vecteur Poids */}\r\n                <group position={[0, -0.6, 0]}>\r\n                    <Line points={[[0, 0, 0], [0, -poids / 50, 0]]} color=\"#FFD700\" lineWidth={4} />\r\n                    <Cone args={[0.1, 0.2, 8]} position={[0, -poids / 50, 0]} rotation={[Math.PI, 0, 0]}><meshBasicMaterial color=\"#FFD700\" /></Cone>\r\n                    <Text position={[0.5, -poids / 100, 0]} fontSize={0.2} color=\"#FFD700\">P = {poids.toFixed(1)} N</Text>\r\n                </group>\r\n            </group>\r\n\r\n            {/* Overlay Mission */}\r\n            {mode === 'challenge' && (\r\n                <Text position={[0, 4, 0]} fontSize={0.4} color=\"white\" outlineWidth={0.02} outlineColor=\"black\">\r\n                    CIBLE P = {targetPoids ? targetPoids.toFixed(1) : '?'} N\r\n                </Text>\r\n            )}\r\n\r\n            <Html position={[6, 2, 0]} transform={false}>\r\n                <DraggableHtmlPanel title={mode === 'explore' ? \"ÔÜû´©Å Poids & Masse\" : \"­ƒÜÇ Mission Cargaison\"} className=\"w-[320px] border-orange-500/30 text-white\">\r\n                    <div className=\"mb-4\">\r\n                        <PhaseSelector currentPhase={mode} onSelect={setMode} />\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-between items-end mb-4 pb-2 border-b border-white/10\">\r\n                        <div>\r\n                            <div className=\"text-xs text-orange-400 font-bold uppercase tracking-wider mb-1\">Module M├®canique</div>\r\n                            <div className=\"text-xl font-black text-white leading-none\">POIDS & MASSE</div>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {mode === 'explore' ? (\r\n                        <>\r\n                            <MissionObjective objective=\"Testez la gravit├® sur diff├®rentes plan├¿tes !\" icon=\"­ƒ¬É\" />\r\n                            <div className=\"space-y-4\">\r\n                                <div className=\"bg-gray-800 p-3 rounded\">\r\n                                    <label className=\"text-xs text-secondary block mb-2\">Plan├¿te</label>\r\n                                    <div className=\"grid grid-cols-2 gap-1 mt-1\">\r\n                                        {Object.keys(planetes).map(p => (\r\n                                            <button key={p} onClick={() => setPlanete(p)} className={`text-xs p-1 rounded ${planete === p ? 'bg-orange-600' : 'bg-gray-700'}`}>\r\n                                                {planetes[p].name}\r\n                                            </button>\r\n                                        ))}\r\n                                    </div>\r\n                                    <div className=\"text-center text-xs text-gray-400 mt-1\">g = {planetes[planete].g} N/kg</div>\r\n                                </div>\r\n                                <div className=\"mb-4 bg-gray-800 p-3 rounded\">\r\n                                    <label className=\"text-xs text-gray-400\">Masse de la cargaison: <span className=\"text-orange-400 font-bold\">{masse} kg</span></label>\r\n                                    <input type=\"range\" min=\"1\" max=\"50\" step=\"1\" value={masse} onChange={e => setMasse(Number(e.target.value))} className=\"w-full accent-orange-500\" />\r\n                                </div>\r\n                                <div className=\"text-center bg-orange-900/20 p-2 rounded\">\r\n                                    <div className=\"text-xs text-orange-200\">Poids (Force)</div>\r\n                                    <div className=\"font-bold text-xl text-white\">{poids.toFixed(1)} Newtons</div>\r\n                                    <div className=\"text-[10px] text-gray-400\">P = m ├ù g</div>\r\n                                </div>\r\n                            </div>\r\n                        </>\r\n                    ) : (\r\n                        <div className=\"bg-gray-900/50 p-4 rounded-xl border border-orange-500/30\">\r\n                            <div className=\"flex justify-between items-center mb-6\">\r\n                                <h3 className=\"text-orange-300 font-bold flex items-center gap-2\">\r\n                                    <span>­ƒÅù´©Å</span> Cargaison Spatiale\r\n                                </h3>\r\n                                <XPBar current={score} nextLevel={100} />\r\n                            </div>\r\n\r\n                            {targetPoids ? (\r\n                                <div className=\"space-y-4 animate-in slide-in-from-right duration-300\">\r\n                                    <div className=\"bg-gray-800 p-3 rounded border border-gray-600 text-center\">\r\n                                        <div className=\"text-gray-400 text-xs uppercase mb-1\">Commande Client</div>\r\n                                        <div className=\"font-bold text-xl text-white\">Poids Requis: {targetPoids.toFixed(1)} N</div>\r\n                                        <div className=\"text-xs text-orange-400 mt-1\">Plan├¿te: {planetes[planete].name} (g={planetes[planete].g})</div>\r\n                                    </div>\r\n\r\n                                    <div className=\"bg-gray-800 p-3 rounded-lg\">\r\n                                        <label className=\"text-xs text-gray-400 block mb-1\">Ajuste la Masse</label>\r\n                                        <input type=\"range\" min=\"1\" max=\"50\" step=\"1\" value={masse} onChange={(e) => setMasse(Number(e.target.value))} className=\"w-full accent-orange-500\" />\r\n                                        <div className=\"text-center font-bold text-lg mt-1\">{masse} kg</div>\r\n                                    </div>\r\n\r\n                                    <div className=\"text-center text-xs text-gray-400\">Poids Actuel: {(masse * planetes[planete].g).toFixed(1)} N</div>\r\n\r\n                                    <button onClick={checkChallenge} disabled={missionStatus !== 'idle' && missionStatus !== 'fail'} className=\"w-full py-2 bg-orange-600 hover:bg-orange-500 rounded-lg font-bold text-white shadow-lg shadow-orange-900/30\">\r\n                                        {missionStatus === 'checking' ? 'V├®rification...' : 'Charger la Caisse'}\r\n                                    </button>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"text-center py-8\">\r\n                                    <button onClick={startChallenge} className=\"px-8 py-3 bg-orange-600 hover:bg-orange-500 text-white rounded-full font-bold shadow-lg shadow-orange-900/20 transition-all transform hover:scale-105\">\r\n                                        Nouvelle Mission\r\n                                    </button>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// P11. ├ëQUILIBRE SOUMIS ├Ç 3 FORCES\r\n// ============================================================\r\n// ============================================================\r\n// P11. ├ëQUILIBRE SOUMIS ├Ç 3 FORCES (ENRICHI)\r\n// ============================================================\r\nexport function Equilibre3ForcesSeconde() {\r\n    const [force1, setForce1] = useState(50);\r\n    const [force2, setForce2] = useState(50);\r\n    const [angle1, setAngle1] = useState(120);\r\n    const [angle2, setAngle2] = useState(240);\r\n    const [showResultante, setShowResultante] = useState(false);\r\n\r\n    // Gamification\r\n    const [mode, setMode] = useState('explore'); // explore, challenge\r\n    const [targetEquilibrium, setTargetEquilibrium] = useState(false);\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n\r\n    // Calculate forces components\r\n    const rad1 = (angle1 * Math.PI) / 180;\r\n    const rad2 = (angle2 * Math.PI) / 180;\r\n    const f1x = force1 * Math.cos(rad1);\r\n    const f1y = force1 * Math.sin(rad1);\r\n    const f2x = force2 * Math.cos(rad2);\r\n    const f2y = force2 * Math.sin(rad2);\r\n\r\n    const [userForce, setUserForce] = useState(50);\r\n    const [userAngle, setUserAngle] = useState(0);\r\n\r\n    const activeF3 = mode === 'challenge' ? userForce : Math.sqrt(Math.pow(-(f1x + f2x), 2) + Math.pow(-(f1y + f2y), 2));\r\n    const activeAngle3 = mode === 'challenge' ? userAngle : (Math.atan2(-(f1y + f2y), -(f1x + f2x)) * 180) / Math.PI;\r\n\r\n    const rad3 = (activeAngle3 * Math.PI) / 180;\r\n    const f3x = activeF3 * Math.cos(rad3);\r\n    const f3y = activeF3 * Math.sin(rad3);\r\n\r\n    const sumX = f1x + f2x + f3x;\r\n    const sumY = f1y + f2y + f3y;\r\n    const residual = Math.sqrt(sumX * sumX + sumY * sumY);\r\n    const isEquilibrium = residual < 5; // Tolerance\r\n\r\n    const startChallenge = () => {\r\n        setMode('challenge');\r\n        // Randomize F1 and F2\r\n        setForce1(Math.floor(Math.random() * 50 + 30));\r\n        setAngle1(Math.floor(Math.random() * 360));\r\n\r\n        setForce2(Math.floor(Math.random() * 50 + 30));\r\n        setAngle2(Math.floor(Math.random() * 360));\r\n\r\n        // Reset user guess\r\n        setUserForce(50);\r\n        setUserAngle(0);\r\n        setScore(0);\r\n        setShowSuccess(false);\r\n    };\r\n\r\n    const checkChallenge = () => {\r\n        if (isEquilibrium) {\r\n            setShowSuccess(true);\r\n            setScore(s => s + 100);\r\n        }\r\n    };\r\n\r\n    const scale = 0.02;\r\n\r\n    return (\r\n        <group>\r\n            <SuccessOverlay show={showSuccess} message={`├ëquilibre atteint !`} points={100} onNext={startChallenge} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            {/* Central point */}\r\n            <Sphere args={[0.2, 16, 16]} position={[0, 0, 0]}>\r\n                <meshStandardMaterial color={isEquilibrium ? \"#4caf50\" : \"#fff\"} emissive={isEquilibrium ? \"#4caf50\" : \"#000\"} emissiveIntensity={0.5} />\r\n            </Sphere>\r\n\r\n            {/* Force 1 */}\r\n            <group>\r\n                <Line points={[[0, 0, 0], [f1x * scale, f1y * scale, 0]]} color=\"#f44336\" lineWidth={4} />\r\n                <Cone args={[0.1, 0.2, 8]} position={[f1x * scale, f1y * scale, 0]} rotation={[0, 0, rad1 - Math.PI / 2]}>\r\n                    <meshStandardMaterial color=\"#f44336\" />\r\n                </Cone>\r\n                <Text position={[f1x * scale * 0.6, f1y * scale * 0.6 + 0.3, 0]} fontSize={0.2} color=\"#f44336\">FÔéü</Text>\r\n            </group>\r\n\r\n            {/* Force 2 */}\r\n            <group>\r\n                <Line points={[[0, 0, 0], [f2x * scale, f2y * scale, 0]]} color=\"#4caf50\" lineWidth={4} />\r\n                <Cone args={[0.1, 0.2, 8]} position={[f2x * scale, f2y * scale, 0]} rotation={[0, 0, rad2 - Math.PI / 2]}>\r\n                    <meshStandardMaterial color=\"#4caf50\" />\r\n                </Cone>\r\n                <Text position={[f2x * scale * 0.6, f2y * scale * 0.6 + 0.3, 0]} fontSize={0.2} color=\"#4caf50\">FÔéé</Text>\r\n            </group>\r\n\r\n            {/* Force 3 (User or Auto) */}\r\n            <group>\r\n                <Line points={[[0, 0, 0], [f3x * scale, f3y * scale, 0]]} color=\"#2196f3\" lineWidth={4} />\r\n                <Cone args={[0.1, 0.2, 8]} position={[f3x * scale, f3y * scale, 0]} rotation={[0, 0, rad3 - Math.PI / 2]}>\r\n                    <meshStandardMaterial color=\"#2196f3\" />\r\n                </Cone>\r\n                <Text position={[f3x * scale * 0.6, f3y * scale * 0.6 + 0.3, 0]} fontSize={0.2} color=\"#2196f3\">FÔéâ</Text>\r\n            </group>\r\n\r\n            {/* Resultant Text */}\r\n            <Text position={[0, -2.5, 0]} fontSize={0.25} color={isEquilibrium ? '#4caf50' : '#f44336'}>\r\n                {isEquilibrium ? 'Ô£ô ├ëQUILIBRE' : `ÔÜá R├®siduel: ${residual.toFixed(1)} N`}\r\n            </Text>\r\n\r\n            {/* Triangle des forces (Optional visualization) */}\r\n            {mode === 'explore' && showResultante && (\r\n                <group position={[3, 0, -2]}>\r\n                    <Text position={[0, 2, 0]} fontSize={0.2} color=\"#fff\">Triangle des forces</Text>\r\n                    <Line points={[[0, 0, 0], [f1x * scale, f1y * scale, 0]]} color=\"#f44336\" lineWidth={2} />\r\n                    <Line points={[[f1x * scale, f1y * scale, 0], [f1x * scale + f2x * scale, f1y * scale + f2y * scale, 0]]} color=\"#4caf50\" lineWidth={2} />\r\n                    <Line points={[[f1x * scale + f2x * scale, f1y * scale + f2y * scale, 0], [0, 0, 0]]} color=\"#2196f3\" lineWidth={2} />\r\n                </group>\r\n            )}\r\n\r\n            {/* Control Panel */}\r\n            <Html position={[6, 2, 0]} transform={false}>\r\n                <DraggableHtmlPanel title=\"ÔÜû´©Å ├ëquilibre 3 Forces\" className=\"w-[300px] border-purple-500/30 text-white\">\r\n                    <div className=\"mb-4\">\r\n                        <PhaseSelector currentPhase={mode} onSelect={setMode} />\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-between items-end mb-4 pb-2 border-b border-white/10\">\r\n                        <div>\r\n                            <div className=\"text-xs text-purple-400 font-bold uppercase tracking-wider mb-1\">Module M├®canique</div>\r\n                            <div className=\"text-xl font-black text-white leading-none\">├ëQUILIBRE</div>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {mode === 'explore' ? (\r\n                        <>\r\n                            <MissionObjective objective=\"Visualisez l'├®quilibre de 3 forces !\" icon=\"ÔÜû´©Å\" />\r\n                            <div className=\"space-y-4\">\r\n                                {/* F1 Controls */}\r\n                                <div className=\"mb-2 p-2 rounded border border-red-500/30 bg-red-900/10\">\r\n                                    <label className=\"text-xs text-red-300 font-bold block mb-1\">Force FÔéü</label>\r\n                                    <div className=\"flex items-center gap-2 mb-1\">\r\n                                        <input type=\"range\" min=\"10\" max=\"100\" value={force1} onChange={e => setForce1(Number(e.target.value))} className=\"w-full h-1 accent-red-500\" />\r\n                                        <span className=\"text-[10px] w-6\">{force1}N</span>\r\n                                    </div>\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <input type=\"range\" min=\"0\" max=\"360\" value={angle1} onChange={e => setAngle1(Number(e.target.value))} className=\"w-full h-1 accent-red-500\" />\r\n                                        <span className=\"text-[10px] w-6\">{angle1}┬░</span>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* F2 Controls */}\r\n                                <div className=\"mb-2 p-2 rounded border border-green-500/30 bg-green-900/10\">\r\n                                    <label className=\"text-xs text-green-300 font-bold block mb-1\">Force FÔéé</label>\r\n                                    <div className=\"flex items-center gap-2 mb-1\">\r\n                                        <input type=\"range\" min=\"10\" max=\"100\" value={force2} onChange={e => setForce2(Number(e.target.value))} className=\"w-full h-1 accent-green-500\" />\r\n                                        <span className=\"text-[10px] w-6\">{force2}N</span>\r\n                                    </div>\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <input type=\"range\" min=\"0\" max=\"360\" value={angle2} onChange={e => setAngle2(Number(e.target.value))} className=\"w-full h-1 accent-green-500\" />\r\n                                        <span className=\"text-[10px] w-6\">{angle2}┬░</span>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"p-2 text-xs bg-gray-800 rounded\">\r\n                                    <label className=\"flex items-center gap-2\">\r\n                                        <input type=\"checkbox\" checked={showResultante} onChange={e => setShowResultante(e.target.checked)} className=\"accent-purple-500\" />\r\n                                        <span>Voir Triangle des Forces</span>\r\n                                    </label>\r\n                                </div>\r\n                            </div>\r\n                        </>\r\n                    ) : (\r\n                        <div className=\"bg-gray-900/50 p-4 rounded-xl border border-purple-500/30\">\r\n                            <div className=\"flex justify-between items-center mb-6\">\r\n                                <h3 className=\"text-purple-300 font-bold flex items-center gap-2\">\r\n                                    <span>­ƒÄ»</span> D├®fi ├ëquilibre\r\n                                </h3>\r\n                                <XPBar current={score} nextLevel={100} />\r\n                            </div>\r\n\r\n                            {showSuccess ? (\r\n                                <div className=\"space-y-4 animate-in slide-in-from-right duration-300\">\r\n                                    <div className=\"bg-green-900/30 p-3 rounded border border-green-500/30 text-center\">\r\n                                        <div className=\"text-xl font-bold text-green-300\">├ëQUILIBRE ATTEINT !</div>\r\n                                        <div className=\"text-xs text-gray-300 mt-1\">Excellent travail ing├®nieur.</div>\r\n                                    </div>\r\n                                    <button onClick={startChallenge} className=\"w-full py-2 bg-purple-600 hover:bg-purple-500 rounded-lg font-bold text-white shadow-lg shadow-purple-900/30\">\r\n                                        Nouveau D├®fi\r\n                                    </button>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"space-y-4\">\r\n                                    <div className=\"bg-purple-900/20 p-2 rounded text-xs text-purple-200\">\r\n                                        Ajuste FÔéâ (Bleu) pour annuler FÔéü et FÔéé et r├®ussir l'├®quilibre (point central Vert).\r\n                                    </div>\r\n\r\n                                    {/* F1 & F2 Info */}\r\n                                    <div className=\"grid grid-cols-2 gap-2 text-[10px] text-gray-400\">\r\n                                        <div className=\"bg-gray-800 p-1 rounded\">FÔéü: {force1}N ├á {angle1}┬░</div>\r\n                                        <div className=\"bg-gray-800 p-1 rounded\">FÔéé: {force2}N ├á {angle2}┬░</div>\r\n                                    </div>\r\n\r\n                                    {/* F3 Controls */}\r\n                                    <div className=\"p-3 rounded border border-blue-500/30 bg-blue-900/10\">\r\n                                        <label className=\"text-xs text-blue-300 font-bold block mb-2\">Ton Action (FÔéâ)</label>\r\n\r\n                                        <div className=\"mb-2\">\r\n                                            <div className=\"flex justify-between text-[10px] text-blue-200\"><span>Force</span> <span>{userForce} N</span></div>\r\n                                            <input type=\"range\" min=\"10\" max=\"150\" value={userForce} onChange={e => setUserForce(Number(e.target.value))} className=\"w-full h-1 accent-blue-500\" />\r\n                                        </div>\r\n\r\n                                        <div>\r\n                                            <div className=\"flex justify-between text-[10px] text-blue-200\"><span>Angle</span> <span>{userAngle}┬░</span></div>\r\n                                            <input type=\"range\" min=\"-180\" max=\"180\" value={userAngle} onChange={e => setUserAngle(Number(e.target.value))} className=\"w-full h-1 accent-blue-500\" />\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"text-center text-xs font-mono text-gray-400\">\r\n                                        R├®siduel actuel: {residual.toFixed(1)} N\r\n                                    </div>\r\n\r\n                                    <button onClick={checkChallenge} className=\"w-full py-2 bg-purple-600 hover:bg-purple-500 rounded-lg font-bold text-white shadow-lg shadow-purple-900/30\">\r\n                                        V├®rifier l'├ëquilibre\r\n                                    </button>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n        </group>\r\n    );\r\n}\r\n\r\n\r\n// ============================================================\r\n// P12. MOMENT D'UNE FORCE - ├ëquilibre autour d'un axe\r\n// ============================================================\r\n// ============================================================\r\n// P12. MOMENT D'UNE FORCE - ├ëquilibre autour d'un axe (ENRICHI)\r\n// ============================================================\r\nexport function MomentForceSeconde() {\r\n    const [force1, setForce1] = useState(20);\r\n    const [distance1, setDistance1] = useState(1);\r\n    const [force2, setForce2] = useState(10);\r\n    const [distance2, setDistance2] = useState(2);\r\n    const [showMoments, setShowMoments] = useState(true);\r\n    const leverRef = useRef();\r\n\r\n    // Gamification\r\n    const [mode, setMode] = useState('explore');\r\n    const [targetMoment, setTargetMoment] = useState(null);\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n\r\n    const moment1 = force1 * distance1;\r\n    const moment2 = force2 * distance2;\r\n    const momentNet = moment1 - moment2;\r\n    const isEquilibrium = Math.abs(momentNet) < 0.5;\r\n\r\n    useFrame(() => {\r\n        if (leverRef.current && !isEquilibrium) {\r\n            const angle = Math.min(Math.max(momentNet / 100, -0.3), 0.3);\r\n            leverRef.current.rotation.z += (angle - leverRef.current.rotation.z) * 0.05;\r\n        } else if (leverRef.current) {\r\n            leverRef.current.rotation.z *= 0.95;\r\n        }\r\n    });\r\n\r\n    const startChallenge = () => {\r\n        setMode('challenge');\r\n        // Randomize F1, d1 (Target side)\r\n        const f1 = Math.floor(Math.random() * 40 + 10);\r\n        const d1 = Number((Math.random() * 2 + 0.5).toFixed(1));\r\n        setForce1(f1);\r\n        setDistance1(d1);\r\n        setTargetMoment(f1 * d1);\r\n\r\n        // Reset User side F2, d2\r\n        setForce2(10);\r\n        setDistance2(1);\r\n\r\n        setScore(0);\r\n        setShowSuccess(false);\r\n    };\r\n\r\n    const checkChallenge = () => {\r\n        if (isEquilibrium) {\r\n            setShowSuccess(true);\r\n            setScore(s => s + 100);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            <SuccessOverlay show={showSuccess} message=\"├ëquilibre Parfait !\" points={100} onNext={startChallenge} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            {/* Pivot point */}\r\n            <Cylinder args={[0.2, 0.3, 0.5, 16]} position={[0, -0.5, 0]}>\r\n                <meshStandardMaterial color=\"#795548\" />\r\n            </Cylinder>\r\n            <Sphere args={[0.15, 16, 16]} position={[0, 0, 0]}>\r\n                <meshStandardMaterial color=\"#ff9800\" />\r\n            </Sphere>\r\n            <Text position={[0, 0.4, 0]} fontSize={0.15} color=\"#ff9800\">\r\n                Axe ╬ö\r\n            </Text>\r\n\r\n            {/* Lever */}\r\n            <group ref={leverRef}>\r\n                <Box args={[6, 0.15, 0.4]} position={[0, 0, 0]}>\r\n                    <meshStandardMaterial color=\"#607d8b\" />\r\n                </Box>\r\n\r\n                {/* Force 1 (left) */}\r\n                <group position={[-distance1, 0, 0]}>\r\n                    <Box args={[0.4, 0.4, 0.4]} position={[0, -0.3, 0]}>\r\n                        <meshStandardMaterial color={mode === 'challenge' ? \"#f44336\" : \"#f44336\"} />\r\n                    </Box>\r\n                    <Line points={[[0, 0, 0], [0, -force1 / 30, 0]]} color=\"#f44336\" lineWidth={4} />\r\n                    <Text position={[0.5, -force1 / 60, 0]} fontSize={0.15} color=\"#f44336\">\r\n                        FÔéü = {force1}N\r\n                    </Text>\r\n                    <Text position={[0, 0.3, 0]} fontSize={0.12} color=\"#aaa\">\r\n                        dÔéü = {distance1}m\r\n                    </Text>\r\n                </group>\r\n\r\n                {/* Force 2 (right) */}\r\n                <group position={[distance2, 0, 0]}>\r\n                    <Box args={[0.4, 0.4, 0.4]} position={[0, -0.3, 0]}>\r\n                        <meshStandardMaterial color={mode === 'challenge' ? \"#2196f3\" : \"#2196f3\"} />\r\n                    </Box>\r\n                    <Line points={[[0, 0, 0], [0, -force2 / 30, 0]]} color=\"#2196f3\" lineWidth={4} />\r\n                    <Text position={[0.5, -force2 / 60, 0]} fontSize={0.15} color=\"#2196f3\">\r\n                        FÔéé = {force2}N\r\n                    </Text>\r\n                    <Text position={[0, 0.3, 0]} fontSize={0.12} color=\"#aaa\">\r\n                        dÔéé = {distance2}m\r\n                    </Text>\r\n                </group>\r\n            </group>\r\n\r\n            {/* Distance markers */}\r\n            <Line points={[[0, -1.5, 0], [-distance1, -1.5, 0]]} color=\"#f44336\" lineWidth={1} dashed />\r\n            <Line points={[[0, -1.5, 0], [distance2, -1.5, 0]]} color=\"#2196f3\" lineWidth={1} dashed />\r\n\r\n            {/* Equilibrium indicator */}\r\n            <Text\r\n                position={[0, 2, 0]}\r\n                fontSize={0.3}\r\n                color={isEquilibrium ? '#4caf50' : '#ff9800'}\r\n            >\r\n                {isEquilibrium ? 'ÔÜû´©Å ├ëQUILIBRE' : 'Ôå╗ Rotation...'}\r\n            </Text>\r\n\r\n            <Html position={[5, 2, 0]} transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒöä Moment d'une Force\" className=\"w-[350px] border-orange-500/30 text-white\">\r\n                    <div className=\"mb-4\">\r\n                        <PhaseSelector currentPhase={mode} onSelect={setMode} />\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-between items-end mb-4 pb-2 border-b border-white/10\">\r\n                        <div>\r\n                            <div className=\"text-xs text-orange-400 font-bold uppercase tracking-wider mb-1\">Module M├®canique</div>\r\n                            <div className=\"text-xl font-black text-white leading-none\">MOMENTS</div>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {mode === 'explore' ? (\r\n                        <>\r\n                            <MissionObjective objective=\"Testez la loi des moments !\" icon=\"ÔÜû´©Å\" />\r\n                            <div className=\"space-y-4\">\r\n                                <div className=\"bg-red-900/20 p-3 rounded border-l-4 border-red-500\">\r\n                                    <label className=\"text-xs text-red-400 font-bold block mb-1\">Force Gauche (FÔéü)</label>\r\n                                    <div className=\"grid grid-cols-2 gap-2\">\r\n                                        <div>\r\n                                            <span className=\"text-[10px] text-gray-400\">Force (N)</span>\r\n                                            <input type=\"range\" min=\"5\" max=\"50\" value={force1} onChange={e => setForce1(Number(e.target.value))} className=\"w-full accent-red-500\" />\r\n                                        </div>\r\n                                        <div>\r\n                                            <span className=\"text-[10px] text-gray-400\">Dist (m)</span>\r\n                                            <input type=\"range\" min=\"0.5\" max=\"2.5\" step=\"0.1\" value={distance1} onChange={e => setDistance1(Number(e.target.value))} className=\"w-full accent-red-500\" />\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"text-right text-xs text-red-300 mt-1\">MÔéü = {moment1.toFixed(1)} N┬Àm</div>\r\n                                </div>\r\n\r\n                                <div className=\"bg-blue-900/20 p-3 rounded border-l-4 border-blue-500\">\r\n                                    <label className=\"text-xs text-blue-400 font-bold block mb-1\">Force Droite (FÔéé)</label>\r\n                                    <div className=\"grid grid-cols-2 gap-2\">\r\n                                        <div>\r\n                                            <span className=\"text-[10px] text-gray-400\">Force (N)</span>\r\n                                            <input type=\"range\" min=\"5\" max=\"50\" value={force2} onChange={e => setForce2(Number(e.target.value))} className=\"w-full accent-blue-500\" />\r\n                                        </div>\r\n                                        <div>\r\n                                            <span className=\"text-[10px] text-gray-400\">Dist (m)</span>\r\n                                            <input type=\"range\" min=\"0.5\" max=\"2.5\" step=\"0.1\" value={distance2} onChange={e => setDistance2(Number(e.target.value))} className=\"w-full accent-blue-500\" />\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"text-right text-xs text-blue-300 mt-1\">MÔéé = {moment2.toFixed(1)} N┬Àm</div>\r\n                                </div>\r\n\r\n                                <div className={`text-center p-2 rounded ${isEquilibrium ? 'bg-green-500/20 text-green-400' : 'bg-orange-500/20 text-orange-400'}`}>\r\n                                    <div className=\"font-bold text-sm\">╬úM = {(momentNet).toFixed(1)} N┬Àm</div>\r\n                                    <div className=\"text-[10px]\">{isEquilibrium ? '├ëQUILIBRE STABLE' : 'D├ëS├ëQUILIBRE'}</div>\r\n                                </div>\r\n                            </div>\r\n                        </>\r\n                    ) : (\r\n                        <div className=\"bg-gray-900/50 p-4 rounded-xl border border-orange-500/30\">\r\n                            <div className=\"flex justify-between items-center mb-6\">\r\n                                <h3 className=\"text-orange-300 font-bold flex items-center gap-2\">\r\n                                    <span>­ƒÅù´©Å</span> D├®fi Architecte\r\n                                </h3>\r\n                                <XPBar current={score} nextLevel={100} />\r\n                            </div>\r\n\r\n                            {targetMoment ? (\r\n                                <div className=\"space-y-4 animate-in slide-in-from-right duration-300\">\r\n                                    <div className=\"bg-red-900/30 p-3 rounded border border-red-500/30 text-center\">\r\n                                        <div className=\"text-red-200 text-xs uppercase mb-1\">Cible (Gauche)</div>\r\n                                        <div className=\"font-bold text-lg text-white\">MÔéü = {targetMoment.toFixed(1)} N┬Àm</div>\r\n                                        <div className=\"text-[10px] text-gray-400\">FÔéü={force1}N ├ù dÔéü={distance1}m</div>\r\n                                    </div>\r\n\r\n                                    <div className=\"bg-blue-900/20 p-3 rounded border border-blue-500/50\">\r\n                                        <label className=\"text-xs text-blue-300 font-bold block mb-2\">Ajuste le Contrepoids (Droite)</label>\r\n\r\n                                        <div className=\"mb-2\">\r\n                                            <label className=\"text-[10px] text-gray-400 block\">Force FÔéé</label>\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <input type=\"range\" min=\"5\" max=\"50\" value={force2} onChange={e => setForce2(Number(e.target.value))} className=\"flex-1 accent-blue-500\" />\r\n                                                <span className=\"text-xs font-mono w-12 text-right\">{force2}N</span>\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        <div>\r\n                                            <label className=\"text-[10px] text-gray-400 block\">Distance dÔéé</label>\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <input type=\"range\" min=\"0.5\" max=\"2.5\" step=\"0.1\" value={distance2} onChange={e => setDistance2(Number(e.target.value))} className=\"flex-1 accent-blue-500\" />\r\n                                                <span className=\"text-xs font-mono w-12 text-right\">{distance2}m</span>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <button onClick={checkChallenge} className=\"w-full py-2 bg-orange-600 hover:bg-orange-500 rounded-lg font-bold text-white shadow-lg shadow-orange-900/30\">\r\n                                        V├®rifier l'├ëquilibre\r\n                                    </button>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"text-center py-8\">\r\n                                    <button onClick={startChallenge} className=\"px-8 py-3 bg-orange-600 hover:bg-orange-500 text-white rounded-full font-bold shadow-lg shadow-orange-900/20 transition-all transform hover:scale-105\">\r\n                                        Relever le D├®fi\r\n                                    </button>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n        </group>\r\n    );\r\n}\r\n\r\nexport default {\r\n    MouvementSeconde,\r\n    ForcesPoidsSeconde,\r\n    Equilibre3ForcesSeconde,\r\n    MomentForceSeconde\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\Physique2ndeSimulationsPart3.js","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":218,"column":103,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[11925,11957],"text":"Ajuste la position de l&apos;obstacle"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[11925,11957],"text":"Ajuste la position de l&lsquo;obstacle"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[11925,11957],"text":"Ajuste la position de l&#39;obstacle"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[11925,11957],"text":"Ajuste la position de l&rsquo;obstacle"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":418,"column":98,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[22714,22735],"text":"Angle d&apos;incidence (i)"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[22714,22735],"text":"Angle d&lsquo;incidence (i)"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[22714,22735],"text":"Angle d&#39;incidence (i)"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[22714,22735],"text":"Angle d&rsquo;incidence (i)"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":454,"column":103,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[25574,25600],"text":"Ajuste l&apos;Angle d'Incidence"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[25574,25600],"text":"Ajuste l&lsquo;Angle d'Incidence"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[25574,25600],"text":"Ajuste l&#39;Angle d'Incidence"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[25574,25600],"text":"Ajuste l&rsquo;Angle d'Incidence"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":454,"column":111,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[25574,25600],"text":"Ajuste l'Angle d&apos;Incidence"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[25574,25600],"text":"Ajuste l'Angle d&lsquo;Incidence"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[25574,25600],"text":"Ajuste l'Angle d&#39;Incidence"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[25574,25600],"text":"Ajuste l'Angle d&rsquo;Incidence"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":641,"column":98,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[35763,35785],"text":"Angle d&apos;incidence (iÔéü)"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[35763,35785],"text":"Angle d&lsquo;incidence (iÔéü)"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[35763,35785],"text":"Angle d&#39;incidence (iÔéü)"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[35763,35785],"text":"Angle d&rsquo;incidence (iÔéü)"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":679,"column":93,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[38716,38751],"text":"Change l&apos;angle et devine l'indice !"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[38716,38751],"text":"Change l&lsquo;angle et devine l'indice !"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[38716,38751],"text":"Change l&#39;angle et devine l'indice !"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[38716,38751],"text":"Change l&rsquo;angle et devine l'indice !"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":679,"column":111,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[38716,38751],"text":"Change l'angle et devine l&apos;indice !"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[38716,38751],"text":"Change l'angle et devine l&lsquo;indice !"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[38716,38751],"text":"Change l'angle et devine l&#39;indice !"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[38716,38751],"text":"Change l'angle et devine l&rsquo;indice !"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":683,"column":102,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[38981,39003],"text":"Angle d&apos;incidence (iÔéü)"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[38981,39003],"text":"Angle d&lsquo;incidence (iÔéü)"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[38981,39003],"text":"Angle d&#39;incidence (iÔéü)"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[38981,39003],"text":"Angle d&rsquo;incidence (iÔéü)"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"import/no-anonymous-default-export","severity":1,"message":"Assign object to a variable before exporting as module default","line":721,"column":1,"nodeType":"ExportDefaultDeclaration","endLine":725,"endColumn":3}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Physique 2nde Simulations - Part 3: Optique (Chapitres 13-15)\r\n * High-quality 3D simulations for Seconde curriculum\r\n */\r\nimport React, { useState, useRef, useEffect, useMemo } from 'react';\r\nimport { useFrame } from '@react-three/fiber';\r\nimport { Html, Sphere, Box, Cylinder, Line, Text, Plane } from '@react-three/drei';\r\nimport * as THREE from 'three';\r\nimport DraggableHtmlPanel from './DraggableHtmlPanel';\r\nimport { PhaseSelector, GradeBadge, MissionObjective, XPBar, SuccessOverlay, ConfettiExplosion } from './GamificationUtils';\r\n\r\n// ============================================================\r\n// P13. PROPAGATION RECTILIGNE DE LA LUMI├êRE\r\n// ============================================================\r\n// ============================================================\r\n// P13. PROPAGATION RECTILIGNE DE LA LUMI├êRE (ENRICHI)\r\n// ============================================================\r\nexport function PropagationLumiereSeconde() {\r\n    const [sourceType, setSourceType] = useState('ponctuelle');\r\n    const [showRays, setShowRays] = useState(true);\r\n    const [showShadow, setShowShadow] = useState(true);\r\n    const [obstaclePosition, setObstaclePosition] = useState(0);\r\n    const lightRef = useRef();\r\n\r\n    useFrame((state) => {\r\n        if (lightRef.current) {\r\n            lightRef.current.intensity = 1 + Math.sin(state.clock.elapsedTime * 3) * 0.2;\r\n        }\r\n    });\r\n\r\n    const h_obstacle = 0.4;\r\n    const d_source_screen = 8;\r\n    const d_source_obstacle = obstaclePosition - (-4);\r\n    const safe_d_so = Math.max(0.1, d_source_obstacle);\r\n    const shadowScale = d_source_screen / safe_d_so;\r\n    const shadowWidth = 0.8 * shadowScale;\r\n    const penumbraWidth = sourceType === 'etendue' ? 0.3 * shadowScale : 0;\r\n\r\n    // Gamification\r\n    const [mode, setMode] = useState('explore');\r\n    const [targetNotchWidth, setTargetNotchWidth] = useState(null);\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n\r\n    const startChallenge = () => {\r\n        setMode('challenge');\r\n        const target = Math.random() * 2 + 1;\r\n        setTargetNotchWidth(target);\r\n        setObstaclePosition(0);\r\n        setScore(0);\r\n        setShowSuccess(false);\r\n    };\r\n\r\n    const checkChallenge = () => {\r\n        if (!targetNotchWidth) return;\r\n        if (Math.abs(shadowWidth - targetNotchWidth) / targetNotchWidth < 0.1) {\r\n            setShowSuccess(true);\r\n            setScore(s => s + 100);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            <SuccessOverlay show={showSuccess} message={mode === 'challenge' ? `Bravo ! Ombre de ${shadowWidth.toFixed(2)}m obtenue.` : \"D├®fi r├®ussi !\"} points={100} onNext={startChallenge} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            {/* Light source */}\r\n            <group position={[-4, 0, 0]}>\r\n                {sourceType === 'ponctuelle' ? (\r\n                    <Sphere args={[0.3, 16, 16]}>\r\n                        <meshStandardMaterial color=\"#ffeb3b\" emissive=\"#ff9800\" emissiveIntensity={1} />\r\n                    </Sphere>\r\n                ) : (\r\n                    <Box args={[0.3, 1.5, 0.3]}>\r\n                        <meshStandardMaterial color=\"#ffeb3b\" emissive=\"#ff9800\" emissiveIntensity={1} />\r\n                    </Box>\r\n                )}\r\n                <Text position={[0, -1, 0]} fontSize={0.2} color=\"#fff\">\r\n                    Source {sourceType === 'ponctuelle' ? 'ponctuelle' : '├®tendue'}\r\n                </Text>\r\n                <pointLight ref={lightRef} position={[0, 0, 0]} intensity={1} color=\"#fff\" />\r\n            </group>\r\n\r\n            {/* Light rays */}\r\n            {showRays && (\r\n                <group>\r\n                    {[-0.8, -0.4, 0, 0.4, 0.8].map((offset, i) => (\r\n                        <Line\r\n                            key={i}\r\n                            points={[\r\n                                [-3.5, sourceType === 'etendue' ? offset * 0.8 : 0, 0],\r\n                                [obstaclePosition - 0.6, offset, 0]\r\n                            ]}\r\n                            color=\"#ffeb3b\"\r\n                            lineWidth={2}\r\n                            transparent\r\n                            opacity={0.7}\r\n                        />\r\n                    ))}\r\n                </group>\r\n            )}\r\n\r\n            {/* Opaque obstacle */}\r\n            <group position={[obstaclePosition, 0, 0]}>\r\n                <Cylinder args={[0.4, 0.4, 1.5, 16]} rotation={[0, 0, 0]}>\r\n                    <meshStandardMaterial color=\"#333\" />\r\n                </Cylinder>\r\n                <Text position={[0, 1.2, 0]} fontSize={0.15} color=\"#fff\">\r\n                    Obstacle opaque\r\n                </Text>\r\n            </group>\r\n\r\n            {/* Screen */}\r\n            <Box args={[0.1, 4, 3]} position={[4, 0, 0]}>\r\n                <meshStandardMaterial color=\"#e0e0e0\" />\r\n            </Box>\r\n\r\n            {/* Shadow on screen */}\r\n            {showShadow && (\r\n                <group position={[3.9, 0, 0]}>\r\n                    <Plane args={[0.1, shadowWidth]} rotation={[0, -Math.PI / 2, 0]}>\r\n                        <meshBasicMaterial color=\"#111\" side={THREE.DoubleSide} />\r\n                    </Plane>\r\n\r\n                    {sourceType === 'etendue' && (\r\n                        <>\r\n                            <Plane args={[0.1, penumbraWidth]} position={[0, shadowWidth / 2 + penumbraWidth / 2, 0]} rotation={[0, -Math.PI / 2, 0]}>\r\n                                <meshBasicMaterial color=\"#444\" transparent opacity={0.5} side={THREE.DoubleSide} />\r\n                            </Plane>\r\n                            <Plane args={[0.1, penumbraWidth]} position={[0, -shadowWidth / 2 - penumbraWidth / 2, 0]} rotation={[0, -Math.PI / 2, 0]}>\r\n                                <meshBasicMaterial color=\"#444\" transparent opacity={0.5} side={THREE.DoubleSide} />\r\n                            </Plane>\r\n                        </>\r\n                    )}\r\n\r\n                    <Text position={[0.2, -2.3, 0]} fontSize={0.15} color=\"#fff\" rotation={[0, -Math.PI / 2, 0]}>\r\n                        {sourceType === 'etendue' ? 'Ombre + P├®nombre' : 'Ombre port├®e'}\r\n                    </Text>\r\n                </group>\r\n            )}\r\n\r\n            <Text position={[4, 2.3, 0]} fontSize={0.2} color=\"#fff\">├ëcran</Text>\r\n\r\n            {showShadow && (\r\n                <Line\r\n                    points={[[obstaclePosition, 0.75, 0], [4, shadowWidth / 2 + (sourceType === 'etendue' ? penumbraWidth : 0), 0]]}\r\n                    color=\"#666\" lineWidth={1} dashed\r\n                />\r\n            )}\r\n\r\n            {mode === 'challenge' && (\r\n                <group position={[4, 0, 0]}>\r\n                    <Plane args={[0.1, targetNotchWidth]} rotation={[0, -Math.PI / 2, 0]}>\r\n                        <meshBasicMaterial color=\"#e91e63\" transparent opacity={0.3} side={THREE.DoubleSide} />\r\n                    </Plane>\r\n                    <Text position={[0.2, targetNotchWidth / 2 + 0.2, 0]} fontSize={0.15} color=\"#e91e63\" rotation={[0, -Math.PI / 2, 0]}>Cible</Text>\r\n                    <Text position={[0.2, -targetNotchWidth / 2 - 0.2, 0]} fontSize={0.15} color=\"#e91e63\" rotation={[0, -Math.PI / 2, 0]}>Cible</Text>\r\n                </group>\r\n            )}\r\n\r\n            <Html position={[6, 2, 0]} transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒÆí Propagation de la Lumi├¿re\" className=\"w-[350px] border-amber-500/30 text-white\">\r\n                    <div className=\"mb-4\">\r\n                        <PhaseSelector currentPhase={mode} onSelect={setMode} />\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-between items-end mb-4 pb-2 border-b border-white/10\">\r\n                        <div>\r\n                            <div className=\"text-xs text-amber-400 font-bold uppercase tracking-wider mb-1\">Module Optique</div>\r\n                            <div className=\"text-xl font-black text-white leading-none\">PROPAGATION</div>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {mode === 'explore' ? (\r\n                        <>\r\n                            <MissionObjective objective=\"Observez la formation des ombres !\" icon=\"­ƒÆí\" />\r\n                            <div className=\"space-y-4\">\r\n                                <div className=\"bg-gray-800 p-3 rounded\">\r\n                                    <label className=\"text-xs text-gray-400 block mb-2\">Type de source</label>\r\n                                    <div className=\"flex gap-2\">\r\n                                        <button onClick={() => setSourceType('ponctuelle')} className={`flex-1 py-2 rounded text-xs ${sourceType === 'ponctuelle' ? 'bg-amber-600' : 'bg-gray-700'}`}>ÔÜ¬ Ponctuelle</button>\r\n                                        <button onClick={() => setSourceType('etendue')} className={`flex-1 py-2 rounded text-xs ${sourceType === 'etendue' ? 'bg-amber-600' : 'bg-gray-700'}`}>­ƒôÅ ├ëtendue</button>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"bg-gray-800 p-3 rounded\">\r\n                                    <label className=\"text-xs text-gray-400 block mb-1\">Position obstacle: {obstaclePosition.toFixed(2)}m</label>\r\n                                    <input type=\"range\" min=\"-2\" max=\"2\" step=\"0.05\" value={obstaclePosition} onChange={(e) => setObstaclePosition(parseFloat(e.target.value))} className=\"w-full accent-amber-500\" />\r\n                                </div>\r\n\r\n                                <div className=\"grid grid-cols-2 gap-2 text-xs text-gray-300\">\r\n                                    <label className=\"flex items-center gap-2\"><input type=\"checkbox\" checked={showRays} onChange={(e) => setShowRays(e.target.checked)} className=\"accent-amber-500\" /> Rayons</label>\r\n                                    <label className=\"flex items-center gap-2\"><input type=\"checkbox\" checked={showShadow} onChange={(e) => setShowShadow(e.target.checked)} className=\"accent-amber-500\" /> Ombre</label>\r\n                                </div>\r\n\r\n                                <div className=\"bg-amber-900/20 p-2 rounded text-center\">\r\n                                    <div className=\"text-xs text-amber-200\">Largeur Ombre</div>\r\n                                    <div className=\"text-lg font-bold text-white\">{shadowWidth.toFixed(2)} m</div>\r\n                                    {sourceType === 'etendue' && <div className=\"text-xs text-gray-400 mt-1\">P├®nombre: {penumbraWidth.toFixed(2)} m</div>}\r\n                                </div>\r\n                            </div>\r\n                        </>\r\n                    ) : (\r\n                        <div className=\"bg-gray-900/50 p-4 rounded-xl border border-amber-500/30\">\r\n                            <div className=\"flex justify-between items-center mb-6\">\r\n                                <h3 className=\"text-amber-300 font-bold flex items-center gap-2\">\r\n                                    <span>­ƒÄÑ</span> D├®fi Projectionniste\r\n                                </h3>\r\n                                <XPBar current={score} nextLevel={100} />\r\n                            </div>\r\n\r\n                            {targetNotchWidth ? (\r\n                                <div className=\"space-y-4 animate-in slide-in-from-right duration-300\">\r\n                                    <div className=\"bg-black/30 p-3 rounded border border-amber-500/30 text-center\">\r\n                                        <div className=\"text-amber-200 text-xs uppercase mb-1\">Cible (Zone Rose)</div>\r\n                                        <div className=\"font-bold text-2xl text-white\">{targetNotchWidth.toFixed(2)} m</div>\r\n                                        <div className=\"text-xs text-gray-500\">Ajuste la position de l'obstacle</div>\r\n                                    </div>\r\n\r\n                                    <div className=\"bg-gray-800 p-3 rounded-lg\">\r\n                                        <label className=\"text-xs text-gray-400 block mb-1\">Position Obstacle</label>\r\n                                        <input type=\"range\" min=\"-2\" max=\"2\" step=\"0.01\" value={obstaclePosition} onChange={e => setObstaclePosition(parseFloat(e.target.value))} className=\"w-full accent-amber-500\" />\r\n                                        <div className=\"flex justify-between text-xs mt-1\">\r\n                                            <span>Proche Source</span>\r\n                                            <span>Proche ├ëcran</span>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"text-center text-xs\">\r\n                                        <span className=\"text-gray-400\">Taille Actuelle: </span>\r\n                                        <strong className={Math.abs(shadowWidth - targetNotchWidth) / targetNotchWidth < 0.1 ? 'text-green-400' : 'text-white'}>{shadowWidth.toFixed(2)} m</strong>\r\n                                    </div>\r\n\r\n                                    <button onClick={checkChallenge} className=\"w-full py-2 bg-pink-600 hover:bg-pink-500 rounded-lg font-bold text-white shadow-lg shadow-pink-900/30\">\r\n                                        V├®rifier la Taille\r\n                                    </button>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"text-center py-8\">\r\n                                    <button onClick={startChallenge} className=\"px-8 py-3 bg-amber-600 hover:bg-amber-500 text-white rounded-full font-bold shadow-lg shadow-amber-900/20 transition-all transform hover:scale-105\">\r\n                                        Relever le D├®fi\r\n                                    </button>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// P14. R├ëFLEXION DE LA LUMI├êRE\r\n// ============================================================\r\n// ============================================================\r\n// P14. R├ëFLEXION DE LA LUMI├êRE (ENRICHI)\r\n// ============================================================\r\nexport function ReflexionLumiereSeconde() {\r\n    const [angleIncidence, setAngleIncidence] = useState(45);\r\n    const [showNormal, setShowNormal] = useState(true);\r\n    const [showAngles, setShowAngles] = useState(true);\r\n    const [mirrorType, setMirrorType] = useState('plan');\r\n\r\n    const rad = (angleIncidence * Math.PI) / 180;\r\n    const angleReflexion = angleIncidence; // i = r\r\n\r\n    // Gamification\r\n    const [mode, setMode] = useState('explore');\r\n    const [targetAngle, setTargetAngle] = useState(null);\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [hitTarget, setHitTarget] = useState(false);\r\n\r\n    const startChallenge = () => {\r\n        setMode('challenge');\r\n        // Random target angle\r\n        const target = Math.floor(Math.random() * 60 + 10); // 10 to 70 deg\r\n        setTargetAngle(target);\r\n        setAngleIncidence(45); // reset\r\n        setHitTarget(false);\r\n        setScore(0);\r\n        setShowSuccess(false);\r\n    };\r\n\r\n    const checkChallenge = () => {\r\n        if (!targetAngle) return;\r\n        if (Math.abs(angleReflexion - targetAngle) < 3) {\r\n            setHitTarget(true);\r\n            setShowSuccess(true);\r\n            setScore(s => s + 100);\r\n        }\r\n    };\r\n\r\n    // Calculate ray positions\r\n    const rayLength = 3;\r\n    const incidentEnd = [-rayLength * Math.sin(rad), rayLength * Math.cos(rad), 0];\r\n    const reflectedEnd = [rayLength * Math.sin(rad), rayLength * Math.cos(rad), 0];\r\n\r\n    return (\r\n        <group>\r\n            <SuccessOverlay show={showSuccess} message=\"Cible touch├®e ! Excellent tir.\" points={100} onNext={startChallenge} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            {/* Mirror surface */}\r\n            <group rotation={[0, 0, 0]}>\r\n                {mirrorType === 'plan' ? (\r\n                    <Box args={[6, 0.1, 2]} position={[0, 0, 0]}>\r\n                        <meshStandardMaterial color=\"#90caf9\" metalness={0.9} roughness={0.1} />\r\n                    </Box>\r\n                ) : (\r\n                    <mesh position={[0, 0, 0]}>\r\n                        <cylinderGeometry args={[3, 3, 2, 32, 1, true, Math.PI * 0.75, Math.PI * 0.5]} />\r\n                        <meshStandardMaterial color=\"#90caf9\" metalness={0.9} roughness={0.1} side={THREE.DoubleSide} />\r\n                    </mesh>\r\n                )}\r\n                <Text position={[0, -0.5, 0]} fontSize={0.2} color=\"#fff\">\r\n                    Miroir {mirrorType}\r\n                </Text>\r\n            </group>\r\n\r\n            {/* Normal line */}\r\n            {showNormal && (\r\n                <group>\r\n                    <Line points={[[0, 0, 0], [0, 3.5, 0]]} color=\"#9c27b0\" lineWidth={2} dashed dashSize={0.1} />\r\n                    <Text position={[0.3, 3.2, 0]} fontSize={0.15} color=\"#9c27b0\">Normale (N)</Text>\r\n                </group>\r\n            )}\r\n\r\n            {/* Incident ray */}\r\n            <group>\r\n                <Line points={[incidentEnd, [0, 0, 0]]} color=\"#ffeb3b\" lineWidth={4} />\r\n                <Sphere args={[0.1, 8, 8]} position={incidentEnd}>\r\n                    <meshStandardMaterial color=\"#ffeb3b\" emissive=\"#ff9800\" emissiveIntensity={0.5} />\r\n                </Sphere>\r\n                <Text position={[incidentEnd[0] - 0.5, incidentEnd[1] + 0.3, 0]} fontSize={0.15} color=\"#ffeb3b\">Rayon incident</Text>\r\n            </group>\r\n\r\n            {/* Reflected ray */}\r\n            <group>\r\n                <Line points={[[0, 0, 0], reflectedEnd]} color=\"#4caf50\" lineWidth={4} />\r\n                <Text position={[reflectedEnd[0] + 0.3, reflectedEnd[1] + 0.3, 0]} fontSize={0.15} color=\"#4caf50\">Rayon r├®fl├®chi</Text>\r\n            </group>\r\n\r\n            {/* Angle arcs */}\r\n            {showAngles && (\r\n                <group>\r\n                    <mesh rotation={[0, 0, 0]}>\r\n                        <ringGeometry args={[0.8, 0.9, 32, 1, Math.PI / 2, rad]} />\r\n                        <meshBasicMaterial color=\"#ffeb3b\" transparent opacity={0.5} side={THREE.DoubleSide} />\r\n                    </mesh>\r\n                    <Text position={[-0.5, 1.2, 0]} fontSize={0.15} color=\"#ffeb3b\">i = {angleIncidence}┬░</Text>\r\n\r\n                    <mesh rotation={[0, 0, 0]}>\r\n                        <ringGeometry args={[0.8, 0.9, 32, 1, Math.PI / 2 - rad, rad]} />\r\n                        <meshBasicMaterial color=\"#4caf50\" transparent opacity={0.5} side={THREE.DoubleSide} />\r\n                    </mesh>\r\n                    <Text position={[0.5, 1.2, 0]} fontSize={0.15} color=\"#4caf50\">r = {angleReflexion}┬░</Text>\r\n                </group>\r\n            )}\r\n\r\n            {/* Point of incidence */}\r\n            <Sphere args={[0.12, 16, 16]} position={[0, 0, 0]}><meshStandardMaterial color=\"#f44336\" /></Sphere>\r\n            <Text position={[0.3, -0.25, 0]} fontSize={0.12} color=\"#f44336\">I</Text>\r\n\r\n            {/* Virtual image indicator (for plane mirror) */}\r\n            {mirrorType === 'plan' && mode === 'explore' && (\r\n                <group position={[0, -2.5, 0]}>\r\n                    <Sphere args={[0.15, 16, 16]} position={incidentEnd}>\r\n                        <meshStandardMaterial color=\"#ffeb3b\" transparent opacity={0.4} />\r\n                    </Sphere>\r\n                    <Text position={[incidentEnd[0], incidentEnd[1] - 0.3, 0]} fontSize={0.12} color=\"#aaa\">Image virtuelle</Text>\r\n                    <Line points={[[0, 0, 0], [incidentEnd[0], incidentEnd[1], 0]]} color=\"#aaa\" lineWidth={1} dashed />\r\n                </group>\r\n            )}\r\n\r\n            {/* Target for Challenge */}\r\n            {mode === 'challenge' && targetAngle && (\r\n                <group>\r\n                    <group rotation={[0, 0, -targetAngle * Math.PI / 180]}>\r\n                        <mesh position={[0, 2.5, 0]}>\r\n                            <circleGeometry args={[0.3, 32]} />\r\n                            <meshBasicMaterial color={hitTarget ? \"#4caf50\" : \"#e91e63\"} transparent opacity={0.5} />\r\n                        </mesh>\r\n                        <Text position={[0, 2.5, 0.1]} fontSize={0.1} color=\"white\">CIBLE</Text>\r\n                    </group>\r\n                </group>\r\n            )}\r\n\r\n            <Html position={[5, 3, 0]} transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒ¬× R├®flexion de la Lumi├¿re\" className=\"w-[350px] border-blue-500/30 text-white\">\r\n                    <div className=\"mb-4\">\r\n                        <PhaseSelector currentPhase={mode} onSelect={setMode} />\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-between items-end mb-4 pb-2 border-b border-white/10\">\r\n                        <div>\r\n                            <div className=\"text-xs text-blue-400 font-bold uppercase tracking-wider mb-1\">Module Optique</div>\r\n                            <div className=\"text-xl font-black text-white leading-none\">R├ëFLEXION</div>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {mode === 'explore' ? (\r\n                        <>\r\n                            <MissionObjective objective=\"Manipulez la lumi├¿re avec un miroir !\" icon=\"­ƒ¬×\" />\r\n                            <div className=\"space-y-4\">\r\n                                <div className=\"bg-gray-800 p-3 rounded\">\r\n                                    <label className=\"text-xs text-secondary block mb-2\">Type de miroir</label>\r\n                                    <div className=\"flex gap-2\">\r\n                                        <button onClick={() => setMirrorType('plan')} className={`flex-1 py-2 rounded text-xs ${mirrorType === 'plan' ? 'bg-blue-600' : 'bg-gray-700'}`}>­ƒôÅ Plan</button>\r\n                                        <button onClick={() => setMirrorType('courbe')} className={`flex-1 py-2 rounded text-xs ${mirrorType === 'courbe' ? 'bg-blue-600' : 'bg-gray-700'}`}>­ƒöÁ Courbe</button>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"bg-gray-800 p-3 rounded border-l-4 border-yellow-500\">\r\n                                    <label className=\"text-xs text-yellow-400 block mb-1\">Angle d'incidence (i)</label>\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <input type=\"range\" min=\"10\" max=\"80\" value={angleIncidence} onChange={(e) => setAngleIncidence(parseFloat(e.target.value))} className=\"flex-1 accent-yellow-400\" />\r\n                                        <span className=\"font-bold w-10 text-right\">{angleIncidence}┬░</span>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"grid grid-cols-2 gap-2 text-xs text-gray-300\">\r\n                                    <label className=\"flex items-center gap-2\"><input type=\"checkbox\" checked={showNormal} onChange={(e) => setShowNormal(e.target.checked)} className=\"accent-blue-500\" /> Normale</label>\r\n                                    <label className=\"flex items-center gap-2\"><input type=\"checkbox\" checked={showAngles} onChange={(e) => setShowAngles(e.target.checked)} className=\"accent-blue-500\" /> Angles</label>\r\n                                </div>\r\n\r\n                                <div className=\"bg-blue-900/20 p-2 rounded text-center\">\r\n                                    <div className=\"text-xs text-blue-200\">Loi de la R├®flexion</div>\r\n                                    <div className=\"font-bold text-white\">i = r</div>\r\n                                    <div className=\"text-xs text-gray-400\">{angleIncidence}┬░ = {angleReflexion}┬░</div>\r\n                                </div>\r\n                            </div>\r\n                        </>\r\n                    ) : (\r\n                        <div className=\"bg-gray-900/50 p-4 rounded-xl border border-blue-500/30\">\r\n                            <div className=\"flex justify-between items-center mb-6\">\r\n                                <h3 className=\"text-blue-300 font-bold flex items-center gap-2\">\r\n                                    <span>­ƒÄ»</span> D├®fi Sniper Optique\r\n                                </h3>\r\n                                <XPBar current={score} nextLevel={100} />\r\n                            </div>\r\n\r\n                            {targetAngle ? (\r\n                                <div className=\"space-y-4 animate-in slide-in-from-right duration-300\">\r\n                                    <div className=\"bg-pink-900/30 p-3 rounded border border-pink-500/30 text-center\">\r\n                                        <div className=\"text-pink-200 text-xs uppercase mb-1\">Cible D├®tect├®e</div>\r\n                                        <div className=\"font-bold text-lg text-white\">Angle Cible: {targetAngle}┬░</div>\r\n                                    </div>\r\n\r\n                                    <div className=\"bg-gray-800 p-3 rounded-lg\">\r\n                                        <label className=\"text-xs text-yellow-400 block mb-1\">Ajuste l'Angle d'Incidence</label>\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <input type=\"range\" min=\"10\" max=\"80\" value={angleIncidence} onChange={(e) => setAngleIncidence(parseFloat(e.target.value))} className=\"w-full accent-yellow-500\" />\r\n                                            <span className=\"text-xs font-mono w-8\">{angleIncidence}┬░</span>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <button onClick={checkChallenge} disabled={hitTarget} className={`w-full py-2 rounded-lg font-bold text-white shadow-lg ${hitTarget ? 'bg-green-600' : 'bg-pink-600 hover:bg-pink-500 shadow-pink-900/30'}`}>\r\n                                        {hitTarget ? 'CIBLE TOUCH├ëE !' : 'Tirer le Rayon'}\r\n                                    </button>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"text-center py-8\">\r\n                                    <button onClick={startChallenge} className=\"px-8 py-3 bg-blue-600 hover:bg-blue-500 text-white rounded-full font-bold shadow-lg shadow-blue-900/20 transition-all transform hover:scale-105\">\r\n                                        Relever le D├®fi\r\n                                    </button>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// P15. R├ëFRACTION ET DISPERSION (ENRICHI)\r\n// ============================================================\r\nexport function RefractionDispersionSeconde() {\r\n    const [angleIncidence, setAngleIncidence] = useState(45);\r\n    const [milieu1, setMilieu1] = useState('air');\r\n    const [milieu2, setMilieu2] = useState('eau');\r\n    const [showNormal, setShowNormal] = useState(true);\r\n    const [showDispersion, setShowDispersion] = useState(false);\r\n\r\n    // Gamification\r\n    const [mode, setMode] = useState('explore');\r\n    const [mysteryIndex, setMysteryIndex] = useState(null);\r\n    const [guessIndex, setGuessIndex] = useState(1.5);\r\n    const [score, setScore] = useState(0);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n\r\n    const indices = {\r\n        air: { n: 1.0, color: '#e3f2fd', name: 'Air' },\r\n        eau: { n: 1.33, color: '#81d4fa', name: 'Eau' },\r\n        verre: { n: 1.5, color: '#b2dfdb', name: 'Verre' },\r\n        diamant: { n: 2.4, color: '#e1bee7', name: 'Diamant' },\r\n        mystery: { n: mysteryIndex || 1.6, color: '#9e9e9e', name: 'Myst├¿re ???' }\r\n    };\r\n\r\n    const startChallenge = () => {\r\n        setMode('challenge');\r\n        // Random mystery index\r\n        const secret = Number((Math.random() * 1.0 + 1.2).toFixed(2)); // 1.2 to 2.2\r\n        setMysteryIndex(secret);\r\n        setMilieu1('air');\r\n        setMilieu2('mystery');\r\n        setScore(0);\r\n        setShowSuccess(false);\r\n    };\r\n\r\n    const checkChallenge = () => {\r\n        if (!mysteryIndex) return;\r\n        if (Math.abs(guessIndex - mysteryIndex) < 0.05) {\r\n            setShowSuccess(true);\r\n            setScore(s => s + 100);\r\n        }\r\n    };\r\n\r\n    const n1 = indices[milieu1].n;\r\n    const n2 = indices[milieu2].n;\r\n    const rad1 = (angleIncidence * Math.PI) / 180;\r\n\r\n    // Snell-Descartes: n1 sin i1 = n2 sin i2\r\n    const sinI2 = (n1 * Math.sin(rad1)) / n2;\r\n    const hasTotalReflection = sinI2 > 1;\r\n    const angleRefraction = hasTotalReflection ? 90 : (Math.asin(sinI2) * 180) / Math.PI;\r\n    const rad2 = (angleRefraction * Math.PI) / 180;\r\n\r\n    const rayLength = 2.5;\r\n    const spectrumColors = ['#ff0000', '#ff7f00', '#ffff00', '#00ff00', '#0000ff', '#4b0082', '#8f00ff'];\r\n\r\n    return (\r\n        <group>\r\n            {/* First medium (top) */}\r\n            <Box args={[8, 3, 2]} position={[0, 1.5, 0]}>\r\n                <meshStandardMaterial color={indices[milieu1].color} transparent opacity={0.3} />\r\n            </Box>\r\n            <Text position={[-3, 2.5, 1]} fontSize={0.2} color=\"#333\">{indices[milieu1].name} (nÔéü = {n1})</Text>\r\n\r\n            {/* Second medium (bottom) */}\r\n            <Box args={[8, 3, 2]} position={[0, -1.5, 0]}>\r\n                <meshStandardMaterial color={indices[milieu2].color} transparent opacity={0.5} />\r\n            </Box>\r\n            <Text position={[-3, -2.5, 1]} fontSize={0.2} color=\"#333\">\r\n                {indices[milieu2].name} (nÔéé = {mode === 'challenge' && milieu2 === 'mystery' ? '?' : n2})\r\n            </Text>\r\n\r\n            {/* Interface */}\r\n            <Box args={[8, 0.05, 2]} position={[0, 0, 0]}><meshStandardMaterial color=\"#fff\" /></Box>\r\n\r\n            {/* Normal */}\r\n            {showNormal && (\r\n                <group>\r\n                    <Line points={[[0, -2.5, 0], [0, 2.5, 0]]} color=\"#9c27b0\" lineWidth={2} dashed />\r\n                    <Text position={[0.3, 2.2, 0]} fontSize={0.15} color=\"#9c27b0\">Normale</Text>\r\n                </group>\r\n            )}\r\n\r\n            {/* Incident ray */}\r\n            <Line points={[[-rayLength * Math.sin(rad1), rayLength * Math.cos(rad1), 0], [0, 0, 0]]} color=\"#ffeb3b\" lineWidth={4} />\r\n            <Text position={[-rayLength * Math.sin(rad1) * 0.5 - 0.5, rayLength * Math.cos(rad1) * 0.5, 0]} fontSize={0.15} color=\"#ffeb3b\">Incident</Text>\r\n\r\n            {/* Refracted ray */}\r\n            {!showDispersion && (\r\n                hasTotalReflection ? (\r\n                    <group>\r\n                        <Line points={[[0, 0, 0], [rayLength * Math.sin(rad1), rayLength * Math.cos(rad1), 0]]} color=\"#f44336\" lineWidth={4} />\r\n                        <Text position={[1.5, 1.5, 0]} fontSize={0.2} color=\"#f44336\">ÔÜá´©Å R├®flexion Totale!</Text>\r\n                    </group>\r\n                ) : (\r\n                    <group>\r\n                        <Line points={[[0, 0, 0], [rayLength * Math.sin(rad2), -rayLength * Math.cos(rad2), 0]]} color=\"#4caf50\" lineWidth={4} />\r\n                        <Text position={[rayLength * Math.sin(rad2) * 0.5 + 0.3, -rayLength * Math.cos(rad2) * 0.5, 0]} fontSize={0.15} color=\"#4caf50\">R├®fract├®</Text>\r\n                    </group>\r\n                )\r\n            )}\r\n\r\n            {/* Dispersion */}\r\n            {showDispersion && !hasTotalReflection && (\r\n                <group>\r\n                    {spectrumColors.map((color, i) => {\r\n                        const dispersionAngle = angleRefraction + (i - 3) * 2;\r\n                        const dispRad = (dispersionAngle * Math.PI) / 180;\r\n                        return (\r\n                            <Line key={i} points={[[0, 0, 0], [rayLength * Math.sin(dispRad), -rayLength * Math.cos(dispRad), 0]]} color={color} lineWidth={3} />\r\n                        );\r\n                    })}\r\n                    <Text position={[2, -2, 0]} fontSize={0.15} color=\"#fff\">Dispersion (Spectre)</Text>\r\n                </group>\r\n            )}\r\n\r\n            <SuccessOverlay show={showSuccess} message={`Bravo ! Indice n = ${mysteryIndex}`} points={100} onNext={startChallenge} />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            {/* Angle indicators */}\r\n            <Text position={[-0.8, 0.8, 0]} fontSize={0.15} color=\"#ffeb3b\">iÔéü = {angleIncidence}┬░</Text>\r\n            {!hasTotalReflection && (\r\n                <Text position={[0.5, -0.8, 0]} fontSize={0.15} color=\"#4caf50\">iÔéé = {angleRefraction.toFixed(1)}┬░</Text>\r\n            )}\r\n\r\n            <Html position={[6, 2, 0]} transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒö¼ R├®fraction & Dispersion\" className=\"w-[380px] border-cyan-500/30 text-white\">\r\n                    <div className=\"mb-4\">\r\n                        <PhaseSelector currentPhase={mode} onSelect={setMode} />\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-between items-end mb-4 pb-2 border-b border-white/10\">\r\n                        <div>\r\n                            <div className=\"text-xs text-cyan-400 font-bold uppercase tracking-wider mb-1\">Module Optique</div>\r\n                            <div className=\"text-xl font-black text-white leading-none\">R├ëFRACTION</div>\r\n                        </div>\r\n                        <GradeBadge score={score} />\r\n                    </div>\r\n\r\n                    {mode === 'explore' ? (\r\n                        <>\r\n                            <MissionObjective objective=\"Simulez le changement de milieu !\" icon=\"­ƒº¬\" />\r\n                            <div className=\"space-y-4\">\r\n                                <div className=\"bg-gray-800 p-3 rounded\">\r\n                                    <label className=\"text-xs text-secondary block mb-2\">Milieux</label>\r\n                                    <div className=\"grid grid-cols-2 gap-2 mb-2\">\r\n                                        <select value={milieu1} onChange={e => setMilieu1(e.target.value)} className=\"bg-gray-700 text-xs p-1 rounded\">\r\n                                            {Object.keys(indices).filter(k => k !== 'mystery').map(k => <option key={k} value={k}>{indices[k].name}</option>)}\r\n                                        </select>\r\n                                        <select value={milieu2} onChange={e => setMilieu2(e.target.value)} className=\"bg-gray-700 text-xs p-1 rounded\">\r\n                                            {Object.keys(indices).filter(k => k !== 'mystery').map(k => <option key={k} value={k}>{indices[k].name}</option>)}\r\n                                        </select>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between text-xs text-gray-400\">\r\n                                        <span>nÔéü = {n1}</span>\r\n                                        <span>nÔéé = {n2}</span>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"bg-gray-800 p-3 rounded border-l-4 border-yellow-500\">\r\n                                    <label className=\"text-xs text-yellow-500 block mb-1\">Angle d'incidence (iÔéü)</label>\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <input type=\"range\" min=\"5\" max=\"85\" value={angleIncidence} onChange={(e) => setAngleIncidence(parseFloat(e.target.value))} className=\"flex-1 accent-yellow-400\" />\r\n                                        <span className=\"font-bold w-10 text-right text-sm\">{angleIncidence}┬░</span>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-2 mb-4\">\r\n                                    <div className=\"flex items-center gap-4\">\r\n                                        <label className=\"flex items-center gap-2 text-xs text-gray-300\">\r\n                                            <input type=\"checkbox\" checked={showNormal} onChange={(e) => setShowNormal(e.target.checked)} className=\"accent-cyan-500\" /> Normale\r\n                                        </label>\r\n                                        <label className=\"flex items-center gap-2 text-xs text-gray-300\">\r\n                                            <input type=\"checkbox\" checked={showDispersion} onChange={(e) => setShowDispersion(e.target.checked)} className=\"accent-purple-500\" /> Dispersion\r\n                                        </label>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"bg-cyan-900/20 p-2 rounded text-center\">\r\n                                    <div className=\"text-xs text-cyan-200\">Loi de Snell-Descartes</div>\r\n                                    <div className=\"font-bold text-white text-sm\">nÔéü sin(iÔéü) = nÔéé sin(iÔéé)</div>\r\n                                </div>\r\n                            </div>\r\n                        </>\r\n                    ) : (\r\n                        <div className=\"bg-gray-900/50 p-4 rounded-xl border border-cyan-500/30\">\r\n                            <div className=\"flex justify-between items-center mb-6\">\r\n                                <h3 className=\"text-cyan-300 font-bold flex items-center gap-2\">\r\n                                    <span>­ƒòÁ´©Å</span> D├®fi Indice Myst├¿re\r\n                                </h3>\r\n                                <XPBar current={score} nextLevel={100} />\r\n                            </div>\r\n\r\n                            {mysteryIndex ? (\r\n                                <div className=\"space-y-4 animate-in slide-in-from-right duration-300\">\r\n                                    <div className=\"bg-gray-800 p-3 rounded border border-gray-600 text-center\">\r\n                                        <div className=\"text-gray-400 text-xs uppercase mb-1\">Mat├®riau Inconnu</div>\r\n                                        <div className=\"font-bold text-xl text-white\">nÔéé = ???</div>\r\n                                        <div className=\"text-xs text-gray-500 mt-1\">Change l'angle et devine l'indice !</div>\r\n                                    </div>\r\n\r\n                                    <div className=\"bg-gray-800 p-3 rounded-lg\">\r\n                                        <label className=\"text-xs text-yellow-400 block mb-1\">Angle d'incidence (iÔéü)</label>\r\n                                        <input type=\"range\" min=\"5\" max=\"85\" value={angleIncidence} onChange={(e) => setAngleIncidence(parseFloat(e.target.value))} className=\"w-full accent-yellow-400\" />\r\n                                        <div className=\"flex justify-between text-xs text-gray-400 mt-1\">\r\n                                            <span>iÔéü = {angleIncidence}┬░</span>\r\n                                            <span>iÔéé = {hasTotalReflection ? 'Refl. Tot.' : angleRefraction.toFixed(1) + '┬░'}</span>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"bg-cyan-900/20 p-3 rounded border border-cyan-500/30\">\r\n                                        <label className=\"text-xs text-cyan-300 font-bold block mb-2\">Ton Estimation de nÔéé</label>\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <button onClick={() => setGuessIndex(g => Math.max(1, Number((g - 0.05).toFixed(2))))} className=\"px-2 bg-gray-700 rounded text-lg font-bold\">-</button>\r\n                                            <div className=\"flex-1 text-center font-mono text-xl font-bold bg-black/30 rounded py-1 border border-cyan-500/50 text-cyan-400\">\r\n                                                {guessIndex.toFixed(2)}\r\n                                            </div>\r\n                                            <button onClick={() => setGuessIndex(g => Math.min(3, Number((g + 0.05).toFixed(2))))} className=\"px-2 bg-gray-700 rounded text-lg font-bold\">+</button>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <button onClick={checkChallenge} className=\"w-full py-2 bg-cyan-600 hover:bg-cyan-500 rounded-lg font-bold text-white shadow-lg shadow-cyan-900/30\">\r\n                                        Valider mon hypoth├¿se\r\n                                    </button>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"text-center py-8\">\r\n                                    <button onClick={startChallenge} className=\"px-8 py-3 bg-cyan-600 hover:bg-cyan-500 text-white rounded-full font-bold shadow-lg shadow-cyan-900/20 transition-all transform hover:scale-105\">\r\n                                        Relever le D├®fi\r\n                                    </button>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n        </group>\r\n    );\r\n}\r\n\r\nexport default {\r\n    PropagationLumiereSeconde,\r\n    ReflexionLumiereSeconde,\r\n    RefractionDispersionSeconde\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\PhysiqueTSAdvanced.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'startMission'. Either include it or remove the dependency array.","line":118,"column":8,"nodeType":"ArrayExpression","endLine":118,"endColumn":31,"suggestions":[{"desc":"Update the dependencies array to be: [phase, level, mission, startMission]","fix":{"range":[4512,4535],"text":"[phase, level, mission, startMission]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'startMission'. Either include it or remove the dependency array.","line":183,"column":8,"nodeType":"ArrayExpression","endLine":183,"endColumn":45,"suggestions":[{"desc":"Update the dependencies array to be: [timeLeft, phase, showSuccess, level, startMission]","fix":{"range":[7123,7160],"text":"[timeLeft, phase, showSuccess, level, startMission]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'missions'. Either include it or remove the dependency array.","line":383,"column":8,"nodeType":"ArrayExpression","endLine":383,"endColumn":31,"suggestions":[{"desc":"Update the dependencies array to be: [phase, level, mission, missions]","fix":{"range":[18160,18183],"text":"[phase, level, mission, missions]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'missions'. Either include it or remove the dependency array.","line":598,"column":8,"nodeType":"ArrayExpression","endLine":598,"endColumn":31,"suggestions":[{"desc":"Update the dependencies array to be: [phase, level, mission, missions]","fix":{"range":[29123,29146],"text":"[phase, level, mission, missions]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'missions'. Either include it or remove the dependency array.","line":804,"column":8,"nodeType":"ArrayExpression","endLine":804,"endColumn":31,"suggestions":[{"desc":"Update the dependencies array to be: [phase, level, mission, missions]","fix":{"range":[39148,39171],"text":"[phase, level, mission, missions]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'showSuccess'. Either include it or remove the dependency array.","line":849,"column":8,"nodeType":"ArrayExpression","endLine":849,"endColumn":37,"suggestions":[{"desc":"Update the dependencies array to be: [orbitRadius, phase, mission, showSuccess]","fix":{"range":[40968,40997],"text":"[orbitRadius, phase, mission, showSuccess]"}}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":922,"column":37,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[45224,45346],"text":"\r\n                                    &quot;La p├®riode augmente avec le cube de la distance.\"\r\n                                "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[45224,45346],"text":"\r\n                                    &ldquo;La p├®riode augmente avec le cube de la distance.\"\r\n                                "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[45224,45346],"text":"\r\n                                    &#34;La p├®riode augmente avec le cube de la distance.\"\r\n                                "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[45224,45346],"text":"\r\n                                    &rdquo;La p├®riode augmente avec le cube de la distance.\"\r\n                                "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":922,"column":86,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[45224,45346],"text":"\r\n                                    \"La p├®riode augmente avec le cube de la distance.&quot;\r\n                                "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[45224,45346],"text":"\r\n                                    \"La p├®riode augmente avec le cube de la distance.&ldquo;\r\n                                "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[45224,45346],"text":"\r\n                                    \"La p├®riode augmente avec le cube de la distance.&#34;\r\n                                "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[45224,45346],"text":"\r\n                                    \"La p├®riode augmente avec le cube de la distance.&rdquo;\r\n                                "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n/**\r\n * Physique Terminale S - Simulations Avanc├®es\r\n * Partie 1: Cin├®matique - Dynamique (Chapitres 1-4)\r\n * Mode D├®fi avec gamification compl├¿te\r\n */\r\nimport React, { useState, useRef, useEffect, useMemo, useCallback } from 'react';\r\nimport { useFrame } from '@react-three/fiber';\r\nimport { Html, Sphere, Box, Cylinder, Line, Text, Float, Cone, Ring } from '@react-three/drei';\r\nimport * as THREE from 'three';\r\nimport DraggableHtmlPanel from './DraggableHtmlPanel';\r\nimport {\r\n    SuccessOverlay,\r\n    ConfettiExplosion,\r\n    ChallengeTimer,\r\n    ParticleTrail,\r\n    GradeBadge,\r\n    XPBar,\r\n    PhaseSelector,\r\n    MissionObjective\r\n} from './GamificationUtils';\r\n\r\n// ============================================================\r\n// COMPOSANTS UTILITAIRES R├ëUTILISABLES\r\n// ============================================================\r\n\r\n// ============================================================\r\n// P1. CIN├ëMATIQUE DU POINT - VERSION AVANC├ëE\r\n// Mission: Course Spatiale - Atteindre des cibles avec le bon mouvement\r\n// ============================================================\r\nexport function CinematiquePointAdvanced() {\r\n    // ├ëtats Globaux & Gamification\r\n    const [phase, setPhase] = useState('explore'); // explore, train, mission\r\n    const [score, setScore] = useState(0);\r\n    const [level, setLevel] = useState(1);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n    const [streak, setStreak] = useState(0);\r\n\r\n    // ├ëtats Physiques de l'Engin\r\n    const [motionType, setMotionType] = useState('mru');\r\n    const [running, setRunning] = useState(false);\r\n    const [time, setTime] = useState(0);\r\n    const [v0, setV0] = useState(2);\r\n    const [acceleration, setAcceleration] = useState(0.5);\r\n    const [omega, setOmega] = useState(1);\r\n    const [radius, setRadius] = useState(2);\r\n\r\n    // Environnement & Cibles\r\n    const [targetPos, setTargetPos] = useState({ x: 3, y: 0 });\r\n    const [targetReached, setTargetReached] = useState(false);\r\n    const [obstacles, setObstacles] = useState([]);\r\n\r\n    const particleRef = useRef();\r\n    const trailPoints = useRef([]);\r\n\r\n    // Configuration des Missions\r\n    const missions = useMemo(() => [\r\n        {\r\n            id: 1,\r\n            type: 'mru',\r\n            title: 'Docking Orbital',\r\n            desc: 'Stabilisez le vecteur vitesse pour approcher la station.',\r\n            objective: 'Atteignez la zone bleue ├á une vitesse constante de 3.0 m/s.',\r\n            targetX: 3.5,\r\n            targetY: 0,\r\n            reqV: 3.0,\r\n            tolerance: 0.1\r\n        },\r\n        {\r\n            id: 2,\r\n            type: 'mruv',\r\n            title: 'Freinage d\\'Urgence',\r\n            desc: 'Un d├®bris approche ! Stoppez-vous exactement dans la zone de s├®curit├®.',\r\n            objective: 'La vitesse finale v(t) doit ├¬tre nulle sur la cible.',\r\n            targetX: 3.0,\r\n            targetY: 0,\r\n            reqV: 0,\r\n            tolerance: 0.2\r\n        },\r\n        {\r\n            id: 3,\r\n            type: 'mcu',\r\n            title: 'Mise en Orbite',\r\n            desc: 'Maintenez un rayon de courbure constant pour scanner la plan├¿te.',\r\n            objective: 'Synchronisez votre rotation ╬©(t) avec la balise.',\r\n            targetX: 0,\r\n            targetY: 2.5,\r\n            reqR: 2.5,\r\n            tolerance: 0.1\r\n        }\r\n    ], []);\r\n\r\n    // Logique Cin├®matique\r\n    const getPosition = useCallback((t) => {\r\n        if (motionType === 'mru') return { x: v0 * t - 4, y: 0 };\r\n        if (motionType === 'mruv') return { x: 0.5 * acceleration * t * t + v0 * t - 4, y: 0 };\r\n        return { x: radius * Math.cos(omega * t), y: radius * Math.sin(omega * t) };\r\n    }, [motionType, v0, acceleration, omega, radius]);\r\n\r\n    const getVelocity = useCallback((t) => {\r\n        if (motionType === 'mru') return { vx: v0, vy: 0, magnitude: v0 };\r\n        if (motionType === 'mruv') {\r\n            const vx = acceleration * t + v0;\r\n            return { vx, vy: 0, magnitude: Math.abs(vx) };\r\n        }\r\n        const vx = -radius * omega * Math.sin(omega * t);\r\n        const vy = radius * omega * Math.cos(omega * t);\r\n        return { vx, vy, magnitude: Math.sqrt(vx * vx + vy * vy) };\r\n    }, [motionType, v0, acceleration, omega, radius]);\r\n\r\n    // Syst├¿me de Jeu\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            startMission(level);\r\n        }\r\n    }, [phase, level, mission]); // Added mission to dependencies to prevent infinite loop if mission is null\r\n\r\n    const startMission = (lvl) => {\r\n        const m = missions[Math.min(lvl - 1, missions.length - 1)];\r\n        setMission(m);\r\n        setMotionType(m.type);\r\n        setTargetPos({ x: m.targetX, y: m.targetY });\r\n        if (m.type === 'mcu') setRadius(m.reqR || 2);\r\n        setTimeLeft(45);\r\n        resetSimulation();\r\n    };\r\n\r\n    const resetSimulation = () => {\r\n        setTime(0);\r\n        setRunning(false);\r\n        trailPoints.current = [];\r\n        setTargetReached(false);\r\n        if (particleRef.current) {\r\n            const initialPos = getPosition(0);\r\n            particleRef.current.position.set(initialPos.x, initialPos.y, 0);\r\n        }\r\n    };\r\n\r\n    useFrame((state, delta) => {\r\n        if (running && particleRef.current) {\r\n            const newTime = time + delta;\r\n            setTime(newTime);\r\n            const pos = getPosition(newTime);\r\n            particleRef.current.position.set(pos.x, pos.y, 0);\r\n\r\n            if (trailPoints.current.length < 200) {\r\n                trailPoints.current.push(new THREE.Vector3(pos.x, pos.y, 0));\r\n            }\r\n\r\n            // V├®rification Mission\r\n            if (phase === 'mission' && mission && !targetReached) {\r\n                const dist = Math.sqrt(Math.pow(pos.x - targetPos.x, 2) + Math.pow(pos.y - targetPos.y, 2));\r\n                if (dist < 0.4) {\r\n                    const vel = getVelocity(newTime);\r\n                    let success = true;\r\n                    if (mission.reqV !== undefined && Math.abs(vel.magnitude - mission.reqV) > mission.tolerance) success = false;\r\n                    // Add other mission specific checks here (e.g., for MCU radius, etc.)\r\n\r\n                    if (success) {\r\n                        setTargetReached(true);\r\n                        handleMissionSuccess();\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (Math.abs(pos.x) > 7 || Math.abs(pos.y) > 5) resetSimulation();\r\n        }\r\n    });\r\n\r\n    // Timer du d├®fi\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        } else if (timeLeft === 0 && phase === 'mission') {\r\n            // Mission failed due to timeout\r\n            setStreak(0); // Reset streak on failure\r\n            // Optionally, show a failure message or restart mission\r\n            startMission(level); // Restart current mission\r\n        }\r\n    }, [timeLeft, phase, showSuccess, level]); // Added level to dependencies\r\n\r\n    const handleMissionSuccess = () => {\r\n        const points = 100 + Math.floor(timeLeft * 5);\r\n        setScore(s => s + points);\r\n        setShowSuccess(true);\r\n        setRunning(false);\r\n    };\r\n\r\n    const nextLevel = () => {\r\n        setShowSuccess(false);\r\n        setLevel(l => Math.min(l + 1, missions.length)); // Cap level at max missions\r\n        setPhase('mission');\r\n        setMission(null); // Force reload\r\n    };\r\n\r\n    const velocity = getVelocity(time);\r\n\r\n    return (\r\n        <group>\r\n            <SuccessOverlay\r\n                show={showSuccess}\r\n                message={`F├®licitations Major ! Mission \"${mission?.title}\" r├®ussie.`}\r\n                points={100 + Math.floor(timeLeft * 5)}\r\n                onNext={nextLevel}\r\n            />\r\n            <ConfettiExplosion active={showSuccess} />\r\n            <ParticleTrail active={running && motionType === 'mcu'} color=\"#3B82F6\" />\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel\r\n                    title=\"­ƒÜÇ Syst├¿me de Navigation Cin├®matique\"\r\n                    showCloseButton={false}\r\n                    defaultPosition=\"bottom-center\"\r\n                    className=\"w-[400px] border-blue-500/30\"\r\n                >\r\n                    <div className=\"text-white\">\r\n                        {/* Barre d'ent├¬te premium */}\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <GradeBadge score={score} />\r\n                            {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={45} />}\r\n                        </div>\r\n\r\n                        <XPBar current={score} nextLevel={2000} />\r\n\r\n                        <div className=\"h-[1px] bg-gradient-to-r from-transparent via-blue-500/50 to-transparent my-4\" />\r\n\r\n                        <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                        {phase === 'mission' && mission && (\r\n                            <MissionObjective objective={mission.objective} icon=\"­ƒÜÇ\" />\r\n                        )}\r\n\r\n                        <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                            <div className=\"space-y-4\">\r\n                                <div>\r\n                                    <label className=\"text-[10px] text-gray-400 block mb-1 uppercase\">Direction du Vecteur</label>\r\n                                    <div className=\"flex gap-2\">\r\n                                        <button onClick={() => setMotionType('mru')} className={`flex-1 py-1 rounded border ${motionType === 'mru' ? 'bg-blue-600 border-blue-400' : 'bg-gray-800 border-gray-600'} text-[10px]`}>LIN├ëAIRE</button>\r\n                                        <button onClick={() => setMotionType('mcu')} className={`flex-1 py-1 rounded border ${motionType === 'mcu' ? 'bg-purple-600 border-purple-400' : 'bg-gray-800 border-gray-600'} text-[10px]`}>CIRCULAIRE</button>\r\n                                    </div>\r\n                                </div>\r\n                                {motionType !== 'mcu' && (\r\n                                    <>\r\n                                        <div>\r\n                                            <label className=\"text-[10px] text-gray-400 block\">Vitesse Initiale vÔéÇ: {v0.toFixed(1)} m/s</label>\r\n                                            <input type=\"range\" min=\"0\" max=\"5\" step=\"0.1\" value={v0} onChange={(e) => setV0(parseFloat(e.target.value))} className=\"w-full h-1 bg-gray-700 accent-blue-500\" />\r\n                                        </div>\r\n                                        <div className=\"flex items-center justify-between\">\r\n                                            <label className=\"text-[10px] text-gray-400\">Mode MRUV</label>\r\n                                            <button onClick={() => setMotionType(motionType === 'mruv' ? 'mru' : 'mruv')} className={`w-10 h-5 rounded-full transition-colors ${motionType === 'mruv' ? 'bg-orange-500' : 'bg-gray-700'}`}>\r\n                                                <div className={`w-3 h-3 bg-white rounded-full transition-transform mx-1 ${motionType === 'mruv' ? 'translate-x-5' : 'translate-x-0'}`} />\r\n                                            </button>\r\n                                        </div>\r\n                                        {motionType === 'mruv' && (\r\n                                            <div>\r\n                                                <label className=\"text-[10px] text-gray-400 block\">Acc├®l├®ration a: {acceleration.toFixed(2)} m/s┬▓</label>\r\n                                                <input type=\"range\" min=\"-1\" max=\"1\" step=\"0.05\" value={acceleration} onChange={(e) => setAcceleration(parseFloat(e.target.value))} className=\"w-full h-1 bg-gray-700 accent-orange-500\" />\r\n                                            </div>\r\n                                        )}\r\n                                    </>\r\n                                )}\r\n                                {motionType === 'mcu' && (\r\n                                    <>\r\n                                        <div>\r\n                                            <label className=\"text-[10px] text-gray-400 block\">Vitesse Angulaire ¤ë: {omega.toFixed(1)} rad/s</label>\r\n                                            <input type=\"range\" min=\"0.1\" max=\"3\" step=\"0.1\" value={omega} onChange={(e) => setOmega(parseFloat(e.target.value))} className=\"w-full h-1 bg-gray-700 accent-purple-500\" />\r\n                                        </div>\r\n                                        <div>\r\n                                            <label className=\"text-[10px] text-gray-400 block\">Rayon R: {radius.toFixed(1)} m</label>\r\n                                            <input type=\"range\" min=\"1\" max=\"3\" step=\"0.1\" value={radius} onChange={(e) => setRadius(parseFloat(e.target.value))} className=\"w-full h-1 bg-gray-700 accent-purple-500\" />\r\n                                        </div>\r\n                                    </>\r\n                                )}\r\n                            </div>\r\n\r\n                            <div className=\"bg-black/60 rounded-xl p-3 border border-white/5 flex flex-col justify-between\">\r\n                                <div className=\"space-y-2\">\r\n                                    <div className=\"text-[9px] text-gray-500 font-mono\">TELEMETRY_STREAM</div>\r\n                                    <div className=\"text-xs font-mono\">\r\n                                        <span className=\"text-emerald-400\">POS:</span> {getPosition(time).x.toFixed(2)}, {getPosition(time).y.toFixed(2)}\r\n                                    </div>\r\n                                    <div className=\"text-xs font-mono\">\r\n                                        <span className=\"text-blue-400\">VEL:</span> {velocity.magnitude.toFixed(2)} m/s\r\n                                    </div>\r\n                                    <div className=\"text-xs font-mono\">\r\n                                        <span className=\"text-yellow-400\">TIME:</span> {time.toFixed(2)}s\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-2\">\r\n                                    <button\r\n                                        onClick={() => setRunning(!running)}\r\n                                        className={`w-full py-2 rounded-lg font-bold text-xs transition-all ${running ? 'bg-red-500/20 text-red-400 border border-red-500/40' : 'bg-emerald-500/20 text-emerald-400 border border-emerald-500/40'}`}\r\n                                    >\r\n                                        {running ? 'ÔÜá´©Å ARR├èTER' : '­ƒÜÇ INITIALISER FEU'}\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={resetSimulation}\r\n                                        className=\"w-full py-2 bg-white/5 hover:bg-white/10 rounded-lg text-xs transition-all\"\r\n                                    >\r\n                                        ­ƒöä RESET\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// P2. DYNAMIQUE DE NEWTON - VERSION AVANC├ëE\r\n// Mission: Ing├®nieur Spatial - Calculer les forces pour d├®placer des cargaisons\r\n// ============================================================\r\nexport function DynamiqueNewtonAdvanced() {\r\n    // ├ëtats Globaux\r\n    const [phase, setPhase] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [level, setLevel] = useState(1);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n    const [planet, setPlanet] = useState('earth');\r\n\r\n    // ├ëtats Physiques\r\n    const [force, setForce] = useState(10);\r\n    const [mass, setMass] = useState(5);\r\n    const [friction, setFriction] = useState(2);\r\n    const [angle, setAngle] = useState(0);\r\n    const [position, setPosition] = useState(-3);\r\n    const [velocity, setVelocity] = useState(0);\r\n    const [isSimulating, setIsSimulating] = useState(false);\r\n\r\n    const boxRef = useRef();\r\n\r\n    // Donn├®es Plan├®taires\r\n    const planets = {\r\n        earth: { g: 9.81, color: '#374151', label: 'Terre ­ƒîì', bg: '#111827' },\r\n        mars: { g: 3.71, color: '#92400e', label: 'Mars ­ƒö┤', bg: '#450a0a' },\r\n        moon: { g: 1.62, color: '#4b5563', label: 'Lune ­ƒîò', bg: '#0f172a' }\r\n    };\r\n\r\n    const g = planets[planet].g;\r\n\r\n    // Config des Missions\r\n    const missions = useMemo(() => [\r\n        {\r\n            id: 1,\r\n            title: 'Livraison au Camp',\r\n            objective: 'Atteignez la zone cible avec une charge de 10kg sur Terre.',\r\n            reqMass: 10, reqPlanet: 'earth', reqAngle: 0\r\n        },\r\n        {\r\n            id: 2,\r\n            title: 'Rampe Martienne',\r\n            objective: 'Poussez le rover (5kg) sur un plan inclin├® de 20┬░ sur Mars.',\r\n            reqMass: 5, reqPlanet: 'mars', reqAngle: 20\r\n        },\r\n        {\r\n            id: 3,\r\n            title: '├ëquilibre Solaire',\r\n            objective: 'Maintenez la station en ├®quilibre statique sur la Lune (Force = Frottement).',\r\n            reqMass: 8, reqPlanet: 'moon', reqAngle: 0\r\n        }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            const m = missions[Math.min(level - 1, missions.length - 1)];\r\n            setMission(m);\r\n            setMass(m.reqMass);\r\n            setPlanet(m.reqPlanet);\r\n            setAngle(m.reqAngle);\r\n            setTimeLeft(45);\r\n            resetSimulation();\r\n        }\r\n    }, [phase, level, mission]);\r\n\r\n    // Calculs Dynamiques (Somme des forces)\r\n    const weight = mass * g;\r\n    const weightParallel = weight * Math.sin(angle * Math.PI / 180);\r\n    const weightNormal = weight * Math.cos(angle * Math.PI / 180);\r\n    const frictionForce = (friction / 10) * weightNormal;\r\n    const netForce = force - weightParallel - (velocity > 0 ? frictionForce : -frictionForce);\r\n    const acceleration = netForce / mass;\r\n\r\n    useFrame((state, delta) => {\r\n        if (isSimulating && boxRef.current) {\r\n            const newVel = velocity + acceleration * delta;\r\n            const newPos = position + newVel * delta;\r\n\r\n            if (newPos > 4) {\r\n                if (phase === 'mission') handleSuccess();\r\n                setPosition(4);\r\n                setVelocity(0);\r\n                setIsSimulating(false);\r\n            } else if (newPos < -4) {\r\n                setPosition(-4);\r\n                setVelocity(0);\r\n                setIsSimulating(false);\r\n            } else {\r\n                setPosition(newPos);\r\n                setVelocity(newVel);\r\n            }\r\n            boxRef.current.position.x = position;\r\n        }\r\n    });\r\n\r\n    const handleSuccess = () => {\r\n        setScore(s => s + 150 + Math.floor(timeLeft * 2));\r\n        setShowSuccess(true);\r\n        setIsSimulating(false);\r\n    };\r\n\r\n    const resetSimulation = () => {\r\n        setPosition(-3);\r\n        setVelocity(0);\r\n        setIsSimulating(false);\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        setLevel(l => Math.min(l + 1, 3));\r\n        setMission(null);\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            <SuccessOverlay\r\n                show={showSuccess}\r\n                message={`Masse transport├®e avec succ├¿s ! Niveau ${level} valid├®.`}\r\n                points={150 + Math.floor(timeLeft * 2)}\r\n                onNext={nextMission}\r\n            />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel\r\n                    title=\"ÔÜû´©Å Lab Dynamique - Ing├®nieur Cargo\"\r\n                    showCloseButton={false}\r\n                    defaultPosition=\"bottom-center\"\r\n                    className=\"w-[420px] border-orange-500/30\"\r\n                >\r\n                    <div className=\"text-white\">\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <GradeBadge score={score} />\r\n                            {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={45} />}\r\n                        </div>\r\n\r\n                        <XPBar current={score} nextLevel={2000} />\r\n\r\n                        <div className=\"flex gap-2 my-4\">\r\n                            {Object.entries(planets).map(([id, p]) => (\r\n                                <button\r\n                                    key={id}\r\n                                    onClick={() => setPlanet(id)}\r\n                                    className={`flex-1 py-1 rounded text-[10px] font-bold transition ${planet === id ? 'bg-white/20 border-white' : 'bg-gray-800 border-transparent'} border`}\r\n                                >\r\n                                    {p.label}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n\r\n                        <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                        {phase === 'mission' && mission && (\r\n                            <MissionObjective objective={mission.objective} icon=\"­ƒÜø\" />\r\n                        )}\r\n\r\n                        <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                            <div className=\"space-y-4\">\r\n                                <div>\r\n                                    <label className=\"text-[10px] text-gray-400 block\">Force Appliqu├®e: {force.toFixed(1)} N</label>\r\n                                    <input type=\"range\" min=\"0\" max=\"100\" step=\"1\" value={force} onChange={(e) => setForce(parseFloat(e.target.value))} className=\"w-full h-1 bg-gray-700 accent-green-500\" />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"text-[10px] text-gray-400 block\">Masse Cargo: {mass.toFixed(1)} kg</label>\r\n                                    <input type=\"range\" min=\"1\" max=\"50\" step=\"1\" value={mass} onChange={(e) => setMass(parseFloat(e.target.value))} className=\"w-full h-1 bg-gray-700 accent-blue-500\" />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"text-[10px] text-gray-400 block\">Coefficient Frottement: {friction.toFixed(1)}</label>\r\n                                    <input type=\"range\" min=\"0\" max=\"5\" step=\"0.1\" value={friction} onChange={(e) => setFriction(parseFloat(e.target.value))} className=\"w-full h-1 bg-gray-700 accent-orange-500\" />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"text-[10px] text-gray-400 block\">Inclinaison ╬▒: {angle}┬░</label>\r\n                                    <input type=\"range\" min=\"0\" max=\"45\" value={angle} onChange={(e) => setAngle(parseFloat(e.target.value))} className=\"w-full h-1 bg-gray-700 accent-yellow-400\" />\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"bg-black/60 rounded-xl p-3 border border-white/5 flex flex-col justify-between\">\r\n                                <div className=\"space-y-1\">\r\n                                    <div className=\"text-[9px] text-gray-500 font-mono\">DYNAMICS_DATA</div>\r\n                                    <div className=\"text-[11px] font-mono\"><span className=\"text-red-400\">POIDS:</span> {weight.toFixed(1)} N</div>\r\n                                    <div className=\"text-[11px] font-mono\"><span className=\"text-orange-400\">FROT:</span> {frictionForce.toFixed(1)} N</div>\r\n                                    <div className=\"text-[11px] font-mono\"><span className=\"text-emerald-400\">ACCEL:</span> {acceleration.toFixed(2)} m/s┬▓</div>\r\n                                    <div className=\"text-[11px] font-mono\"><span className=\"text-blue-400\">VITESSE:</span> {velocity.toFixed(2)} m/s</div>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-2 mt-4\">\r\n                                    <button\r\n                                        onClick={() => setIsSimulating(!isSimulating)}\r\n                                        className={`w-full py-2 rounded-lg font-bold text-xs transition-all ${isSimulating ? 'bg-red-500/20 text-red-400 border border-red-500/40' : 'bg-emerald-500/20 text-emerald-400 border border-emerald-500/40'}`}\r\n                                    >\r\n                                        {isSimulating ? 'ÔÅ© PAUSE' : 'ÔûÂ SIMULER'}\r\n                                    </button>\r\n                                    <button onClick={resetSimulation} className=\"w-full py-2 bg-white/5 hover:bg-white/10 rounded-lg text-xs transition-all\">­ƒöä RESET</button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <group rotation={[0, 0, -angle * Math.PI / 180]}>\r\n                <Box args={[12, 0.5, 4]} position={[0, -2, 0]}>\r\n                    <meshStandardMaterial color={planets[planet].color} />\r\n                </Box>\r\n\r\n                <Box args={[1.5, 0.6, 4.1]} position={[4, -2, 0]}>\r\n                    <meshStandardMaterial color=\"#4ADE80\" emissive=\"#4ADE80\" emissiveIntensity={0.5} transparent opacity={0.6} />\r\n                </Box>\r\n\r\n                <group ref={boxRef} position={[position, -0.75, 0]}>\r\n                    <Box args={[1, 1, 1]}>\r\n                        <meshStandardMaterial color=\"#3B82F6\" roughness={0.3} metalness={0.2} />\r\n                    </Box>\r\n                    <Text position={[0, 1.2, 0]} fontSize={0.2} color=\"white\">{mass} kg</Text>\r\n\r\n                    {/* Vectors */}\r\n                    <Line points={[[0, 0, 0], [force / 20, 0, 0]]} color=\"#22c55e\" lineWidth={5} />\r\n                    <Line points={[[0, 0, 0], [0, -weight / 20, 0]]} color=\"#ef4444\" lineWidth={3} />\r\n                </group>\r\n            </group>\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// P3. MOUVEMENT PROJECTILE - VERSION AVANC├ëE\r\n// Mission: Artilleur Spatial - Atteindre des cibles sur diff├®rentes plan├¿tes\r\n// ============================================================\r\nexport function ProjectileMotionAdvanced() {\r\n    // ├ëtats Globaux\r\n    const [phase, setPhase] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [level, setLevel] = useState(1);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(60);\r\n\r\n    // ├ëtats Physiques\r\n    const [angle, setAngle] = useState(45);\r\n    const [v0, setV0] = useState(15);\r\n    const [planet, setPlanet] = useState('earth');\r\n    const [launched, setLaunched] = useState(false);\r\n    const [time, setTime] = useState(0);\r\n\r\n    // Cibles & T├®l├®m├®trie\r\n    const [targetPos, setTargetPos] = useState({ x: 5, y: 0 });\r\n    const [targetHit, setTargetHit] = useState(false);\r\n    const [maxHeightObserved, setMaxHeightObserved] = useState(0);\r\n\r\n    const ballRef = useRef();\r\n    const trailPoints = useRef([]);\r\n\r\n    const planets = {\r\n        earth: { name: 'Terre', g: 9.81, color: '#3B82F6', emoji: '­ƒîì', ground: '#15803D' },\r\n        moon: { name: 'Lune', g: 1.62, color: '#9CA3AF', emoji: '­ƒîÖ', ground: '#4b5563' },\r\n        mars: { name: 'Mars', g: 3.71, color: '#EF4444', emoji: '­ƒö┤', ground: '#8B4513' }\r\n    };\r\n\r\n    const g = planets[planet].g;\r\n    const angleRad = (angle * Math.PI) / 180;\r\n    const vx = v0 * Math.cos(angleRad);\r\n    const vy = v0 * Math.sin(angleRad);\r\n\r\n    // Missions\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Cible Terrestre', planet: 'earth', targetX: 6, objective: 'Touchez la base d\\'entra├«nement ├á 6m sur Terre.' },\r\n        { id: 2, title: 'Base Lunaire', planet: 'moon', targetX: 10, objective: 'Lancez un module de ravitaillement ├á 10m sur la Lune.' },\r\n        { id: 3, title: 'Avant-poste Martien', planet: 'mars', targetX: 8, objective: 'Atteignez le d├┤me martien situ├® ├á 8m.' }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            const m = missions[Math.min(level - 1, missions.length - 1)];\r\n            setMission(m);\r\n            setPlanet(m.planet);\r\n            setTargetPos({ x: m.targetX, y: 0 });\r\n            resetSimulation();\r\n        }\r\n    }, [phase, level, mission]);\r\n\r\n    useFrame((state, delta) => {\r\n        if (launched && ballRef.current) {\r\n            const newTime = time + delta;\r\n            setTime(newTime);\r\n\r\n            const x = vx * newTime - 4;\r\n            const y = vy * newTime - 0.5 * g * newTime * newTime;\r\n\r\n            if (y > maxHeightObserved) setMaxHeightObserved(y);\r\n\r\n            if (y >= 0) {\r\n                ballRef.current.position.set(x, y, 0);\r\n                if (trailPoints.current.length < 300) {\r\n                    trailPoints.current.push(new THREE.Vector3(x, y, 0));\r\n                }\r\n\r\n                if (phase === 'mission' && !targetHit) {\r\n                    const dist = Math.sqrt(Math.pow(x - targetPos.x, 2) + Math.pow(y - 0.2, 2));\r\n                    if (dist < 0.6) {\r\n                        setTargetHit(true);\r\n                        handleSuccess();\r\n                    }\r\n                }\r\n            } else {\r\n                setLaunched(false);\r\n            }\r\n        }\r\n    });\r\n\r\n    const handleSuccess = () => {\r\n        setScore(s => s + 200 + Math.floor(timeLeft * 3));\r\n        setShowSuccess(true);\r\n        setLaunched(false);\r\n    };\r\n\r\n    const resetSimulation = () => {\r\n        setLaunched(false);\r\n        setTime(0);\r\n        setTargetHit(false);\r\n        setMaxHeightObserved(0);\r\n        trailPoints.current = [];\r\n        if (ballRef.current) ballRef.current.position.set(-4, 0, 0);\r\n    };\r\n\r\n    const launch = () => {\r\n        resetSimulation();\r\n        setLaunched(true);\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        setLevel(l => Math.min(l + 1, 3));\r\n        setMission(null);\r\n    };\r\n\r\n\r\n    return (\r\n        <group>\r\n            <SuccessOverlay\r\n                show={showSuccess}\r\n                message={`Trait de g├®niebalistique ! Mission \"${mission?.title}\" accomplie.`}\r\n                points={200 + Math.floor(timeLeft * 3)}\r\n                onNext={nextMission}\r\n            />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel\r\n                    title=\"­ƒÄ» Syst├¿me de Guidage Balistique\"\r\n                    showCloseButton={false}\r\n                    defaultPosition=\"bottom-center\"\r\n                    className=\"w-[420px] border-orange-500/30\"\r\n                >\r\n                    <div className=\"text-white\">\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <GradeBadge score={score} />\r\n                            {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={60} />}\r\n                        </div>\r\n\r\n                        <XPBar current={score} nextLevel={2000} />\r\n\r\n                        <div className=\"flex gap-2 my-4\">\r\n                            {Object.entries(planets).map(([id, p]) => (\r\n                                <button\r\n                                    key={id}\r\n                                    onClick={() => { setPlanet(id); resetSimulation(); }}\r\n                                    className={`flex-1 py-1 rounded text-[10px] font-bold transition ${planet === id ? 'bg-white/20 border-white text-white' : 'bg-gray-800 border-transparent text-gray-400'} border`}\r\n                                >\r\n                                    {p.emoji} {p.name}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n\r\n                        <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                        {phase === 'mission' && mission && (\r\n                            <MissionObjective objective={mission.objective} icon=\"­ƒÄ»\" />\r\n                        )}\r\n\r\n                        <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                            <div className=\"space-y-4\">\r\n                                <div>\r\n                                    <label className=\"text-[10px] text-gray-400 block mb-1\">Angle du Canon ╬▒: {angle}┬░</label>\r\n                                    <div className=\"relative h-1 bg-gray-700 rounded-full\">\r\n                                        <div className=\"absolute h-full bg-orange-500 rounded-full\" style={{ width: `${(angle / 90) * 100}%` }} />\r\n                                        <input type=\"range\" min=\"0\" max=\"90\" step=\"1\" value={angle} onChange={(e) => setAngle(parseFloat(e.target.value))} className=\"absolute inset-0 w-full h-full opacity-0 cursor-pointer\" />\r\n                                    </div>\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"text-[10px] text-gray-400 block mb-1\">Vitesse de Bouche vÔéÇ: {v0.toFixed(1)} m/s</label>\r\n                                    <div className=\"relative h-1 bg-gray-700 rounded-full\">\r\n                                        <div className=\"absolute h-full bg-blue-500 rounded-full\" style={{ width: `${(v0 / 30) * 100}%` }} />\r\n                                        <input type=\"range\" min=\"1\" max=\"30\" step=\"0.5\" value={v0} onChange={(e) => setV0(parseFloat(e.target.value))} className=\"absolute inset-0 w-full h-full opacity-0 cursor-pointer\" />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"bg-black/60 rounded-xl p-3 border border-white/5 flex flex-col justify-between\">\r\n                                <div className=\"space-y-1\">\r\n                                    <div className=\"text-[9px] text-gray-500 font-mono\">BALLISTICS_TELEMETRY</div>\r\n                                    <div className=\"text-[10px] font-mono\"><span className=\"text-blue-400\">vx:</span> {vx.toFixed(1)} m/s</div>\r\n                                    <div className=\"text-[10px] font-mono\"><span className=\"text-red-400\">vy:</span> {vy.toFixed(1)} m/s</div>\r\n                                    <div className=\"text-[10px] font-mono\"><span className=\"text-yellow-400\">H_MAX:</span> {maxHeightObserved.toFixed(2)} m</div>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-2 mt-4\">\r\n                                    <button\r\n                                        onClick={launch}\r\n                                        className=\"w-full py-2 bg-gradient-to-r from-orange-600 to-red-600 rounded-lg font-bold text-xs shadow-lg shadow-orange-900/40 hover:scale-105 transition-transform\"\r\n                                    >\r\n                                        ­ƒÜÇ FEU !\r\n                                    </button>\r\n                                    <button onClick={resetSimulation} className=\"w-full py-2 bg-white/5 hover:bg-white/10 rounded-lg text-xs transition-all tracking-widest uppercase\">Reset</button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            {/* Sc├¿ne 3D */}\r\n            <group>\r\n                <Box args={[15, 0.4, 6]} position={[0, -0.2, 0]}>\r\n                    <meshStandardMaterial color={planets[planet].ground} />\r\n                </Box>\r\n\r\n                <Cylinder args={[0.2, 0.3, 1.2]} position={[-4, 0.4, 0]} rotation={[0, 0, angleRad]}>\r\n                    <meshStandardMaterial color=\"#374151\" metalness={0.8} />\r\n                </Cylinder>\r\n\r\n                <group position={[targetPos.x, 0.2, 0]}>\r\n                    <mesh rotation={[-Math.PI / 2, 0, 0]}>\r\n                        <ringGeometry args={[0.5, 0.7, 32]} />\r\n                        <meshStandardMaterial color={targetHit ? \"#4ade80\" : \"#ef4444\"} emissive={targetHit ? \"#4ade80\" : \"#ef4444\"} />\r\n                    </mesh>\r\n                </group>\r\n\r\n                {trailPoints.current.length > 1 && (\r\n                    <Line points={trailPoints.current} color=\"#FBBF24\" lineWidth={2} alphaTest={0.5} transparent opacity={0.6} />\r\n                )}\r\n\r\n                <Sphere ref={ballRef} args={[0.2]} position={[-4, 0, 0]}>\r\n                    <meshStandardMaterial color=\"#EF4444\" emissive=\"#EF4444\" emissiveIntensity={launched ? 0.8 : 0} />\r\n                </Sphere>\r\n            </group>\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// P4. GRAVITATION UNIVERSELLE - VERSION AVANC├ëE\r\n// Mission: Commandant Orbital - Placer des satellites en orbite\r\n// ============================================================\r\nexport function GravitationAdvanced() {\r\n    // ├ëtats Globaux\r\n    const [phase, setPhase] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [level, setLevel] = useState(1);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n\r\n    // ├ëtats Physiques\r\n    const [orbitRadius, setOrbitRadius] = useState(2.5);\r\n    const [satelliteCount, setSatelliteCount] = useState(1);\r\n    const [showVectors, setShowVectors] = useState(false);\r\n\r\n    const satelliteRefs = useRef([]);\r\n    const moonRef = useRef();\r\n\r\n    // Missions\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Basse Orbite (LEO)', objective: 'Stabilisez 1 satellite ├á r = 1.5u (Altitude ISS).', targetR: 1.5, reqSats: 1 },\r\n        { id: 2, title: 'R├®seau GPS (MEO)', objective: 'Placez 3 satellites ├á r = 2.8u pour le r├®seau GPS.', targetR: 2.8, reqSats: 3 },\r\n        { id: 3, title: 'Ceinture TV (GEO)', objective: 'Atteignez l\\'orbite g├®ostationnaire ├á r = 4.2u avec 6 satellites.', targetR: 4.2, reqSats: 6 }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            const m = missions[Math.min(level - 1, missions.length - 1)];\r\n            setMission(m);\r\n            setSatelliteCount(m.reqSats);\r\n            setTimeLeft(45);\r\n        }\r\n    }, [phase, level, mission]);\r\n\r\n    // Constantes (simplifi├®es pour l'animation)\r\n    const G = 6.67e-11; // Constante gravitationnelle\r\n    const M_terre = 5.97e24; // Masse de la Terre en kg\r\n    const R_terre = 6371; // Rayon de la Terre en km\r\n\r\n    // Calculs Orbitaux\r\n    const orbitalPeriod = 2 * Math.PI * Math.sqrt(Math.pow(orbitRadius, 3) / 10);\r\n    const orbitalVelocity = Math.sqrt(10 / orbitRadius);\r\n    const keplerConstant = Math.pow(orbitalPeriod, 2) / Math.pow(orbitRadius, 3);\r\n\r\n    useFrame((state) => {\r\n        const t = state.clock.elapsedTime;\r\n        satelliteRefs.current.forEach((sat, index) => {\r\n            if (sat) {\r\n                const omega = 2 * Math.PI / orbitalPeriod;\r\n                const phase_offset = (index * 2 * Math.PI) / satelliteCount;\r\n                sat.position.x = orbitRadius * Math.cos(omega * t + phase_offset);\r\n                sat.position.z = orbitRadius * Math.sin(omega * t + phase_offset);\r\n                sat.rotation.y = omega * t + phase_offset;\r\n            }\r\n        });\r\n        if (moonRef.current) {\r\n            moonRef.current.position.x = 6 * Math.cos(t * 0.1);\r\n            moonRef.current.position.z = 6 * Math.sin(t * 0.1);\r\n        }\r\n    });\r\n\r\n    // Timer\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [timeLeft, phase, showSuccess]);\r\n\r\n    // V├®rifier si l'orbite cible est atteinte\r\n    useEffect(() => {\r\n        if (phase === 'mission' && mission && !showSuccess) {\r\n            const tolerance = 0.15;\r\n            if (Math.abs(orbitRadius - mission.targetR) < tolerance) {\r\n                handleSuccess();\r\n            }\r\n        }\r\n    }, [orbitRadius, phase, mission]);\r\n\r\n    const handleSuccess = () => {\r\n        setScore(s => s + 250);\r\n        setShowSuccess(true);\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        setLevel(l => Math.min(l + 1, 3));\r\n        setMission(null);\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            <SuccessOverlay\r\n                show={showSuccess}\r\n                message={`Verrouillage orbital confirm├® ! Mission \"${mission?.title}\" r├®ussie.`}\r\n                points={250}\r\n                onNext={nextMission}\r\n            />\r\n            <ConfettiExplosion active={showSuccess} />\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel\r\n                    title=\"­ƒø░´©Å Centre de Commande Orbital\"\r\n                    showCloseButton={false}\r\n                    defaultPosition=\"bottom-center\"\r\n                    className=\"w-[420px] border-blue-500/30\"\r\n                >\r\n                    <div className=\"text-white\">\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <GradeBadge score={score} />\r\n                            {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={45} />}\r\n                        </div>\r\n\r\n                        <XPBar current={score} nextLevel={2000} />\r\n\r\n                        <div className=\"h-[1px] bg-gradient-to-r from-transparent via-blue-500/50 to-transparent my-4\" />\r\n\r\n                        <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                        {phase === 'mission' && mission && (\r\n                            <MissionObjective objective={mission.objective} icon=\"­ƒø░´©Å\" />\r\n                        )}\r\n\r\n                        <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                            <div className=\"space-y-4\">\r\n                                <div>\r\n                                    <label className=\"text-[10px] text-gray-400 block mb-1\">Rayon Orbital r: {orbitRadius.toFixed(2)} u</label>\r\n                                    <input type=\"range\" min=\"1.2\" max=\"5.5\" step=\"0.05\" value={orbitRadius} onChange={(e) => setOrbitRadius(parseFloat(e.target.value))} className=\"w-full h-1 bg-gray-700 accent-blue-500\" />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"text-[10px] text-gray-400 block mb-1\">Nombre de Satellites: {satelliteCount}</label>\r\n                                    <input type=\"range\" min=\"1\" max=\"12\" step=\"1\" value={satelliteCount} onChange={(e) => setSatelliteCount(parseInt(e.target.value))} className=\"w-full h-1 bg-gray-700 accent-orange-500\" />\r\n                                </div>\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <label className=\"text-[10px] text-gray-400\">Vecteurs Physiques</label>\r\n                                    <button onClick={() => setShowVectors(!showVectors)} className={`px-2 py-1 rounded text-[10px] ${showVectors ? 'bg-purple-600' : 'bg-gray-800'}`}>\r\n                                        {showVectors ? 'ON' : 'OFF'}\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"bg-black/60 rounded-xl p-3 border border-white/5 flex flex-col justify-between\">\r\n                                <div className=\"space-y-1\">\r\n                                    <div className=\"text-[9px] text-gray-500 font-mono\">ORBITAL_STREAM</div>\r\n                                    <div className=\"text-[10px] font-mono\"><span className=\"text-emerald-400\">P├ëRIODE T:</span> {orbitalPeriod.toFixed(2)} s</div>\r\n                                    <div className=\"text-[10px] font-mono\"><span className=\"text-blue-400\">VITESSE v:</span> {orbitalVelocity.toFixed(2)} u/s</div>\r\n                                    <div className=\"text-[10px] font-mono\"><span className=\"text-purple-400\">K (T┬▓/r┬│):</span> {keplerConstant.toFixed(3)}</div>\r\n                                </div>\r\n\r\n                                <div className=\"mt-4 text-[9px] text-gray-500 leading-tight italic\">\r\n                                    \"La p├®riode augmente avec le cube de la distance.\"\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <Sphere args={[1.1, 32, 32]}>\r\n                <meshStandardMaterial color=\"#3B82F6\" emissive=\"#1E3A8A\" emissiveIntensity={0.2} />\r\n                <Text position={[0, 1.3, 0]} fontSize={0.2} color=\"white\">Terre</Text>\r\n            </Sphere>\r\n\r\n            {Array.from({ length: satelliteCount }).map((_, i) => (\r\n                <group key={i} ref={el => satelliteRefs.current[i] = el}>\r\n                    <Box args={[0.2, 0.1, 0.2]}>\r\n                        <meshStandardMaterial color=\"#FBBF24\" metalness={0.8} />\r\n                    </Box>\r\n                    <Box args={[0.6, 0.05, 0.2]} position={[0, 0, 0]}>\r\n                        <meshStandardMaterial color=\"#1E40AF\" transparent opacity={0.8} />\r\n                    </Box>\r\n                    {showVectors && (\r\n                        <>\r\n                            <Line points={[[0, 0, 0], [0, 0, 1]]} color=\"#4ade80\" lineWidth={2} />\r\n                            <Line points={[[0, 0, 0], [-1, 0, 0]]} color=\"#ef4444\" lineWidth={2} />\r\n                        </>\r\n                    )}\r\n                </group>\r\n            ))}\r\n\r\n            <group ref={moonRef}>\r\n                <Sphere args={[0.3]}>\r\n                    <meshStandardMaterial color=\"#9CA3AF\" />\r\n                </Sphere>\r\n            </group>\r\n\r\n            {phase === 'mission' && mission && (\r\n                <Ring args={[mission.targetR - 0.05, mission.targetR + 0.05, 64]} rotation={[Math.PI / 2, 0, 0]}>\r\n                    <meshBasicMaterial color=\"#4ADE80\" transparent opacity={0.2} side={THREE.DoubleSide} />\r\n                </Ring>\r\n            )}\r\n            <Ring args={[orbitRadius - 0.02, orbitRadius + 0.02, 64]} rotation={[Math.PI / 2, 0, 0]}>\r\n                <meshBasicMaterial color=\"#3b82f6\" transparent opacity={0.5} side={THREE.DoubleSide} />\r\n            </Ring>\r\n        </group>\r\n    );\r\n}\r\n\r\n// Export des composants\r\nexport { CinematiquePointAdvanced as CinematiqueTS };\r\nexport { DynamiqueNewtonAdvanced as DynamiqueTS };\r\nexport { ProjectileMotionAdvanced as ProjectileTS };\r\nexport { GravitationAdvanced as GravitationTS };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\PhysiqueTSAdvanced2.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'handleSuccess'. Either include it or remove the dependency array.","line":116,"column":8,"nodeType":"ArrayExpression","endLine":116,"endColumn":43,"suggestions":[{"desc":"Update the dependencies array to be: [B_mT, phase, mission, showSuccess, handleSuccess]","fix":{"range":[4416,4451],"text":"[B_mT, phase, mission, showSuccess, handleSuccess]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'handleSuccess'. Either include it or remove the dependency array.","line":790,"column":8,"nodeType":"ArrayExpression","endLine":790,"endColumn":44,"suggestions":[{"desc":"Update the dependencies array to be: [tauMs, phase, mission, showSuccess, handleSuccess]","fix":{"range":[38471,38507],"text":"[tauMs, phase, mission, showSuccess, handleSuccess]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n/**\r\n * Physique Terminale S - Simulations Avanc├®es\r\n * Partie 2: ├ëlectromagn├®tisme (Chapitres 5-9)\r\n * Mode D├®fi avec gamification compl├¿te\r\n */\r\nimport React, { useState, useRef, useEffect, useMemo, useCallback } from 'react';\r\nimport { useFrame } from '@react-three/fiber';\r\nimport { Html, Line, Text } from '@react-three/drei';\r\nimport * as THREE from 'three';\r\nimport { SuccessOverlay, ConfettiExplosion, ChallengeTimer, GradeBadge, XPBar, PhaseSelector, MissionObjective } from './GamificationUtils';\r\nimport DraggableHtmlPanel from './DraggableHtmlPanel';\r\n\r\n// ============================================================\r\n// COMPOSANTS UTILITAIRES R├ëUTILISABLES\r\n// ============================================================\r\n\r\n// (ChallengeTimer supprim├® car import├® de GamificationUtils)\r\n\r\n// Particules magn├®tiques anim├®es\r\nfunction MagneticFieldLines({ intensity = 1, polarity = 'N' }) {\r\n    const groupRef = useRef();\r\n\r\n    useFrame((state) => {\r\n        if (groupRef.current) {\r\n            groupRef.current.rotation.z = Math.sin(state.clock.elapsedTime * 0.5) * 0.1;\r\n        }\r\n    });\r\n\r\n    const lines = useMemo(() => {\r\n        const result = [];\r\n        const count = 8;\r\n        for (let i = 0; i < count; i++) {\r\n            const angle = (i / count) * Math.PI * 2;\r\n            const points = [];\r\n            for (let j = 0; j <= 20; j++) {\r\n                const t = j / 20;\r\n                const r = 0.5 + t * 2 * intensity;\r\n                const x = Math.cos(angle + t * 0.5) * r;\r\n                const y = Math.sin(angle + t * 0.5) * r;\r\n                const z = (polarity === 'N' ? 1 : -1) * t * 0.5;\r\n                points.push(new THREE.Vector3(x, y, z));\r\n            }\r\n            result.push(points);\r\n        }\r\n        return result;\r\n    }, [intensity, polarity]);\r\n\r\n    return (\r\n        <group ref={groupRef}>\r\n            {lines.map((points, i) => (\r\n                <Line\r\n                    key={i}\r\n                    points={points}\r\n                    color={polarity === 'N' ? '#ef4444' : '#3b82f6'}\r\n                    lineWidth={2}\r\n                    opacity={0.7}\r\n                    transparent\r\n                />\r\n            ))}\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// P5. CHAMP MAGN├ëTIQUE - VERSION AVANC├ëE\r\n// Mission: Ing├®nieur IRM - Cr├®er le bon champ magn├®tique\r\n// ============================================================\r\nfunction ChampMagnetiqueAdvanced() {\r\n    // ├ëtats Globaux\r\n    const [phase, setPhase] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [level, setLevel] = useState(1);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n\r\n    // ├ëtats Physiques (Sol├®no├»de)\r\n    const [current, setCurrent] = useState(5);\r\n    const [turns, setTurns] = useState(100);\r\n    const [length, setLength] = useState(0.2);\r\n\r\n    const MU_0 = 4 * Math.PI * 1e-7;\r\n    const n = turns / length;\r\n    const B = MU_0 * n * current;\r\n    const B_mT = B * 1000;\r\n\r\n    // Missions\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'IRM Standard', objective: 'G├®n├®rez un champ B = 1.50 mT pour un diagnostic standard.', targetB: 1.5, tolerance: 0.1 },\r\n        { id: 2, title: 'IRM Haute R├®solution', objective: 'Atteignez B = 3.00 mT pour une imagerie neurologique.', targetB: 3.0, tolerance: 0.15 },\r\n        { id: 3, title: 'IRM Recherche CERN', objective: 'Configurez le sol├®no├»de pour B = 7.00 mT.', targetB: 7.0, tolerance: 0.2 }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            const m = missions[Math.min(level - 1, missions.length - 1)];\r\n            setMission(m);\r\n            setTimeLeft(45);\r\n        }\r\n    }, [phase, level, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [timeLeft, phase, showSuccess]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && mission && !showSuccess) {\r\n            if (Math.abs(B_mT - mission.targetB) <= mission.tolerance) {\r\n                handleSuccess();\r\n            }\r\n        }\r\n    }, [B_mT, phase, mission, showSuccess]);\r\n\r\n    const handleSuccess = () => {\r\n        setScore(s => s + 200 + Math.floor(timeLeft * 5));\r\n        setShowSuccess(true);\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        setLevel(l => Math.min(l + 1, 3));\r\n        setMission(null);\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            {/* Sc├¿ne 3D */}\r\n            <group scale={2}>\r\n                {/* Sol├®no├»de 3D */}\r\n                <mesh position={[0, 0, 0]} rotation={[0, 0, Math.PI / 2]}>\r\n                    <cylinderGeometry args={[0.5, 0.5, length * 5, 32, 1, true]} />\r\n                    <meshStandardMaterial color=\"#fbbf24\" wireframe />\r\n                </mesh>\r\n\r\n                {/* Noyau ferromagn├®tique (optionnel visuel) */}\r\n                <mesh position={[0, 0, 0]} rotation={[0, 0, Math.PI / 2]}>\r\n                    <cylinderGeometry args={[0.45, 0.45, (length * 5) + 0.2, 32]} />\r\n                    <meshStandardMaterial color=\"#475569\" metalness={0.9} roughness={0.1} />\r\n                </mesh>\r\n\r\n                {/* Lignes de champ */}\r\n                <MagneticFieldLines intensity={B_mT / 2} polarity=\"N\" />\r\n            </group>\r\n\r\n            {/* UI Holographique */}\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel\r\n                    title=\"­ƒº▓ Ing├®nierie Magn├®tique\"\r\n                    showCloseButton={false}\r\n                    defaultPosition=\"bottom-center\"\r\n                    className=\"w-[420px] border-emerald-500/30\"\r\n                >\r\n                    <div className=\"text-white\">\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <GradeBadge score={score} />\r\n                            {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={45} />}\r\n                        </div>\r\n\r\n                        <XPBar current={score} nextLevel={2000} />\r\n\r\n                        <div className=\"h-[1px] bg-gradient-to-r from-transparent via-emerald-500/50 to-transparent my-4\" />\r\n\r\n                        <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                        {phase === 'mission' && mission && (\r\n                            <MissionObjective objective={mission.objective} icon=\"­ƒÅÑ\" />\r\n                        )}\r\n\r\n                        <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                            <div className=\"space-y-4\">\r\n                                <div>\r\n                                    <label className=\"text-[10px] text-gray-400 block mb-1 uppercase tracking-wider font-bold\">Courant I: {current.toFixed(1)} A</label>\r\n                                    <input type=\"range\" min=\"0.1\" max=\"25\" step=\"0.1\" value={current} onChange={(e) => setCurrent(parseFloat(e.target.value))} className=\"w-full h-1 bg-gray-700 accent-emerald-500 rounded-full\" />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"text-[10px] text-gray-400 block mb-1 uppercase tracking-wider font-bold\">Spires N: {turns}</label>\r\n                                    <input type=\"range\" min=\"10\" max=\"1000\" step=\"10\" value={turns} onChange={(e) => setTurns(parseInt(e.target.value))} className=\"w-full h-1 bg-gray-700 accent-blue-500 rounded-full\" />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"text-[10px] text-gray-400 block mb-1 uppercase tracking-wider font-bold\">Longueur L: {(length * 100).toFixed(0)} cm</label>\r\n                                    <input type=\"range\" min=\"0.05\" max=\"0.5\" step=\"0.01\" value={length} onChange={(e) => setLength(parseFloat(e.target.value))} className=\"w-full h-1 bg-gray-700 accent-orange-500 rounded-full\" />\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"bg-black/60 rounded-xl p-3 border border-emerald-500/20 flex flex-col justify-between shadow-inner\">\r\n                                <div className=\"space-y-1\">\r\n                                    <div className=\"text-[9px] text-emerald-500 font-mono tracking-tighter uppercase opacity-70 italic shadow-sm shadow-emerald-900/40 transform -skew-x-12 mb-1\">MAGNETIC_FLUX_LIVE</div>\r\n                                    <div className=\"text-[10px] font-mono\"><span className=\"text-emerald-400\">CHAMP B:</span> {B_mT.toFixed(2)} mT</div>\r\n                                    <div className=\"text-[10px] font-mono\"><span className=\"text-blue-400\">DENSIT├ë n:</span> {n.toFixed(0)} tr/m</div>\r\n                                </div>\r\n\r\n                                <div className=\"mt-4 pt-2 border-t border-white/5 text-[9px] text-gray-500 leading-tight italic\">\r\n                                    B = ╬╝ÔéÇ ┬À (N/L) ┬À I\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay\r\n                show={showSuccess}\r\n                message={`Champ B stabilis├® ! Mission \"${mission?.title}\" termin├®e.`}\r\n                points={200 + Math.floor(timeLeft * 5)}\r\n                onNext={nextMission}\r\n            />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// P6. FORCE DE LORENTZ - VERSION AVANC├ëE\r\n// Mission: Pilote de Cyclotron - Guider les particules\r\n// ============================================================\r\nfunction LorentzAdvanced() {\r\n    // ├ëtats Globaux\r\n    const [phase, setPhase] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [level, setLevel] = useState(1);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n\r\n    // ├ëtats Physiques\r\n    const [velocity, setVelocity] = useState(2e6);\r\n    const [magneticField, setMagneticField] = useState(0.5);\r\n    const [particleCharge, setParticleCharge] = useState(1);\r\n    const [particlePos, setParticlePos] = useState({ x: 0, y: 0, angle: 0 });\r\n\r\n    const ELECTRON_MASS = 9.109e-31;\r\n    const ELECTRON_CHARGE = 1.602e-19;\r\n    const mass = ELECTRON_MASS;\r\n    const charge = particleCharge * ELECTRON_CHARGE;\r\n    const radius = (mass * velocity) / (Math.abs(charge) * magneticField);\r\n    const radiusCm = radius * 100;\r\n\r\n    // Missions\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Calibrage Faisceau', objective: 'Ajustez le rayon ├á R = 5.00 cm (┬▒1) pour le calibrage.', targetR: 5, tolerance: 1 },\r\n        { id: 2, title: 'Scanner M├®dical', objective: 'Ciblez une tumeur avec un rayon R = 12.00 cm (┬▒1.5).', targetR: 12, tolerance: 1.5 },\r\n        { id: 3, title: 'Collisionneur CERN', objective: 'Atteignez un rayon critique R = 25.00 cm (┬▒2).', targetR: 25, tolerance: 2 }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            const m = missions[Math.min(level - 1, missions.length - 1)];\r\n            setMission(m);\r\n            setTimeLeft(45);\r\n        }\r\n    }, [phase, level, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [timeLeft, phase, showSuccess]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && mission && !showSuccess) {\r\n            if (Math.abs(radiusCm - mission.targetR) <= mission.tolerance) {\r\n                handleSuccess();\r\n            }\r\n        }\r\n    }, [radiusCm, phase, mission, showSuccess]);\r\n\r\n    useFrame((state) => {\r\n        const t = state.clock.elapsedTime;\r\n        const speedFactor = velocity / 1e6;\r\n        setParticlePos({\r\n            x: Math.cos(t * speedFactor) * Math.min(radiusCm / 5, 4),\r\n            y: Math.sin(t * speedFactor) * Math.min(radiusCm / 5, 4),\r\n            angle: t * speedFactor\r\n        });\r\n    });\r\n\r\n    const handleSuccess = () => {\r\n        setScore(s => s + 250);\r\n        setShowSuccess(true);\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        setLevel(l => Math.min(l + 1, 3));\r\n        setMission(null);\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            {/* Sc├¿ne 3D */}\r\n            <group rotation={[Math.PI / 2, 0, 0]}>\r\n                {/* Chambre du cyclotron */}\r\n                <mesh>\r\n                    <torusGeometry args={[4.5, 0.1, 16, 100]} />\r\n                    <meshStandardMaterial color=\"#334155\" metalness={0.8} />\r\n                </mesh>\r\n\r\n                {/* Trajectoire */}\r\n                <mesh>\r\n                    <ringGeometry args={[Math.min(radiusCm / 5, 4) - 0.02, Math.min(radiusCm / 5, 4) + 0.02, 64]} />\r\n                    <meshBasicMaterial color=\"#22d3ee\" opacity={0.4} transparent side={THREE.DoubleSide} />\r\n                </mesh>\r\n\r\n                {/* Particule */}\r\n                <mesh position={[particlePos.x, particlePos.y, 0]}>\r\n                    <sphereGeometry args={[0.15, 16, 16]} />\r\n                    <meshStandardMaterial\r\n                        color={particleCharge > 0 ? '#ef4444' : '#3b82f6'}\r\n                        emissive={particleCharge > 0 ? '#ef4444' : '#3b82f6'}\r\n                        emissiveIntensity={1}\r\n                    />\r\n                    <pointLight color={particleCharge > 0 ? '#ef4444' : '#3b82f6'} intensity={1} distance={2} />\r\n                </mesh>\r\n\r\n                {/* Champ B Visuel */}\r\n                {[...Array(12)].map((_, i) => (\r\n                    <group key={i} position={[Math.cos(i) * 3, Math.sin(i) * 3, 0]}>\r\n                        <mesh rotation={[Math.PI / 2, 0, 0]}>\r\n                            <cylinderGeometry args={[0.01, 0.01, 1, 8]} />\r\n                            <meshBasicMaterial color=\"#a855f7\" opacity={0.3} transparent />\r\n                        </mesh>\r\n                    </group>\r\n                ))}\r\n            </group>\r\n\r\n            {/* UI Holographique */}\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel\r\n                    title=\"ÔÜí Pilotage de Cyclotron\"\r\n                    showCloseButton={false}\r\n                    defaultPosition=\"bottom-center\"\r\n                    className=\"w-[420px] border-cyan-500/30\"\r\n                >\r\n                    <div className=\"text-white\">\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <GradeBadge score={score} />\r\n                            {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={45} />}\r\n                        </div>\r\n\r\n                        <XPBar current={score} nextLevel={2000} />\r\n\r\n                        <div className=\"h-[1px] bg-gradient-to-r from-transparent via-cyan-500/50 to-transparent my-4\" />\r\n\r\n                        <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                        {phase === 'mission' && mission && (\r\n                            <MissionObjective objective={mission.objective} icon=\"­ƒö¼\" />\r\n                        )}\r\n\r\n                        <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                            <div className=\"space-y-4\">\r\n                                <div>\r\n                                    <label className=\"text-[10px] text-gray-400 block mb-1 uppercase tracking-wider font-bold\">Vitesse v: {(velocity / 1e6).toFixed(1)} Mm/s</label>\r\n                                    <input type=\"range\" min=\"0.5\" max=\"10\" step=\"0.1\" value={velocity / 1e6} onChange={(e) => setVelocity(parseFloat(e.target.value) * 1e6)} className=\"w-full h-1 bg-gray-700 accent-cyan-400 rounded-full\" />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"text-[10px] text-gray-400 block mb-1 uppercase tracking-wider font-bold\">Champ B: {magneticField.toFixed(2)} T</label>\r\n                                    <input type=\"range\" min=\"0.1\" max=\"2\" step=\"0.05\" value={magneticField} onChange={(e) => setMagneticField(parseFloat(e.target.value))} className=\"w-full h-1 bg-gray-700 accent-purple-500 rounded-full\" />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"text-[10px] text-gray-400 block mb-1 uppercase tracking-wider font-bold\">Charge: {particleCharge > 0 ? 'Proton' : 'Electron'}</label>\r\n                                    <div className=\"flex gap-2\">\r\n                                        <button onClick={() => setParticleCharge(1)} className={`flex-1 py-1 rounded text-[10px] font-bold transition-all ${particleCharge > 0 ? 'bg-red-500 text-white' : 'bg-gray-800 text-gray-400'}`}>+</button>\r\n                                        <button onClick={() => setParticleCharge(-1)} className={`flex-1 py-1 rounded text-[10px] font-bold transition-all ${particleCharge < 0 ? 'bg-blue-500 text-white' : 'bg-gray-800 text-gray-400'}`}>-</button>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"bg-black/60 rounded-xl p-3 border border-cyan-500/20 flex flex-col justify-between shadow-inner\">\r\n                                <div className=\"space-y-1\">\r\n                                    <div className=\"text-[9px] text-cyan-500 font-mono tracking-tighter uppercase opacity-70 italic transform -skew-x-12 mb-1\">PARTICLE_TRACKER_V2</div>\r\n                                    <div className=\"text-[10px] font-mono\"><span className=\"text-cyan-400\">RAYON R:</span> {radiusCm.toFixed(2)} cm</div>\r\n                                    <div className=\"text-[10px] font-mono\"><span className=\"text-purple-400\">FORCE F:</span> {(Math.abs(charge * velocity * magneticField) * 1e15).toFixed(2)} fN</div>\r\n                                </div>\r\n\r\n                                <div className=\"mt-4 pt-2 border-t border-white/5 text-[9px] text-gray-500 leading-tight italic\">\r\n                                    R = (m ┬À v) / (|q| ┬À B)\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay\r\n                show={showSuccess}\r\n                message={`Trajectoire verrouill├®e ! Mission \"${mission?.title}\" r├®ussie.`}\r\n                points={250}\r\n                onNext={nextMission}\r\n            />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// P7. LOI DE LAPLACE - VERSION AVANC├ëE\r\n// Mission: Ing├®nieur Audio - Concevoir un haut-parleur\r\n// ============================================================\r\nfunction LaplaceAdvanced() {\r\n    // ├ëtats Globaux\r\n    const [phase, setPhase] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [level, setLevel] = useState(1);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n\r\n    // ├ëtats Physiques\r\n    const [current, setCurrent] = useState(2);\r\n    const [wireLength, setWireLength] = useState(0.1);\r\n    const [magneticField, setMagneticField] = useState(0.5);\r\n    const [angle, setAngle] = useState(90);\r\n    const [wirePosition, setWirePosition] = useState(0);\r\n\r\n    const force = magneticField * current * wireLength * Math.sin(angle * Math.PI / 180);\r\n    const forceMN = force * 1000;\r\n\r\n    // Missions\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Haut-parleur Smartphone', objective: 'G├®n├®rez une force F = 50.0 mN (┬▒5) pour un petit HP.', targetF: 50, tolerance: 5 },\r\n        { id: 2, title: 'Enceinte Bluetooth', objective: 'Atteignez F = 150.0 mN (┬▒15) pour une qualit├® Hi-Fi.', targetF: 150, tolerance: 15 },\r\n        { id: 3, title: 'Woofer de Concert', objective: 'Configurez la bobine pour F = 500.0 mN (┬▒50).', targetF: 500, tolerance: 50 }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            const m = missions[Math.min(level - 1, missions.length - 1)];\r\n            setMission(m);\r\n            setTimeLeft(45);\r\n        }\r\n    }, [phase, level, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [timeLeft, phase, showSuccess]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && mission && !showSuccess) {\r\n            if (Math.abs(forceMN - mission.targetF) <= mission.tolerance) {\r\n                handleSuccess();\r\n            }\r\n        }\r\n    }, [forceMN, phase, mission, showSuccess]);\r\n\r\n    useFrame((state) => {\r\n        const t = state.clock.elapsedTime;\r\n        setWirePosition(Math.sin(t * 20) * (forceMN / 500));\r\n    });\r\n\r\n    const handleSuccess = () => {\r\n        setScore(s => s + 300);\r\n        setShowSuccess(true);\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        setLevel(l => Math.min(l + 1, 3));\r\n        setMission(null);\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            {/* Sc├¿ne 3D */}\r\n            <group scale={1.5}>\r\n                {/* Aimants permanents */}\r\n                <mesh position={[-1.2, 0, 0]}>\r\n                    <boxGeometry args={[0.3, 2, 1]} />\r\n                    <meshStandardMaterial color=\"#ef4444\" emissive=\"#ef4444\" emissiveIntensity={0.2} />\r\n                </mesh>\r\n                <mesh position={[1.2, 0, 0]}>\r\n                    <boxGeometry args={[0.3, 2, 1]} />\r\n                    <meshStandardMaterial color=\"#3b82f6\" emissive=\"#3b82f6\" emissiveIntensity={0.2} />\r\n                </mesh>\r\n\r\n                {/* Fil conducteur */}\r\n                <mesh position={[0, wirePosition * 0.1, 0]}>\r\n                    <cylinderGeometry args={[0.05, 0.05, wireLength * 8, 16]} rotation={[0, 0, Math.PI / 2]} />\r\n                    <meshStandardMaterial color=\"#fbbf24\" metalness={0.8} />\r\n                </mesh>\r\n\r\n                {/* Vecteur Force */}\r\n                <group position={[0, (wirePosition * 0.1) + 0.2, 0]}>\r\n                    <mesh>\r\n                        <cylinderGeometry args={[0.02, 0.02, Math.min(forceMN / 100, 1.5), 8]} />\r\n                        <meshBasicMaterial color=\"#10b981\" />\r\n                    </mesh>\r\n                    <mesh position={[0, Math.min(forceMN / 100, 1.5) / 2 + 0.05, 0]}>\r\n                        <coneGeometry args={[0.08, 0.15, 8]} />\r\n                        <meshBasicMaterial color=\"#10b981\" />\r\n                    </mesh>\r\n                </group>\r\n            </group>\r\n\r\n            {/* UI Holographique */}\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel\r\n                    title=\"­ƒöè Ing├®nierie Audio - Laplace\"\r\n                    showCloseButton={false}\r\n                    defaultPosition=\"bottom-center\"\r\n                    className=\"w-[420px] border-amber-500/30\"\r\n                >\r\n                    <div className=\"text-white\">\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <GradeBadge score={score} />\r\n                            {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={45} />}\r\n                        </div>\r\n\r\n                        <XPBar current={score} nextLevel={2000} />\r\n\r\n                        <div className=\"h-[1px] bg-gradient-to-r from-transparent via-amber-500/50 to-transparent my-4\" />\r\n\r\n                        <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                        {phase === 'mission' && mission && (\r\n                            <MissionObjective objective={mission.objective} icon=\"­ƒöè\" />\r\n                        )}\r\n\r\n                        <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                            <div className=\"space-y-4\">\r\n                                <div>\r\n                                    <label className=\"text-[10px] text-gray-400 block mb-1 uppercase tracking-wider font-bold\">Courant I: {current.toFixed(1)} A</label>\r\n                                    <input type=\"range\" min=\"0.1\" max=\"10\" step=\"0.1\" value={current} onChange={(e) => setCurrent(parseFloat(e.target.value))} className=\"w-full h-1 bg-gray-700 accent-amber-500 rounded-full\" />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"text-[10px] text-gray-400 block mb-1 uppercase tracking-wider font-bold\">Longueur L: {(wireLength * 100).toFixed(0)} cm</label>\r\n                                    <input type=\"range\" min=\"0.01\" max=\"0.3\" step=\"0.01\" value={wireLength} onChange={(e) => setWireLength(parseFloat(e.target.value))} className=\"w-full h-1 bg-gray-700 accent-blue-500 rounded-full\" />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"text-[10px] text-gray-400 block mb-1 uppercase tracking-wider font-bold\">Champ B: {magneticField.toFixed(2)} T</label>\r\n                                    <input type=\"range\" min=\"0.1\" max=\"1.5\" step=\"0.05\" value={magneticField} onChange={(e) => setMagneticField(parseFloat(e.target.value))} className=\"w-full h-1 bg-gray-700 accent-red-500 rounded-full\" />\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"bg-black/60 rounded-xl p-3 border border-amber-500/20 flex flex-col justify-between shadow-inner\">\r\n                                <div className=\"space-y-1\">\r\n                                    <div className=\"text-[9px] text-amber-500 font-mono tracking-tighter uppercase opacity-70 italic transform -skew-x-12 mb-1\">AUDIO_DRIVER_STATS</div>\r\n                                    <div className=\"text-[10px] font-mono\"><span className=\"text-amber-400\">FORCE F:</span> {forceMN.toFixed(1)} mN</div>\r\n                                    <div className=\"text-[10px] font-mono\"><span className=\"text-blue-400\">OFFSET:</span> {(wirePosition * 10).toFixed(2)} mm</div>\r\n                                </div>\r\n\r\n                                <div className=\"mt-4 pt-2 border-t border-white/5 text-[9px] text-gray-500 leading-tight italic\">\r\n                                    F = B ┬À I ┬À L ┬À sin(╬©)\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay\r\n                show={showSuccess}\r\n                message={`Force optimis├®e ! Mission \"${mission?.title}\" termin├®e.`}\r\n                points={300}\r\n                onNext={nextMission}\r\n            />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// P8. INDUCTION RL - VERSION AVANC├ëE  \r\n// Mission: Ing├®nieur ├ëlectricien - Prot├®ger les circuits\r\n// ============================================================\r\nfunction InductionRLAdvanced() {\r\n    // ├ëtats Globaux\r\n    const [phase, setPhase] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [level, setLevel] = useState(1);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n\r\n    // ├ëtats Physiques\r\n    const [resistance, setResistance] = useState(100);\r\n    const [inductance, setInductance] = useState(0.5);\r\n    const [voltage, setVoltage] = useState(12);\r\n    const [time, setTime] = useState(0);\r\n    const [isCharging, setIsCharging] = useState(false);\r\n\r\n    const tau = inductance / resistance;\r\n    const tauMs = tau * 1000;\r\n    const I_max = voltage / resistance;\r\n    const currentI = isCharging ? I_max * (1 - Math.exp(-time / tau)) : I_max * Math.exp(-time / tau);\r\n\r\n    // Missions\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Protection LED', objective: 'Ajustez ¤ä = 1.00 ms (┬▒0.2) pour prot├®ger une diode.', targetTau: 1.0, tolerance: 0.2 },\r\n        { id: 2, title: 'Filtre Audio', objective: 'Stabilisez ¤ä = 5.00 ms (┬▒0.5) pour un signal clair.', targetTau: 5.0, tolerance: 0.5 },\r\n        { id: 3, title: 'Disjoncteur Industriel', objective: 'Configurez le dip├┤le pour ¤ä = 15.00 ms (┬▒1.5).', targetTau: 15.0, tolerance: 1.5 }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            const m = missions[Math.min(level - 1, missions.length - 1)];\r\n            setMission(m);\r\n            setTimeLeft(45);\r\n        }\r\n    }, [phase, level, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [timeLeft, phase, showSuccess]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && mission && !showSuccess) {\r\n            if (Math.abs(tauMs - mission.targetTau) <= mission.tolerance) {\r\n                handleSuccess();\r\n            }\r\n        }\r\n    }, [tauMs, phase, mission, showSuccess]);\r\n\r\n    useFrame((state, delta) => {\r\n        if (isCharging || time > 0) {\r\n            setTime(t => Math.max(0, t + delta));\r\n        }\r\n    });\r\n\r\n    const handleSuccess = () => {\r\n        setScore(s => s + 350);\r\n        setShowSuccess(true);\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        setLevel(l => Math.min(l + 1, 3));\r\n        setMission(null);\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            {/* Sc├¿ne 3D */}\r\n            <group scale={2}>\r\n                {/* Bobine */}\r\n                <mesh position={[-0.8, 0, 0]}>\r\n                    <torusGeometry args={[0.3, 0.08, 16, 32]} />\r\n                    <meshStandardMaterial color=\"#8b5cf6\" metalness={0.6} emissive=\"#8b5cf6\" emissiveIntensity={currentI / I_max} />\r\n                </mesh>\r\n\r\n                {/* R├®sistance */}\r\n                <mesh position={[0.8, 0, 0]}>\r\n                    <boxGeometry args={[0.6, 0.2, 0.2]} />\r\n                    <meshStandardMaterial color=\"#78716c\" />\r\n                </mesh>\r\n\r\n                {/* Flux de courant */}\r\n                <mesh position={[0, -0.5, 0]}>\r\n                    <boxGeometry args={[2, 0.05, 0.1]} />\r\n                    <meshStandardMaterial color=\"#1e293b\" />\r\n                </mesh>\r\n                <mesh position={[-1 + (currentI / I_max) * 2, -0.5, 0.1]}>\r\n                    <sphereGeometry args={[0.08, 16, 16]} />\r\n                    <meshStandardMaterial color=\"#22d3ee\" emissive=\"#22d3ee\" emissiveIntensity={1} />\r\n                </mesh>\r\n            </group>\r\n\r\n            {/* UI Holographique */}\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel\r\n                    title=\"­ƒöï Dip├┤le RL - Induction\"\r\n                    showCloseButton={false}\r\n                    defaultPosition=\"bottom-center\"\r\n                    className=\"w-[420px] border-violet-500/30\"\r\n                >\r\n                    <div className=\"text-white\">\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <GradeBadge score={score} />\r\n                            {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={45} />}\r\n                        </div>\r\n\r\n                        <XPBar current={score} nextLevel={2000} />\r\n\r\n                        <div className=\"h-[1px] bg-gradient-to-r from-transparent via-violet-500/50 to-transparent my-4\" />\r\n\r\n                        <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                        {phase === 'mission' && mission && (\r\n                            <MissionObjective objective={mission.objective} icon=\"ÔÜí\" />\r\n                        )}\r\n\r\n                        <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                            <div className=\"space-y-4\">\r\n                                <div>\r\n                                    <label className=\"text-[10px] text-gray-400 block mb-1 uppercase tracking-wider font-bold\">Inductance L: {inductance.toFixed(2)} H</label>\r\n                                    <input type=\"range\" min=\"0.01\" max=\"2\" step=\"0.01\" value={inductance} onChange={(e) => setInductance(parseFloat(e.target.value))} className=\"w-full h-1 bg-gray-700 accent-violet-500 rounded-full\" />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"text-[10px] text-gray-400 block mb-1 uppercase tracking-wider font-bold\">R├®sistance R: {resistance} ╬®</label>\r\n                                    <input type=\"range\" min=\"10\" max=\"1000\" step=\"10\" value={resistance} onChange={(e) => setResistance(parseInt(e.target.value))} className=\"w-full h-1 bg-gray-700 accent-emerald-500 rounded-full\" />\r\n                                </div>\r\n                                <div className=\"flex gap-2\">\r\n                                    <button onClick={() => { setIsCharging(true); setTime(0); }} className={`flex-1 py-1 rounded text-[10px] font-bold transition-all ${isCharging ? 'bg-emerald-500' : 'bg-gray-800'}`}>CHARGER</button>\r\n                                    <button onClick={() => { setIsCharging(false); setTime(0); }} className={`flex-1 py-1 rounded text-[10px] font-bold transition-all ${!isCharging ? 'bg-red-500' : 'bg-gray-800'}`}>D├ëCHARGER</button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"bg-black/60 rounded-xl p-3 border border-violet-500/20 flex flex-col justify-between shadow-inner\">\r\n                                <div className=\"space-y-1\">\r\n                                    <div className=\"text-[9px] text-violet-500 font-mono tracking-tighter uppercase opacity-70 italic transform -skew-x-12 mb-1\">CIRCUIT_MONITOR_RL</div>\r\n                                    <div className=\"text-[10px] font-mono\"><span className=\"text-violet-400\">CONSTANTE ¤ä:</span> {tauMs.toFixed(2)} ms</div>\r\n                                    <div className=\"text-[10px] font-mono\"><span className=\"text-blue-400\">COURANT I:</span> {(currentI * 1000).toFixed(1)} mA</div>\r\n                                </div>\r\n\r\n                                <div className=\"mt-4 pt-2 border-t border-white/5 text-[9px] text-gray-500 leading-tight italic\">\r\n                                    ¤ä = L / R\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay\r\n                show={showSuccess}\r\n                message={`Circuit s├®curis├® ! Mission \"${mission?.title}\" r├®ussie.`}\r\n                points={350}\r\n                onNext={nextMission}\r\n            />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// P9. DIP├öLE RC - VERSION AVANC├ëE\r\n// Mission: Ing├®nieur Flash - Concevoir un flash photo\r\n// ============================================================\r\nfunction DipoleRCAdvanced() {\r\n    // ├ëtats Globaux\r\n    const [phase, setPhase] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [level, setLevel] = useState(1);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n\r\n    // ├ëtats Physiques\r\n    const [resistance, setResistance] = useState(1000);\r\n    const [capacitance, setCapacitance] = useState(100);\r\n    const [voltage, setVoltage] = useState(300);\r\n    const [chargePercent, setChargePercent] = useState(0);\r\n    const [isCharging, setIsCharging] = useState(false);\r\n    const [showFlash, setShowFlash] = useState(false);\r\n\r\n    const C_farads = capacitance * 1e-6;\r\n    const tau = resistance * C_farads;\r\n    const tauMs = tau * 1000;\r\n    const energy = 0.5 * C_farads * voltage * voltage;\r\n\r\n    // Missions\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Flash Compact', objective: 'R├®glez ¤ä = 50.0 ms (┬▒5) pour un flash rapide.', targetTau: 50.0, tolerance: 5 },\r\n        { id: 2, title: '├ëclairage Studio', objective: 'Ajustez ¤ä = 150.0 ms (┬▒15) pour un portrait doux.', targetTau: 150.0, tolerance: 15 },\r\n        { id: 3, title: 'Flash Master', objective: 'Configurez ¤ä = 450.0 ms (┬▒30) pour une puissance maximale.', targetTau: 450.0, tolerance: 30 }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            const m = missions[Math.min(level - 1, missions.length - 1)];\r\n            setMission(m);\r\n            setTimeLeft(45);\r\n        }\r\n    }, [phase, level, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [timeLeft, phase, showSuccess]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && mission && !showSuccess) {\r\n            if (Math.abs(tauMs - mission.targetTau) <= mission.tolerance) {\r\n                handleSuccess();\r\n            }\r\n        }\r\n    }, [tauMs, phase, mission, showSuccess]);\r\n\r\n    useEffect(() => {\r\n        if (isCharging && chargePercent < 99.9) {\r\n            const step = (100 - chargePercent) * 0.1;\r\n            const interval = setInterval(() => {\r\n                setChargePercent(p => Math.min(100, p + step));\r\n            }, tauMs / 10);\r\n            return () => clearInterval(interval);\r\n        }\r\n    }, [isCharging, chargePercent, tauMs]);\r\n\r\n    const triggerFlash = () => {\r\n        if (chargePercent > 80) {\r\n            setShowFlash(true);\r\n            setChargePercent(0);\r\n            setIsCharging(false);\r\n            setTimeout(() => setShowFlash(false), 150);\r\n        }\r\n    };\r\n\r\n    const handleSuccess = () => {\r\n        setScore(s => s + 400);\r\n        setShowSuccess(true);\r\n        triggerFlash();\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        setLevel(l => Math.min(l + 1, 3));\r\n        setMission(null);\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            {/* Sc├¿ne 3D */}\r\n            <group scale={2}>\r\n                {/* Flash Effect */}\r\n                {showFlash && (\r\n                    <mesh>\r\n                        <sphereGeometry args={[8, 32, 32]} />\r\n                        <meshBasicMaterial color=\"#ffffff\" transparent opacity={0.6} side={THREE.BackSide} />\r\n                    </mesh>\r\n                )}\r\n\r\n                {/* Condensateur */}\r\n                <group position={[-0.5, 0, 0]}>\r\n                    <mesh position={[-0.1, 0, 0]}>\r\n                        <boxGeometry args={[0.04, 0.8, 0.5]} />\r\n                        <meshStandardMaterial color=\"#3b82f6\" />\r\n                    </mesh>\r\n                    <mesh position={[0.1, 0, 0]}>\r\n                        <boxGeometry args={[0.04, 0.8, 0.5]} />\r\n                        <meshStandardMaterial color=\"#3b82f6\" />\r\n                    </mesh>\r\n                    {/* Charge Visuelle */}\r\n                    <mesh position={[0, -0.4 + (chargePercent / 100 * 0.4), 0]}>\r\n                        <boxGeometry args={[0.16, chargePercent / 100 * 0.8, 0.48]} />\r\n                        <meshStandardMaterial color=\"#fbbf24\" emissive=\"#fbbf24\" emissiveIntensity={chargePercent / 150} />\r\n                    </mesh>\r\n                </group>\r\n\r\n                {/* R├®sistance */}\r\n                <mesh position={[0.6, 0, 0]}>\r\n                    <cylinderGeometry args={[0.1, 0.1, 0.5, 16]} rotation={[0, 0, Math.PI / 2]} />\r\n                    <meshStandardMaterial color=\"#78716c\" />\r\n                </mesh>\r\n            </group>\r\n\r\n            {/* UI Holographique */}\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel\r\n                    title=\"­ƒô© Dip├┤le RC - Flash Photo\"\r\n                    showCloseButton={false}\r\n                    defaultPosition=\"bottom-center\"\r\n                    className=\"w-[420px] border-yellow-500/30\"\r\n                >\r\n                    <div className=\"text-white\">\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <GradeBadge score={score} />\r\n                            {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={45} />}\r\n                        </div>\r\n\r\n                        <XPBar current={score} nextLevel={2000} />\r\n\r\n                        <div className=\"h-[1px] bg-gradient-to-r from-transparent via-yellow-500/50 to-transparent my-4\" />\r\n\r\n                        <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                        {phase === 'mission' && mission && (\r\n                            <MissionObjective objective={mission.objective} icon=\"­ƒô©\" />\r\n                        )}\r\n\r\n                        <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                            <div className=\"space-y-4\">\r\n                                <div>\r\n                                    <label className=\"text-[10px] text-gray-400 block mb-1 uppercase tracking-wider font-bold\">Capacit├® C: {capacitance} ┬ÁF</label>\r\n                                    <input type=\"range\" min=\"10\" max=\"1000\" step=\"10\" value={capacitance} onChange={(e) => setCapacitance(parseInt(e.target.value))} className=\"w-full h-1 bg-gray-700 accent-yellow-500 rounded-full\" />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"text-[10px] text-gray-400 block mb-1 uppercase tracking-wider font-bold\">R├®sistance R: {resistance / 1000} k╬®</label>\r\n                                    <input type=\"range\" min=\"100\" max=\"5000\" step=\"100\" value={resistance} onChange={(e) => setResistance(parseInt(e.target.value))} className=\"w-full h-1 bg-gray-700 accent-blue-500 rounded-full\" />\r\n                                </div>\r\n                                <div className=\"flex gap-2\">\r\n                                    <button onClick={() => setIsCharging(true)} className={`flex-1 py-1 rounded text-[10px] font-bold transition-all ${isCharging ? 'bg-emerald-500' : 'bg-gray-800'}`}>CHARGER</button>\r\n                                    <button onClick={triggerFlash} className={`flex-1 py-1 rounded text-[10px] font-bold transition-all ${chargePercent > 80 ? 'bg-yellow-500 text-black' : 'bg-gray-800 text-gray-400 cursor-not-allowed'}`}>FLASH!</button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"bg-black/60 rounded-xl p-3 border border-yellow-500/20 flex flex-col justify-between shadow-inner\">\r\n                                <div className=\"space-y-1\">\r\n                                    <div className=\"text-[9px] text-yellow-500 font-mono tracking-tighter uppercase opacity-70 italic transform -skew-x-12 mb-1\">FLASH_ENERGY_CAP</div>\r\n                                    <div className=\"text-[10px] font-mono\"><span className=\"text-yellow-400\">CONSTANTE ¤ä:</span> {tauMs.toFixed(1)} ms</div>\r\n                                    <div className=\"text-[10px] font-mono\"><span className=\"text-blue-400\">├ëNERGIE W:</span> {(energy * 1000).toFixed(1)} mJ</div>\r\n                                    <div className=\"text-[10px] font-mono\"><span className=\"text-white\">CHARGE:</span> {chargePercent.toFixed(1)}%</div>\r\n                                </div>\r\n\r\n                                <div className=\"mt-4 pt-2 border-t border-white/5 text-[9px] text-gray-500 leading-tight italic\">\r\n                                    ¤ä = R ┬À C | W = ┬¢ ┬À C ┬À U┬▓\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay\r\n                show={showSuccess}\r\n                message={`Flash calibr├® ! Mission \"${mission?.title}\" r├®ussie.`}\r\n                points={400}\r\n                onNext={nextMission}\r\n            />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// Export Partie 2\r\nexport { ChampMagnetiqueAdvanced as ChampMagnetiqueTS };\r\nexport { LorentzAdvanced as LorentzTS };\r\nexport { LaplaceAdvanced as LaplaceTS };\r\nexport { InductionRLAdvanced as InductionRLTS };\r\nexport { DipoleRCAdvanced as DipoleRCTS };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\PhysiqueTSAdvanced3.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\PhysiqueTSAdvanced4.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'getTransitionWavelength'. Either include it or remove the dependency array.","line":292,"column":8,"nodeType":"ArrayExpression","endLine":292,"endColumn":57,"suggestions":[{"desc":"Update the dependencies array to be: [selectedTransition, phase, mission, showSuccess, getTransitionWavelength]","fix":{"range":[13218,13267],"text":"[selectedTransition, phase, mission, showSuccess, getTransitionWavelength]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n/**\r\n * Physique Terminale S - Simulations Avanc├®es\r\n * Partie 4: Ph├®nom├¿nes Corpusculaires (Chapitres 13-15)\r\n * Mode D├®fi avec gamification compl├¿te\r\n */\r\nimport React, { useState, useRef, useEffect, useMemo, useCallback } from 'react';\r\nimport { useFrame } from '@react-three/fiber';\r\nimport { Html, Line, Text } from '@react-three/drei';\r\nimport * as THREE from 'three';\r\nimport { SuccessOverlay, ConfettiExplosion, ChallengeTimer, GradeBadge, XPBar, PhaseSelector, MissionObjective } from './GamificationUtils';\r\nimport DraggableHtmlPanel from './DraggableHtmlPanel';\r\n\r\n// (ChallengeTimer supprim├® car import├® de GamificationUtils)\r\n\r\n// ============================================================\r\n// P13. EFFET PHOTO├ëLECTRIQUE - VERSION AVANC├ëE\r\n// Mission: Ing├®nieur Cellule Solaire - Optimiser la production\r\n// ============================================================\r\nfunction PhotoelectriqueAdvanced() {\r\n    // ├ëtats Globaux\r\n    const [phase, setPhase] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [level, setLevel] = useState(1);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n\r\n    // ├ëtats Physiques\r\n    const [wavelength, setWavelength] = useState(400);\r\n    const [intensity, setIntensity] = useState(50);\r\n    const [metalType, setMetalType] = useState('cesium');\r\n    const [time, setTime] = useState(0);\r\n\r\n    const h = 6.626e-34;\r\n    const c = 3e8;\r\n    const eV = 1.602e-19;\r\n\r\n    const metals = {\r\n        cesium: { name: 'C├®sium', W: 1.9, color: '#ffd700' },\r\n        sodium: { name: 'Sodium', W: 2.3, color: '#c0c0c0' },\r\n        zinc: { name: 'Zinc', W: 4.3, color: '#808080' },\r\n        cuivre: { name: 'Cuivre', W: 4.7, color: '#b87333' }\r\n    };\r\n\r\n    const W = metals[metalType].W;\r\n    const wavelengthM = wavelength * 1e-9;\r\n    const photonEnergy = (h * c / wavelengthM) / eV;\r\n    const kineticEnergy = Math.max(0, photonEnergy - W);\r\n    const isPhotoelectric = photonEnergy > W;\r\n    const lambdaSeuil = (h * c) / (W * eV) * 1e9;\r\n\r\n    // Missions\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Cellule Domestique', objective: 'G├®n├®rez des ├®lectrons ├á Ec = 0.50 eV (┬▒0.1) pour une LED.', targetE: 0.5, tolerance: 0.1 },\r\n        { id: 2, title: 'Panneau Satellite', objective: 'Optimisez pour Ec = 1.20 eV (┬▒0.15) en orbite.', targetE: 1.2, tolerance: 0.15 },\r\n        { id: 3, title: 'Capteur UV Industriel', objective: 'Atteignez Ec = 2.50 eV (┬▒0.2) avec des UV.', targetE: 2.5, tolerance: 0.2 }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            const m = missions[Math.min(level - 1, missions.length - 1)];\r\n            setMission(m);\r\n            setTimeLeft(45);\r\n        }\r\n    }, [phase, level, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [timeLeft, phase, showSuccess]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && mission && !showSuccess) {\r\n            if (isPhotoelectric && Math.abs(kineticEnergy - mission.targetE) <= mission.tolerance) {\r\n                handleSuccess();\r\n            }\r\n        }\r\n    }, [kineticEnergy, isPhotoelectric, phase, mission, showSuccess]);\r\n\r\n    useFrame((state, delta) => {\r\n        setTime(t => t + delta);\r\n    });\r\n\r\n    const handleSuccess = () => {\r\n        setScore(s => s + 600);\r\n        setShowSuccess(true);\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        setLevel(l => Math.min(l + 1, 3));\r\n        setMission(null);\r\n    };\r\n\r\n    const getColor = (wl) => {\r\n        if (wl < 450) return '#8b5cf6';\r\n        if (wl < 495) return '#3b82f6';\r\n        if (wl < 570) return '#22c55e';\r\n        if (wl < 590) return '#eab308';\r\n        if (wl < 620) return '#f97316';\r\n        return '#ef4444';\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            {/* Sc├¿ne 3D */}\r\n            <group scale={1.2}>\r\n                <mesh position={[0, -1, 0]} rotation={[-Math.PI / 2, 0, 0]}>\r\n                    <boxGeometry args={[4, 3, 0.2]} />\r\n                    <meshStandardMaterial color={metals[metalType].color} metalness={0.8} roughness={0.2} />\r\n                </mesh>\r\n\r\n                <mesh position={[-2, 2.5, 0]}>\r\n                    <sphereGeometry args={[0.3, 16, 16]} />\r\n                    <meshStandardMaterial color={getColor(wavelength)} emissive={getColor(wavelength)} emissiveIntensity={2} />\r\n                </mesh>\r\n\r\n                {/* Photons */}\r\n                {Array.from({ length: 5 }).map((_, i) => {\r\n                    const phaseMult = (time * 1.5 + i * 0.4) % 1;\r\n                    return (\r\n                        <mesh key={`p-${i}`} position={[-2 + phaseMult * 2, 2.5 - phaseMult * 3.5, 0]}>\r\n                            <sphereGeometry args={[0.05, 8, 8]} />\r\n                            <meshStandardMaterial color={getColor(wavelength)} emissive={getColor(wavelength)} emissiveIntensity={1} />\r\n                        </mesh>\r\n                    );\r\n                })}\r\n\r\n                {/* ├ëlectrons */}\r\n                {isPhotoelectric && Array.from({ length: 5 }).map((_, i) => {\r\n                    const phaseMult = (time * 2 + i * 0.5) % 1;\r\n                    return (\r\n                        <mesh key={`e-${i}`} position={[phaseMult * kineticEnergy * 0.5, -0.8 + phaseMult * 2, 0]}>\r\n                            <sphereGeometry args={[0.04, 8, 8]} />\r\n                            <meshStandardMaterial color=\"#22d3ee\" emissive=\"#22d3ee\" emissiveIntensity={1} />\r\n                        </mesh>\r\n                    );\r\n                })}\r\n            </group>\r\n\r\n            {/* UI Holographique */}\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel\r\n                    title=\"ÔÿÇ´©Å Photovolta├»que - Effet Einstein\"\r\n                    showCloseButton={false}\r\n                    defaultPosition=\"bottom-center\"\r\n                    className=\"w-[420px] border-yellow-500/30\"\r\n                >\r\n                    <div className=\"text-white\">\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <GradeBadge score={score} />\r\n                            {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={45} />}\r\n                        </div>\r\n\r\n                        <XPBar current={score} nextLevel={2000} />\r\n\r\n                        <div className=\"h-[1px] bg-gradient-to-r from-transparent via-yellow-500/50 to-transparent my-4\" />\r\n\r\n                        <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                        {phase === 'mission' && mission && (\r\n                            <MissionObjective objective={mission.objective} icon=\"­ƒöï\" />\r\n                        )}\r\n\r\n                        <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                            <div className=\"space-y-4\">\r\n                                <div>\r\n                                    <label className=\"text-[10px] text-gray-400 block mb-1 uppercase tracking-wider font-bold\">M├®tal Cible</label>\r\n                                    <select value={metalType} onChange={(e) => setMetalType(e.target.value)} className=\"w-full bg-gray-800 border border-gray-700 rounded p-1 text-[10px]\">\r\n                                        {Object.entries(metals).map(([k, v]) => <option key={k} value={k}>{v.name} (W={v.W}eV)</option>)}\r\n                                    </select>\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"text-[10px] text-gray-400 block mb-1 uppercase tracking-wider font-bold\">╬╗: {wavelength} nm</label>\r\n                                    <input type=\"range\" min=\"200\" max=\"800\" value={wavelength} onChange={(e) => setWavelength(parseInt(e.target.value))} className=\"w-full h-1 bg-gray-700 accent-yellow-500 rounded-full\" />\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"bg-black/60 rounded-xl p-3 border border-yellow-500/20 flex flex-col justify-between shadow-inner\">\r\n                                <div className=\"space-y-1\">\r\n                                    <div className=\"text-[9px] text-yellow-500 font-mono tracking-tighter uppercase opacity-70 italic transform -skew-x-12 mb-1\">QUANTUM_CELL_X1</div>\r\n                                    <div className=\"text-[10px] font-mono\"><span className=\"text-yellow-400\">├ëNERGIE Ec:</span> {kineticEnergy.toFixed(2)} eV</div>\r\n                                    <div className=\"text-[10px] font-mono\"><span className=\"text-blue-400\">SEUIL ╬╗ÔéÇ:</span> {lambdaSeuil.toFixed(0)} nm</div>\r\n                                    <div className={`text-[9px] mt-1 ${isPhotoelectric ? 'text-emerald-400' : 'text-red-400'}`}>\r\n                                        {isPhotoelectric ? \"Ô£ô ├ëMISSION ACTIVE\" : \"Ô£ù ├ëNERGIE INSUFFISANTE\"}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay\r\n                show={showSuccess}\r\n                message={`Courant ├®tabli ! Mission \"${mission?.title}\" r├®ussie.`}\r\n                points={600}\r\n                onNext={nextMission}\r\n            />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// P14. NIVEAUX D'├ëNERGIE - VERSION AVANC├ëE\r\n// Mission: Spectroscopiste - Identifier les raies spectrales\r\n// ============================================================\r\nfunction NiveauxEnergieAdvanced() {\r\n    // ├ëtats Globaux\r\n    const [phase, setPhase] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [level, setLevel] = useState(1);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n\r\n    // ├ëtats Physiques\r\n    const [currentLevel, setCurrentLevel] = useState(1);\r\n    const [selectedTransition, setSelectedTransition] = useState(null);\r\n    const [showPhoton, setShowPhoton] = useState(false);\r\n    const [photonPhase, setPhotonPhase] = useState(0);\r\n\r\n    const h = 6.626e-34;\r\n    const c = 3e8;\r\n    const eV = 1.602e-19;\r\n\r\n    const energyLevels = [\r\n        { n: 1, E: -13.6, y: -2 },\r\n        { n: 2, E: -3.4, y: -0.5 },\r\n        { n: 3, E: -1.51, y: 0.5 },\r\n        { n: 4, E: -0.85, y: 1.2 },\r\n        { n: 5, E: -0.54, y: 1.7 },\r\n        { n: 6, E: -0.38, y: 2.0 }\r\n    ];\r\n\r\n    const transitions = [\r\n        { from: 3, to: 2, name: \"H╬▒ (rouge)\", targetWl: 656 },\r\n        { from: 4, to: 2, name: \"H╬▓ (cyan)\", targetWl: 486 },\r\n        { from: 5, to: 2, name: \"H╬│ (bleu)\", targetWl: 434 },\r\n        { from: 6, to: 2, name: \"H╬┤ (violet)\", targetWl: 410 }\r\n    ];\r\n\r\n    const getTransitionWavelength = (from, to) => {\r\n        const E1 = energyLevels.find(l => l.n === from).E;\r\n        const E2 = energyLevels.find(l => l.n === to).E;\r\n        const deltaE = Math.abs(E1 - E2) * eV;\r\n        return (h * c / deltaE) * 1e9;\r\n    };\r\n\r\n    const getColorFromWavelength = (wl) => {\r\n        if (wl > 620) return '#ef4444';\r\n        if (wl > 590) return '#f97316';\r\n        if (wl > 570) return '#eab308';\r\n        if (wl > 495) return '#22c55e';\r\n        if (wl > 450) return '#22d3ee';\r\n        return '#8b5cf6';\r\n    };\r\n\r\n    // Missions\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Raie de Balmer Rouge', objective: 'Identifiez la transition g├®n├®rant ╬╗ = 656 nm (H╬▒).', targetWl: 656, tolerance: 10 },\r\n        { id: 2, title: 'Spectre Cyan', objective: 'Trouvez la raie H╬▓ correspondant ├á ╬╗ = 486 nm.', targetWl: 486, tolerance: 10 },\r\n        { id: 3, title: 'Ultraviolet Proche', objective: 'Identifiez la raie H╬┤ ├á ╬╗ = 410 nm.', targetWl: 410, tolerance: 10 }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            const m = missions[Math.min(level - 1, missions.length - 1)];\r\n            setMission(m);\r\n            setTimeLeft(45);\r\n        }\r\n    }, [phase, level, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [timeLeft, phase, showSuccess]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && selectedTransition && !showSuccess) {\r\n            const actualWl = getTransitionWavelength(selectedTransition.from, selectedTransition.to);\r\n            if (Math.abs(actualWl - mission.targetWl) <= mission.tolerance) {\r\n                handleSuccess();\r\n            }\r\n        }\r\n    }, [selectedTransition, phase, mission, showSuccess]);\r\n\r\n    useFrame((state, delta) => {\r\n        if (showPhoton) {\r\n            setPhotonPhase(p => {\r\n                if (p >= 1) {\r\n                    setShowPhoton(false);\r\n                    return 0;\r\n                }\r\n                return p + delta * 2;\r\n            });\r\n        }\r\n    });\r\n\r\n    const executeTransition = (trans) => {\r\n        setSelectedTransition(trans);\r\n        setCurrentLevel(trans.from);\r\n        setShowPhoton(true);\r\n        setPhotonPhase(0);\r\n        setTimeout(() => setCurrentLevel(trans.to), 300);\r\n    };\r\n\r\n    const handleSuccess = () => {\r\n        setScore(s => s + 650);\r\n        setShowSuccess(true);\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        setLevel(l => Math.min(l + 1, 3));\r\n        setMission(null);\r\n        setSelectedTransition(null);\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            {/* Sc├¿ne 3D */}\r\n            <group scale={1.2}>\r\n                {energyLevels.map((lvl) => (\r\n                    <group key={lvl.n} position={[0, lvl.y, 0]}>\r\n                        <Line points={[[-2, 0, 0], [2, 0, 0]]} color={currentLevel === lvl.n ? '#22d3ee' : '#475569'} lineWidth={currentLevel === lvl.n ? 3 : 1} />\r\n                        <Text position={[-2.4, 0, 0]} fontSize={0.12} color=\"white\">n={lvl.n}</Text>\r\n                        <Text position={[2.4, 0, 0]} fontSize={0.1} color=\"#94a3b8\">{lvl.E} eV</Text>\r\n                    </group>\r\n                ))}\r\n\r\n                <mesh position={[0, energyLevels.find(l => l.n === currentLevel)?.y || 0, 0.1]}>\r\n                    <sphereGeometry args={[0.12, 16, 16]} />\r\n                    <meshStandardMaterial color=\"#22d3ee\" emissive=\"#22d3ee\" emissiveIntensity={1} />\r\n                </mesh>\r\n\r\n                {showPhoton && selectedTransition && (() => {\r\n                    const wl = getTransitionWavelength(selectedTransition.from, selectedTransition.to);\r\n                    const color = getColorFromWavelength(wl);\r\n                    const fromY = energyLevels.find(l => l.n === selectedTransition.from).y;\r\n                    const toY = energyLevels.find(l => l.n === selectedTransition.to).y;\r\n                    return (\r\n                        <mesh position={[0.5 + photonPhase * 2, fromY + (toY - fromY) * photonPhase, 0]}>\r\n                            <sphereGeometry args={[0.08, 8, 8]} />\r\n                            <meshStandardMaterial color={color} emissive={color} emissiveIntensity={2} />\r\n                        </mesh>\r\n                    );\r\n                })()}\r\n\r\n                {/* Spectre visible */}\r\n                <group position={[0, -3.2, 0]}>\r\n                    <mesh><boxGeometry args={[4, 0.4, 0.1]} /><meshStandardMaterial color=\"#020617\" /></mesh>\r\n                    {transitions.map((t, i) => {\r\n                        const wl = getTransitionWavelength(t.from, t.to);\r\n                        return (\r\n                            <mesh key={i} position={[((wl - 400) / 300) * 3.5 - 1.75, 0, 0.1]}>\r\n                                <boxGeometry args={[0.04, 0.3, 0.02]} />\r\n                                <meshStandardMaterial color={getColorFromWavelength(wl)} emissive={getColorFromWavelength(wl)} emissiveIntensity={1} />\r\n                            </mesh>\r\n                        );\r\n                    })}\r\n                </group>\r\n            </group>\r\n\r\n            {/* UI Holographique */}\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel\r\n                    title=\"­ƒîê Spectroscopie Atomique\"\r\n                    showCloseButton={false}\r\n                    defaultPosition=\"bottom-center\"\r\n                    className=\"w-[420px] border-indigo-500/30\"\r\n                >\r\n                    <div className=\"text-white\">\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <GradeBadge score={score} />\r\n                            {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={45} />}\r\n                        </div>\r\n\r\n                        <XPBar current={score} nextLevel={2500} />\r\n\r\n                        <div className=\"h-[1px] bg-gradient-to-r from-transparent via-indigo-500/50 to-transparent my-4\" />\r\n\r\n                        <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                        {phase === 'mission' && mission && (\r\n                            <MissionObjective objective={mission.objective} icon=\"­ƒö¼\" />\r\n                        )}\r\n\r\n                        <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                            <div className=\"grid grid-cols-2 gap-2\">\r\n                                {transitions.map((t, i) => (\r\n                                    <button\r\n                                        key={i}\r\n                                        onClick={() => executeTransition(t)}\r\n                                        style={{ borderLeft: `3px solid ${getColorFromWavelength(t.targetWl)}` }}\r\n                                        className={`p-2 rounded bg-gray-800/50 hover:bg-gray-700 transition-all text-left group`}\r\n                                    >\r\n                                        <div className=\"text-[9px] font-bold text-gray-400\">n={t.from} ÔåÆ n={t.to}</div>\r\n                                        <div className=\"text-[10px] text-white\"> Balmer-{i + 1}</div>\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n\r\n                            <div className=\"bg-black/60 rounded-xl p-3 border border-indigo-500/20 flex flex-col justify-between shadow-inner\">\r\n                                <div className=\"space-y-1\">\r\n                                    <div className=\"text-[9px] text-indigo-500 font-mono tracking-tighter uppercase opacity-70 italic transform -skew-x-12 mb-1\">SPECTRA_SCANNR_V5</div>\r\n                                    {selectedTransition ? (\r\n                                        <>\r\n                                            <div className=\"text-[10px] font-mono\"><span className=\"text-indigo-400\">╬╗:</span> {getTransitionWavelength(selectedTransition.from, selectedTransition.to).toFixed(1)} nm</div>\r\n                                            <div className=\"text-[10px] font-mono\"><span className=\"text-blue-400\">╬öE:</span> {(Math.abs(energyLevels.find(l => l.n === selectedTransition.from).E - energyLevels.find(l => l.n === selectedTransition.to).E)).toFixed(2)} eV</div>\r\n                                        </>\r\n                                    ) : (\r\n                                        <div className=\"text-[9px] text-gray-500 animate-pulse italic\">ATTENTE_TRANSITION...</div>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay\r\n                show={showSuccess}\r\n                message={`Raie identifi├®e ! Mission \"${mission?.title}\" r├®ussie.`}\r\n                points={650}\r\n                onNext={nextMission}\r\n            />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// ============================================================\r\n// P15. R├ëACTIONS NUCL├ëAIRES - VERSION AVANC├ëE\r\n// Mission: Ing├®nieur Nucl├®aire - Contr├┤ler la r├®action\r\n// ============================================================\r\nfunction NucleaireAdvanced() {\r\n    // ├ëtats Globaux\r\n    const [phase, setPhase] = useState('explore');\r\n    const [score, setScore] = useState(0);\r\n    const [level, setLevel] = useState(1);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const [mission, setMission] = useState(null);\r\n    const [timeLeft, setTimeLeft] = useState(45);\r\n\r\n    // ├ëtats Physiques\r\n    const [controlRods, setControlRods] = useState(50);\r\n    const [neutronCount, setNeutronCount] = useState(1);\r\n    const [time, setTime] = useState(0);\r\n    const [isReacting, setIsReacting] = useState(false);\r\n    const [chainReaction, setChainReaction] = useState([]);\r\n\r\n    const k = (120 - controlRods) / 60; // Facteur de multiplication k\r\n    const power = Math.min(100, neutronCount * k * 8);\r\n    const isCritical = k > 1.1 && controlRods < 40;\r\n    const isStable = k >= 0.9 && k <= 1.1;\r\n\r\n    // Missions\r\n    const missions = useMemo(() => [\r\n        { id: 1, title: 'Mode Veille', objective: 'Maintenez une puissance P = 20% (┬▒5%) pour le r├®seau urbain.', targetP: 20, tolerance: 5 },\r\n        { id: 2, title: 'Pic de Consommation', objective: 'Stabilisez ├á P = 75% (┬▒5%) pendant la temp├¬te.', targetP: 75, tolerance: 5 },\r\n        { id: 3, title: 'Test de Criticit├®', objective: 'Atteignez P = 95% (┬▒3%) sans fusion du c┼ôur.', targetP: 95, tolerance: 3 }\r\n    ], []);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && !mission) {\r\n            const m = missions[Math.min(level - 1, missions.length - 1)];\r\n            setMission(m);\r\n            setTimeLeft(45);\r\n        }\r\n    }, [phase, level, mission, missions]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && timeLeft > 0 && !showSuccess) {\r\n            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [timeLeft, phase, showSuccess]);\r\n\r\n    useEffect(() => {\r\n        if (phase === 'mission' && mission && !showSuccess) {\r\n            if (isReacting && Math.abs(power - mission.targetP) <= mission.tolerance) {\r\n                handleSuccess();\r\n            }\r\n        }\r\n    }, [power, isReacting, phase, mission, showSuccess]);\r\n\r\n    useFrame((state, delta) => {\r\n        if (isReacting) {\r\n            setTime(t => t + delta);\r\n            setNeutronCount(n => Math.min(100, Math.max(0.1, n * (1 + (k - 1) * delta * 2))));\r\n\r\n            if (Math.random() < k * 0.2) {\r\n                setChainReaction(prev => [...prev.slice(-15), {\r\n                    id: Date.now() + Math.random(),\r\n                    x: (Math.random() - 0.5) * 2.5,\r\n                    y: (Math.random() - 0.5) * 2.5,\r\n                    z: (Math.random() - 0.5) * 2.5\r\n                }]);\r\n            }\r\n        }\r\n    });\r\n\r\n    const handleSuccess = () => {\r\n        setScore(s => s + 700);\r\n        setShowSuccess(true);\r\n    };\r\n\r\n    const nextMission = () => {\r\n        setShowSuccess(false);\r\n        setLevel(l => Math.min(l + 1, 3));\r\n        setMission(null);\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            {/* C┼ôur du r├®acteur */}\r\n            <group scale={1.2}>\r\n                <mesh position={[0, 0, 0]}>\r\n                    <cylinderGeometry args={[1.5, 1.5, 3, 32]} />\r\n                    <meshStandardMaterial\r\n                        color={isCritical ? \"#ef4444\" : isStable ? \"#22c55e\" : \"#3b82f6\"}\r\n                        emissive={isCritical ? \"#ef4444\" : \"#22d3ee\"}\r\n                        emissiveIntensity={power / 100}\r\n                        transparent\r\n                        opacity={0.6}\r\n                    />\r\n                </mesh>\r\n\r\n                {/* Barres de contr├┤le graphit├®es */}\r\n                {[-0.8, 0, 0.8].map((x, i) => (\r\n                    <mesh key={i} position={[x, 1 + (controlRods / 100) * 2, 0]}>\r\n                        <cylinderGeometry args={[0.1, 0.1, 2, 8]} />\r\n                        <meshStandardMaterial color=\"#1e293b\" metalness={0.9} roughness={0.1} />\r\n                    </mesh>\r\n                ))}\r\n\r\n                {/* Neutrons & Fragments - Particules dynamiques */}\r\n                {chainReaction.map((p) => (\r\n                    <mesh key={p.id} position={[p.x, p.y, p.z]}>\r\n                        <sphereGeometry args={[0.06, 8, 8]} />\r\n                        <meshStandardMaterial color={Math.random() > 0.5 ? \"#22d3ee\" : \"#facc15\"} emissive={Math.random() > 0.5 ? \"#22d3ee\" : \"#facc15\"} emissiveIntensity={1} />\r\n                    </mesh>\r\n                ))}\r\n            </group>\r\n\r\n            {/* UI Holographique */}\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel\r\n                    title=\"Ôÿó´©Å Gestion Centrale - Fission\"\r\n                    showCloseButton={false}\r\n                    defaultPosition=\"bottom-center\"\r\n                    className=\"w-[420px] border-emerald-500/30\"\r\n                >\r\n                    <div className=\"text-white\">\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <GradeBadge score={score} />\r\n                            {phase === 'mission' && <ChallengeTimer timeLeft={timeLeft} maxTime={45} />}\r\n                        </div>\r\n\r\n                        <XPBar current={score} nextLevel={3000} />\r\n\r\n                        <div className=\"h-[1px] bg-gradient-to-r from-transparent via-emerald-500/50 to-transparent my-4\" />\r\n\r\n                        <PhaseSelector currentPhase={phase} onSelect={setPhase} />\r\n\r\n                        {phase === 'mission' && mission && (\r\n                            <MissionObjective objective={mission.objective} icon=\"Ôÿó´©Å\" />\r\n                        )}\r\n\r\n                        <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                            <div className=\"space-y-4\">\r\n                                <div>\r\n                                    <label className=\"text-[10px] text-gray-400 block mb-1 uppercase tracking-wider font-bold\">Barres de Contr├┤le: {controlRods}%</label>\r\n                                    <input type=\"range\" min=\"0\" max=\"100\" value={controlRods} onChange={(e) => setControlRods(parseInt(e.target.value))} className=\"w-full h-1 bg-gray-700 accent-emerald-500 rounded-full\" />\r\n                                    <div className=\"flex justify-between text-[8px] text-gray-500 mt-1 font-mono\">\r\n                                        <span>MAX_POW</span>\r\n                                        <span>SHUTDOWN</span>\r\n                                    </div>\r\n                                </div>\r\n                                <button onClick={() => { setIsReacting(!isReacting); if (!isReacting) setNeutronCount(1); }} className={`w-full py-1 rounded text-[10px] font-bold transition-all ${isReacting ? 'bg-red-500' : 'bg-emerald-500'}`}>\r\n                                    {isReacting ? 'ARR├èTER R├ëACTEUR' : 'D├ëMARRER R├ëACTEUR'}\r\n                                </button>\r\n                            </div>\r\n\r\n                            <div className=\"bg-black/60 rounded-xl p-3 border border-emerald-500/20 flex flex-col justify-between shadow-inner\">\r\n                                <div className=\"space-y-1\">\r\n                                    <div className=\"text-[9px] text-emerald-500 font-mono tracking-tighter uppercase opacity-70 italic transform -skew-x-12 mb-1\">REACTOR_CORE_OS</div>\r\n                                    <div className=\"text-[10px] font-mono\"><span className=\"text-emerald-400\">PUISSANCE:</span> {power.toFixed(1)}%</div>\r\n                                    <div className=\"text-[10px] font-mono\"><span className=\"text-blue-400\">MULT. k:</span> {k.toFixed(3)}</div>\r\n                                    <div className={`text-[9px] mt-1 font-bold ${isCritical ? 'text-red-500' : isStable ? 'text-emerald-400' : 'text-blue-400'}`}>\r\n                                        {isCritical ? \"ÔÜá´©Å ├ëTAT CRITIQUE\" : isStable ? \"Ô£ô R├ëGIME STABLE\" : \"­ƒôë SOUS-CRITIQUE\"}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n\r\n            <SuccessOverlay\r\n                show={showSuccess}\r\n                message={`R├®acteur stabilis├® ! Mission \"${mission?.title}\" r├®ussie.`}\r\n                points={700}\r\n                onNext={nextMission}\r\n            />\r\n            <ConfettiExplosion active={showSuccess} />\r\n        </group>\r\n    );\r\n}\r\n\r\n// Export Partie 4\r\nexport { PhotoelectriqueAdvanced as PhotoelectriqueTS };\r\nexport { NiveauxEnergieAdvanced as NiveauxEnergieTS };\r\nexport { NucleaireAdvanced as NucleaireTS };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\PhysiqueTSSimulations.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\RichText.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\SecondeSimulations.js","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":98,"column":29,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[4533,4650],"text":"\r\n                            &quot;Un corps garde sa vitesse si aucune force ne le freine.\"\r\n                            "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[4533,4650],"text":"\r\n                            &ldquo;Un corps garde sa vitesse si aucune force ne le freine.\"\r\n                            "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[4533,4650],"text":"\r\n                            &#34;Un corps garde sa vitesse si aucune force ne le freine.\"\r\n                            "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[4533,4650],"text":"\r\n                            &rdquo;Un corps garde sa vitesse si aucune force ne le freine.\"\r\n                            "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":98,"column":85,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[4533,4650],"text":"\r\n                            \"Un corps garde sa vitesse si aucune force ne le freine.&quot;\r\n                            "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[4533,4650],"text":"\r\n                            \"Un corps garde sa vitesse si aucune force ne le freine.&ldquo;\r\n                            "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[4533,4650],"text":"\r\n                            \"Un corps garde sa vitesse si aucune force ne le freine.&#34;\r\n                            "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[4533,4650],"text":"\r\n                            \"Un corps garde sa vitesse si aucune force ne le freine.&rdquo;\r\n                            "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":365,"column":39,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[17063,17146],"text":"\r\n                            R├¿gle de l&apos;Octet/Duet :\r\n                            "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[17063,17146],"text":"\r\n                            R├¿gle de l&lsquo;Octet/Duet :\r\n                            "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[17063,17146],"text":"\r\n                            R├¿gle de l&#39;Octet/Duet :\r\n                            "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[17063,17146],"text":"\r\n                            R├¿gle de l&rsquo;Octet/Duet :\r\n                            "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":469,"column":98,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[21658,21693],"text":" : La vapeur d&apos;eau emporte l'huile."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[21658,21693],"text":" : La vapeur d&lsquo;eau emporte l'huile."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[21658,21693],"text":" : La vapeur d&#39;eau emporte l'huile."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[21658,21693],"text":" : La vapeur d&rsquo;eau emporte l'huile."},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":469,"column":112,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[21658,21693],"text":" : La vapeur d'eau emporte l&apos;huile."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[21658,21693],"text":" : La vapeur d'eau emporte l&lsquo;huile."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[21658,21693],"text":" : La vapeur d'eau emporte l&#39;huile."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[21658,21693],"text":" : La vapeur d'eau emporte l&rsquo;huile."},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":474,"column":45,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[22097,22220],"text":"\r\n                            ÔÜá´©Å Attention : L&apos;eau froide doit entrer par le BAS du r├®frig├®rant !\r\n                        "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[22097,22220],"text":"\r\n                            ÔÜá´©Å Attention : L&lsquo;eau froide doit entrer par le BAS du r├®frig├®rant !\r\n                        "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[22097,22220],"text":"\r\n                            ÔÜá´©Å Attention : L&#39;eau froide doit entrer par le BAS du r├®frig├®rant !\r\n                        "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[22097,22220],"text":"\r\n                            ÔÜá´©Å Attention : L&rsquo;eau froide doit entrer par le BAS du r├®frig├®rant !\r\n                        "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport React, { useState, useRef, useEffect } from 'react';\r\nimport { Canvas, useFrame } from '@react-three/fiber';\r\nimport { Html, OrbitControls, useGLTF, Float, Text, Line, Sphere } from '@react-three/drei';\r\nimport * as THREE from 'three';\r\nimport DraggableHtmlPanel from './DraggableHtmlPanel';\r\nimport EnhancedQuiz from './EnhancedQuiz'; // Assuming this exists or using standard quiz logic\r\n\r\n// =========================================================\r\n// 1. FORCES ET INERTIE (Curling / Glissade)\r\n// =========================================================\r\nexport function ForcesInertia() {\r\n    const [surface, setSurface] = useState('ice'); // ice, grass, sand\r\n    const [pushed, setPushed] = useState(false);\r\n    const [position, setPosition] = useState(0);\r\n    const [velocity, setVelocity] = useState(0);\r\n\r\n    // Config surfaces\r\n    const surfaces = {\r\n        ice: { name: 'Glace', friction: 0.005, color: '#A5F3FC', emoji: '­ƒºè' },\r\n        wood: { name: 'Parquet', friction: 0.05, color: '#D4A373', emoji: '­ƒ¬Á' },\r\n        sand: { name: 'Sable', friction: 0.3, color: '#EAB308', emoji: '­ƒÅû´©Å' }\r\n    };\r\n\r\n    useFrame((state, delta) => {\r\n        if (pushed && Math.abs(velocity) > 0.01) {\r\n            setPosition(p => p + velocity * delta * 5);\r\n            // Friction slows down\r\n            const friction = surfaces[surface].friction;\r\n            setVelocity(v => v > 0 ? Math.max(0, v - friction * delta * 5) : 0);\r\n        } else if (pushed && Math.abs(velocity) <= 0.01) {\r\n            setPushed(false);\r\n            setVelocity(0);\r\n        }\r\n    });\r\n\r\n    const pushObject = () => {\r\n        setPosition(0);\r\n        setVelocity(5);\r\n        setPushed(true);\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            <ambientLight intensity={0.5} />\r\n            <pointLight position={[10, 10, 10]} />\r\n\r\n            {/* Piste */}\r\n            <mesh rotation={[-Math.PI / 2, 0, 0]} position={[0, -0.5, 0]}>\r\n                <planeGeometry args={[20, 4]} />\r\n                <meshStandardMaterial color={surfaces[surface].color} roughness={0.1} metalness={0.1} />\r\n            </mesh>\r\n\r\n            {/* Objet (Stone) */}\r\n            <group position={[position - 5, 0, 0]}>\r\n                <mesh castShadow receiveShadow>\r\n                    <cylinderGeometry args={[0.5, 0.5, 0.2, 32]} />\r\n                    <meshStandardMaterial color=\"#ef4444\" />\r\n                </mesh>\r\n                <mesh position={[0, 0.2, 0]}>\r\n                    <cylinderGeometry args={[0.1, 0.1, 0.3, 16]} />\r\n                    <meshStandardMaterial color=\"#333\" />\r\n                </mesh>\r\n                <Html position={[0, 1, 0]} center>\r\n                    <div className=\"text-xs font-bold bg-black/50 text-white px-1 rounded whitespace-nowrap\">\r\n                        v = {velocity.toFixed(2)} m/s\r\n                    </div>\r\n                </Html>\r\n            </group>\r\n\r\n            {/* Rep├¿res distance */}\r\n            {[...Array(10)].map((_, i) => (\r\n                <mesh key={i} position={[-5 + i * 2, -0.49, 1.5]} rotation={[-Math.PI / 2, 0, 0]}>\r\n                    <planeGeometry args={[0.1, 0.5]} />\r\n                    <meshBasicMaterial color=\"white\" />\r\n                </mesh>\r\n            ))}\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒºè Principe d'Inertie\" defaultPosition=\"bottom-center\" className=\"w-[350px]\">\r\n                    <div className=\"space-y-4 text-white\">\r\n                        <div className=\"bg-gray-800 p-3 rounded-lg\">\r\n                            <label className=\"text-sm text-gray-400\">Surface :</label>\r\n                            <div className=\"flex gap-2 mt-2\">\r\n                                {Object.entries(surfaces).map(([k, s]) => (\r\n                                    <button\r\n                                        key={k}\r\n                                        onClick={() => { setSurface(k); setPushed(false); setPosition(0); }}\r\n                                        className={`flex-1 py-2 rounded border ${surface === k ? 'border-blue-400 bg-blue-500/30' : 'border-gray-600 bg-gray-700'}`}\r\n                                    >\r\n                                        <span className=\"text-lg\">{s.emoji}</span>\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"text-sm bg-blue-900/30 p-3 rounded border border-blue-500/30\">\r\n                            \"Un corps garde sa vitesse si aucune force ne le freine.\"\r\n                            <br />\r\n                            <span className=\"text-yellow-400 text-xs\">Frottement = {surfaces[surface].friction}</span>\r\n                        </div>\r\n\r\n                        <button\r\n                            onClick={pushObject}\r\n                            disabled={pushed && velocity > 0}\r\n                            className=\"w-full py-3 bg-green-600 hover:bg-green-500 rounded font-bold transition-all disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                        >\r\n                            {pushed ? 'Glissade en cours...' : '­ƒÜÇ Lancer le Palet'}\r\n                        </button>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n        </group>\r\n    );\r\n}\r\n\r\n// =========================================================\r\n// 2. LOI DE BOYLE-MARIOTTE (Gaz Parfait)\r\n// =========================================================\r\nexport function GasLaws() {\r\n    const [volume, setVolume] = useState(5); // Litres\r\n    // P = nRT/V. Constante k = P*V. Assuming P=1 when V=10. k=10.\r\n    const pressure = 10 / volume;\r\n\r\n    return (\r\n        <group>\r\n            <ambientLight intensity={0.5} />\r\n            <pointLight position={[10, 10, 10]} />\r\n\r\n            {/* Cylindre */}\r\n            <mesh position={[0, 0, 0]}>\r\n                <cylinderGeometry args={[2, 2, 6, 32, 1, true]} />\r\n                <meshPhysicalMaterial color=\"#ffffff\" transmission={0.9} roughness={0} thickness={0.5} opacity={0.3} transparent side={THREE.DoubleSide} />\r\n            </mesh>\r\n\r\n            {/* Piston mobile */}\r\n            <group position={[0, 3 - (10 - volume) / 10 * 6, 0]}>\r\n                <mesh rotation={[0, 0, 0]}>\r\n                    <cylinderGeometry args={[1.9, 1.9, 0.2, 32]} />\r\n                    <meshStandardMaterial color=\"#666\" metalness={0.8} />\r\n                </mesh>\r\n                <mesh position={[0, 2, 0]}>\r\n                    <cylinderGeometry args={[0.2, 0.2, 4, 16]} />\r\n                    <meshStandardMaterial color=\"#666\" />\r\n                </mesh>\r\n                <mesh position={[0, 4, 0]}>\r\n                    <boxGeometry args={[3, 0.5, 1]} />\r\n                    <meshStandardMaterial color=\"red\" />\r\n                </mesh>\r\n            </group>\r\n\r\n            {/* Particules de gaz */}\r\n            <Particles count={50} volume={volume} speed={pressure} />\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒÆ¿ Loi de Boyle-Mariotte\" defaultPosition=\"bottom-right\" className=\"w-[300px]\">\r\n                    <div className=\"space-y-4 text-white\">\r\n                        <div>\r\n                            <label className=\"text-sm text-gray-400\">Volume (L)</label>\r\n                            <input\r\n                                type=\"range\" min=\"1\" max=\"9\" step=\"0.1\"\r\n                                value={volume} onChange={(e) => setVolume(parseFloat(e.target.value))}\r\n                                className=\"w-full h-2 bg-gray-700 rounded-lg accent-blue-500\"\r\n                            />\r\n                            <div className=\"flex justify-between text-xl font-mono mt-1\">\r\n                                <span>{volume.toFixed(1)} L</span>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"bg-black/50 p-4 rounded-xl border border-white/10\">\r\n                            <div className=\"text-gray-400 text-xs uppercase mb-1\">Pression (Bar)</div>\r\n                            <div className=\"text-4xl font-bold text-red-500 font-mono\">{pressure.toFixed(2)}</div>\r\n                            <div className=\"h-2 bg-gray-800 rounded-full mt-2 overflow-hidden\">\r\n                                <div className=\"h-full bg-red-500 transition-all duration-300\" style={{ width: `${(pressure / 10) * 100}%` }}></div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"text-xs bg-blue-900/30 p-2 rounded text-center\">\r\n                            P ├ù V = Constante\r\n                            <br />\r\n                            {(pressure * volume).toFixed(1)} Ôëê 10.0\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n        </group>\r\n    );\r\n}\r\n\r\nfunction Particles({ count, volume, speed }) {\r\n    const mesh = useRef();\r\n    const particleData = useRef(Array.from({ length: count }, () => ({\r\n        pos: [Math.random() * 3 - 1.5, Math.random() * 4 - 2, Math.random() * 3 - 1.5],\r\n        vel: [(Math.random() - 0.5), (Math.random() - 0.5), (Math.random() - 0.5)]\r\n    })));\r\n\r\n    // Height of container varies with volume (mapped 1-10L to height)\r\n    // 10L = height 6 (full). 1L = height 0.6.\r\n    const h = (volume / 10) * 6;\r\n    const bottom = -3;\r\n    const top = bottom + h;\r\n\r\n    useFrame((state, delta) => {\r\n        const dummy = new THREE.Object3D();\r\n        particleData.current.forEach((p, i) => {\r\n            // Update pos\r\n            p.pos[0] += p.vel[0] * delta * speed * 2;\r\n            p.pos[1] += p.vel[1] * delta * speed * 2;\r\n            p.pos[2] += p.vel[2] * delta * speed * 2;\r\n\r\n            // Bounce walls (Cylinder radius approx 2)\r\n            if (Math.sqrt(p.pos[0] ** 2 + p.pos[2] ** 2) > 1.8) {\r\n                const angle = Math.atan2(p.pos[2], p.pos[0]);\r\n                p.vel[0] = -Math.cos(angle) * Math.abs(p.vel[0]);\r\n                p.vel[2] = -Math.sin(angle) * Math.abs(p.vel[2]);\r\n            }\r\n            // Bounce Top/Bottom\r\n            if (p.pos[1] > top) { p.pos[1] = top; p.vel[1] *= -1; }\r\n            if (p.pos[1] < bottom) { p.pos[1] = bottom; p.vel[1] *= -1; }\r\n\r\n            dummy.position.set(p.pos[0], p.pos[1], p.pos[2]);\r\n            dummy.scale.set(0.1, 0.1, 0.1);\r\n            dummy.updateMatrix();\r\n            mesh.current.setMatrixAt(i, dummy.matrix);\r\n        });\r\n        mesh.current.instanceMatrix.needsUpdate = true;\r\n    });\r\n\r\n    return (\r\n        <instancedMesh ref={mesh} args={[null, null, count]}>\r\n            <sphereGeometry args={[1, 16, 16]} />\r\n            <meshStandardMaterial color=\"#00ff88\" emissive=\"#00ff88\" emissiveIntensity={0.5} />\r\n        </instancedMesh>\r\n    );\r\n}\r\n\r\n// =========================================================\r\n// 3. SOUND WAVES (Oscilloscope)\r\n// =========================================================\r\nexport function SoundWaves() {\r\n    const [freq, setFreq] = useState(440);\r\n    const [amp, setAmp] = useState(1);\r\n    const pointsRef = useRef();\r\n\r\n    useFrame(({ clock }) => {\r\n        if (!pointsRef.current) return;\r\n        const pts = [];\r\n        const t = clock.getElapsedTime();\r\n        // Generate wave points\r\n        for (let x = -5; x <= 5; x += 0.05) {\r\n            const y = Math.sin(x * 2 + t * freq * 0.05) * amp;\r\n            pts.push(new THREE.Vector3(x, y, 0));\r\n        }\r\n        pointsRef.current.setFromPoints(pts);\r\n    });\r\n\r\n    return (\r\n        <group>\r\n            <ambientLight />\r\n\r\n            {/* Oscilloscope Screen */}\r\n            <mesh position={[0, 0, -1]}>\r\n                <boxGeometry args={[11, 6, 1]} />\r\n                <meshStandardMaterial color=\"#111\" />\r\n            </mesh>\r\n            <gridHelper position={[0, 0, -0.4]} args={[10, 10, 0x444444, 0x222222]} rotation={[Math.PI / 2, 0, 0]} />\r\n\r\n            {/* The Wave */}\r\n            <line ref={pointsRef} position={[0, 0, 0]}>\r\n                <bufferGeometry />\r\n                <lineBasicMaterial color=\"#00ff00\" linewidth={3} />\r\n            </line>\r\n\r\n            {/* Speaker Visual */}\r\n            <group position={[4, -3, 2]}>\r\n                <mesh scale={[1 + amp * 0.2, 1 + amp * 0.2, 1]}>\r\n                    <cylinderGeometry args={[2, 1, 1, 32]} rotation={[Math.PI / 2, 0, 0]} />\r\n                    <meshStandardMaterial color=\"#333\" />\r\n                </mesh>\r\n            </group>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒöè Ondes Sonores\" defaultPosition=\"bottom-center\" className=\"w-[300px]\">\r\n                    <div className=\"space-y-4 text-white\">\r\n                        <div>\r\n                            <label className=\"text-xs text-green-400\">Fr├®quence (Hauteur) - {freq} Hz</label>\r\n                            <input\r\n                                type=\"range\" min=\"100\" max=\"1000\"\r\n                                value={freq} onChange={(e) => setFreq(Number(e.target.value))}\r\n                                className=\"w-full h-2 bg-gray-700 rounded-lg accent-green-500\"\r\n                            />\r\n                            <div className=\"text-[10px] text-gray-400\">{freq < 300 ? 'Grave ­ƒÉÿ' : 'Aigu ­ƒÉª'}</div>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label className=\"text-xs text-blue-400\">Amplitude (Volume) - {amp}</label>\r\n                            <input\r\n                                type=\"range\" min=\"0.1\" max=\"2\" step=\"0.1\"\r\n                                value={amp} onChange={(e) => setAmp(Number(e.target.value))}\r\n                                className=\"w-full h-2 bg-gray-700 rounded-lg accent-blue-500\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n        </group>\r\n    );\r\n}\r\n\r\n// =========================================================\r\n// 4. ATOMIC STRUCTURE (K, L, M Shells)\r\n// =========================================================\r\nexport function AtomicStructureSeconde() {\r\n    const [protonCount, setProtonCount] = useState(1);\r\n\r\n    // Simple shell config rules: K=2, L=8, M=8\r\n    const getElectronConfig = (n) => {\r\n        let remaining = n;\r\n        const K = Math.min(remaining, 2); remaining -= K;\r\n        const L = Math.min(remaining, 8); remaining -= L;\r\n        const M = Math.min(remaining, 8);\r\n        return { K, L, M };\r\n    };\r\n\r\n    const config = getElectronConfig(protonCount);\r\n    const elements = [\"H\", \"He\", \"Li\", \"Be\", \"B\", \"C\", \"N\", \"O\", \"F\", \"Ne\", \"Na\", \"Mg\", \"Al\", \"Si\", \"P\", \"S\", \"Cl\", \"Ar\"];\r\n    const symbol = elements[protonCount - 1] || \"?\";\r\n\r\n    return (\r\n        <group>\r\n            <ambientLight />\r\n            <pointLight position={[10, 10, 10]} />\r\n\r\n            {/* Nucleus */}\r\n            <mesh>\r\n                <sphereGeometry args={[0.5, 32, 32]} />\r\n                <meshStandardMaterial color=\"orange\" emissive=\"red\" emissiveIntensity={0.5} />\r\n            </mesh>\r\n            <Text position={[0, 0, 0]} fontSize={0.3} color=\"white\">{symbol}</Text>\r\n\r\n            {/* Shells */}\r\n            <ElectronShell radius={2} count={config.K} speed={1} name=\"K\" />\r\n            {config.L > 0 && <ElectronShell radius={3.5} count={config.L} speed={0.7} name=\"L\" />}\r\n            {config.M > 0 && <ElectronShell radius={5} count={config.M} speed={0.5} name=\"M\" />}\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"ÔÜø´©Å Cort├¿ge ├ëlectronique\" defaultPosition=\"bottom-right\" className=\"w-[300px]\">\r\n                    <div className=\"text-white space-y-4\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <button onClick={() => setProtonCount(Math.max(1, protonCount - 1))} className=\"bg-gray-700 px-3 py-1 rounded\">-</button>\r\n                            <div className=\"text-center\">\r\n                                <div className=\"text-2xl font-bold\">{symbol}</div>\r\n                                <div className=\"text-xs text-gray-400\">Z = {protonCount}</div>\r\n                            </div>\r\n                            <button onClick={() => setProtonCount(Math.min(18, protonCount + 1))} className=\"bg-gray-700 px-3 py-1 rounded\">+</button>\r\n                        </div>\r\n\r\n                        <div className=\"bg-black/40 p-2 rounded text-sm font-mono space-y-1\">\r\n                            <div className={config.K === 2 ? \"text-green-400\" : \"text-white\"}>Couche K : {config.K} / 2eÔü╗</div>\r\n                            <div className={config.L === 8 ? \"text-green-400\" : \"text-gray-400\"}>Couche L : {config.L} / 8eÔü╗</div>\r\n                            <div className={config.M === 8 ? \"text-green-400\" : \"text-gray-500\"}>Couche M : {config.M} / 8eÔü╗</div>\r\n                        </div>\r\n\r\n                        <div className=\"text-xs bg-gray-800 p-2 rounded\">\r\n                            R├¿gle de l'Octet/Duet :\r\n                            <br />\r\n                            Les atomes cherchent ├á saturer leur couche externe pour ├¬tre stables (comme les Gaz Nobles).\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n        </group>\r\n    );\r\n}\r\n\r\nfunction ElectronShell({ radius, count, speed, name }) {\r\n    const group = useRef();\r\n    useFrame((state, delta) => {\r\n        group.current.rotation.z += delta * speed * 0.5;\r\n        group.current.rotation.x += delta * speed * 0.2;\r\n    });\r\n\r\n    return (\r\n        <group ref={group}>\r\n            {/* Orbital Ring */}\r\n            <mesh rotation={[Math.PI / 2, 0, 0]}>\r\n                <torusGeometry args={[radius, 0.02, 16, 100]} />\r\n                <meshBasicMaterial color=\"gray\" opacity={0.3} transparent />\r\n            </mesh>\r\n            {/* Electrons */}\r\n            {Array.from({ length: count }).map((_, i) => {\r\n                const angle = (i / count) * Math.PI * 2;\r\n                return (\r\n                    <mesh key={i} position={[Math.cos(angle) * radius, Math.sin(angle) * radius, 0]}>\r\n                        <sphereGeometry args={[0.15, 16, 16]} />\r\n                        <meshStandardMaterial color=\"#00F5D4\" emissive=\"#00F5D4\" emissiveIntensity={0.8} />\r\n                    </mesh>\r\n                );\r\n            })}\r\n            <Text position={[radius, 0, 0]} fontSize={0.2} color=\"gray\">{name}</Text>\r\n        </group>\r\n    );\r\n}\r\n\r\n// =========================================================\r\n// 5. HYDRODISTILLATION (Extraction)\r\n// =========================================================\r\nexport function DistillationSetup() {\r\n    return (\r\n        <group>\r\n            <ambientLight intensity={0.8} />\r\n            <pointLight position={[5, 10, 5]} />\r\n\r\n            {/* Setup 3D simplistic */}\r\n            {/* Chauffe-ballon */}\r\n            <mesh position={[0, 0, 0]}>\r\n                <cylinderGeometry args={[1, 1.2, 1.5, 32]} />\r\n                <meshStandardMaterial color=\"#333\" />\r\n            </mesh>\r\n            {/* Ballon */}\r\n            <mesh position={[0, 1.5, 0]}>\r\n                <sphereGeometry args={[1, 32, 32]} />\r\n                <meshPhysicalMaterial color=\"white\" transmission={0.9} opacity={0.5} transparent roughness={0} />\r\n            </mesh>\r\n            {/* Liquide boiling inside */}\r\n            <mesh position={[0, 1.2, 0]}>\r\n                <sphereGeometry args={[0.9, 32, 32]} />\r\n                <meshStandardMaterial color=\"orange\" />\r\n            </mesh>\r\n\r\n            {/* Colonne */}\r\n            <mesh position={[0, 3, 0]}>\r\n                <cylinderGeometry args={[0.3, 0.3, 2, 16]} />\r\n                <meshPhysicalMaterial color=\"white\" transmission={0.9} transparent />\r\n            </mesh>\r\n\r\n            {/* R├®frig├®rant (Condenser) - Angled */}\r\n            <group position={[1.5, 3.5, 0]} rotation={[0, 0, -Math.PI / 4]}>\r\n                <mesh>\r\n                    <cylinderGeometry args={[0.4, 0.4, 4, 16]} />\r\n                    <meshPhysicalMaterial color=\"white\" transmission={0.8} transparent opacity={0.4} />\r\n                </mesh>\r\n                {/* Tube interne */}\r\n                <mesh>\r\n                    <cylinderGeometry args={[0.1, 0.1, 4.2, 16]} />\r\n                    <meshStandardMaterial color=\"#AAF\" opacity={0.6} transparent />\r\n                </mesh>\r\n            </group>\r\n\r\n            {/* Erlenmeyer (Recolte) */}\r\n            <group position={[3.5, 0.5, 0]}>\r\n                <mesh>\r\n                    <coneGeometry args={[0.8, 1.5, 32]} />\r\n                    <meshPhysicalMaterial color=\"white\" transmission={0.9} transparent />\r\n                </mesh>\r\n                {/* Distillat */}\r\n                <mesh position={[0, -0.5, 0]}>\r\n                    <cylinderGeometry args={[0.7, 0.8, 0.5, 32]} />\r\n                    <meshStandardMaterial color=\"#FFFF00\" transparent opacity={0.8} />\r\n                </mesh>\r\n            </group>\r\n\r\n            {/* UI */}\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"ÔÜù´©Å Hydrodistillation\" className=\"w-[300px]\" defaultPosition=\"top-right\">\r\n                    <div className=\"text-white space-y-2\">\r\n                        <p className=\"text-sm\"> Technique pour extraire des huiles essentielles (ex: Citronnelle, Menthe).</p>\r\n                        <ol className=\"text-xs list-decimal ml-4 space-y-1 text-gray-300\">\r\n                            <li><span className=\"text-orange-400\">├ëbullition</span> : La vapeur d'eau emporte l'huile.</li>\r\n                            <li><span className=\"text-blue-400\">Condensation</span> : Le r├®frig├®rant refroidit la vapeur.</li>\r\n                            <li><span className=\"text-yellow-400\">R├®cup├®ration</span> : On obtient le distillat (eau + huile).</li>\r\n                        </ol>\r\n                        <div className=\"bg-red-900/50 p-2 rounded border border-red-500/50 text-xs mt-2\">\r\n                            ÔÜá´©Å Attention : L'eau froide doit entrer par le BAS du r├®frig├®rant !\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n        </group>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\SecondeSimulationsPart2.js","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":84,"column":29,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[4865,5018],"text":"\r\n                            &quot;La force est proportionnelle aux masses et inversement proportionnelle au carr├® de la distance.\"\r\n                        "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[4865,5018],"text":"\r\n                            &ldquo;La force est proportionnelle aux masses et inversement proportionnelle au carr├® de la distance.\"\r\n                        "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[4865,5018],"text":"\r\n                            &#34;La force est proportionnelle aux masses et inversement proportionnelle au carr├® de la distance.\"\r\n                        "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[4865,5018],"text":"\r\n                            &rdquo;La force est proportionnelle aux masses et inversement proportionnelle au carr├® de la distance.\"\r\n                        "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":84,"column":125,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[4865,5018],"text":"\r\n                            \"La force est proportionnelle aux masses et inversement proportionnelle au carr├® de la distance.&quot;\r\n                        "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[4865,5018],"text":"\r\n                            \"La force est proportionnelle aux masses et inversement proportionnelle au carr├® de la distance.&ldquo;\r\n                        "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[4865,5018],"text":"\r\n                            \"La force est proportionnelle aux masses et inversement proportionnelle au carr├® de la distance.&#34;\r\n                        "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[4865,5018],"text":"\r\n                            \"La force est proportionnelle aux masses et inversement proportionnelle au carr├® de la distance.&rdquo;\r\n                        "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":147,"column":77,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[7589,7611],"text":"Angle d&apos;incidence (i1)"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[7589,7611],"text":"Angle d&lsquo;incidence (i1)"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[7589,7611],"text":"Angle d&#39;incidence (i1)"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[7589,7611],"text":"Angle d&rsquo;incidence (i1)"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":208,"column":117,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[10861,10937],"text":"La lumi├¿re blanche est un m├®lange de toutes les couleurs (longueurs d&apos;onde)."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[10861,10937],"text":"La lumi├¿re blanche est un m├®lange de toutes les couleurs (longueurs d&lsquo;onde)."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[10861,10937],"text":"La lumi├¿re blanche est un m├®lange de toutes les couleurs (longueurs d&#39;onde)."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[10861,10937],"text":"La lumi├¿re blanche est un m├®lange de toutes les couleurs (longueurs d&rsquo;onde)."},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":214,"column":30,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[11362,11485],"text":"\r\n                            C&apos;est le m├¬me ph├®nom├¿ne que l'Arc-en-ciel (gouttes d'eau = prisme).\r\n                        "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[11362,11485],"text":"\r\n                            C&lsquo;est le m├¬me ph├®nom├¿ne que l'Arc-en-ciel (gouttes d'eau = prisme).\r\n                        "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[11362,11485],"text":"\r\n                            C&#39;est le m├¬me ph├®nom├¿ne que l'Arc-en-ciel (gouttes d'eau = prisme).\r\n                        "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[11362,11485],"text":"\r\n                            C&rsquo;est le m├¬me ph├®nom├¿ne que l'Arc-en-ciel (gouttes d'eau = prisme).\r\n                        "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":214,"column":58,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[11362,11485],"text":"\r\n                            C'est le m├¬me ph├®nom├¿ne que l&apos;Arc-en-ciel (gouttes d'eau = prisme).\r\n                        "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[11362,11485],"text":"\r\n                            C'est le m├¬me ph├®nom├¿ne que l&lsquo;Arc-en-ciel (gouttes d'eau = prisme).\r\n                        "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[11362,11485],"text":"\r\n                            C'est le m├¬me ph├®nom├¿ne que l&#39;Arc-en-ciel (gouttes d'eau = prisme).\r\n                        "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[11362,11485],"text":"\r\n                            C'est le m├¬me ph├®nom├¿ne que l&rsquo;Arc-en-ciel (gouttes d'eau = prisme).\r\n                        "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":214,"column":81,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[11362,11485],"text":"\r\n                            C'est le m├¬me ph├®nom├¿ne que l'Arc-en-ciel (gouttes d&apos;eau = prisme).\r\n                        "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[11362,11485],"text":"\r\n                            C'est le m├¬me ph├®nom├¿ne que l'Arc-en-ciel (gouttes d&lsquo;eau = prisme).\r\n                        "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[11362,11485],"text":"\r\n                            C'est le m├¬me ph├®nom├¿ne que l'Arc-en-ciel (gouttes d&#39;eau = prisme).\r\n                        "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[11362,11485],"text":"\r\n                            C'est le m├¬me ph├®nom├¿ne que l'Arc-en-ciel (gouttes d&rsquo;eau = prisme).\r\n                        "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":391,"column":56,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[19364,19481],"text":"\r\n                            Regarde la couleur : Plus c&apos;est fonc├®, plus c'est concentr├® !\r\n                        "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[19364,19481],"text":"\r\n                            Regarde la couleur : Plus c&lsquo;est fonc├®, plus c'est concentr├® !\r\n                        "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[19364,19481],"text":"\r\n                            Regarde la couleur : Plus c&#39;est fonc├®, plus c'est concentr├® !\r\n                        "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[19364,19481],"text":"\r\n                            Regarde la couleur : Plus c&rsquo;est fonc├®, plus c'est concentr├® !\r\n                        "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":391,"column":74,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[19364,19481],"text":"\r\n                            Regarde la couleur : Plus c'est fonc├®, plus c&apos;est concentr├® !\r\n                        "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[19364,19481],"text":"\r\n                            Regarde la couleur : Plus c'est fonc├®, plus c&lsquo;est concentr├® !\r\n                        "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[19364,19481],"text":"\r\n                            Regarde la couleur : Plus c'est fonc├®, plus c&#39;est concentr├® !\r\n                        "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[19364,19481],"text":"\r\n                            Regarde la couleur : Plus c'est fonc├®, plus c&rsquo;est concentr├® !\r\n                        "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport React, { useState, useRef, useMemo } from 'react';\r\nimport { Canvas, useFrame } from '@react-three/fiber';\r\nimport { Html, Text, Line, useTexture, OrbitControls, Float } from '@react-three/drei';\r\nimport * as THREE from 'three';\r\nimport DraggableHtmlPanel from './DraggableHtmlPanel';\r\n\r\n// =========================================================\r\n// 6. GRAVITATION UNIVERSELLE (Planets)\r\n// =========================================================\r\nexport function UniversalGravitationSeconde() {\r\n    const [m1, setM1] = useState(500); // Earth-ish\r\n    const [m2, setM2] = useState(50); // Moon-ish\r\n    const [distance, setDistance] = useState(4); // Units\r\n\r\n    // F = G * m1 * m2 / d^2\r\n    const G = 0.001; // Scaled Constant\r\n    const force = (G * m1 * m2) / (distance * distance);\r\n\r\n    return (\r\n        <group>\r\n            <ambientLight intensity={0.5} />\r\n            <pointLight position={[10, 10, 10]} />\r\n            <Stars />\r\n\r\n            {/* Mass 1 (Blue Planet) */}\r\n            <group position={[-distance / 2, 0, 0]}>\r\n                <mesh>\r\n                    <sphereGeometry args={[0.5 + m1 / 2000, 32, 32]} />\r\n                    <meshStandardMaterial color=\"#3B82F6\" emissive=\"#1D4ED8\" emissiveIntensity={0.2} />\r\n                </mesh>\r\n                <Text position={[0, -1.2, 0]} fontSize={0.3} color=\"#3B82F6\">Masse A = {m1} kg</Text>\r\n                {/* Force Vector (Towards B) */}\r\n                <arrowHelper args={[new THREE.Vector3(1, 0, 0), new THREE.Vector3(0, 0, 0), 1 + force * 100, 0xFFFFFF]} />\r\n                <Html position={[1, 0.5, 0]}>\r\n                    <div className=\"text-xs font-bold text-white bg-blue-900/50 px-1 rounded\">F A/B</div>\r\n                </Html>\r\n            </group>\r\n\r\n            {/* Mass 2 (Grey Moon) */}\r\n            <group position={[distance / 2, 0, 0]}>\r\n                <mesh>\r\n                    <sphereGeometry args={[0.3 + m2 / 2000, 32, 32]} />\r\n                    <meshStandardMaterial color=\"#9CA3AF\" />\r\n                </mesh>\r\n                <Text position={[0, -1.2, 0]} fontSize={0.3} color=\"#9CA3AF\">Masse B = {m2} kg</Text>\r\n                {/* Force Vector (Towards A) */}\r\n                <arrowHelper args={[new THREE.Vector3(-1, 0, 0), new THREE.Vector3(0, 0, 0), 1 + force * 100, 0xFFFFFF]} />\r\n                <Html position={[-1, 0.5, 0]}>\r\n                    <div className=\"text-xs font-bold text-white bg-gray-700/50 px-1 rounded\">F B/A</div>\r\n                </Html>\r\n            </group>\r\n\r\n            {/* Distance Line */}\r\n            <Line points={[[-distance / 2, -0.5, 0], [distance / 2, -0.5, 0]]} color=\"white\" dashed dashSize={0.2} gapSize={0.1} />\r\n            <Text position={[0, -0.7, 0]} fontSize={0.3} color=\"yellow\">d = {distance} m</Text>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒ¬É Gravitation Universelle\" className=\"w-[320px]\" defaultPosition=\"bottom-center\">\r\n                    <div className=\"space-y-4 text-white\">\r\n                        <div className=\"bg-gray-900 p-3 rounded-lg border border-gray-700\">\r\n                            <div className=\"flex justify-between items-end mb-2\">\r\n                                <span className=\"text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-400\">\r\n                                    F = {(force * 1000).toFixed(2)} mN\r\n                                </span>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-2 text-xs\">\r\n                                <div>\r\n                                    <label className=\"text-blue-400\">Masse A (Terre)</label>\r\n                                    <input type=\"range\" min=\"100\" max=\"1000\" step=\"10\" value={m1} onChange={(e) => setM1(Number(e.target.value))} className=\"w-full h-1 bg-blue-900 rounded accent-blue-500\" />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"text-gray-400\">Masse B (Lune)</label>\r\n                                    <input type=\"range\" min=\"10\" max=\"500\" step=\"10\" value={m2} onChange={(e) => setM2(Number(e.target.value))} className=\"w-full h-1 bg-gray-700 rounded accent-gray-500\" />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"text-yellow-400\">Distance</label>\r\n                                    <input type=\"range\" min=\"2\" max=\"8\" step=\"0.1\" value={distance} onChange={(e) => setDistance(Number(e.target.value))} className=\"w-full h-1 bg-yellow-900 rounded accent-yellow-500\" />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"text-xs italic text-gray-400 text-center\">\r\n                            \"La force est proportionnelle aux masses et inversement proportionnelle au carr├® de la distance.\"\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n        </group>\r\n    );\r\n}\r\n\r\n// =========================================================\r\n// 7. REFRACTION LUMIERE (Laser)\r\n// =========================================================\r\nexport function RefractionSeconde() {\r\n    const [n2, setN2] = useState(1.33); // Eau\r\n    const [angle, setAngle] = useState(45); // Degrees\r\n\r\n    const rad = (deg) => deg * Math.PI / 180;\r\n    const n1 = 1.0; // Air\r\n    // n1 sin i1 = n2 sin i2  => sin i2 = (n1/n2) * sin i1\r\n    let angle2 = Math.asin((n1 / n2) * Math.sin(rad(angle)));\r\n    if (isNaN(angle2)) angle2 = Math.PI / 2; // Total reflection limit\r\n\r\n    // Laser rays\r\n    const origin = [0, 2, 0];\r\n    const hit = [0, 0, 0];\r\n    const end = [Math.sin(angle2) * 5, -Math.cos(angle2) * 5, 0];\r\n    const sourcePos = [-Math.sin(rad(angle)) * 3, Math.cos(rad(angle)) * 3, 0];\r\n\r\n    return (\r\n        <group>\r\n            <ambientLight intensity={0.5} />\r\n\r\n            {/* Milieu 2 (Water/Glass) */}\r\n            <mesh position={[0, -2, 0]}>\r\n                <boxGeometry args={[10, 4, 1]} />\r\n                <meshPhysicalMaterial\r\n                    color={n2 > 1.4 ? \"#A5B4FC\" : \"#CFFAFE\"} // Glass vs Water look\r\n                    transmission={0.9}\r\n                    roughness={0.1}\r\n                    transparent\r\n                />\r\n            </mesh>\r\n\r\n            {/* Normal Line */}\r\n            <Line points={[[0, 3, 0], [0, -3, 0]]} color=\"gray\" dashed />\r\n\r\n            {/* Incident Ray */}\r\n            <Line points={[sourcePos, hit]} color=\"#EF4444\" lineWidth={4} />\r\n\r\n            {/* Refracted Ray */}\r\n            <Line points={[hit, end]} color=\"#EF4444\" lineWidth={4} opacity={0.6} transparent />\r\n\r\n            {/* Reflection Ray (Partial) */}\r\n            <Line points={[hit, [Math.sin(rad(angle)) * 3, Math.cos(rad(angle)) * 3, 0]]} color=\"#EF4444\" lineWidth={1} dashed />\r\n\r\n            {/* Angles Text */}\r\n            <Text position={[-0.5, 0.5, 0]} fontSize={0.2} color=\"white\">{angle}┬░</Text>\r\n            <Text position={[0.5, -0.5, 0]} fontSize={0.2} color=\"white\">{(angle2 * 180 / Math.PI).toFixed(1)}┬░</Text>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒöª R├®fraction (Snell-Descartes)\" className=\"w-[300px]\" defaultPosition=\"bottom-right\">\r\n                    <div className=\"space-y-4 text-white\">\r\n                        <div className=\"bg-gray-800 p-2 rounded\">\r\n                            <label className=\"text-xs text-gray-400\">Angle d'incidence (i1)</label>\r\n                            <input type=\"range\" min=\"0\" max=\"85\" value={angle} onChange={(e) => setAngle(Number(e.target.value))} className=\"w-full h-1 bg-red-900 rounded accent-red-500\" />\r\n                        </div>\r\n\r\n                        <div className=\"bg-gray-800 p-2 rounded\">\r\n                            <label className=\"text-xs text-gray-400\">Milieu 2 (Indice n2)</label>\r\n                            <div className=\"flex gap-2 mt-1\">\r\n                                <button onClick={() => setN2(1.33)} className={`flex-1 text-xs py-1 rounded ${n2 === 1.33 ? 'bg-blue-600' : 'bg-gray-700'}`}>Eau (1.33)</button>\r\n                                <button onClick={() => setN2(1.5)} className={`flex-1 text-xs py-1 rounded ${n2 === 1.5 ? 'bg-indigo-600' : 'bg-gray-700'}`}>Verre (1.5)</button>\r\n                                <button onClick={() => setN2(2.4)} className={`flex-1 text-xs py-1 rounded ${n2 === 2.4 ? 'bg-purple-600' : 'bg-gray-700'}`}>Diamant (2.4)</button>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"text-center font-mono text-sm bg-black/40 p-2 rounded\">\r\n                            nÔéü┬Àsin(iÔéü) = nÔéé┬Àsin(iÔéé)\r\n                            <br />\r\n                            <span className=\"text-yellow-400\">iÔéé = {(angle2 * 180 / Math.PI).toFixed(1)}┬░</span>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n        </group>\r\n    );\r\n}\r\n\r\n// =========================================================\r\n// 8. SPECTRE LUMIERE (Prism)\r\n// =========================================================\r\nexport function PrismDispersion() {\r\n    return (\r\n        <group>\r\n            <ambientLight intensity={0.2} />\r\n\r\n            {/* Prism - Triangle Extruded */}\r\n            <mesh rotation={[Math.PI / 2, Math.PI, 0]}>\r\n                <cylinderGeometry args={[2, 2, 2, 3]} />\r\n                <meshPhysicalMaterial\r\n                    color=\"white\" transmission={1} roughness={0}\r\n                    ior={1.5} thickness={2}\r\n                />\r\n            </mesh>\r\n\r\n            {/* White Light Beam */}\r\n            <mesh position={[-4, 0.5, 0]} rotation={[0, 0, -0.2]}>\r\n                <cylinderGeometry args={[0.05, 0.05, 4]} />\r\n                <meshBasicMaterial color=\"white\" />\r\n            </mesh>\r\n\r\n            {/* Rainbow Fan (Simulated geometry for visual appeal) */}\r\n            <group position={[0.5, -0.5, 0]} rotation={[0, 0, -1]}>\r\n                {['#FF0000', '#FFA500', '#FFFF00', '#00FF00', '#0000FF', '#4B0082', '#EE82EE'].map((color, i) => (\r\n                    <mesh key={i} position={[2, i * 0.15 - 0.5, 0]} rotation={[0, 0, 0.1 * i]}>\r\n                        <cylinderGeometry args={[0.02, 0.05, 5]} rotation={[0, 0, Math.PI / 2]} />\r\n                        <meshBasicMaterial color={color} />\r\n                    </mesh>\r\n                ))}\r\n            </group>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒîê Dispersion de la Lumi├¿re\" className=\"w-[300px]\" defaultPosition=\"top-right\">\r\n                    <div className=\"text-white space-y-3\">\r\n                        <p className=\"text-sm\">La lumi├¿re blanche est un m├®lange de toutes les couleurs (longueurs d'onde).</p>\r\n                        <ul className=\"text-xs list-disc ml-4 space-y-1 text-gray-300\">\r\n                            <li className=\"text-red-400\">Le Rouge est moins d├®vi├® (╬╗ ~ 800nm)</li>\r\n                            <li className=\"text-purple-400\">Le Violet est plus d├®vi├® (╬╗ ~ 400nm)</li>\r\n                        </ul>\r\n                        <div className=\"text-xs bg-gray-800 p-2 rounded border border-gray-600\">\r\n                            C'est le m├¬me ph├®nom├¿ne que l'Arc-en-ciel (gouttes d'eau = prisme).\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n        </group>\r\n    );\r\n}\r\n\r\n// =========================================================\r\n// 9. LA MOLE (Balance)\r\n// =========================================================\r\nexport function MoleScale() {\r\n    const [atomType, setAtomType] = useState('C');\r\n    const [moles, setMoles] = useState(1);\r\n\r\n    const atoms = {\r\n        C: { name: 'Carbone', M: 12.0, color: '#333' },\r\n        H: { name: 'Hydrog├¿ne', M: 1.0, color: '#FFF' },\r\n        Fe: { name: 'Fer', M: 55.8, color: '#A16207' },\r\n        Au: { name: 'Or', M: 197.0, color: '#FACC15' },\r\n    };\r\n\r\n    const currentAtom = atoms[atomType];\r\n    const totalMass = (currentAtom.M * moles).toFixed(1);\r\n    const particleCount = (moles * 6.02).toFixed(2); // x 10^23\r\n\r\n    return (\r\n        <group>\r\n            <ambientLight intensity={0.6} />\r\n            <pointLight position={[5, 5, 5]} />\r\n\r\n            {/* Balance Base */}\r\n            <mesh position={[0, -2, 0]}>\r\n                <boxGeometry args={[4, 0.5, 3]} />\r\n                <meshStandardMaterial color=\"#374151\" />\r\n            </mesh>\r\n            {/* Balance Screen */}\r\n            <group position={[0, -1.74, 1.51]}>\r\n                <mesh>\r\n                    <boxGeometry args={[1.5, 0.5, 0.1]} />\r\n                    <meshBasicMaterial color=\"#000\" />\r\n                </mesh>\r\n                <Text position={[0, 0, 0.06]} fontSize={0.25} color=\"#00FF00\" font=\"monospace\">\r\n                    {totalMass} g\r\n                </Text>\r\n            </group>\r\n\r\n            {/* Pile of Atoms */}\r\n            <group position={[0, -1.5, 0]}>\r\n                <PileOfAtoms count={Math.min(50, Math.ceil(moles * 10))} color={currentAtom.color} />\r\n            </group>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"ÔÜû´©Å La Mole (n)\" className=\"w-[300px]\" defaultPosition=\"bottom-right\">\r\n                    <div className=\"text-white space-y-4\">\r\n                        <div className=\"flex gap-2 justify-center\">\r\n                            {Object.entries(atoms).map(([key, data]) => (\r\n                                <button key={key} onClick={() => setAtomType(key)} className={`px-2 py-1 rounded border ${atomType === key ? 'border-yellow-400 bg-yellow-500/20' : 'border-gray-600'}`}>\r\n                                    {key}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label className=\"text-xs text-gray-400\">Quantit├® de mati├¿re (n)</label>\r\n                            <input\r\n                                type=\"range\" min=\"0.1\" max=\"5.0\" step=\"0.1\"\r\n                                value={moles} onChange={(e) => setMoles(parseFloat(e.target.value))}\r\n                                className=\"w-full h-1 bg-gray-700 rounded accent-green-500\"\r\n                            />\r\n                            <div className=\"text-center font-bold text-green-400\">{moles} mol</div>\r\n                        </div>\r\n\r\n                        <div className=\"bg-gray-900 p-2 rounded text-sm space-y-1 font-mono\">\r\n                            <div>Masse Molaire (M) : {currentAtom.M} g/mol</div>\r\n                            <div className=\"border-t border-gray-700 pt-1\">\r\n                                m = n ├ù M = <span className=\"text-yellow-400 font-bold\">{totalMass} g</span>\r\n                            </div>\r\n                            <div className=\"text-gray-500 text-xs\">\r\n                                N = {particleCount} ├ù 10┬▓┬│ atomes\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n        </group>\r\n    );\r\n}\r\n\r\nfunction PileOfAtoms({ count, color }) {\r\n    // Generate random positions in a pile shape\r\n    const positions = useMemo(() => {\r\n        const pos = [];\r\n        for (let i = 0; i < count; i++) {\r\n            pos.push([\r\n                (Math.random() - 0.5) * 1.5,\r\n                (Math.random()) * 1.0 + (i * 0.02),\r\n                (Math.random() - 0.5) * 1.5\r\n            ]);\r\n        }\r\n        return pos;\r\n    }, [count]);\r\n\r\n    return (\r\n        <group>\r\n            {positions.map((p, i) => (\r\n                <mesh key={i} position={p}>\r\n                    <sphereGeometry args={[0.15, 16, 16]} />\r\n                    <meshStandardMaterial color={color} />\r\n                </mesh>\r\n            ))}\r\n        </group>\r\n    )\r\n}\r\n\r\n// =========================================================\r\n// 10. SOLUTIONS & CONCENTRATION (Beaker)\r\n// =========================================================\r\nexport function SolutionsSeconde() {\r\n    const [solute, setSolute] = useState(1); // Mol\r\n    const [volume, setVolume] = useState(0.5); // Litres\r\n    const concentration = solute / volume; // mol/L\r\n\r\n    return (\r\n        <group>\r\n            <ambientLight intensity={0.7} />\r\n\r\n            {/* Beaker Glass */}\r\n            <mesh position={[0, 0, 0]}>\r\n                <cylinderGeometry args={[1.5, 1.5, 4, 32, 1, true]} />\r\n                <meshPhysicalMaterial color=\"white\" transmission={0.9} roughness={0} thickness={0.2} transparent side={THREE.DoubleSide} />\r\n            </mesh>\r\n\r\n            {/* Liquid */}\r\n            <mesh position={[0, -2 + (volume / 1.0) * 2, 0]}>\r\n                <cylinderGeometry args={[1.45, 1.45, (volume / 1.0) * 4, 32]} />\r\n                <meshStandardMaterial\r\n                    color=\"#3B82F6\"\r\n                    transparent\r\n                    opacity={Math.min(0.9, 0.1 + concentration * 0.2)} // Opacity based on concentration\r\n                />\r\n            </mesh>\r\n\r\n            {/* Particles floating inside */}\r\n            <ParticlesFloating count={Math.floor(solute * 20)} height={(volume / 1.0) * 4} radius={1.4} />\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒº¬ Solutions & Concentration\" className=\"w-[300px]\" defaultPosition=\"bottom-left\">\r\n                    <div className=\"space-y-4 text-white\">\r\n                        <div>\r\n                            <label className=\"text-xs text-blue-300\">Solut├® (n)</label>\r\n                            <input\r\n                                type=\"range\" min=\"0.1\" max=\"3\" step=\"0.1\"\r\n                                value={solute} onChange={(e) => setSolute(Number(e.target.value))}\r\n                                className=\"w-full h-1 bg-gray-700 rounded accent-blue-500\"\r\n                            />\r\n                            <div className=\"text-right text-xs\">{solute.toFixed(1)} mol</div>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"text-xs text-cyan-300\">Volume (V)</label>\r\n                            <input\r\n                                type=\"range\" min=\"0.2\" max=\"1.0\" step=\"0.1\"\r\n                                value={volume} onChange={(e) => setVolume(Number(e.target.value))}\r\n                                className=\"w-full h-1 bg-gray-700 rounded accent-cyan-500\"\r\n                            />\r\n                            <div className=\"text-right text-xs\">{volume.toFixed(1)} L</div>\r\n                        </div>\r\n\r\n                        <div className=\"bg-gray-900 p-3 rounded-xl text-center border border-blue-900\">\r\n                            <div className=\"text-xs text-gray-400\">Concentration Molaire (C = n/V)</div>\r\n                            <div className=\"text-2xl font-bold font-mono text-white\">\r\n                                {concentration.toFixed(2)} <span className=\"text-sm text-gray-400\">mol/L</span>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"text-xs text-gray-400\">\r\n                            Regarde la couleur : Plus c'est fonc├®, plus c'est concentr├® !\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n        </group>\r\n    );\r\n}\r\n\r\nfunction ParticlesFloating({ count, height, radius }) {\r\n    const particles = useMemo(() => Array.from({ length: 50 }, () => ({\r\n        pos: [(Math.random() - 0.5) * 2 * radius * 0.8, Math.random(), (Math.random() - 0.5) * 2 * radius * 0.8],\r\n        speed: Math.random() * 0.5 + 0.5\r\n    })), [radius]);\r\n\r\n    return (\r\n        <group position={[0, -2, 0]}>\r\n            {particles.slice(0, count).map((p, i) => (\r\n                <MovingParticle key={i} p={p} maxY={height} />\r\n            ))}\r\n        </group>\r\n    )\r\n}\r\n\r\nfunction MovingParticle({ p, maxY }) {\r\n    const ref = useRef();\r\n    useFrame(({ clock }) => {\r\n        const t = clock.getElapsedTime() * p.speed;\r\n        if (ref.current) {\r\n            ref.current.position.y = (t % 1) * maxY;\r\n            ref.current.position.x = p.pos[0] + Math.sin(t * 2) * 0.1;\r\n        }\r\n    });\r\n\r\n    return (\r\n        <mesh ref={ref} position={[p.pos[0], 0, p.pos[2]]}>\r\n            <sphereGeometry args={[0.05]} />\r\n            <meshBasicMaterial color=\"white\" />\r\n        </mesh>\r\n    );\r\n}\r\n\r\nfunction Stars() {\r\n    return (\r\n        <points>\r\n            <bufferGeometry>\r\n                <bufferAttribute attach=\"attributes-position\" count={500} array={new Float32Array(1500).map(() => (Math.random() - 0.5) * 50)} itemSize={3} />\r\n            </bufferGeometry>\r\n            <pointsMaterial size={0.1} color=\"white\" transparent opacity={0.8} />\r\n        </points>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\SecondeSimulationsPart3.js","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":122,"column":63,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[5317,5353],"text":"Le passager lance la balle en l&apos;air."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[5317,5353],"text":"Le passager lance la balle en l&lsquo;air."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[5317,5353],"text":"Le passager lance la balle en l&#39;air."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[5317,5353],"text":"Le passager lance la balle en l&rsquo;air."},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":125,"column":43,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[5588,5646],"text":"Pour l&apos;observateur (Quai) : La balle d├®crit une PARABOLE !"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[5588,5646],"text":"Pour l&lsquo;observateur (Quai) : La balle d├®crit une PARABOLE !"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[5588,5646],"text":"Pour l&#39;observateur (Quai) : La balle d├®crit une PARABOLE !"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[5588,5646],"text":"Pour l&rsquo;observateur (Quai) : La balle d├®crit une PARABOLE !"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":210,"column":74,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[9138,9190],"text":"S├®paration des colorants d&apos;un feutre vert et violet."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[9138,9190],"text":"S├®paration des colorants d&lsquo;un feutre vert et violet."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[9138,9190],"text":"S├®paration des colorants d&#39;un feutre vert et violet."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[9138,9190],"text":"S├®paration des colorants d&rsquo;un feutre vert et violet."},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":325,"column":65,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[14848,14919],"text":"\r\n                                    Cela prouve la pr├®sence de l&apos;ion "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[14848,14919],"text":"\r\n                                    Cela prouve la pr├®sence de l&lsquo;ion "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[14848,14919],"text":"\r\n                                    Cela prouve la pr├®sence de l&#39;ion "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[14848,14919],"text":"\r\n                                    Cela prouve la pr├®sence de l&rsquo;ion "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'realTime'. Either include it or remove the dependency array.","line":371,"column":8,"nodeType":"ArrayExpression","endLine":371,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [pinging, realTime]","fix":{"range":[16791,16800],"text":"[pinging, realTime]"}}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport React, { useState, useRef, useEffect, useMemo } from 'react';\r\nimport { Canvas, useFrame } from '@react-three/fiber';\r\nimport { Html, Text, Line, useTexture, OrbitControls, Float } from '@react-three/drei';\r\nimport * as THREE from 'three';\r\nimport DraggableHtmlPanel from './DraggableHtmlPanel';\r\n\r\n// =========================================================\r\n// 11. MOUVEMENT RELATIF (Trains)\r\n// =========================================================\r\nexport function MotionRelativity() {\r\n    const [trainSpeed, setTrainSpeed] = useState(1);\r\n    const [view, setView] = useState('ground'); // 'ground' or 'train'\r\n    const trainRef = useRef();\r\n    const ballRef = useRef();\r\n    const [ballTime, setBallTime] = useState(0);\r\n    const [isThrowing, setIsThrowing] = useState(false);\r\n\r\n    useFrame((state, delta) => {\r\n        // Move Train\r\n        if (trainRef.current) {\r\n            // Reset if too far\r\n            if (trainRef.current.position.x > 10) trainRef.current.position.x = -10;\r\n            trainRef.current.position.x += trainSpeed * delta * 2;\r\n        }\r\n\r\n        // Animate Ball\r\n        if (isThrowing && ballRef.current) {\r\n            const t = ballTime + delta;\r\n            setBallTime(t);\r\n            // Parabola: y = vy*t - 0.5*g*t^2, x = vx*t\r\n            // Relative to train: vx = 0\r\n            // Relative to ground: vx = trainSpeed\r\n\r\n            // We visualize the ball in World Coords always, but user perception changes\r\n            const startX = trainRef.current.position.x; // Moving start point? No, start point was when thrown.\r\n            // Simplified: Ball is child of train? No, easier to simulate world pos.\r\n\r\n            // Let's just animate local to train for \"Throw Up\"\r\n            // y = 4*t - 5*t^2\r\n            const y = 2 + (4 * t - 4 * t * t);\r\n\r\n            if (y < 2 && t > 0.1) {\r\n                setIsThrowing(false); // Caught\r\n                ballRef.current.position.y = 2;\r\n                ballRef.current.position.x = 0; // Relative to train\r\n            } else {\r\n                ballRef.current.position.y = y;\r\n                // x is relative 0 to train\r\n                ballRef.current.position.x = 0;\r\n            }\r\n        }\r\n    });\r\n\r\n    // Camera rig for relativity\r\n    useFrame((state) => {\r\n        if (view === 'train' && trainRef.current) {\r\n            state.camera.position.x = THREE.MathUtils.lerp(state.camera.position.x, trainRef.current.position.x, 0.1);\r\n        } else {\r\n            state.camera.position.x = THREE.MathUtils.lerp(state.camera.position.x, 0, 0.1);\r\n        }\r\n        state.camera.lookAt(state.camera.position.x, 0, 0);\r\n    });\r\n\r\n    const throwBall = () => {\r\n        setIsThrowing(true);\r\n        setBallTime(0);\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            <ambientLight intensity={0.7} />\r\n            <pointLight position={[10, 10, 10]} />\r\n\r\n            {/* Ground */}\r\n            <gridHelper args={[100, 100]} position={[0, -0.5, 0]} color1=\"gray\" color2=\"gray\" />\r\n            <Text position={[0, -0.5, 2]} rotation={[-Math.PI / 2, 0, 0]} fontSize={1} color=\"gray\">QUAI (R├®f├®rentiel Terrestre)</Text>\r\n\r\n            {/* Train Container */}\r\n            <group ref={trainRef} position={[-5, 0, 0]}>\r\n                <mesh position={[0, 1, 0]}>\r\n                    <boxGeometry args={[6, 3, 2]} />\r\n                    <meshStandardMaterial color=\"#ef4444\" opacity={0.5} transparent />\r\n                </mesh>\r\n                <Text position={[0, 3, 0]} fontSize={0.5} color=\"white\">TRAIN</Text>\r\n\r\n                {/* Character Inside */}\r\n                <mesh position={[0, 0.5, 0]}>\r\n                    <capsuleGeometry args={[0.3, 1, 4]} />\r\n                    <meshStandardMaterial color=\"yellow\" />\r\n                </mesh>\r\n\r\n                {/* Ball */}\r\n                <mesh ref={ballRef} position={[0, 2, 0]}>\r\n                    <sphereGeometry args={[0.2]} />\r\n                    <meshStandardMaterial color=\"white\" />\r\n                </mesh>\r\n            </group>\r\n\r\n            {/* Tree (Reference Ground) */}\r\n            <group position={[0, 0, -4]}>\r\n                <mesh position={[0, 2, 0]}>\r\n                    <coneGeometry args={[1, 4, 8]} />\r\n                    <meshStandardMaterial color=\"green\" />\r\n                </mesh>\r\n                <mesh position={[0, 0, 0]}>\r\n                    <cylinderGeometry args={[0.2, 0.2, 1]} />\r\n                    <meshStandardMaterial color=\"brown\" />\r\n                </mesh>\r\n            </group>\r\n\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒÜä Relativit├® du Mouvement\" className=\"w-[300px]\" defaultPosition=\"bottom-center\">\r\n                    <div className=\"space-y-4 text-white\">\r\n                        <div className=\"flex gap-2 bg-gray-800 p-2 rounded\">\r\n                            <button onClick={() => setView('ground')} className={`flex-1 py-1 rounded ${view === 'ground' ? 'bg-blue-600' : 'bg-gray-700'}`}>­ƒæü´©Å Quai (Sol)</button>\r\n                            <button onClick={() => setView('train')} className={`flex-1 py-1 rounded ${view === 'train' ? 'bg-red-600' : 'bg-gray-700'}`}>­ƒæü´©Å Train</button>\r\n                        </div>\r\n\r\n                        <div className=\"text-sm\">\r\n                            <p>Le passager lance la balle en l'air.</p>\r\n                            <ul className=\"list-disc ml-4 text-xs text-gray-300\">\r\n                                <li>Pour le passager (Train) : La balle monte et descend verticalement.</li>\r\n                                <li>Pour l'observateur (Quai) : La balle d├®crit une PARABOLE !</li>\r\n                            </ul>\r\n                        </div>\r\n\r\n                        <div className=\"flex justify-between items-center\">\r\n                            <button onClick={throwBall} disabled={isThrowing} className=\"bg-green-600 px-4 py-2 rounded font-bold hover:bg-green-500 disabled:opacity-50\">\r\n                                ­ƒÑÄ Lancer\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n        </group>\r\n    );\r\n}\r\n\r\n// =========================================================\r\n// 12. CHROMATOGRAPHIE (Couleurs)\r\n// =========================================================\r\nexport function ChromatographyExperiment() {\r\n    const [progress, setProgress] = useState(0);\r\n    const [isRunning, setIsRunning] = useState(false);\r\n\r\n    useFrame((state, delta) => {\r\n        if (isRunning && progress < 1) {\r\n            setProgress(p => Math.min(1, p + delta * 0.1));\r\n        }\r\n    });\r\n\r\n    // Separation of components\r\n    // Blue travels 0.8, Red 0.6, Yellow 0.4\r\n    const hBlue = progress * 3.5;\r\n    const hRed = progress * 2.5;\r\n    const hYellow = progress * 1.5;\r\n\r\n    return (\r\n        <group>\r\n            <ambientLight intensity={0.8} />\r\n\r\n            {/* Tank */}\r\n            <mesh position={[0, -1, 0]}>\r\n                <boxGeometry args={[3, 4, 0.2]} />\r\n                <meshPhysicalMaterial color=\"white\" transmission={0.9} transparent opacity={0.3} side={THREE.DoubleSide} />\r\n            </mesh>\r\n            {/* Solvent at bottom */}\r\n            <mesh position={[0, -2.5, 0]}>\r\n                <boxGeometry args={[2.8, 1, 0.1]} />\r\n                <meshStandardMaterial color=\"#BAE6FD\" opacity={0.6} transparent />\r\n            </mesh>\r\n\r\n            {/* Paper */}\r\n            <group position={[0, 0, 0]}>\r\n                <mesh>\r\n                    <planeGeometry args={[2, 3.5]} />\r\n                    <meshBasicMaterial color=\"white\" />\r\n                </mesh>\r\n\r\n                {/* Start Line */}\r\n                <Line points={[[-0.8, -1.5, 0.01], [0.8, -1.5, 0.01]]} color=\"gray\" />\r\n\r\n                {/* Ink Spots Moving */}\r\n                {/* Green Spot = Blue + Yellow */}\r\n                <mesh position={[-0.5, -1.5 + hBlue, 0.02]}>\r\n                    <circleGeometry args={[0.1]} />\r\n                    <meshBasicMaterial color=\"cyan\" opacity={0.6} transparent />\r\n                </mesh>\r\n                <mesh position={[-0.5, -1.5 + hYellow, 0.02]}>\r\n                    <circleGeometry args={[0.1]} />\r\n                    <meshBasicMaterial color=\"yellow\" opacity={0.6} transparent />\r\n                </mesh>\r\n\r\n                {/* Purple Spot = Blue + Red */}\r\n                <mesh position={[0.5, -1.5 + hBlue, 0.02]}>\r\n                    <circleGeometry args={[0.1]} />\r\n                    <meshBasicMaterial color=\"cyan\" opacity={0.6} transparent />\r\n                </mesh>\r\n                <mesh position={[0.5, -1.5 + hRed, 0.02]}>\r\n                    <circleGeometry args={[0.1]} />\r\n                    <meshBasicMaterial color=\"magenta\" opacity={0.6} transparent />\r\n                </mesh>\r\n            </group>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒÄ¿ Chromatographie (CCM)\" className=\"w-[300px]\" defaultPosition=\"top-right\">\r\n                    <div className=\"space-y-4 text-white\">\r\n                        <p className=\"text-sm\">S├®paration des colorants d'un feutre vert et violet.</p>\r\n\r\n                        <div className=\"flex justify-center\">\r\n                            <button\r\n                                onClick={() => { setIsRunning(true); if (progress >= 1) setProgress(0); }}\r\n                                className=\"bg-blue-600 hover:bg-blue-500 px-6 py-2 rounded-xl font-bold transition-all\"\r\n                            >\r\n                                {progress >= 1 ? 'Recommencer ­ƒöä' : isRunning ? 'En cours...' : 'D├®marrer l\\'├®lution ­ƒÆº'}\r\n                            </button>\r\n                        </div>\r\n\r\n                        {progress > 0.5 && (\r\n                            <div className=\"bg-gray-800 p-2 rounded text-xs animate-in fade-in\">\r\n                                <p>Observation :</p>\r\n                                <ul className=\"list-disc ml-4 mt-1\">\r\n                                    <li><span className=\"text-green-400\">Vert</span> = Jaune (lent) + Cyan (rapide)</li>\r\n                                    <li><span className=\"text-purple-400\">Violet</span> = Magenta (moyen) + Cyan (rapide)</li>\r\n                                </ul>\r\n                                <p className=\"mt-2 text-gray-400\">Chaque esp├¿ce chimique migre ├á une vitesse diff├®rente (Rf).</p>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n        </group>\r\n    );\r\n}\r\n\r\n// =========================================================\r\n// 13. IDENTIFICATION IONS (Tests Chimiques)\r\n// =========================================================\r\nexport function ChemicalIdentification() {\r\n    const [selectedTest, setSelectedTest] = useState(null);\r\n    const [hasDripped, setHasDripped] = useState(false);\r\n\r\n    // Tests data\r\n    const tests = [\r\n        { id: 'AgNO3', name: 'Nitrate d\\'Argent', ion: 'ClÔü╗', result: 'Pr├®cipit├® BLANC', color: 'white' },\r\n        { id: 'NaOH_Cu', name: 'Soude (sur Cu┬▓Ôü║)', ion: 'Cu┬▓Ôü║', result: 'Pr├®cipit├® BLEU', color: 'blue' },\r\n        { id: 'NaOH_Fe2', name: 'Soude (sur Fe┬▓Ôü║)', ion: 'Fe┬▓Ôü║', result: 'Pr├®cipit├® VERT', color: 'green' },\r\n        { id: 'NaOH_Fe3', name: 'Soude (sur Fe┬│Ôü║)', ion: 'Fe┬│Ôü║', result: 'Pr├®cipit├® ROUILLE', color: '#8B4513' },\r\n    ];\r\n\r\n    const currentTest = tests.find(t => t.id === selectedTest);\r\n\r\n    useFrame(() => {\r\n        // Animation logic could go here\r\n    });\r\n\r\n    const runTest = (id) => {\r\n        setSelectedTest(id);\r\n        setHasDripped(false);\r\n        setTimeout(() => setHasDripped(true), 500);\r\n    };\r\n\r\n    return (\r\n        <group>\r\n            <ambientLight intensity={0.8} />\r\n\r\n            {/* Tube ├á essai */}\r\n            <mesh position={[0, -1, 0]}>\r\n                <cylinderGeometry args={[0.5, 0.5, 3, 32, 1, true]} />\r\n                <meshPhysicalMaterial color=\"#EEE\" transmission={0.9} transparent opacity={0.4} side={THREE.DoubleSide} />\r\n            </mesh>\r\n            {/* Liquid Initial */}\r\n            <mesh position={[0, -1.8, 0]}>\r\n                <cylinderGeometry args={[0.45, 0.45, 1.2, 32]} />\r\n                <meshStandardMaterial color={currentTest ? (currentTest.id.includes('Cu') ? '#BFDBFE' : '#F3F4F6') : '#F3F4F6'} transparent opacity={0.6} />\r\n            </mesh>\r\n\r\n            {/* Precipitate appearing */}\r\n            {hasDripped && currentTest && (\r\n                <group position={[0, -2, 0]}>\r\n                    {/* Cloud of particles */}\r\n                    <mesh>\r\n                        <dodecahedronGeometry args={[0.4, 0]} />\r\n                        <meshStandardMaterial color={currentTest.color} roughness={0.8} />\r\n                    </mesh>\r\n                </group>\r\n            )}\r\n\r\n            {/* Pipette */}\r\n            <group position={[0, 1.5, 0]} rotation={[0, 0, Math.PI / 6]}>\r\n                <mesh>\r\n                    <cylinderGeometry args={[0.1, 0.1, 2]} />\r\n                    <meshStandardMaterial color=\"#AAA\" transparent opacity={0.5} />\r\n                </mesh>\r\n                {/* Drop */}\r\n                <mesh position={[0, -1.1, 0]}>\r\n                    <sphereGeometry args={[0.15]} />\r\n                    <meshStandardMaterial color=\"white\" />\r\n                </mesh>\r\n            </group>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒº¬ Identification des Ions\" className=\"w-[320px]\" defaultPosition=\"bottom-right\">\r\n                    <div className=\"space-y-4 text-white\">\r\n                        <div className=\"grid grid-cols-2 gap-2\">\r\n                            {tests.map(t => (\r\n                                <button\r\n                                    key={t.id}\r\n                                    onClick={() => runTest(t.id)}\r\n                                    className={`text-xs p-2 rounded border transition-all ${selectedTest === t.id ? 'bg-blue-600 border-blue-400' : 'bg-gray-800 border-gray-600 hover:bg-gray-700'}`}\r\n                                >\r\n                                    {t.name}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n\r\n                        {hasDripped && currentTest && (\r\n                            <div className=\"bg-gray-900 p-3 rounded-xl border border-white/20 animate-in zoom-in duration-300\">\r\n                                <div className=\"text-center font-bold text-lg mb-1\" style={{ color: currentTest.color === 'white' ? 'white' : currentTest.color }}>\r\n                                    {currentTest.result}\r\n                                </div>\r\n                                <div className=\"text-center text-sm text-gray-400\">\r\n                                    Cela prouve la pr├®sence de l'ion <span className=\"font-bold text-white\">{currentTest.ion}</span>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                        {!selectedTest && (\r\n                            <div className=\"text-center text-gray-500 text-sm\">\r\n                                S├®lectionne un r├®actif pour tester la r├®action.\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n        </group>\r\n    );\r\n}\r\n\r\n// =========================================================\r\n// 14. SONAR (Echolocation)\r\n// =========================================================\r\nexport function SonarEcholocation() {\r\n    const [depth, setDepth] = useState(500); // meters\r\n    const [pinging, setPinging] = useState(false);\r\n    const [time, setTime] = useState(0);\r\n\r\n    // Speed of sound in water approx 1500 m/s\r\n    const V_SOUND = 1500;\r\n    const realTime = (2 * depth) / V_SOUND; // Round trip\r\n\r\n    useEffect(() => {\r\n        if (pinging) {\r\n            let start = Date.now();\r\n            const interval = setInterval(() => {\r\n                const elapsed = (Date.now() - start) / 1000; // simulated speedup\r\n                // Let's multiply elapsed by 1000 to make it observable in seconds on screen if we want real physics math?\r\n                // Actually let's just animate a progress bar.\r\n                if (elapsed >= (realTime / 1000)) { // Scale time for UX (1500m/s is fast, 500m takes 0.6s)\r\n                    // Let's slow down the simulation 10x\r\n                }\r\n            }, 16);\r\n\r\n            // Simpler: Just CSS animation key\r\n            setTimeout(() => {\r\n                setTime(realTime);\r\n                setPinging(false);\r\n            }, 1500); // Fixed visual duration\r\n        }\r\n    }, [pinging]);\r\n\r\n    return (\r\n        <group>\r\n            <ambientLight intensity={0.5} />\r\n            <color attach=\"background\" args={['#001030']} />\r\n            <Fog />\r\n\r\n            {/* Boat */}\r\n            <group position={[0, 4, 0]}>\r\n                <mesh>\r\n                    <boxGeometry args={[2, 1, 4]} />\r\n                    <meshStandardMaterial color=\"gray\" />\r\n                </mesh>\r\n            </group>\r\n\r\n            {/* Sea Surface */}\r\n            <mesh position={[0, 3.5, 0]} rotation={[-Math.PI / 2, 0, 0]}>\r\n                <planeGeometry args={[50, 50]} />\r\n                <meshStandardMaterial color=\"#1E3A8A\" transparent opacity={0.5} />\r\n            </mesh>\r\n\r\n            {/* Sea Floor */}\r\n            <mesh position={[0, 4 - (depth / 100), 0]} rotation={[-Math.PI / 2, 0, 0]}>\r\n                <planeGeometry args={[50, 50, 32, 32]} />\r\n                <meshStandardMaterial color=\"#000000\" wireframe />\r\n            </mesh>\r\n            <Text position={[0, 4 - (depth / 100) + 1, 0]} color=\"white\" fontSize={0.5}>Fond Marin</Text>\r\n\r\n            {/* Ping Wave Visual */}\r\n            {pinging && (\r\n                <PingWave startY={3.5} endY={4 - (depth / 100)} duration={1.5} />\r\n            )}\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"­ƒªç Sonar & ├ëcholocation\" className=\"w-[300px]\" defaultPosition=\"bottom-right\">\r\n                    <div className=\"space-y-4 text-white\">\r\n                        <div>\r\n                            <label className=\"text-xs text-blue-300\">Profondeur r├®elle (m)</label>\r\n                            <input\r\n                                type=\"range\" min=\"100\" max=\"1000\" step=\"10\"\r\n                                value={depth} onChange={(e) => setDepth(Number(e.target.value))}\r\n                                className=\"w-full h-1 bg-gray-700 rounded accent-blue-500\"\r\n                            />\r\n                            <div className=\"text-right\">{depth} m</div>\r\n                        </div>\r\n\r\n                        <button\r\n                            onClick={() => { setPinging(true); setTime(0); }}\r\n                            disabled={pinging}\r\n                            className=\"w-full py-3 rounded-xl bg-green-600 font-bold hover:bg-green-500 disabled:opacity-50\"\r\n                        >\r\n                            {pinging ? '­ƒôí Mesure en cours...' : 'Envoyer PING'}\r\n                        </button>\r\n\r\n                        <div className=\"bg-black/50 p-3 rounded font-mono text-sm\">\r\n                            <div>v (son) = {V_SOUND} m/s</div>\r\n                            <div className=\"mt-2 text-gray-400\">Temps ├®cho (t) :</div>\r\n                            <div className=\"text-xl text-yellow-400 font-bold\">\r\n                                {time > 0 ? time.toFixed(4) : '--'} s\r\n                            </div>\r\n                            <div className=\"mt-2 border-t border-gray-700 pt-1 text-xs\">\r\n                                d = (v ├ù t) / 2 = <span className=\"text-green-400 font-bold\">{time > 0 ? ((V_SOUND * time) / 2).toFixed(0) : '?'} m</span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n        </group>\r\n    );\r\n}\r\n\r\nfunction PingWave({ startY, endY, duration }) {\r\n    const ref = useRef();\r\n    useFrame(({ clock }) => {\r\n        // Simple scaling ring\r\n    });\r\n    return (\r\n        <mesh position={[0, (startY + endY) / 2, 0]}>\r\n            <cylinderGeometry args={[0.1, 0.1, Math.abs(startY - endY), 8]} />\r\n            <meshBasicMaterial color=\"yellow\" transparent opacity={0.5} />\r\n        </mesh>\r\n    )\r\n}\r\n\r\nfunction Fog() {\r\n    return <fog attach=\"fog\" args={['#001030', 5, 30]} />\r\n}\r\n\r\n// =========================================================\r\n// 15. PUISSANCE & ├ëNERGIE (PowerLifter)\r\n// =========================================================\r\nexport function PowerLifter() {\r\n    const [mass, setMass] = useState(50); // kg\r\n    const [height, setHeight] = useState(2); // m\r\n    const [time, setTime] = useState(2); // seconds\r\n\r\n    const energy = mass * 9.8 * height; // E = mgh\r\n    const power = energy / time; // P = E/t\r\n\r\n    const [lifting, setLifting] = useState(false);\r\n    const weightRef = useRef();\r\n\r\n    useFrame(({ clock }) => {\r\n        if (lifting && weightRef.current) {\r\n            // Animate lifting\r\n            // Simple interp\r\n        }\r\n    });\r\n\r\n    return (\r\n        <group>\r\n            <ambientLight intensity={0.8} />\r\n\r\n            {/* Floor */}\r\n            <mesh position={[0, -0.1, 0]} rotation={[-Math.PI / 2, 0, 0]}>\r\n                <planeGeometry args={[10, 10]} />\r\n                <meshStandardMaterial color=\"#333\" />\r\n            </mesh>\r\n\r\n            {/* Weight */}\r\n            <group ref={weightRef} position={[0, lifting ? height : 0.4, 0]}>\r\n                <mesh>\r\n                    <boxGeometry args={[1, 0.8, 1]} />\r\n                    <meshStandardMaterial color=\"#444\" />\r\n                </mesh>\r\n                <Text position={[0, 0, 0.6]} fontSize={0.3}>\r\n                    {mass} kg\r\n                </Text>\r\n            </group>\r\n\r\n            {/* Target Height Marker */}\r\n            <mesh position={[2, height, 0]}>\r\n                <boxGeometry args={[1, 0.05, 1]} />\r\n                <meshBasicMaterial color=\"red\" />\r\n            </mesh>\r\n            <Text position={[2, height + 0.5, 0]} color=\"red\">{height} m</Text>\r\n\r\n            <Html transform={false}>\r\n                <DraggableHtmlPanel title=\"ÔÜí Puissance & ├ënergie\" className=\"w-[300px]\" defaultPosition=\"bottom-left\">\r\n                    <div className=\"space-y-4 text-white\">\r\n                        <div className=\"text-xs space-y-2\">\r\n                            <div>\r\n                                <label>Masse (m)</label>\r\n                                <input type=\"range\" min=\"10\" max=\"100\" value={mass} onChange={e => setMass(Number(e.target.value))} className=\"w-full h-1 bg-gray-700 rounded\" />\r\n                            </div>\r\n                            <div>\r\n                                <label>Hauteur (h)</label>\r\n                                <input type=\"range\" min=\"1\" max=\"5\" step=\"0.5\" value={height} onChange={e => setHeight(Number(e.target.value))} className=\"w-full h-1 bg-gray-700 rounded\" />\r\n                            </div>\r\n                            <div>\r\n                                <label>Temps du soulev├® (t)</label>\r\n                                <input type=\"range\" min=\"0.5\" max=\"5\" step=\"0.5\" value={time} onChange={e => setTime(Number(e.target.value))} className=\"w-full h-1 bg-gray-700 rounded\" />\r\n                                <div className=\"text-right text-gray-400\">{time} s</div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <button\r\n                            onClick={() => { setLifting(false); setTimeout(() => setLifting(true), 100); }}\r\n                            className=\"w-full bg-red-600 hover:bg-red-500 py-2 rounded font-bold\"\r\n                        >\r\n                            ­ƒÅï´©Å Soulever\r\n                        </button>\r\n\r\n                        <div className=\"grid grid-cols-2 gap-2 text-center text-sm\">\r\n                            <div className=\"bg-gray-800 p-2 rounded\">\r\n                                <div className=\"text-gray-400 text-xs\">├ënergie (W = mgh)</div>\r\n                                <div className=\"font-bold text-yellow-400\">{energy.toFixed(0)} J</div>\r\n                            </div>\r\n                            <div className=\"bg-gray-800 p-2 rounded\">\r\n                                <div className=\"text-gray-400 text-xs\">Puissance (P = W/t)</div>\r\n                                <div className=\"font-bold text-green-400\">{power.toFixed(0)} Watt</div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </DraggableHtmlPanel>\r\n            </Html>\r\n        </group>\r\n    );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\Simulation3D.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\SimulationControlsContext.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\ThreeBackground.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Jules Sambou\\Desktop\\SymLab\\src\\components\\VirtualChemLab.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
